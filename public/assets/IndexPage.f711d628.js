import{Q as le}from"./QSpace.f345c4e6.js";import{Q as ne}from"./QToggle.d387ccdf.js";import{v as A,h as c,x as N,r as P,c as _,_ as H,ah as ie,aS as ue,g as M,y as L,i as se,b5 as de,b8 as ee,H as ce,N as pe,ai as me,j as te,m as ve,M as fe,p as T,k as B,l as r,d as t,u as F,ap as W,b2 as z,q as k,t as R,aj as j,X as U,b9 as _e,o as be,w as ge,V as qe,s as Se}from"./index.e81fb1fc.js";import{l as Pe,Q as re}from"./layout.002d03c4.js";import{a as ye,Q as K}from"./QTable.877f6a43.js";import{Q as he}from"./QSlideTransition.a3bf0a09.js";import{u as Ce,a as xe,b as we,c as Fe}from"./use-panel.2cf0d918.js";import{u as Qe}from"./ClosePopup.6338225d.js";import{Q as Ve}from"./QCard.9dedbb2b.js";import{u as Ie,a as De}from"./use-dark.9dc9ea9d.js";import{Q as Re}from"./QPage.8984cb37.js";import{T as Oe}from"./TablePage.ed214491.js";import{P as Ue,u as ke,a as Te,b as Be}from"./usePurchaseOrders.e1747d18.js";import{Q as O,a as D,b as E}from"./QItemLabel.dd0d0c24.js";import{Q as G}from"./QSelect.f9a905e8.js";import{Q as $e}from"./QFile.b0d7dd09.js";import{Q as Ee}from"./QList.c2fb8b2a.js";import{Q as Ne}from"./QCardSection.a8afd0fa.js";import{a as Ae}from"./format.5a4585ee.js";import{Q as Le}from"./QCardActions.4c711164.js";import{c as X}from"./index.7adaf3a2.js";import{e as Ke}from"./useRequisitions.844a4f0a.js";import{_ as je}from"./DatePicker.43c6b027.js";import{Q as He}from"./QForm.1f8f3bc3.js";import{u as Me}from"./useSubBudgets.e9d4364e.js";import{_ as We}from"./CardDialog.95418859.js";import{F as ze}from"./FilePreview.debddd79.js";import{_ as Ge}from"./DeleteCardDialog.7a8bd754.js";import"./QCheckbox.4b3f9cbd.js";import"./planeacion.api.ea428453.js";import"./index.2cf0d985.js";import"./scroll.e271a657.js";import"./touch.70a9dd44.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./QChip.349b418c.js";import"./utils.esm.db18b7fe.js";import"./useMutation.esm.f7013444.js";import"./mutation.esm.fb605c8f.js";import"./QPopupProxy.75399885.js";import"./date.eb50e543.js";import"./MyCardTitle.9ccc1ed9.js";import"./QTooltip.4fedd4bd.js";import"./QImg.7f40ff77.js";import"./QBanner.2379f02e.js";var J=A({name:"QStepperNavigation",setup(e,{slots:s}){return()=>c("div",{class:"q-stepper__nav"},N(s.default))}}),ae=A({name:"StepHeader",props:{stepper:{},step:{},goToPanel:Function},setup(e,{attrs:s}){const{proxy:{$q:p}}=M(),m=P(null),o=_(()=>e.stepper.modelValue===e.step.name),q=_(()=>{const a=e.step.disable;return a===!0||a===""}),y=_(()=>{const a=e.step.error;return a===!0||a===""}),v=_(()=>{const a=e.step.done;return q.value===!1&&(a===!0||a==="")}),b=_(()=>{const a=e.step.headerNav,l=a===!0||a===""||a===void 0;return q.value===!1&&e.stepper.headerNav&&l}),w=_(()=>e.step.prefix&&(o.value===!1||e.stepper.activeIcon==="none")&&(y.value===!1||e.stepper.errorIcon==="none")&&(v.value===!1||e.stepper.doneIcon==="none")),h=_(()=>{const a=e.step.icon||e.stepper.inactiveIcon;if(o.value===!0){const l=e.step.activeIcon||e.stepper.activeIcon;return l==="none"?a:l||p.iconSet.stepper.active}if(y.value===!0){const l=e.step.errorIcon||e.stepper.errorIcon;return l==="none"?a:l||p.iconSet.stepper.error}if(q.value===!1&&v.value===!0){const l=e.step.doneIcon||e.stepper.doneIcon;return l==="none"?a:l||p.iconSet.stepper.done}return a}),d=_(()=>{const a=y.value===!0?e.step.errorColor||e.stepper.errorColor:void 0;if(o.value===!0){const l=e.step.activeColor||e.stepper.activeColor||e.step.color;return l!==void 0?l:a}return a!==void 0?a:q.value===!1&&v.value===!0?e.step.doneColor||e.stepper.doneColor||e.step.color||e.stepper.inactiveColor:e.step.color||e.stepper.inactiveColor}),C=_(()=>"q-stepper__tab col-grow flex items-center no-wrap relative-position"+(d.value!==void 0?` text-${d.value}`:"")+(y.value===!0?" q-stepper__tab--error q-stepper__tab--error-with-"+(w.value===!0?"prefix":"icon"):"")+(o.value===!0?" q-stepper__tab--active":"")+(v.value===!0?" q-stepper__tab--done":"")+(b.value===!0?" q-stepper__tab--navigation q-focusable q-hoverable":"")+(q.value===!0?" q-stepper__tab--disabled":"")),f=_(()=>e.stepper.headerNav!==!0?!1:b.value);function x(){m.value!==null&&m.value.focus(),o.value===!1&&e.goToPanel(e.step.name)}function V(a){a.keyCode===13&&o.value===!1&&e.goToPanel(e.step.name)}return()=>{const a={class:C.value};b.value===!0&&(a.onClick=x,a.onKeyup=V,Object.assign(a,q.value===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:s.tabindex||0}));const l=[c("div",{class:"q-focus-helper",tabindex:-1,ref:m}),c("div",{class:"q-stepper__dot row flex-center q-stepper__line relative-position"},[c("span",{class:"row flex-center"},[w.value===!0?e.step.prefix:c(H,{name:h.value})])])];if(e.step.title!==void 0&&e.step.title!==null){const I=[c("div",{class:"q-stepper__title"},e.step.title)];e.step.caption!==void 0&&e.step.caption!==null&&I.push(c("div",{class:"q-stepper__caption"},e.step.caption)),l.push(c("div",{class:"q-stepper__label q-stepper__line relative-position"},I))}return ie(c("div",a,l),[[ue,f.value]])}}});function oe(e){return c("div",{class:"q-stepper__step-content"},[c("div",{class:"q-stepper__step-inner"},N(e.default))])}const Y={setup(e,{slots:s}){return()=>oe(s)}};var Z=A({name:"QStep",props:{...Ce,icon:String,color:String,title:{type:String,required:!0},caption:String,prefix:[String,Number],doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String,headerNav:{type:Boolean,default:!0},done:Boolean,error:Boolean,onScroll:[Function,Array]},setup(e,{slots:s,emit:p}){const{proxy:{$q:m}}=M(),o=se(ee,L);if(o===L)return console.error("QStep needs to be a child of QStepper"),L;const{getCacheWithFn:q}=Qe(),y=P(null),v=_(()=>o.value.modelValue===e.name),b=_(()=>m.platform.is.ios!==!0&&m.platform.is.chrome===!0||v.value!==!0||o.value.vertical!==!0?{}:{onScroll(d){const{target:C}=d;C.scrollTop>0&&(C.scrollTop=0),e.onScroll!==void 0&&p("scroll",d)}}),w=_(()=>typeof e.name=="string"||typeof e.name=="number"?e.name:String(e.name));function h(){const d=o.value.vertical;return d===!0&&o.value.keepAlive===!0?c(de,o.value.keepAliveProps.value,v.value===!0?[c(o.value.needsUniqueKeepAliveWrapper.value===!0?q(w.value,()=>({...Y,name:w.value})):Y,{key:w.value},s.default)]:void 0):d!==!0||v.value===!0?oe(s):void 0}return()=>c("div",{ref:y,class:"q-stepper__step",role:"tabpanel",...b.value},o.value.vertical===!0?[c(ae,{stepper:o.value,step:e,goToPanel:o.value.goToPanel}),o.value.animated===!0?c(he,h):h()]:[h()])}});const Xe=/(-\w)/g;function Je(e){const s={};for(const p in e){const m=p.replace(Xe,o=>o[1].toUpperCase());s[m]=e[p]}return s}var Ye=A({name:"QStepper",props:{...Ie,...xe,flat:Boolean,bordered:Boolean,alternativeLabels:Boolean,headerNav:Boolean,contracted:Boolean,headerClass:String,inactiveColor:String,inactiveIcon:String,doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String},emits:we,setup(e,{slots:s}){const p=M(),m=De(e,p.proxy.$q),{updatePanelsList:o,isValidPanelName:q,updatePanelIndex:y,getPanelContent:v,getPanels:b,panelDirectives:w,goToPanel:h,keepAliveProps:d,needsUniqueKeepAliveWrapper:C}=Fe();ce(ee,_(()=>({goToPanel:h,keepAliveProps:d,needsUniqueKeepAliveWrapper:C,...e})));const f=_(()=>`q-stepper q-stepper--${e.vertical===!0?"vertical":"horizontal"}`+(e.flat===!0?" q-stepper--flat":"")+(e.bordered===!0?" q-stepper--bordered":"")+(m.value===!0?" q-stepper--dark q-dark":"")),x=_(()=>`q-stepper__header row items-stretch justify-between q-stepper__header--${e.alternativeLabels===!0?"alternative":"standard"}-labels`+(e.flat===!1||e.bordered===!0?" q-stepper__header--border":"")+(e.contracted===!0?" q-stepper__header--contracted":"")+(e.headerClass!==void 0?` ${e.headerClass}`:""));function V(){const a=N(s.message,[]);if(e.vertical===!0){q(e.modelValue)&&y();const l=c("div",{class:"q-stepper__content"},N(s.default));return a===void 0?[l]:a.concat(l)}return[c("div",{class:x.value},b().map(l=>{const I=Je(l.props);return c(ae,{key:I.name,stepper:e,step:I,goToPanel:h})})),a,me("div",{class:"q-stepper__content q-panel-parent"},v(),"cont",e.swipeable,()=>w.value)]}return()=>(o(s),c("div",{class:f.value},pe(s.navigation,V())))}});const Ze=()=>{const e=P(),s=P(!1);return{isLoading:s,fileToUpload:e,uploadFile:async m=>{if(!e.value)throw new Error("No hay archivo para cargar");s.value=!0;const o=await m(e.value);return s.value=!1,Pe.showSuccessNotification("Archivo subido con \xE9xito"),e.value=void 0,o}}},et=()=>{const{fileToUpload:e,isLoading:s,uploadFile:p}=Ze();return{fileToUpload:e,isLoading:s,uploadRequisitionFile:async o=>await p(async y=>{const v=new FormData;v.append("file",y);const{data:b}=await Ue.uploadFile(o,v);return b.file_name})}},tt=te({__name:"PurchaseOrderForm",props:{purchaseOrder:{default:()=>({order_number:null,reception_date:new Date().toISOString().substring(0,10),requisition_id:null})}},setup(e){const s=e,p=ve(),m=P(p.query.fromSubBudgets==="true"),{uploadRequisitionFile:o,fileToUpload:q,isLoading:y}=et(),{requisitionsDictionary:v}=Ke(),{subBudgetReqDictionary:b}=Me(),{createPurchaseOrder:w,purchaseOrder:h,purchaseOrderType:d}=ke({fromSubBudgets:m}),C={order_number:null,reception_date:new Date().toISOString().substring(0,10),requisition_id:null},f=fe(X(s.purchaseOrder)||X(C)),x={order_number:[Q=>!!Q||"El n\xFAmero de orden de compra es requerido",Q=>!isNaN(Number(Q))||"El n\xFAmero de orden de compra debe ser un n\xFAmero"],reception_date:[Q=>!!Q||"La fecha de recepci\xF3n es requerida"],requisition_id:[Q=>!!Q||"La requisici\xF3n es requerida"]},V=P(),a=P(null),l=P();async function I(){var S,n,g,i;await((S=V.value)==null?void 0:S.validate())&&(await w({requisition_id:(n=a.value)==null?void 0:n.id,order_number:f.order_number,reception_date:f.reception_date}),l.value?(q.value=l.value,await o(h.value.id),(g=V.value)==null||g.reset()):(i=V.value)==null||i.reset())}function $(){f.order_number=null,f.reception_date=new Date().toISOString().substring(0,10),f.requisition_id=null,a.value=null,l.value=void 0}return(Q,S)=>(T(),B(F(He),{ref_key:"qPurchaseOrderForm",ref:V,onReset:$,onSubmit:_e(I,["prevent"])},{default:r(()=>[t(Ne,null,{default:r(()=>[t(Ee,null,{default:r(()=>[t(O,null,{default:r(()=>[t(D,null,{default:r(()=>[t(re,{modelValue:f.order_number,"onUpdate:modelValue":S[0]||(S[0]=n=>f.order_number=n),dense:"",label:"N\xFAmero de orden de compra",outlined:"",rules:x.order_number},null,8,["modelValue","rules"])]),_:1})]),_:1}),t(O,null,{default:r(()=>[t(D,null,{default:r(()=>[t(je,{modelValue:f.reception_date,"onUpdate:modelValue":S[1]||(S[1]=n=>f.reception_date=n),rules:x.reception_date},null,8,["modelValue","rules"])]),_:1})]),_:1}),t(O,null,{default:r(()=>[F(d)==="PRESUPUESTO"?(T(),B(D,{key:0},{default:r(()=>[t(G,{modelValue:a.value,"onUpdate:modelValue":S[2]||(S[2]=n=>a.value=n),dense:"",label:"Requisici\xF3n","option-label":n=>`Requisici\xF3n #${n.requisition_number} - ${n.area_description}`,"option-value":"id",options:F(v),outlined:"",rules:x.requisition_id},{option:r(n=>[t(O,W(z(n.itemProps)),{default:r(()=>[t(D,null,{default:r(()=>[t(E,null,{default:r(()=>[k("Requisici\xF3n #"+R(n.opt.requisition_number),1)]),_:2},1024),t(E,{caption:""},{default:r(()=>[k(R(n.opt.area_description),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","option-label","options","rules"])]),_:1})):j("",!0),F(d)==="SUBPRESUPUESTO"?(T(),B(D,{key:1},{default:r(()=>[t(G,{modelValue:a.value,"onUpdate:modelValue":S[3]||(S[3]=n=>a.value=n),dense:"",label:"Requisici\xF3n","option-label":n=>`Requisici\xF3n #${n.requisition_number} - ${n.event}`,"option-value":"id",options:F(b),outlined:"",rules:x.requisition_id},{option:r(n=>[t(O,W(z(n.itemProps)),{default:r(()=>[t(D,null,{default:r(()=>[t(E,null,{default:r(()=>[k("Requisici\xF3n #"+R(n.opt.requisition_number),1)]),_:2},1024),t(E,{caption:""},{default:r(()=>[k(R(n.opt.area_description)+" "+R(n.opt.event),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","option-label","options","rules"])]),_:1})):j("",!0)]),_:1}),t(O,null,{default:r(()=>[t(D,null,{default:r(()=>[t($e,{modelValue:l.value,"onUpdate:modelValue":S[4]||(S[4]=n=>l.value=n),accept:".jpg, image/*, application/pdf",dense:"",label:"Haga click para subir el archivo o arrastralo aqu\xED",loading:F(y),outlined:"","use-chips":""},{prepend:r(()=>[t(H,{name:"attach_file"})]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(Ae),t(Le,{align:"right"},{default:r(()=>[t(U,{color:"primary",label:"Guardar",type:"submit",unelevated:""})]),_:1})]),_:1},8,["onSubmit"]))}});const rt={class:"q-table__title"},zt=te({__name:"IndexPage",setup(e){const s="https://nestjs-boilerplate-production.up.railway.app",p=qe(),m=p.currentRoute.value,o=P(m.query.fromSubBudgets==="true"),{isLoading:q,isFetching:y,orders:v,purchaseOrderType:b}=Te({fromSubBudgets:o}),w=[{name:"consecutiveId",label:"ID",field:"consecutiveId",sortable:!1,required:!0},{name:"area",field:g=>{var i,u;return(u=(i=g.requisition)==null?void 0:i.area)==null?void 0:u.name},label:"Departamento",sortable:!0,align:"left"},{name:"event",field:"event",label:"Evento",sortable:!1,align:"left"},{name:"order_number",field:"order_number",label:"N\xFAmero de orden de compra",align:"center",sortable:!0},{name:"reception_date",field:"reception_date",label:"Fecha de recepci\xF3n",sortable:!0,align:"left"},{name:"requisition",field:g=>{var i;return(i=g.requisition)==null?void 0:i.requisition_number},label:"Requisici\xF3n",sortable:!0,align:"center"},{name:"file",field:"file",label:"Archivo",sortable:!1,align:"left"},{name:"actions",field:"actions",label:"Acciones",sortable:!1,align:"center"}],h=P(!1),d=P(1),C=P(["area","order_number","reception_date","requisition","file","actions"]),f=P(""),x=P(!1),{deletePurchaseOrder:V,isDeleteingPurchaseOrder:a}=Be({fromSubBudgets:o}),l=P(void 0);be(()=>{o.value&&C.value.splice(1,0,"event")}),ge(o,g=>{p.replace({query:{...m.query,fromSubBudgets:g.toString()}}),g?C.value.splice(1,0,"event"):C.value.splice(1,1)});const I=_(()=>b.value===""?"Selecciona un tipo de orden de compra":b.value==="PRESUPUESTO"?"Presupuesto":"SubPresupuesto");function $(g){b.value=g,d.value=2}function Q(g){l.value=g,x.value=!0}async function S(){const g=o.value?"RequisitionSubBudgetEntity":"RequisitionEntity";await V({id:l.value,requisitionType:g}),n()}function n(){l.value=void 0,x.value=!1}return(g,i)=>(T(),B(Re,null,{default:r(()=>[t(Oe,null,{"card-body":r(()=>[t(ye,{columns:w,filter:f.value,loading:F(q)||F(y),pagination:{rowsPerPage:20},rows:F(v),"visible-columns":C.value,"wrap-cells":""},{top:r(()=>[Se("div",rt," \xD3rdenes de compra/"+R(o.value?"SubPresupuestos":"Presupuestos"),1),t(le),t(ne,{modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=u=>o.value=u),class:"tw-mr-4",label:"Mostrar las \xF3rdenes de compra de los SubPresupuestos"},null,8,["modelValue"]),t(re,{modelValue:f.value,"onUpdate:modelValue":i[1]||(i[1]=u=>f.value=u),class:"q-mr-xs",clearable:"",debounce:"300",dense:"",outlined:"",placeholder:"Buscar"},{append:r(()=>[t(H,{name:"search"})]),_:1},8,["modelValue"]),t(U,{color:"primary",label:"Nueva orden de compra",onClick:i[2]||(i[2]=u=>h.value=!0)})]),"body-cell-consecutiveId":r(u=>[t(K,{props:u},{default:r(()=>[k(R((u.rowIndex+1).toString()),1)]),_:2},1032,["props"])]),"body-cell-file":r(u=>[t(K,{props:u},{default:r(()=>[u.value?(T(),B(ze,{key:0,"file-url":`${F(s)}/api/files/purchase-orders/${u.row.id}/${u.value}`},null,8,["file-url"])):j("",!0)]),_:2},1032,["props"])]),"body-cell-actions":r(u=>[t(K,{props:u},{default:r(()=>[t(U,{color:"negative",flat:"",icon:"delete",round:"",onClick:at=>Q(u.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["filter","loading","rows","visible-columns"])]),footer:r(()=>[t(We,{modelValue:h.value,"onUpdate:modelValue":i[7]||(i[7]=u=>h.value=u),"card-title":"Orden de Compra",class:"form-purchase-order"},{default:r(()=>[t(Ye,{modelValue:d.value,"onUpdate:modelValue":i[6]||(i[6]=u=>d.value=u),animated:"",color:"primary",vertical:""},{default:r(()=>[t(Z,{done:d.value>1,icon:"settings",name:1,title:"Selecciona un tipo de orden de compra"},{default:r(()=>[t(J,{class:"tw-flex tw-gap-1"},{default:r(()=>[t(U,{color:"primary",label:"Presupuesto",outline:"",onClick:i[3]||(i[3]=u=>$("PRESUPUESTO"))}),t(U,{color:"primary",label:"SubPresupuesto",outline:"",onClick:i[4]||(i[4]=u=>$("SUBPRESUPUESTO"))})]),_:1})]),_:1},8,["done"]),t(Z,{caption:F(I),done:d.value>2,icon:"create_new_folder",name:2,title:"Crear Orden de Compra"},{default:r(()=>[t(Ve,{bordered:"",flat:""},{default:r(()=>[t(tt)]),_:1}),t(J,null,{default:r(()=>[t(U,{color:"primary",flat:"",label:"atr\xE1s",onClick:i[5]||(i[5]=u=>{d.value=1,b.value=""})})]),_:1})]),_:1},8,["caption","done"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),t(Ge,{modelValue:x.value,"onUpdate:modelValue":i[8]||(i[8]=u=>x.value=u),"card-title":"\xBFDesea eliminar la orden de compra?",deleting:F(a),onConfirmDelete:S},null,8,["modelValue","deleting"])]),_:1})]),_:1}))}});export{zt as default};
