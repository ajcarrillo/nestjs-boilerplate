import{j as S,M as N,r as E,c as A,p as q,k as F,l as a,d as e,u as f,s as B,t as I,X as w,aH as D,_ as L,q as $}from"./index.14e8ebb5.js";import{Q as U}from"./QInput.0f74b52d.js";import{Q as z}from"./QBtnGroup.374ee16e.js";import{Q as C,a as K}from"./QTable.4cc72d32.js";import{u as R,a as k,Q as j}from"./QChip.c477ed29.js";import{T as G}from"./TablePage.c82df34f.js";import{Q as g,a as v}from"./QItemLabel.7fed4ad0.js";import{Q as H}from"./QSelect.3bb31b5f.js";import{Q as P}from"./QList.2e5bba7a.js";import{p as Q}from"./planeacion.api.91fa18e5.js";import{l as y}from"./layout.a470fe7f.js";import{u as M}from"./useMutation.esm.fc6ad15c.js";import{c as h}from"./index.7adaf3a2.js";import{Q as X}from"./QForm.4ada3f4b.js";import{C as J}from"./CardForm.508e04c4.js";import"./format.d9f81dde.js";import"./use-dark.e748ccdc.js";import"./scroll.d839d060.js";import"./QCheckbox.cc510596.js";import"./utils.esm.1cc111ad.js";import"./QCard.01814d56.js";import"./QPage.6a9365d9.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./index.2cf0d985.js";import"./mutation.esm.6a2477d4.js";import"./QCardSection.0d056ee7.js";import"./QCardActions.dee82ce4.js";var _={getUsers(){return Q.get("/users")},storeUser(l){return Q.post("/users",l)},updateUser(l,r){return Q.put(`/users/${l}`,r)}};const O=async()=>{const{data:l}=await _.getUsers();return l},W=async l=>{const{data:r}=await _.storeUser(l);return r},Y=async l=>{const{id:r,...d}=l,{data:m}=await _.updateUser(r,d);return m},Z=()=>{const{isLoading:l,isError:r,data:d,error:m}=R({queryKey:["users"],queryFn:O,staleTime:6e5});return{isLoading:l,isError:r,data:d,error:m}},ee=()=>{const l=k();return{userStoreMutations:M({mutationFn:W,onSuccess:()=>{l.invalidateQueries({queryKey:["users"]}),y.showSuccessNotification("Usuario creado con \xE9xito")},onError:()=>{y.showErrorNotification("Error al crear usuario")}})}},ae=()=>{const l=k();return{userUpdateMutations:M({mutationFn:Y,onSuccess:()=>{l.invalidateQueries({queryKey:["users"]}),y.showSuccessNotification("Usuario actualizado con \xE9xito")},onError:()=>{y.showErrorNotification("Error al actualizar usuario")}})}},te=S({__name:"UserForm",props:{user:null},setup(l){const r=l,{userStoreMutations:d}=ee(),{isLoading:m}=d,{userUpdateMutations:c}=ae(),{isLoading:b}=c,V=N({email:"",firstName:"",isActive:!0,lastName:"",roles:[],password:""}),t=N(h(r.user||V)),p=E(),u={email:[o=>!!o||"El email es requerido",o=>/.+@.+\..+/.test(o)||"El email debe ser v\xE1lido"],firstName:[o=>!!o||"El nombre es requerido"],lastName:[o=>!!o||"El apellido es requerido"],password:[o=>!!o||"El password es requerido"],roles:[o=>!!o.length||"Debe seleccionar al menos un rol"]},s=A(()=>r.user&&"id"in r.user),x=A(()=>s.value?"Editar usuario":"Agregar usuario");async function T(){var i,n;!await((i=p.value)==null?void 0:i.validate())||(s.value?await c.mutateAsync(t):(await d.mutateAsync(t),t.email="",t.firstName="",t.isActive=!0,t.lastName="",t.roles=[],t.password="",(n=p.value)==null||n.reset()))}return(o,i)=>(q(),F(J,{title:f(x)},{form:a(()=>[e(f(X),{ref_key:"userForm",ref:p,class:"q-gutter-md"},{default:a(()=>[e(P,null,{default:a(()=>[e(g,null,{default:a(()=>[e(v,null,{default:a(()=>[e(U,{modelValue:t.email,"onUpdate:modelValue":i[0]||(i[0]=n=>t.email=n),dense:"",label:"Email",outlined:"",rules:u.email},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(v,null,{default:a(()=>[e(U,{modelValue:t.firstName,"onUpdate:modelValue":i[1]||(i[1]=n=>t.firstName=n),dense:"",label:"Nombre",outlined:"",rules:u.firstName},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(v,null,{default:a(()=>[e(U,{modelValue:t.lastName,"onUpdate:modelValue":i[2]||(i[2]=n=>t.lastName=n),dense:"",label:"Apellido",outlined:"",rules:u.lastName},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(v,null,{default:a(()=>[e(U,{modelValue:t.password,"onUpdate:modelValue":i[3]||(i[3]=n=>t.password=n),dense:"",label:"Contrase\xF1a",outlined:"",rules:u.password,type:"password"},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(v,null,{default:a(()=>[e(H,{modelValue:t.roles,"onUpdate:modelValue":i[4]||(i[4]=n=>t.roles=n),dense:"",label:"Roles",multiple:"",options:["admin","user"],outlined:"",rules:u.roles},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),B("pre",null,I(t),1)]),_:1},512)]),actions:a(()=>[e(w,{color:"primary",label:"Guardar",loading:f(m)||f(b),onClick:T},null,8,["loading"])]),_:1},8,["title"]))}}),qe=S({__name:"IndexPage",setup(l){const{data:r,isLoading:d}=Z(),m=E(""),c=E(!1);let b=N({email:"",firstName:"",isActive:!0,lastName:"",roles:[],password:""});const V=[{name:"consecutiveId",label:"ID",field:"consecutiveId",sortable:!1},{name:"email",field:"email",label:"Email",sortable:!0,align:"left"},{name:"firstName",field:"firstName",label:"Nombre",sortable:!0,align:"left"},{name:"lastName",field:"lastName",label:"Apellido",sortable:!0,align:"left"},{name:"isActive",field:"isActive",label:"Activo",sortable:!0,align:"left"},{name:"roles",field:p=>p.roles.join(", "),label:"Roles",sortable:!0,align:"left"},{name:"action",align:"center",label:"Acciones",field:"action",sortable:!1}];D(()=>{c.value||(b=N({email:"",firstName:"",isActive:!0,lastName:"",roles:[],password:""}))});function t(p){c.value=!0,b=p}return(p,u)=>(q(),F(G,null,{"card-body":a(()=>[e(K,{columns:V,loading:f(d),"row-key":"id",rows:f(r),"rows-per-page-options":[20,30,40,50],title:"Usuarios"},{"top-right":a(()=>[e(U,{modelValue:m.value,"onUpdate:modelValue":u[0]||(u[0]=s=>m.value=s),class:"q-mr-xs",debounce:"300",dense:"",outlined:"",placeholder:"Search"},{append:a(()=>[e(L,{name:"search"})]),_:1},8,["modelValue"]),e(z,{unelevated:""},{default:a(()=>[e(w,{class:"tw-bg-indigo-900",icon:"add",label:"Nueva Usuario","text-color":"white",onClick:u[1]||(u[1]=s=>c.value=!0)}),e(w,{color:"primary","icon-right":"archive",label:"Exportar CSV"})]),_:1})]),"body-cell-consecutiveId":a(s=>[e(C,{props:s},{default:a(()=>[$(I(s.rowIndex+1),1)]),_:2},1032,["props"])]),"body-cell-action":a(s=>[e(C,{props:s},{default:a(()=>[e(w,{color:"primary",dense:"",flat:"",icon:"edit",rounded:"",size:"sm",onClick:x=>t(s.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["loading","rows"])]),footer:a(()=>[e(j,{modelValue:c.value,"onUpdate:modelValue":u[2]||(u[2]=s=>c.value=s)},{default:a(()=>[e(te,{user:f(b)},null,8,["user"])]),_:1},8,["modelValue"])]),_:1}))}});export{qe as default};
