import{Q as T}from"./QPage.f7e992f7.js";import{_ as X}from"./plugin-vue_export-helper.21dcd24c.js";import{p as _,k as J,l as o,s as l,aR as E,r as f,j as K,N as W,V as Z,c as ee,o as ae,ag as F,d as a,_ as m,u as n,b as te,av as oe,b1 as ie,q as N,t as k,an as A,X as V,ap as D,F as se}from"./index.0b175f01.js";import{a as p,Q as le}from"./QForm.e02b1b3f.js";import{a as re,b as ne,k as C,c as ue}from"./format.bc6b5d0a.js";import{f as de}from"./QSelect.a01fc3f8.js";import{Q as P,a as S,C as M,b as me}from"./ClosePopup.ba470207.js";import{Q as ce}from"./QSpace.c1f9a46e.js";import{R as pe,u as _e,a as fe}from"./useRequisitions.910cf54e.js";import{c as L}from"./index.7adaf3a2.js";import{F as qe}from"./FilePreview.45205163.js";import{l as ve}from"./layout.e5b39b81.js";import{c as be}from"./useAreas.79d8009b.js";const ge={},Fe={class:"q-my-xs q-pt-sm q-ml-md tw-text-2xl tw-font-bold tw-text-slate-700"};function Ve(u,r){return _(),J(T,null,{default:o(()=>[l("h5",Fe,[E(u.$slots,"title")]),E(u.$slots,"body")]),_:3})}var Ke=X(ge,[["render",Ve]]);const xe=()=>{const u=f(),r=f(!1);return{isLoading:r,requisitionFile:u,uploadRequisitionFile:async q=>{const c=new FormData;c.append("file",u.value),r.value=!0;const{data:v}=await pe.uploadFile(q,c);return r.value=!1,ve.showSuccessNotification("Archivo subido con \xE9xito"),u.value=void 0,v.file_name}}},we={class:"row q-gutter-md"},he={class:"col"},ye={class:"row q-gutter-md"},Qe={class:"col"},Re={class:"row q-gutter-md"},Ue={class:"col"},Ee={class:"row q-gutter-md"},Ne={class:"col"},ke={class:"row items-center justify-end"},Ae={class:"col"},De={class:"row items-center justify-end"},Ce={key:0,class:"row q-gutter-md"},Pe={class:"col"},Se={key:0,class:"col"},Me={class:"row q-mt-md"},We=K({__name:"RequisitionForm",props:{requisition:{default:()=>({requisition_number:"",preparation_date:"",processing_date:"",estimated_amount:0,area_id:"",area:null})}},setup(u){const r=u,x="https://nestjs-boilerplate-production.up.railway.app",{uploadRequisitionFile:q,requisitionFile:c,isLoading:v}=xe(),{area:d,filterArea:Y,areasOptions:$}=be(),I={requisition_number:"",preparation_date:"",processing_date:"",estimated_amount:0,area_id:"",area:null},i=W(L(r.requisition)||L(I)),w=f(),{requisitionStoreMutations:h}=_e(),{requisitionUpdateMutations:y}=fe(),{isLoading:j,data:B}=h,{isLoading:H}=y,O=Z(),b={requisition_number:[s=>!!s||"El n\xFAmero de requisici\xF3n es requerido",s=>s.length==3||"El n\xFAmero de requisici\xF3n debe tener 3 d\xEDgitos",s=>!isNaN(Number(s))||"El n\xFAmero de requisici\xF3n debe ser un n\xFAmero"],estimated_amount:[s=>!!s||"El monto estimado es requerido",s=>!isNaN(Number(s))||"El monto estimado debe ser un n\xFAmero"],area_id:[s=>!!s||"El \xE1rea es requerida"]},g=f(),Q=ee(()=>!!r.requisition.id);ae(()=>{r.requisition.area&&(d.value={label:r.requisition.area.alias,full_description:r.requisition.area.description,value:r.requisition.area.id})});async function z(){var t,e,R,U;!await((t=w.value)==null?void 0:t.validate())||(Q.value?await y.mutateAsync({...i,area_id:(U=d.value)==null?void 0:U.value}):(await h.mutateAsync({...i,area_id:(e=d.value)==null?void 0:e.value}),await O.push({name:"requisitions.edit",params:{id:(R=B.value)==null?void 0:R.id}})))}async function G(s){c.value=s,i.file=await q(r.requisition.id),g.value=void 0}return(s,t)=>(_(),F(se,null,[a(n(le),{ref_key:"qRequisitionForm",ref:w,class:"q-pb-md"},{default:o(()=>[l("div",we,[l("div",he,[a(p,{modelValue:i.requisition_number,"onUpdate:modelValue":t[0]||(t[0]=e=>i.requisition_number=e),"bg-color":"white",counter:"",dense:"",label:"N\xFAmero de requisici\xF3n",maxlength:"3",outlined:"",rules:b.requisition_number},{prepend:o(()=>[a(m,{name:"tag"})]),_:1},8,["modelValue","rules"])])]),l("div",ye,[l("div",Qe,[a(de,{modelValue:n(d),"onUpdate:modelValue":t[1]||(t[1]=e=>te(d)?d.value=e:null),"bg-color":"white",dense:"","input-debounce":"0",label:"Departamentos",options:n($),outlined:"",rules:b.area_id,"use-input":"",onFilter:n(Y)},{option:o(e=>[a(re,oe(ie(e.itemProps)),{default:o(()=>[a(ne,null,{default:o(()=>[a(C,null,{default:o(()=>[N(k(e.opt.full_description),1)]),_:2},1024),a(C,{caption:""},{default:o(()=>[N(k(e.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules","onFilter"])])]),l("div",Re,[l("div",Ue,[a(p,{modelValue:i.estimated_amount,"onUpdate:modelValue":t[2]||(t[2]=e=>i.estimated_amount=e),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Monto estimado",outlined:"",rules:b.estimated_amount,type:"number"},{prepend:o(()=>[a(m,{name:"attach_money"})]),_:1},8,["modelValue","rules"])])]),l("div",Ee,[l("div",Ne,[a(p,{modelValue:i.preparation_date,"onUpdate:modelValue":t[4]||(t[4]=e=>i.preparation_date=e),dense:"",label:"Fecha de elaboraci\xF3n",outlined:"",rules:[e=>!!e||"La fecha de elaboraci\xF3n es requerida"]},{append:o(()=>[a(m,{class:"cursor-pointer",name:"event"},{default:o(()=>[a(P,{cover:"","transition-hide":"scale","transition-show":"scale"},{default:o(()=>[a(S,{modelValue:i.preparation_date,"onUpdate:modelValue":t[3]||(t[3]=e=>i.preparation_date=e),mask:"YYYY-MM-DD"},{default:o(()=>[l("div",ke,[A(a(V,{color:"primary",flat:"",label:"Close"},null,512),[[M]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])]),l("div",Ae,[a(p,{modelValue:i.processing_date,"onUpdate:modelValue":t[6]||(t[6]=e=>i.processing_date=e),dense:"",label:"Fecha de tr\xE1mite",outlined:"",rules:[e=>!!e||"La fecha de tr\xE1mite es requerida"]},{append:o(()=>[a(m,{class:"cursor-pointer",name:"event"},{default:o(()=>[a(P,{cover:"","transition-hide":"scale","transition-show":"scale"},{default:o(()=>[a(S,{modelValue:i.processing_date,"onUpdate:modelValue":t[5]||(t[5]=e=>i.processing_date=e),mask:"YYYY-MM-DD"},{default:o(()=>[l("div",De,[A(a(V,{color:"primary",flat:"",label:"Close"},null,512),[[M]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])])]),n(Q)?(_(),F("div",Ce,[l("div",Pe,[a(me,{modelValue:g.value,"onUpdate:modelValue":[t[7]||(t[7]=e=>g.value=e),G],accept:".jpg, image/*, application/pdf",dense:"",label:"Haga click para subir el archivo o arrastralo aqu\xED",loading:n(v),outlined:""},{prepend:o(()=>[a(m,{name:"attach_file"})]),_:1},8,["modelValue","loading"])]),i.file?(_(),F("div",Se,[a(qe,{"file-url":`${n(x)}/api/files/requisitions/${r.requisition.id}/${i.file}`},null,8,["file-url"])])):D("",!0)])):D("",!0)]),_:1},512),a(ue),l("div",Me,[a(ce),l("div",null,[a(V,{color:"primary",label:"Guardar",loading:n(j)||n(H),onClick:z},null,8,["loading"])])])],64))}});export{Ke as C,We as _};
