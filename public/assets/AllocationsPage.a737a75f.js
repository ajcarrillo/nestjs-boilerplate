import{j as B,r as C,M as V,w as v,ae as _,u as h,d as o,l as e,ah as A,s as F,p as c,_ as D,q as s,F as b,ai as N,t as m,k as L}from"./index.c148c0c6.js";import{Q as q}from"./QInput.e430ec3b.js";import{a as j,b as w,Q as u}from"./QTable.0ad6c918.js";import{Q as x}from"./QTr.499d6e88.js";import{u as O}from"./useMoney.dbc60660.js";import{M as S,D as J}from"./constants.d949c564.js";import{u as P}from"./useQuery.esm.9d8865ca.js";import"./use-key-composition.2fce6913.js";import"./use-dark.74ed7cd3.js";import"./focus-manager.387b0375.js";import"./QMenu.f4712139.js";import"./scroll.789d8182.js";import"./QList.21f703e4.js";import"./QSelect.48bd3f96.js";import"./format.2ad21e77.js";import"./QItem.2533442d.js";import"./QItemLabel.cfb7cd9a.js";import"./QCheckbox.93825cb8.js";import"./BudgetResource.04074e95.js";import"./index.2cf0d985.js";import"./utils.esm.6708c4fa.js";const R=async d=>{const{data:p}=await S.getAllByYear(d);return p},Y=({budgetYear:d})=>{const{isLoading:p,isError:y,data:M,error:Q}=P({queryKey:["monthly-allocations",d],queryFn:()=>R(d),staleTime:6e5});return{isLoading:p,isError:y,allocations:M,error:Q}},z={class:"q-pa-md"},K=F("div",{class:"text-h4"},"Asignaci\xF3n de \xC1reas",-1),U={key:0},ft=B({__name:"AllocationsPage",setup(d){const{allocations:p,isLoading:y,isError:M,error:Q}=Y({budgetYear:2025}),{currencyFormat:g}=O(),T=C(""),n=V({allocations:[],monthTotals:new Array(12).fill(0),grandTotal:0}),i={};J.forEach((r,a)=>{const t=`dept-${a+1}`;i[t]={areaId:t,areaName:r,allocations:Array.from({length:12},()=>0).reduce((l,f,E)=>(l[E+1]=0,l),{}),total:0}}),v(p,r=>{n.monthTotals.fill(0),r==null||r.forEach(({areaId:a,areaName:t,month:l,allocatedAmount:f})=>{i[a]||(i[a]={areaId:a,areaName:t,allocations:{},total:0}),i[a].allocations[l]=f,i[a].total+=f,n.monthTotals[l-1]+=f,n.grandTotal+=f}),n.allocations=Object.values(i).sort((a,t)=>a.areaName.localeCompare(t.areaName))},{immediate:!0}),v(T,r=>{const a=Object.values(i).filter(t=>t.areaName.toLowerCase().includes(r.toLowerCase()));n.allocations=a},{immediate:!0});function k(r){return["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][r-1]||""}return(r,a)=>(c(),_("div",z,[K,h(y)?A("",!0):(c(),_("div",U,[o(j,{bordered:"",flat:"",rows:n.allocations,"rows-per-page-options":[0],separator:"cell"},{"top-right":e(()=>[o(q,{modelValue:T.value,"onUpdate:modelValue":a[0]||(a[0]=t=>T.value=t),debounce:"300",dense:"",outlined:"",placeholder:"Buscar"},{append:e(()=>[o(D,{name:"search"})]),_:1},8,["modelValue"])]),header:e(()=>[o(x,null,{default:e(()=>[o(w,null,{default:e(()=>[s("Deptos")]),_:1}),(c(),_(b,null,N(12,t=>o(w,{key:t,class:"text-right"},{default:e(()=>[s(m(k(t)),1)]),_:2},1024)),64)),o(w,{class:"text-right"},{default:e(()=>[s("Total")]),_:1})]),_:1})]),body:e(t=>[o(x,{props:t},{default:e(()=>[o(u,null,{default:e(()=>[s(m(t.row.areaName),1)]),_:2},1024),(c(),_(b,null,N(12,l=>o(u,{key:l,class:"text-right"},{default:e(()=>[s(m(h(g)(t.row.allocations[l]||0)),1)]),_:2},1024)),64)),o(u,{class:"text-right tw-font-bold"},{default:e(()=>[s(m(h(g)(t.row.total)),1)]),_:2},1024)]),_:2},1032,["props"])]),"bottom-row":e(()=>[o(x,{class:"tw-font-bold"},{default:e(()=>[o(u,null,{default:e(()=>[s("Total")]),_:1}),(c(!0),_(b,null,N(n.monthTotals,(t,l)=>(c(),L(u,{key:l,class:"text-right"},{default:e(()=>[s(m(h(g)(t)),1)]),_:2},1024))),128)),o(u,null,{default:e(()=>[s(m(h(g)(n.grandTotal)),1)]),_:1})]),_:1})]),_:1},8,["rows"])]))]))}});export{ft as default};
