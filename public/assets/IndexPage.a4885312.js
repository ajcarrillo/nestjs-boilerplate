import{Q as I}from"./QSpace.c1f9a46e.js";import{r as m,j as R,N as k,p as Q,k as V,l as a,d as e,u as g,av as A,b1 as L,q as w,t as S,_ as $,X as P,b4 as T,ap as E,s as B}from"./index.0b175f01.js";import{Q as j}from"./QTd.18df5e8a.js";import{Q as H}from"./QTable.78812d52.js";import{Q as z}from"./QPage.f7e992f7.js";import{T as G}from"./TablePage.af3732ea.js";import{P as M,u as X,_ as J,a as K,b as W}from"./CardDialog.9060ddf4.js";import{a as Y,Q as Z}from"./QForm.e02b1b3f.js";import{a as v,b as F,k as D,c as ee}from"./format.bc6b5d0a.js";import{f as ae}from"./QSelect.a01fc3f8.js";import{b as re}from"./ClosePopup.ba470207.js";import{Q as oe}from"./QList.de9c20f7.js";import{a as le}from"./QCard.8418aa13.js";import{Q as ie}from"./QCardActions.cdd25544.js";import{c as N}from"./index.7adaf3a2.js";import{d as te}from"./useRequisitions.910cf54e.js";import{l as ne}from"./layout.e5b39b81.js";import{F as ue}from"./FilePreview.45205163.js";import"./scroll.be050d28.js";import"./use-dark.46bf0f81.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./focus-manager.33224ae2.js";import"./utils.esm.4fba875c.js";import"./date.2de2ec43.js";import"./index.2cf0d985.js";import"./QImg.4d76d69d.js";const se=()=>{const n=m(),u=m(!1);return{isLoading:u,fileToUpload:n,uploadFile:async f=>{if(!n.value)throw new Error("No hay archivo para cargar");u.value=!0;const s=await f(n.value);return u.value=!1,ne.showSuccessNotification("Archivo subido con \xE9xito"),n.value=void 0,s}}},de=()=>{const{fileToUpload:n,isLoading:u,uploadFile:p}=se();return{fileToUpload:n,isLoading:u,uploadRequisitionFile:async s=>await p(async d=>{const c=new FormData;c.append("file",d);const{data:l}=await M.uploadFile(s,c);return l.file_name})}},ce=R({__name:"PurchaseOrderForm",props:{purchaseOrder:{default:()=>({order_number:null,reception_date:new Date().toISOString().substring(0,10),requisition_id:null})}},setup(n){const u=n,{uploadRequisitionFile:p,fileToUpload:f,isLoading:s}=de(),{requisitionsDictionary:q}=te(),{createPurchaseOrder:d,purchaseOrder:c}=X(),l={order_number:null,reception_date:new Date().toISOString().substring(0,10),requisition_id:null},r=k(N(u.purchaseOrder)||N(l)),_={order_number:[i=>!!i||"El n\xFAmero de orden de compra es requerido",i=>i.length==3||"El n\xFAmero de orden de compra debe tener 3 d\xEDgitos",i=>!isNaN(Number(i))||"El n\xFAmero de orden de compra debe ser un n\xFAmero"],reception_date:[i=>!!i||"La fecha de recepci\xF3n es requerida"],requisition_id:[i=>!!i||"La requisici\xF3n es requerida"]},x=m(),h=m(null),b=m();async function U(){var t,o,y,O;await((t=x.value)==null?void 0:t.validate())&&(await d({requisition_id:(o=h.value)==null?void 0:o.id,order_number:r.order_number,reception_date:r.reception_date}),b.value?(f.value=b.value,await p(c.value.id),(y=x.value)==null||y.reset()):(O=x.value)==null||O.reset())}function C(){r.order_number=null,r.reception_date=new Date().toISOString().substring(0,10),r.requisition_id=null,h.value=null,b.value=void 0}return(i,t)=>(Q(),V(g(Z),{ref_key:"qPurchaseOrderForm",ref:x,onReset:C,onSubmit:T(U,["prevent"])},{default:a(()=>[e(le,null,{default:a(()=>[e(oe,null,{default:a(()=>[e(v,null,{default:a(()=>[e(F,null,{default:a(()=>[e(Y,{modelValue:r.order_number,"onUpdate:modelValue":t[0]||(t[0]=o=>r.order_number=o),dense:"",label:"N\xFAmero de orden de compra",outlined:"",rules:_.order_number},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(F,null,{default:a(()=>[e(J,{modelValue:r.reception_date,"onUpdate:modelValue":t[1]||(t[1]=o=>r.reception_date=o),rules:_.reception_date},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(F,null,{default:a(()=>[e(ae,{modelValue:h.value,"onUpdate:modelValue":t[2]||(t[2]=o=>h.value=o),dense:"",label:"Requisici\xF3n","option-label":o=>`Requisici\xF3n #${o.requisition_number} - ${o.area_description}`,"option-value":"id",options:g(q),outlined:"",rules:_.requisition_id},{option:a(o=>[e(v,A(L(o.itemProps)),{default:a(()=>[e(F,null,{default:a(()=>[e(D,null,{default:a(()=>[w("Requisici\xF3n #"+S(o.opt.requisition_number),1)]),_:2},1024),e(D,{caption:""},{default:a(()=>[w(S(o.opt.area_description),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","option-label","options","rules"])]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(F,null,{default:a(()=>[e(re,{modelValue:b.value,"onUpdate:modelValue":t[3]||(t[3]=o=>b.value=o),accept:".jpg, image/*, application/pdf",dense:"",label:"Haga click para subir el archivo o arrastralo aqu\xED",loading:g(s),outlined:"","use-chips":""},{prepend:a(()=>[e($,{name:"attach_file"})]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),e(ee),e(ie,{align:"right"},{default:a(()=>[e(P,{color:"primary",label:"Guardar",type:"submit",unelevated:""})]),_:1})]),_:1},8,["onSubmit"]))}});const me=B("div",{class:"q-table__title"},"\xD3rdenes de compra",-1),$e=R({__name:"IndexPage",setup(n){const u="https://nestjs-boilerplate-production.up.railway.app",{isLoading:p,isFetching:f,orders:s}=K(),q=[{name:"order_number",field:"order_number",label:"N\xFAmero de orden de compra",align:"center",sortable:!0},{name:"reception_date",field:"reception_date",label:"Fecha de recepci\xF3n",sortable:!0,align:"left"},{name:"requisition",field:c=>{var l;return(l=c.requisition)==null?void 0:l.requisition_number},label:"Requisici\xF3n",sortable:!0,align:"center"},{name:"file",field:"file",label:"Archivo",sortable:!1,align:"left"}],d=m(!1);return(c,l)=>(Q(),V(z,null,{default:a(()=>[e(G,null,{"card-body":a(()=>[e(H,{columns:q,rows:g(s),title:"\xD3rdenes de compra"},{top:a(()=>[me,e(I),e(P,{color:"primary",label:"Nueva orden de compra",onClick:l[0]||(l[0]=r=>d.value=!0)})]),"body-cell-file":a(r=>[e(j,{props:r},{default:a(()=>[r.value?(Q(),V(ue,{key:0,"file-url":`${g(u)}/api/files/purchase-orders/${r.id}/${r.value}`},{activator:a(({showPreview:_})=>[e(P,{color:"primary",flat:"","no-caps":"",onClick:_},{default:a(()=>[w(" Ver archivo ")]),_:2},1032,["onClick"])]),_:2},1032,["file-url"])):E("",!0)]),_:2},1032,["props"])]),_:1},8,["rows"])]),footer:a(()=>[e(W,{modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=r=>d.value=r),"card-title":"Orden de Compra",class:"form-purchase-order"},{default:a(()=>[e(ce)]),_:1},8,["modelValue"])]),_:1})]),_:1}))}});export{$e as default};
