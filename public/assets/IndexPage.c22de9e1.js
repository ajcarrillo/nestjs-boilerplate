import{Q as re}from"./QSpace.1a6406de.js";import{Q as ae}from"./QToggle.6b7bc800.js";import{v as E,h as s,x as D,r as h,c as v,_ as X,ah as oe,aS as ne,g as B,y as N,i as le,b5 as ie,b8 as J,H as ue,N as se,ai as de,j as Y,m as ce,M as pe,p as k,k as O,l as o,d as a,u as F,ap as K,b2 as j,q as U,t as R,aj as $,X as I,b9 as me,o as ve,w as fe,V as _e,s as be}from"./index.ac1fe3a4.js";import{a as ge,Q as qe}from"./QTable.214090ca.js";import{Q as Se}from"./QSlideTransition.1e5963c7.js";import{u as Pe,a as ye,b as he,c as xe}from"./use-panel.aeb13727.js";import{u as Ce}from"./ClosePopup.d0f7ca96.js";import{Q as Fe}from"./QCard.48cb3cad.js";import{u as Qe,a as we}from"./use-dark.6bee62c2.js";import{Q as Ve}from"./QPage.eed7b46b.js";import{T as Ie}from"./TablePage.89fb7e6d.js";import{P as Re,u as Ue,a as ke}from"./usePurchaseOrders.9ffbc47f.js";import{Q as Oe}from"./QInput.6ca0e8c3.js";import{Q as V,a as w,b as T}from"./QItemLabel.115241ba.js";import{Q as H}from"./QSelect.0a60a580.js";import{Q as Te}from"./QFile.6ae768c9.js";import{Q as De}from"./QList.3fb09338.js";import{Q as Ee}from"./QCardSection.30f08c21.js";import{a as Ne}from"./format.4dafb4f5.js";import{Q as $e}from"./QCardActions.437df79e.js";import{c as M}from"./index.7adaf3a2.js";import{d as Be}from"./useRequisitions.cd0ff11d.js";import{_ as Ae}from"./DatePicker.70bac58e.js";import{Q as Le}from"./QForm.dfb1b43e.js";import{l as Ke}from"./layout.21328db8.js";import{u as je}from"./useSubBudgets.5db0f470.js";import{_ as He}from"./CardDialog.4a650a42.js";import{F as Me}from"./FilePreview.3d6e15c0.js";import"./QCheckbox.4754c15e.js";import"./scroll.a62eedda.js";import"./touch.70a9dd44.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./planeacion.api.e983001c.js";import"./index.2cf0d985.js";import"./QChip.4ddd763a.js";import"./utils.esm.ac57bbee.js";import"./useMutation.esm.262c3a3f.js";import"./mutation.esm.823c4e05.js";import"./QPopupProxy.23f51f0c.js";import"./date.7e11f810.js";import"./QTooltip.5fd65661.js";import"./QImg.e12cef03.js";var W=E({name:"QStepperNavigation",setup(e,{slots:i}){return()=>s("div",{class:"q-stepper__nav"},D(i.default))}}),Z=E({name:"StepHeader",props:{stepper:{},step:{},goToPanel:Function},setup(e,{attrs:i}){const{proxy:{$q:d}}=B(),c=h(null),n=v(()=>e.stepper.modelValue===e.step.name),_=v(()=>{const t=e.step.disable;return t===!0||t===""}),g=v(()=>{const t=e.step.error;return t===!0||t===""}),m=v(()=>{const t=e.step.done;return _.value===!1&&(t===!0||t==="")}),f=v(()=>{const t=e.step.headerNav,r=t===!0||t===""||t===void 0;return _.value===!1&&e.stepper.headerNav&&r}),y=v(()=>e.step.prefix&&(n.value===!1||e.stepper.activeIcon==="none")&&(g.value===!1||e.stepper.errorIcon==="none")&&(m.value===!1||e.stepper.doneIcon==="none")),q=v(()=>{const t=e.step.icon||e.stepper.inactiveIcon;if(n.value===!0){const r=e.step.activeIcon||e.stepper.activeIcon;return r==="none"?t:r||d.iconSet.stepper.active}if(g.value===!0){const r=e.step.errorIcon||e.stepper.errorIcon;return r==="none"?t:r||d.iconSet.stepper.error}if(_.value===!1&&m.value===!0){const r=e.step.doneIcon||e.stepper.doneIcon;return r==="none"?t:r||d.iconSet.stepper.done}return t}),u=v(()=>{const t=g.value===!0?e.step.errorColor||e.stepper.errorColor:void 0;if(n.value===!0){const r=e.step.activeColor||e.stepper.activeColor||e.step.color;return r!==void 0?r:t}return t!==void 0?t:_.value===!1&&m.value===!0?e.step.doneColor||e.stepper.doneColor||e.step.color||e.stepper.inactiveColor:e.step.color||e.stepper.inactiveColor}),S=v(()=>"q-stepper__tab col-grow flex items-center no-wrap relative-position"+(u.value!==void 0?` text-${u.value}`:"")+(g.value===!0?" q-stepper__tab--error q-stepper__tab--error-with-"+(y.value===!0?"prefix":"icon"):"")+(n.value===!0?" q-stepper__tab--active":"")+(m.value===!0?" q-stepper__tab--done":"")+(f.value===!0?" q-stepper__tab--navigation q-focusable q-hoverable":"")+(_.value===!0?" q-stepper__tab--disabled":"")),b=v(()=>e.stepper.headerNav!==!0?!1:f.value);function x(){c.value!==null&&c.value.focus(),n.value===!1&&e.goToPanel(e.step.name)}function p(t){t.keyCode===13&&n.value===!1&&e.goToPanel(e.step.name)}return()=>{const t={class:S.value};f.value===!0&&(t.onClick=x,t.onKeyup=p,Object.assign(t,_.value===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:i.tabindex||0}));const r=[s("div",{class:"q-focus-helper",tabindex:-1,ref:c}),s("div",{class:"q-stepper__dot row flex-center q-stepper__line relative-position"},[s("span",{class:"row flex-center"},[y.value===!0?e.step.prefix:s(X,{name:q.value})])])];if(e.step.title!==void 0&&e.step.title!==null){const Q=[s("div",{class:"q-stepper__title"},e.step.title)];e.step.caption!==void 0&&e.step.caption!==null&&Q.push(s("div",{class:"q-stepper__caption"},e.step.caption)),r.push(s("div",{class:"q-stepper__label q-stepper__line relative-position"},Q))}return oe(s("div",t,r),[[ne,b.value]])}}});function ee(e){return s("div",{class:"q-stepper__step-content"},[s("div",{class:"q-stepper__step-inner"},D(e.default))])}const z={setup(e,{slots:i}){return()=>ee(i)}};var G=E({name:"QStep",props:{...Pe,icon:String,color:String,title:{type:String,required:!0},caption:String,prefix:[String,Number],doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String,headerNav:{type:Boolean,default:!0},done:Boolean,error:Boolean,onScroll:[Function,Array]},setup(e,{slots:i,emit:d}){const{proxy:{$q:c}}=B(),n=le(J,N);if(n===N)return console.error("QStep needs to be a child of QStepper"),N;const{getCacheWithFn:_}=Ce(),g=h(null),m=v(()=>n.value.modelValue===e.name),f=v(()=>c.platform.is.ios!==!0&&c.platform.is.chrome===!0||m.value!==!0||n.value.vertical!==!0?{}:{onScroll(u){const{target:S}=u;S.scrollTop>0&&(S.scrollTop=0),e.onScroll!==void 0&&d("scroll",u)}}),y=v(()=>typeof e.name=="string"||typeof e.name=="number"?e.name:String(e.name));function q(){const u=n.value.vertical;return u===!0&&n.value.keepAlive===!0?s(ie,n.value.keepAliveProps.value,m.value===!0?[s(n.value.needsUniqueKeepAliveWrapper.value===!0?_(y.value,()=>({...z,name:y.value})):z,{key:y.value},i.default)]:void 0):u!==!0||m.value===!0?ee(i):void 0}return()=>s("div",{ref:g,class:"q-stepper__step",role:"tabpanel",...f.value},n.value.vertical===!0?[s(Z,{stepper:n.value,step:e,goToPanel:n.value.goToPanel}),n.value.animated===!0?s(Se,q):q()]:[q()])}});const We=/(-\w)/g;function ze(e){const i={};for(const d in e){const c=d.replace(We,n=>n[1].toUpperCase());i[c]=e[d]}return i}var Ge=E({name:"QStepper",props:{...Qe,...ye,flat:Boolean,bordered:Boolean,alternativeLabels:Boolean,headerNav:Boolean,contracted:Boolean,headerClass:String,inactiveColor:String,inactiveIcon:String,doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String},emits:he,setup(e,{slots:i}){const d=B(),c=we(e,d.proxy.$q),{updatePanelsList:n,isValidPanelName:_,updatePanelIndex:g,getPanelContent:m,getPanels:f,panelDirectives:y,goToPanel:q,keepAliveProps:u,needsUniqueKeepAliveWrapper:S}=xe();ue(J,v(()=>({goToPanel:q,keepAliveProps:u,needsUniqueKeepAliveWrapper:S,...e})));const b=v(()=>`q-stepper q-stepper--${e.vertical===!0?"vertical":"horizontal"}`+(e.flat===!0?" q-stepper--flat":"")+(e.bordered===!0?" q-stepper--bordered":"")+(c.value===!0?" q-stepper--dark q-dark":"")),x=v(()=>`q-stepper__header row items-stretch justify-between q-stepper__header--${e.alternativeLabels===!0?"alternative":"standard"}-labels`+(e.flat===!1||e.bordered===!0?" q-stepper__header--border":"")+(e.contracted===!0?" q-stepper__header--contracted":"")+(e.headerClass!==void 0?` ${e.headerClass}`:""));function p(){const t=D(i.message,[]);if(e.vertical===!0){_(e.modelValue)&&g();const r=s("div",{class:"q-stepper__content"},D(i.default));return t===void 0?[r]:t.concat(r)}return[s("div",{class:x.value},f().map(r=>{const Q=ze(r.props);return s(Z,{key:Q.name,stepper:e,step:Q,goToPanel:q})})),t,de("div",{class:"q-stepper__content q-panel-parent"},m(),"cont",e.swipeable,()=>y.value)]}return()=>(n(i),s("div",{class:b.value},se(i.navigation,p())))}});const Xe=()=>{const e=h(),i=h(!1);return{isLoading:i,fileToUpload:e,uploadFile:async c=>{if(!e.value)throw new Error("No hay archivo para cargar");i.value=!0;const n=await c(e.value);return i.value=!1,Ke.showSuccessNotification("Archivo subido con \xE9xito"),e.value=void 0,n}}},Je=()=>{const{fileToUpload:e,isLoading:i,uploadFile:d}=Xe();return{fileToUpload:e,isLoading:i,uploadRequisitionFile:async n=>await d(async g=>{const m=new FormData;m.append("file",g);const{data:f}=await Re.uploadFile(n,m);return f.file_name})}},Ye=Y({__name:"PurchaseOrderForm",props:{purchaseOrder:{default:()=>({order_number:null,reception_date:new Date().toISOString().substring(0,10),requisition_id:null})}},setup(e){const i=e,d=ce(),c=h(d.query.fromSubBudgets==="true"),{uploadRequisitionFile:n,fileToUpload:_,isLoading:g}=Je(),{requisitionsDictionary:m}=Be(),{subBudgetReqDictionary:f}=je(),{createPurchaseOrder:y,purchaseOrder:q,purchaseOrderType:u}=Ue({fromSubBudgets:c}),S={order_number:null,reception_date:new Date().toISOString().substring(0,10),requisition_id:null},b=pe(M(i.purchaseOrder)||M(S)),x={order_number:[C=>!!C||"El n\xFAmero de orden de compra es requerido",C=>C.length==3||"El n\xFAmero de orden de compra debe tener 3 d\xEDgitos",C=>!isNaN(Number(C))||"El n\xFAmero de orden de compra debe ser un n\xFAmero"],reception_date:[C=>!!C||"La fecha de recepci\xF3n es requerida"],requisition_id:[C=>!!C||"La requisici\xF3n es requerida"]},p=h(),t=h(null),r=h();async function Q(){var P,l,A,L;await((P=p.value)==null?void 0:P.validate())&&(await y({requisition_id:(l=t.value)==null?void 0:l.id,order_number:b.order_number,reception_date:b.reception_date}),r.value?(_.value=r.value,await n(q.value.id),(A=p.value)==null||A.reset()):(L=p.value)==null||L.reset())}function te(){b.order_number=null,b.reception_date=new Date().toISOString().substring(0,10),b.requisition_id=null,t.value=null,r.value=void 0}return(C,P)=>(k(),O(F(Le),{ref_key:"qPurchaseOrderForm",ref:p,onReset:te,onSubmit:me(Q,["prevent"])},{default:o(()=>[a(Ee,null,{default:o(()=>[a(De,null,{default:o(()=>[a(V,null,{default:o(()=>[a(w,null,{default:o(()=>[a(Oe,{modelValue:b.order_number,"onUpdate:modelValue":P[0]||(P[0]=l=>b.order_number=l),dense:"",label:"N\xFAmero de orden de compra",outlined:"",rules:x.order_number},null,8,["modelValue","rules"])]),_:1})]),_:1}),a(V,null,{default:o(()=>[a(w,null,{default:o(()=>[a(Ae,{modelValue:b.reception_date,"onUpdate:modelValue":P[1]||(P[1]=l=>b.reception_date=l),rules:x.reception_date},null,8,["modelValue","rules"])]),_:1})]),_:1}),a(V,null,{default:o(()=>[F(u)==="PRESUPUESTO"?(k(),O(w,{key:0},{default:o(()=>[a(H,{modelValue:t.value,"onUpdate:modelValue":P[2]||(P[2]=l=>t.value=l),dense:"",label:"Requisici\xF3n","option-label":l=>`Requisici\xF3n #${l.requisition_number} - ${l.area_description}`,"option-value":"id",options:F(m),outlined:"",rules:x.requisition_id},{option:o(l=>[a(V,K(j(l.itemProps)),{default:o(()=>[a(w,null,{default:o(()=>[a(T,null,{default:o(()=>[U("Requisici\xF3n #"+R(l.opt.requisition_number),1)]),_:2},1024),a(T,{caption:""},{default:o(()=>[U(R(l.opt.area_description),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","option-label","options","rules"])]),_:1})):$("",!0),F(u)==="SUBPRESUPUESTO"?(k(),O(w,{key:1},{default:o(()=>[a(H,{modelValue:t.value,"onUpdate:modelValue":P[3]||(P[3]=l=>t.value=l),dense:"",label:"Requisici\xF3n","option-label":l=>`Requisici\xF3n #${l.requisition_number} - ${l.event}`,"option-value":"id",options:F(f),outlined:"",rules:x.requisition_id},{option:o(l=>[a(V,K(j(l.itemProps)),{default:o(()=>[a(w,null,{default:o(()=>[a(T,null,{default:o(()=>[U("Requisici\xF3n #"+R(l.opt.requisition_number),1)]),_:2},1024),a(T,{caption:""},{default:o(()=>[U(R(l.opt.area_description)+" "+R(l.opt.event),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","option-label","options","rules"])]),_:1})):$("",!0)]),_:1}),a(V,null,{default:o(()=>[a(w,null,{default:o(()=>[a(Te,{modelValue:r.value,"onUpdate:modelValue":P[4]||(P[4]=l=>r.value=l),accept:".jpg, image/*, application/pdf",dense:"",label:"Haga click para subir el archivo o arrastralo aqu\xED",loading:F(g),outlined:"","use-chips":""},{prepend:o(()=>[a(X,{name:"attach_file"})]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),a(Ne),a($e,{align:"right"},{default:o(()=>[a(I,{color:"primary",label:"Guardar",type:"submit",unelevated:""})]),_:1})]),_:1},8,["onSubmit"]))}});const Ze=be("div",{class:"q-table__title"},"\xD3rdenes de compra",-1),Lt=Y({__name:"IndexPage",setup(e){const i="https://nestjs-boilerplate-production.up.railway.app",d=_e(),c=d.currentRoute.value,n=h(c.query.fromSubBudgets==="true"),{isLoading:_,isFetching:g,orders:m,purchaseOrderType:f}=ke({fromSubBudgets:n}),y=[{name:"area",field:p=>{var t,r;return(r=(t=p.requisition)==null?void 0:t.area)==null?void 0:r.name},label:"Departamento",sortalbe:!0,align:"left"},{name:"event",field:"event",label:"Evento",sortable:!1,align:"left"},{name:"order_number",field:"order_number",label:"N\xFAmero de orden de compra",align:"center",sortable:!0},{name:"reception_date",field:"reception_date",label:"Fecha de recepci\xF3n",sortable:!0,align:"left"},{name:"requisition",field:p=>{var t;return(t=p.requisition)==null?void 0:t.requisition_number},label:"Requisici\xF3n",sortable:!0,align:"center"},{name:"file",field:"file",label:"Archivo",sortable:!1,align:"left"}],q=h(!1),u=h(1),S=h(["area","order_number","reception_date","requisition","file"]);ve(()=>{n.value&&S.value.splice(1,0,"event")}),fe(n,p=>{d.replace({query:{...c.query,fromSubBudgets:p.toString()}}),p?S.value.splice(1,0,"event"):S.value.splice(1,1)});const b=v(()=>f.value===""?"Selecciona un tipo de orden de compra":f.value==="PRESUPUESTO"?"Presupuesto":"SubPresupuesto");function x(p){f.value=p,u.value=2}return(p,t)=>(k(),O(Ve,null,{default:o(()=>[a(Ie,null,{"card-body":o(()=>[a(ge,{columns:y,loading:F(_)||F(g),rows:F(m),title:"\xD3rdenes de compra","visible-columns":S.value},{top:o(()=>[Ze,a(re),a(ae,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=r=>n.value=r),class:"tw-mr-4",label:"Mostrar las \xF3rdenes de compra de los SubPresupuestos"},null,8,["modelValue"]),a(I,{color:"primary",label:"Nueva orden de compra",onClick:t[1]||(t[1]=r=>q.value=!0)})]),"body-cell-file":o(r=>[a(qe,{props:r},{default:o(()=>[r.value?(k(),O(Me,{key:0,"file-url":`${F(i)}/api/files/purchase-orders/${r.id}/${r.value}`},{activator:o(({showPreview:Q})=>[a(I,{color:"primary",flat:"","no-caps":"",onClick:Q},{default:o(()=>[U(" Ver archivo ")]),_:2},1032,["onClick"])]),_:2},1032,["file-url"])):$("",!0)]),_:2},1032,["props"])]),_:1},8,["loading","rows","visible-columns"])]),footer:o(()=>[a(He,{modelValue:q.value,"onUpdate:modelValue":t[6]||(t[6]=r=>q.value=r),"card-title":"Orden de Compra",class:"form-purchase-order"},{default:o(()=>[a(Ge,{modelValue:u.value,"onUpdate:modelValue":t[5]||(t[5]=r=>u.value=r),animated:"",color:"primary",vertical:""},{default:o(()=>[a(G,{done:u.value>1,icon:"settings",name:1,title:"Selecciona un tipo de orden de compra"},{default:o(()=>[a(W,{class:"tw-flex tw-gap-1"},{default:o(()=>[a(I,{color:"primary",label:"Presupuesto",outline:"",onClick:t[2]||(t[2]=r=>x("PRESUPUESTO"))}),a(I,{color:"primary",label:"SubPresupuesto",outline:"",onClick:t[3]||(t[3]=r=>x("SUBPRESUPUESTO"))})]),_:1})]),_:1},8,["done"]),a(G,{caption:F(b),done:u.value>2,icon:"create_new_folder",name:2,title:"Crear Orden de Compra"},{default:o(()=>[a(Fe,{bordered:"",flat:""},{default:o(()=>[a(Ye)]),_:1}),a(W,null,{default:o(()=>[a(I,{color:"primary",flat:"",label:"atr\xE1s",onClick:t[4]||(t[4]=r=>{u.value=1,f.value=""})})]),_:1})]),_:1},8,["caption","done"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})]),_:1}))}});export{Lt as default};
