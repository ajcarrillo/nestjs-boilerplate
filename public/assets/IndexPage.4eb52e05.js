import{Q as X}from"./QSpace.45831ea5.js";import{j as B,r as P,M as R,p as f,k as y,l as a,d as e,u as b,_ as T,X as v,b9 as J,w as Y,q as x,t as Z,aj as S,s as ee,O as ae}from"./index.526cf529.js";import{a as te,Q as C}from"./QTable.97187746.js";import{Q as ne}from"./QPage.91e5688e.js";import{T as re}from"./TablePage.96493308.js";import{p as q}from"./planeacion.api.ed726f7c.js";import{l as Q}from"./layout.4621ed06.js";import{u as oe,a as z}from"./QChip.d1193308.js";import{u as G}from"./useMutation.esm.de042098.js";import{_ as le}from"./CardDialog.d682a4bd.js";import{Q as N}from"./QInput.1c466dbb.js";import{Q as c,a as _}from"./QItemLabel.03c30918.js";import{Q as ie}from"./QSelect.9b11ed75.js";import{Q as ue}from"./QCheckbox.9e0288ff.js";import{Q as j}from"./QFile.e3c46a52.js";import{Q as de}from"./QList.29e33817.js";import{Q as se}from"./QCardSection.3c033d5f.js";import{a as me}from"./format.3015ff60.js";import{Q as pe}from"./QCardActions.58807fc2.js";import{Q as ce}from"./QForm.f9c8ae4e.js";import{c as I}from"./index.7adaf3a2.js";import{_ as _e}from"./DatePicker.18040433.js";import{b as fe}from"./usePurchaseOrders.b5840159.js";import{F as A}from"./FilePreview.e9bbea9c.js";import"./use-dark.4bf010ab.js";import"./scroll.ecadfddb.js";import"./QCard.a7ad5cdc.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./index.2cf0d985.js";import"./utils.esm.089a2c9c.js";import"./mutation.esm.b36ee339.js";import"./QPopupProxy.680f67d8.js";import"./ClosePopup.bab0ff62.js";import"./date.560238d8.js";import"./QTooltip.858eceb1.js";import"./QImg.ae4addd1.js";function L(n){const o=new FormData;return o.append("payment_number",n.payment_number),o.append("payment_date",n.payment_date),o.append("amount",n.amount.toString()),o.append("purchase_order_id",n.purchase_order_id),o.append("check_number",n.check_number||""),o.append("is_submitted_to_finance",n.is_submitted_to_finance),n.paymentFile&&o.append("payment_file",n.paymentFile),n.checkFile&&o.append("check_file",n.checkFile),o}var D={getPaymentOrders(){return q.get("/payment-orders")},storePaymentOrder(n){const o=L(n);return q.post("/payment-orders",o,{headers:{"Content-Type":"multipart/form-data"}})},updatePaymentOrder(n){const{...o}=n,{id:k}=o;delete o.id;const h=L(o);return q.patch(`/payment-orders/${k}`,h,{headers:{"Content-Type":"multipart/form-data"}})}};const ye=async()=>(await D.getPaymentOrders()).data,be=async n=>(await D.storePaymentOrder(n)).data,he=async n=>(await D.updatePaymentOrder(n)).data,ge=()=>({queryPaymentOrders:oe({queryKey:["paymentOrders"],queryFn:ye,staleTime:6e4})}),ve=()=>{const n=z();return{storePaymentOrderMutation:G({mutationFn:be,onSuccess:async()=>{await n.invalidateQueries(["paymentOrders"]),Q.showSuccessNotification("Orden de pago creada")},onError:()=>{Q.showErrorNotification("No se pudo crear la orden de pago")}})}},ke=()=>{const n=z();return{updatePaymentOrderMutation:G({mutationFn:he,onSuccess:async()=>{await n.invalidateQueries(["paymentOrders"]),Q.showSuccessNotification("Orden de pago actualizada")},onError:()=>{Q.showErrorNotification("No se pudo actualizar la orden de pago")}})}},Oe=B({__name:"PaymentOrderForm",props:{paymentOrder:{default:()=>({purchase_order_id:"",payment_number:"",amount:0,payment_date:new Date().toISOString().substring(0,10),payment_file:"",check_number:"",check_file:"",is_submitted_to_finance:!1})}},emits:["close"],setup(n,{emit:o}){const k=n,h="https://nestjs-boilerplate-production.up.railway.app",{storePaymentOrderMutation:U}=ve(),{updatePaymentOrderMutation:$}=ke(),{dictionary:w}=fe(),m=P(),F={purchase_order_id:"",payment_number:"",amount:0,payment_date:new Date().toISOString().substring(0,10),payment_file:"",check_number:"",check_file:"",is_submitted_to_finance:!1},t=R(I(k.paymentOrder)||I(F)),g={purchase_order_id:[i=>!!i||"La orden de compra es requerida"],payment_number:[i=>!!i||"El n\xFAmero de pago es requerido",i=>i.length==3||"El n\xFAmero de pago debe tener 3 d\xEDgitos",i=>!isNaN(Number(i))||"El n\xFAmero de pago debe ser un n\xFAmero"],amount:[i=>!!i||"El monto es requerido",i=>!isNaN(Number(i))||"El monto debe ser un n\xFAmero"],payment_date:[i=>!!i||"La fecha de pago es requerida"]},O=P(),V=P();async function d(){var u,l;await((u=m.value)==null?void 0:u.validate())&&(t.hasOwnProperty("id")?await $.mutateAsync(t):(await U.mutateAsync(t),(l=m.value)==null||l.reset(),o("close")))}function s(){t.purchase_order_id="",t.payment_number="",t.amount=0,t.payment_date=new Date().toISOString().substring(0,10),t.payment_file="",t.check_number="",t.check_file="",t.is_submitted_to_finance=!1,O.value=void 0,V.value=void 0}function r(i){t.paymentFile=i}function p(i){t.checkFile=i}return(i,u)=>(f(),y(b(ce),{ref_key:"qPaymentOrderForm",ref:m,onReset:s,onSubmit:J(d,["prevent"])},{default:a(()=>[e(se,null,{default:a(()=>[e(de,null,{default:a(()=>[e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(N,{modelValue:t.payment_number,"onUpdate:modelValue":u[0]||(u[0]=l=>t.payment_number=l),dense:"",label:"N\xFAmero de pago",outlined:"",rules:g.payment_number},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(_e,{modelValue:t.payment_date,"onUpdate:modelValue":u[1]||(u[1]=l=>t.payment_date=l),rules:g.payment_date},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(N,{modelValue:t.amount,"onUpdate:modelValue":u[2]||(u[2]=l=>t.amount=l),modelModifiers:{number:!0},dense:"",label:"Monto",outlined:"",rules:g.amount},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(ie,{modelValue:t.purchase_order_id,"onUpdate:modelValue":u[3]||(u[3]=l=>t.purchase_order_id=l),dense:"","emit-value":"",label:"Orden de compra","map-options":"",options:b(w),outlined:"",rules:g.purchase_order_id},null,8,["modelValue","options","rules"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(ue,{modelValue:t.is_submitted_to_finance,"onUpdate:modelValue":u[4]||(u[4]=l=>t.is_submitted_to_finance=l),dense:"",label:"\xBFSe envi\xF3 a finanzas?",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[t.payment_file?(f(),y(A,{key:1,"file-url":`${b(h)}/api/files/payment-orders/${t.id}/${t.payment_file}`},{activator:a(({showPreview:l})=>[e(v,{color:"primary",dense:"",flat:"",icon:"visibility",label:"Ver archivo de pago",unelevated:"",onClick:l},null,8,["onClick"])]),_:1},8,["file-url"])):(f(),y(j,{key:0,modelValue:O.value,"onUpdate:modelValue":[u[5]||(u[5]=l=>O.value=l),r],accept:".jpg, image/*, application/pdf",dense:"",label:"Archivo de pago",loading:!1,name:"payment_file",outlined:"","use-chips":""},{prepend:a(()=>[e(T,{name:"attach_file"})]),_:1},8,["modelValue"]))]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(N,{modelValue:t.check_number,"onUpdate:modelValue":u[6]||(u[6]=l=>t.check_number=l),dense:"",label:"N\xFAmero de cheque",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(j,{modelValue:V.value,"onUpdate:modelValue":[u[7]||(u[7]=l=>V.value=l),p],accept:".jpg, image/*, application/pdf",dense:"",label:"Archivo de cheque",loading:!1,name:"check_file",outlined:"","use-chips":""},{prepend:a(()=>[e(T,{name:"attach_file"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(me),e(pe,{align:"right"},{default:a(()=>[e(v,{color:"primary",label:"Guardar",type:"submit"})]),_:1})]),_:1},8,["onSubmit"]))}});const Ve=ee("div",{class:"q-table__title"},"\xD3rdenes de pago",-1),la=B({__name:"IndexPage",setup(n){const o="https://nestjs-boilerplate-production.up.railway.app",{queryPaymentOrders:k}=ge(),{data:h,isLoading:U,isError:$}=k,w=[{name:"payment_number",field:"payment_number",label:"Orden de pago",align:"right",sortable:!0},{name:"amount",field:"amount",label:"Total real",align:"right",sortable:!0},{name:"payment_date",field:"payment_date",label:"Fecha de elaboraci\xF3n",align:"center",sortable:!0},{name:"purchaseOrder",field:d=>{var s;return(s=d.purchaseOrder)==null?void 0:s.order_number},label:"Orden de compra",align:"right",sortable:!0},{name:"requisition",field:d=>{var s,r;return(r=(s=d.purchaseOrder)==null?void 0:s.requisition)==null?void 0:r.requisition_number},label:"Requisici\xF3n",align:"right",sortable:!0},{name:"payment_file",field:"payment_file",label:"Archivo",align:"center",sortable:!0},{name:"is_submitted_to_finance",field:d=>d.is_submitted_to_finance?"Si":"No",label:"Enviado a finanzas",sortable:!0,align:"center"},{name:"check_number",field:"check_number",label:"N\xFAmero de cheque",align:"right",sortable:!0},{name:"check_file",field:"check_file",label:"Cheque",align:"center",sortable:!0}],m=P(!1),F=P(-1);let t=R({purchase_order_id:"",payment_number:"",amount:0,payment_date:new Date().toISOString().substring(0,10),payment_file:"",check_number:"",check_file:"",is_submitted_to_finance:!1});const g={purchase_order_id:"",payment_number:"",amount:0,payment_date:new Date().toISOString().substring(0,10),payment_file:"",check_number:"",check_file:"",is_submitted_to_finance:!1};Y(m,d=>{d||V()});function O(d){var M,E;const{payment_number:s,amount:r,payment_date:p,payment_file:i,check_number:u,check_file:l,id:H,is_submitted_to_finance:K}=d;F.value=(M=h.value)==null?void 0:M.findIndex(W=>W.id===d.id),t=Object.assign({},{id:H,purchase_order_id:(E=d.purchaseOrder)==null?void 0:E.id,payment_number:s,amount:r,payment_date:p,payment_file:i,check_number:u,check_file:l,is_submitted_to_finance:K}),m.value=!0}function V(){m.value=!1,ae(()=>{t=I(g),F.value=-1})}return(d,s)=>(f(),y(ne,null,{default:a(()=>[e(re,null,{"card-body":a(()=>[e(te,{columns:w,rows:b(h),title:"\xD3rdenes de pago"},{top:a(()=>[Ve,e(X),e(v,{color:"primary",label:"Nueva orden de pago",onClick:s[0]||(s[0]=r=>m.value=!0)})]),"body-cell-payment_number":a(r=>[e(C,{props:r},{default:a(()=>[r.value?(f(),y(v,{key:0,color:"primary",flat:"","no-caps":"",onClick:p=>O(r.row)},{default:a(()=>[x(Z(r.value),1)]),_:2},1032,["onClick"])):S("",!0)]),_:2},1032,["props"])]),"body-cell-payment_file":a(r=>[e(C,{props:r},{default:a(()=>[r.value?(f(),y(A,{key:0,"file-url":`${b(o)}/api/files/payment-orders/${r.id}/${r.value}`},{activator:a(({showPreview:p})=>[e(v,{color:"primary",flat:"","no-caps":"",onClick:p},{default:a(()=>[x(" Ver archivo ")]),_:2},1032,["onClick"])]),_:2},1032,["file-url"])):S("",!0)]),_:2},1032,["props"])]),"body-cell-check_file":a(r=>[e(C,{props:r},{default:a(()=>[r.value?(f(),y(A,{key:0,"file-url":`${b(o)}/api/files/payment-orders/${r.id}/${r.value}`},{activator:a(({showPreview:p})=>[e(v,{color:"primary",flat:"","no-caps":"",onClick:p},{default:a(()=>[x(" Ver archivo ")]),_:2},1032,["onClick"])]),_:2},1032,["file-url"])):S("",!0)]),_:2},1032,["props"])]),_:1},8,["rows"])]),footer:a(()=>[e(le,{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=r=>m.value=r),"card-title":"Orden de pago",class:"form-payment-order"},{default:a(({closeDialog:r})=>[e(Oe,{"payment-order":b(t),onClose:r},null,8,["payment-order","onClose"])]),_:1},8,["modelValue"])]),_:1})]),_:1}))}});export{la as default};
