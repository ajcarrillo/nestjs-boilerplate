import{Q as W}from"./QSpace.68167c32.js";import{j as L,r as P,N as B,p as f,k as y,l as a,d as e,u as b,_ as M,X as g,b4 as X,w as Y,q as Q,t as Z,ap as x,s as ee,J as ae}from"./index.29beeebf.js";import{Q as S}from"./QTd.14df1cc5.js";import{Q as te}from"./QTable.b7a0d227.js";import{Q as ne}from"./QPage.4b31ca73.js";import{T as re}from"./TablePage.0b68744b.js";import{p as C,l as F}from"./layout.0b44b01f.js";import{u as oe,a as R,b as z,f as le}from"./QSelect.a8d33ba4.js";import{_ as ie}from"./CardDialog.d035b07e.js";import{a as q,Q as ue}from"./QForm.89ce2382.js";import{a as c,b as _,c as de}from"./format.5ed1b2f9.js";import{Q as se}from"./QCheckbox.cbd511b7.js";import{Q as T}from"./QFile.2467139b.js";import{Q as me}from"./QList.93ee1cf7.js";import{a as pe}from"./QCard.d231550d.js";import{Q as ce}from"./QCardActions.d676ed10.js";import{c as N}from"./index.7adaf3a2.js";import{_ as _e}from"./DatePicker.b0d23327.js";import{b as fe}from"./usePurchaseOrders.c2a28159.js";import{F as I}from"./FilePreview.f0286f62.js";import"./scroll.da39b050.js";import"./use-dark.c9685ee7.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./focus-manager.33224ae2.js";import"./index.2cf0d985.js";import"./utils.esm.b56e2037.js";import"./ClosePopup.c0a5e0d2.js";import"./date.2c671626.js";import"./QImg.15b0dee1.js";function j(n){const o=new FormData;return o.append("payment_number",n.payment_number),o.append("payment_date",n.payment_date),o.append("amount",n.amount.toString()),o.append("purchase_order_id",n.purchase_order_id),o.append("check_number",n.check_number||""),o.append("is_submitted_to_finance",n.is_submitted_to_finance),n.paymentFile&&o.append("payment_file",n.paymentFile),n.checkFile&&o.append("check_file",n.checkFile),o}var A={getPaymentOrders(){return C.get("/payment-orders")},storePaymentOrder(n){const o=j(n);return C.post("/payment-orders",o,{headers:{"Content-Type":"multipart/form-data"}})},updatePaymentOrder(n){const{...o}=n,{id:v}=o;delete o.id;const h=j(o);return C.patch(`/payment-orders/${v}`,h,{headers:{"Content-Type":"multipart/form-data"}})}};const ye=async()=>(await A.getPaymentOrders()).data,be=async n=>(await A.storePaymentOrder(n)).data,he=async n=>(await A.updatePaymentOrder(n)).data,ge=()=>({queryPaymentOrders:oe({queryKey:["paymentOrders"],queryFn:ye,staleTime:6e4})}),ve=()=>{const n=R();return{storePaymentOrderMutation:z({mutationFn:be,onSuccess:async()=>{await n.invalidateQueries(["paymentOrders"]),F.showSuccessNotification("Orden de pago creada")},onError:()=>{F.showErrorNotification("No se pudo crear la orden de pago")}})}},ke=()=>{const n=R();return{updatePaymentOrderMutation:z({mutationFn:he,onSuccess:async()=>{await n.invalidateQueries(["paymentOrders"]),F.showSuccessNotification("Orden de pago actualizada")},onError:()=>{F.showErrorNotification("No se pudo actualizar la orden de pago")}})}},Oe=L({__name:"PaymentOrderForm",props:{paymentOrder:{default:()=>({purchase_order_id:"",payment_number:"",amount:0,payment_date:new Date().toISOString().substring(0,10),payment_file:"",check_number:"",check_file:"",is_submitted_to_finance:!1})}},setup(n){const o=n,v="https://nestjs-boilerplate-production.up.railway.app",{storePaymentOrderMutation:h}=ve(),{updatePaymentOrderMutation:D}=ke(),{dictionary:U}=fe(),k=P(),m={purchase_order_id:"",payment_number:"",amount:0,payment_date:new Date().toISOString().substring(0,10),payment_file:"",check_number:"",check_file:"",is_submitted_to_finance:!1},t=B(N(o.paymentOrder)||N(m)),p={purchase_order_id:[r=>!!r||"La orden de compra es requerida"],payment_number:[r=>!!r||"El n\xFAmero de pago es requerido",r=>r.length==3||"El n\xFAmero de pago debe tener 3 d\xEDgitos",r=>!isNaN(Number(r))||"El n\xFAmero de pago debe ser un n\xFAmero"],amount:[r=>!!r||"El monto es requerido",r=>!isNaN(Number(r))||"El monto debe ser un n\xFAmero"],payment_date:[r=>!!r||"La fecha de pago es requerida"]},O=P(),V=P();async function w(){var u,i;await((u=k.value)==null?void 0:u.validate())&&(t.hasOwnProperty("id")?await D.mutateAsync(t):(await h.mutateAsync(t),(i=k.value)==null||i.reset()))}function d(){t.purchase_order_id="",t.payment_number="",t.amount=0,t.payment_date=new Date().toISOString().substring(0,10),t.payment_file="",t.check_number="",t.check_file="",t.is_submitted_to_finance=!1,O.value=void 0,V.value=void 0}function s(r){t.paymentFile=r}function l(r){t.checkFile=r}return(r,u)=>(f(),y(b(ue),{ref_key:"qPaymentOrderForm",ref:k,onReset:d,onSubmit:X(w,["prevent"])},{default:a(()=>[e(pe,null,{default:a(()=>[e(me,null,{default:a(()=>[e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(q,{modelValue:t.payment_number,"onUpdate:modelValue":u[0]||(u[0]=i=>t.payment_number=i),dense:"",label:"N\xFAmero de pago",outlined:"",rules:p.payment_number},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(_e,{modelValue:t.payment_date,"onUpdate:modelValue":u[1]||(u[1]=i=>t.payment_date=i),rules:p.payment_date},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(q,{modelValue:t.amount,"onUpdate:modelValue":u[2]||(u[2]=i=>t.amount=i),modelModifiers:{number:!0},dense:"",label:"Monto",outlined:"",rules:p.amount},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(le,{modelValue:t.purchase_order_id,"onUpdate:modelValue":u[3]||(u[3]=i=>t.purchase_order_id=i),dense:"","emit-value":"",label:"Orden de compra","map-options":"",options:b(U),outlined:"",rules:p.purchase_order_id},null,8,["modelValue","options","rules"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(se,{modelValue:t.is_submitted_to_finance,"onUpdate:modelValue":u[4]||(u[4]=i=>t.is_submitted_to_finance=i),dense:"",label:"\xBFSe envi\xF3 a finanzas?",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[t.payment_file?(f(),y(I,{key:1,"file-url":`${b(v)}/api/files/payment-orders/${t.id}/${t.payment_file}`},{activator:a(({showPreview:i})=>[e(g,{color:"primary",dense:"",flat:"",icon:"visibility",label:"Ver archivo de pago",unelevated:"",onClick:i},null,8,["onClick"])]),_:1},8,["file-url"])):(f(),y(T,{key:0,modelValue:O.value,"onUpdate:modelValue":[u[5]||(u[5]=i=>O.value=i),s],accept:".jpg, image/*, application/pdf",dense:"",label:"Archivo de pago",loading:!1,name:"payment_file",outlined:"","use-chips":""},{prepend:a(()=>[e(M,{name:"attach_file"})]),_:1},8,["modelValue"]))]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(q,{modelValue:t.check_number,"onUpdate:modelValue":u[6]||(u[6]=i=>t.check_number=i),dense:"",label:"N\xFAmero de cheque",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(T,{modelValue:V.value,"onUpdate:modelValue":[u[7]||(u[7]=i=>V.value=i),l],accept:".jpg, image/*, application/pdf",dense:"",label:"Archivo de cheque",loading:!1,name:"check_file",outlined:"","use-chips":""},{prepend:a(()=>[e(M,{name:"attach_file"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(de),e(ce,{align:"right"},{default:a(()=>[e(g,{color:"primary",label:"Guardar",type:"submit"})]),_:1})]),_:1},8,["onSubmit"]))}});const Ve=ee("div",{class:"q-table__title"},"\xD3rdenes de pago",-1),Ze=L({__name:"IndexPage",setup(n){const o="https://nestjs-boilerplate-production.up.railway.app",{queryPaymentOrders:v}=ge(),{data:h,isLoading:D,isError:U}=v,k=[{name:"payment_number",field:"payment_number",label:"Orden de pago",align:"right",sortable:!0},{name:"amount",field:"amount",label:"Total real",align:"right",sortable:!0},{name:"payment_date",field:"payment_date",label:"Fecha de elaboraci\xF3n",align:"center",sortable:!0},{name:"purchaseOrder",field:d=>{var s;return(s=d.purchaseOrder)==null?void 0:s.order_number},label:"Orden de compra",align:"right",sortable:!0},{name:"requisition",field:d=>{var s,l;return(l=(s=d.purchaseOrder)==null?void 0:s.requisition)==null?void 0:l.requisition_number},label:"Requisici\xF3n",align:"right",sortable:!0},{name:"payment_file",field:"payment_file",label:"Archivo",align:"center",sortable:!0},{name:"is_submitted_to_finance",field:d=>d.is_submitted_to_finance?"Si":"No",label:"Enviado a finanzas",sortable:!0,align:"center"},{name:"check_number",field:"check_number",label:"N\xFAmero de cheque",align:"right",sortable:!0},{name:"check_file",field:"check_file",label:"Cheque",align:"center",sortable:!0}],m=P(!1),t=P(-1);let p=B({purchase_order_id:"",payment_number:"",amount:0,payment_date:new Date().toISOString().substring(0,10),payment_file:"",check_number:"",check_file:"",is_submitted_to_finance:!1});const O={purchase_order_id:"",payment_number:"",amount:0,payment_date:new Date().toISOString().substring(0,10),payment_file:"",check_number:"",check_file:"",is_submitted_to_finance:!1};Y(m,d=>{d||w()});function V(d){var $,E;const{payment_number:s,amount:l,payment_date:r,payment_file:u,check_number:i,check_file:G,id:H,is_submitted_to_finance:J}=d;t.value=($=h.value)==null?void 0:$.findIndex(K=>K.id===d.id),p=Object.assign({},{id:H,purchase_order_id:(E=d.purchaseOrder)==null?void 0:E.id,payment_number:s,amount:l,payment_date:r,payment_file:u,check_number:i,check_file:G,is_submitted_to_finance:J}),m.value=!0}function w(){m.value=!1,ae(()=>{p=N(O),t.value=-1})}return(d,s)=>(f(),y(ne,null,{default:a(()=>[e(re,null,{"card-body":a(()=>[e(te,{columns:k,rows:b(h),title:"\xD3rdenes de pago"},{top:a(()=>[Ve,e(W),e(g,{color:"primary",label:"Nueva orden de pago",onClick:s[0]||(s[0]=l=>m.value=!0)})]),"body-cell-payment_number":a(l=>[e(S,{props:l},{default:a(()=>[l.value?(f(),y(g,{key:0,color:"primary",flat:"","no-caps":"",onClick:r=>V(l.row)},{default:a(()=>[Q(Z(l.value),1)]),_:2},1032,["onClick"])):x("",!0)]),_:2},1032,["props"])]),"body-cell-payment_file":a(l=>[e(S,{props:l},{default:a(()=>[l.value?(f(),y(I,{key:0,"file-url":`${b(o)}/api/files/payment-orders/${l.id}/${l.value}`},{activator:a(({showPreview:r})=>[e(g,{color:"primary",flat:"","no-caps":"",onClick:r},{default:a(()=>[Q(" Ver archivo ")]),_:2},1032,["onClick"])]),_:2},1032,["file-url"])):x("",!0)]),_:2},1032,["props"])]),"body-cell-check_file":a(l=>[e(S,{props:l},{default:a(()=>[l.value?(f(),y(I,{key:0,"file-url":`${b(o)}/api/files/payment-orders/${l.id}/${l.value}`},{activator:a(({showPreview:r})=>[e(g,{color:"primary",flat:"","no-caps":"",onClick:r},{default:a(()=>[Q(" Ver archivo ")]),_:2},1032,["onClick"])]),_:2},1032,["file-url"])):x("",!0)]),_:2},1032,["props"])]),_:1},8,["rows"])]),footer:a(()=>[e(ie,{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=l=>m.value=l),"card-title":"Orden de pago",class:"form-payment-order"},{default:a(()=>[e(Oe,{"payment-order":b(p)},null,8,["payment-order"])]),_:1},8,["modelValue"])]),_:1})]),_:1}))}});export{Ze as default};
