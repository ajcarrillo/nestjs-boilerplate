import{j as V,M as Q,r as x,c as S,p as C,k as q,l as e,d as t,X as _,u as p,w as M,_ as U,s as T,O as L}from"./index.e81fb1fc.js";import{l as w,Q as h}from"./layout.002d03c4.js";import{Q as B,a as D}from"./QTable.877f6a43.js";import{T as $}from"./TablePage.ed214491.js";import{Q as z,a as K}from"./QItemLabel.dd0d0c24.js";import{Q as j}from"./QList.c2fb8b2a.js";import{Q as O}from"./QCardSection.a8afd0fa.js";import{a as P}from"./format.5a4585ee.js";import{Q as G}from"./QCardActions.4c711164.js";import{A as E,u as H}from"./app.3d5fad7f.js";import{u as R,a as I}from"./QChip.349b418c.js";import{u as N}from"./useMutation.esm.f7013444.js";import{c as k}from"./index.7adaf3a2.js";import{Q as X}from"./QForm.1f8f3bc3.js";import{_ as J}from"./CardDialog.95418859.js";import"./use-dark.9dc9ea9d.js";import"./planeacion.api.ea428453.js";import"./index.2cf0d985.js";import"./QSelect.f9a905e8.js";import"./scroll.e271a657.js";import"./QCheckbox.4b3f9cbd.js";import"./QCard.9dedbb2b.js";import"./QPage.8984cb37.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./ArticleResource.bca6a98d.js";import"./utils.esm.db18b7fe.js";import"./mutation.esm.fb605c8f.js";import"./QSpace.f345c4e6.js";import"./MyCardTitle.9ccc1ed9.js";const W=async()=>{const{data:a}=await E.getActions();return a},Y=async a=>{const{data:o}=await E.storeAction(a);return o},Z=async a=>{const{id:o,name:l}=a,{data:r}=await E.updateAction(o,{name:l});return r},tt=()=>{const{isLoading:a,isError:o,data:l,error:r}=R({queryKey:["actions"],queryFn:W,staleTime:6e5});return{isLoading:a,isError:o,data:l,error:r}},at=()=>{const a=I();return{actionStoreMutations:N({mutationFn:Y,onSuccess:()=>{a.invalidateQueries({queryKey:["actions"]}),w.showSuccessNotification("Acci\xF3n creada con \xE9xito")},onError:()=>{w.showErrorNotification("Error al crear acci\xF3n")}})}},ot=()=>{const a=I();return{actionUpdateMutations:N({mutationFn:Z,onSuccess:()=>{a.invalidateQueries({queryKey:["actions"]}),w.showSuccessNotification("Acci\xF3n actualizada con \xE9xito")},onError:()=>{w.showErrorNotification("Error al actualizar acci\xF3n")}})}},et=V({__name:"ActionForm",props:{action:null},setup(a){const o=a,l=H(),{fetchActionDictionary:r}=l,{actionStoreMutations:A}=at(),{isLoading:s}=A,{actionUpdateMutations:f}=ot(),{isLoading:y}=f,b=Q({name:""}),u=Q(k(o.action||b)),g=x(),F={name:[d=>!!d||"El nombre es requerido"]},c=S(()=>o.action&&"id"in o.action);S(()=>c.value?"Editar acci\xF3n":"Agregar acci\xF3n");async function i(){var m,v;!await((m=g.value)==null?void 0:m.validate())||(c.value?(await f.mutateAsync(u),await n()):(await A.mutateAsync(u),u.name="",(v=g.value)==null||v.reset(),await n()))}async function n(){await r()}return(d,m)=>(C(),q(p(X),{ref_key:"actionForm",ref:g,class:"q-gutter-md"},{default:e(()=>[t(O,null,{default:e(()=>[t(j,null,{default:e(()=>[t(z,null,{default:e(()=>[t(K,null,{default:e(()=>[t(h,{modelValue:u.name,"onUpdate:modelValue":m[0]||(m[0]=v=>u.name=v),dense:"",label:"Nombre",outlined:"",rules:F.name},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),t(P),t(G,{align:"right"},{default:e(()=>[t(_,{color:"primary",label:"Guardar",loading:p(s)||p(y),onClick:i},null,8,["loading"])]),_:1})]),_:1},512))}}),nt={class:"q-gutter-sm"},Mt=V({__name:"IndexPage",setup(a){const{data:o,isLoading:l}=tt(),r=x(""),A=[{name:"id",field:"id",required:!0,label:"ID",sortable:!0,align:"left"},{name:"name",field:"name",label:"Nombre",sortable:!0,align:"left"},{name:"action",align:"center",label:"Acciones",field:"action",sortable:!1}],s=x(!1),f=x(-1);let y=Q({name:""});const b=Q({name:""}),u=S(()=>f.value===-1?"Nueva acci\xF3n":"Editar acci\xF3n");M(s,c=>{c||F()});function g(c){var d;const{name:i,id:n}=c;f.value=(d=o.value)==null?void 0:d.findIndex(m=>m.id===c.id),y=Object.assign({},{id:n,name:i}),s.value=!0}function F(){s.value=!1,L(()=>{y=k(b),f.value=-1})}return(c,i)=>(C(),q($,null,{"card-body":e(()=>[t(D,{columns:A,loading:p(l),rows:p(o),"rows-per-page-options":[20,30,40,50],title:"Acciones"},{"top-right":e(()=>[t(_,{class:"q-mr-xs",color:"primary",icon:"add",label:"Nueva Acci\xF3n",outline:"",onClick:i[0]||(i[0]=n=>s.value=!0)}),t(h,{modelValue:r.value,"onUpdate:modelValue":i[1]||(i[1]=n=>r.value=n),class:"q-mr-xs",debounce:"300",dense:"",outlined:"",placeholder:"Search"},{append:e(()=>[t(U,{name:"search"})]),_:1},8,["modelValue"]),t(_,{color:"primary","icon-right":"archive",label:"Exportar CSV","no-caps":""})]),"body-cell-action":e(n=>[t(B,{props:n},{default:e(()=>[T("div",nt,[t(_,{color:"primary",dense:"",flat:"",icon:"edit",rounded:"",size:"sm",onClick:d=>g(n.row)},null,8,["onClick"])])]),_:2},1032,["props"])]),_:1},8,["loading","rows"])]),footer:e(()=>[t(J,{modelValue:s.value,"onUpdate:modelValue":i[2]||(i[2]=n=>s.value=n),"card-title":p(u)},{default:e(()=>[t(et,{action:p(y)},null,8,["action"])]),_:1},8,["modelValue","card-title"])]),_:1}))}});export{Mt as default};
