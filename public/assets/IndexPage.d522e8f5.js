import{Q as ye}from"./QSpace.5bc997f5.js";import{Q as be}from"./QToggle.64018a49.js";import{j as re,r as m,M as le,p as Q,k as x,l as t,d as e,u as _,_ as K,X as v,b9 as ge,o as ve,w as te,c as he,V as we,m as Oe,s as Pe,t as z,q as G,aj as Ve,O as ke}from"./index.3d665631.js";import{l as O,Q as N}from"./layout.21dc5158.js";import{a as Fe,Q as I}from"./QTable.843ad210.js";import{Q as Qe}from"./QBanner.d48485d7.js";import{Q as ie}from"./QCardSection.02e6e3b1.js";import{Q as xe}from"./QPage.fee6a90a.js";import{T as qe}from"./TablePage.df84b26a.js";import{p as M}from"./planeacion.api.4cc732a1.js";import{u as De,a as X}from"./QChip.cdaf7a40.js";import{u as J}from"./useMutation.esm.240f9cfd.js";import{_ as ae}from"./CardDialog.342a40be.js";import{Q as y,a as b}from"./QItemLabel.1f3981e9.js";import{Q as Se}from"./QSelect.c5cb43cf.js";import{Q as Ce}from"./QCheckbox.3af97c36.js";import{Q as ne}from"./QFile.64c40b41.js";import{Q as Ie}from"./QList.d86de2bc.js";import{a as Me}from"./format.7464a207.js";import{Q as Ne}from"./QCardActions.340cfd25.js";import{Q as Ae}from"./QForm.b6a6a45d.js";import{c as W}from"./index.7adaf3a2.js";import{_ as Ue}from"./DatePicker.3d037082.js";import{c as Ee}from"./usePurchaseOrders.e48ffdf7.js";import{F as se}from"./FilePreview.bf2e2bbc.js";import{d as $e}from"./date.2758cfda.js";import{u as Te}from"./useMoney.dbc60660.js";import"./use-dark.4660b51b.js";import"./scroll.9a2f493c.js";import"./QCard.0c3a06eb.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./index.2cf0d985.js";import"./utils.esm.6ce701e0.js";import"./mutation.esm.c056a971.js";import"./MyCardTitle.e0088f0f.js";import"./QPopupProxy.8c939df0.js";import"./ClosePopup.798306ca.js";import"./QTooltip.976cbced.js";import"./QImg.b5b4cfe3.js";function oe(a){const n=new FormData;return n.append("payment_number",a.payment_number),n.append("payment_date",a.payment_date),n.append("amount",a.amount.toString()),n.append("purchase_order_id",a.purchase_order_id),n.append("check_number",a.check_number||""),n.append("is_submitted_to_finance",a.is_submitted_to_finance),a.paymentFile&&n.append("payment_file",a.paymentFile),a.checkFile&&n.append("check_file",a.checkFile),n}var A={getPaymentOrders({show:a}){const n=a===!1?"presupuestos":"subpresupuestos";return M.get(`/payment-orders?show=${n}`)},storePaymentOrder(a){const n=oe(a);return M.post("/payment-orders",n,{headers:{"Content-Type":"multipart/form-data"}})},updatePaymentOrder(a){const{...n}=a,{id:h}=n;delete n.id;const w=oe(n);return M.patch(`/payment-orders/${h}`,w,{headers:{"Content-Type":"multipart/form-data"}})},deletePaymentOrder(a){return M.delete(`/payment-orders/${a}`)}};const Ye=async({show:a})=>(await A.getPaymentOrders({show:a})).data,Be=async a=>(await A.storePaymentOrder(a)).data,Re=async a=>(await A.updatePaymentOrder(a)).data,je=async({id:a})=>(await A.deletePaymentOrder(a)).data,Le=({show:a})=>({queryPaymentOrders:De({queryKey:["paymentOrders",{show:a}],queryFn:()=>Ye({show:a.value}),staleTime:6e4})}),ze=()=>{const a=X();return{storePaymentOrderMutation:J({mutationFn:Be,onSuccess:async()=>{await a.invalidateQueries(["paymentOrders"]),O.showSuccessNotification("Orden de pago creada")},onError:()=>{O.showErrorNotification("No se pudo crear la orden de pago")}})}},Ge=()=>{const a=X();return{updatePaymentOrderMutation:J({mutationFn:Re,onSuccess:async()=>{await a.invalidateQueries(["paymentOrders"]),O.showSuccessNotification("Orden de pago actualizada")},onError:()=>{O.showErrorNotification("No se pudo actualizar la orden de pago")}})}},He=({show:a})=>{const n=X();return{deletePaymentOrderMutation:J({mutationFn:je,onSuccess:async()=>{await n.invalidateQueries(["paymentOrders",{show:a}]),O.showSuccessNotification("Orden de pago eliminada")},onError:()=>{O.showErrorNotification("No se pudo eliminar la orden de pago")}})}},Ke=re({__name:"PaymentOrderForm",props:{paymentOrder:{default:()=>({purchase_order_id:"",payment_number:"",amount:0,payment_date:new Date().toISOString().substring(0,10),payment_file:"",check_number:"",check_file:"",is_submitted_to_finance:!1})}},emits:["close"],setup(a,{emit:n}){const h=a,w="https://nestjs-boilerplate-production.up.railway.app",{storePaymentOrderMutation:U}=ze(),{updatePaymentOrderMutation:p}=Ge(),{dictionary:P}=Ee(),V=m(),q={purchase_order_id:"",payment_number:"",amount:0,payment_date:new Date().toISOString().substring(0,10),payment_file:"",check_number:"",check_file:"",is_submitted_to_finance:!1},o=le(W(h.paymentOrder)||W(q)),g={purchase_order_id:[i=>!!i||"La orden de compra es requerida"],payment_number:[i=>!!i||"El n\xFAmero de pago es requerido",i=>i.length<=4||"El n\xFAmero de pago debe tener 4 d\xEDgitos",i=>!isNaN(Number(i))||"El n\xFAmero de pago debe ser un n\xFAmero"],amount:[i=>!!i||"El monto es requerido",i=>!isNaN(Number(i))||"El monto debe ser un n\xFAmero"],payment_date:[i=>!!i||"La fecha de pago es requerida"]},k=m(),D=m();async function E(){var u,l;await((u=V.value)==null?void 0:u.validate())&&(o.hasOwnProperty("id")?await p.mutateAsync(o):(await U.mutateAsync(o),(l=V.value)==null||l.reset(),n("close")))}function c(){o.purchase_order_id="",o.payment_number="",o.amount=0,o.payment_date=new Date().toISOString().substring(0,10),o.payment_file="",o.check_number="",o.check_file="",o.is_submitted_to_finance=!1,k.value=void 0,D.value=void 0}function f(i){o.paymentFile=i}function S(i){o.checkFile=i}return(i,u)=>(Q(),x(_(Ae),{ref_key:"qPaymentOrderForm",ref:V,onReset:c,onSubmit:ge(E,["prevent"])},{default:t(()=>[e(ie,null,{default:t(()=>[e(Ie,null,{default:t(()=>[e(y,null,{default:t(()=>[e(b,null,{default:t(()=>[e(N,{modelValue:o.payment_number,"onUpdate:modelValue":u[0]||(u[0]=l=>o.payment_number=l),dense:"",label:"N\xFAmero de pago",outlined:"",rules:g.payment_number},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(b,null,{default:t(()=>[e(Ue,{modelValue:o.payment_date,"onUpdate:modelValue":u[1]||(u[1]=l=>o.payment_date=l),rules:g.payment_date},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(b,null,{default:t(()=>[e(N,{modelValue:o.amount,"onUpdate:modelValue":u[2]||(u[2]=l=>o.amount=l),modelModifiers:{number:!0},dense:"",label:"Monto",outlined:"",rules:g.amount},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(b,null,{default:t(()=>[e(Se,{modelValue:o.purchase_order_id,"onUpdate:modelValue":u[3]||(u[3]=l=>o.purchase_order_id=l),dense:"","emit-value":"",label:"Orden de compra","map-options":"",options:_(P),outlined:"",rules:g.purchase_order_id},null,8,["modelValue","options","rules"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(b,null,{default:t(()=>[e(Ce,{modelValue:o.is_submitted_to_finance,"onUpdate:modelValue":u[4]||(u[4]=l=>o.is_submitted_to_finance=l),dense:"",label:"\xBFSe envi\xF3 a finanzas?",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(b,null,{default:t(()=>[o.payment_file?(Q(),x(se,{key:1,"file-url":`${_(w)}/api/files/payment-orders/${o.id}/${o.payment_file}`},{activator:t(({showPreview:l})=>[e(v,{color:"primary",dense:"",flat:"",icon:"visibility",label:"Ver archivo de pago",unelevated:"",onClick:l},null,8,["onClick"])]),_:1},8,["file-url"])):(Q(),x(ne,{key:0,modelValue:k.value,"onUpdate:modelValue":[u[5]||(u[5]=l=>k.value=l),f],accept:".jpg, image/*, application/pdf",dense:"",label:"Archivo de pago",loading:!1,name:"payment_file",outlined:"","use-chips":""},{prepend:t(()=>[e(K,{name:"attach_file"})]),_:1},8,["modelValue"]))]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(b,null,{default:t(()=>[e(N,{modelValue:o.check_number,"onUpdate:modelValue":u[6]||(u[6]=l=>o.check_number=l),dense:"",label:"N\xFAmero de cheque",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(b,null,{default:t(()=>[e(ne,{modelValue:D.value,"onUpdate:modelValue":[u[7]||(u[7]=l=>D.value=l),S],accept:".jpg, image/*, application/pdf",dense:"",label:"Archivo de cheque",loading:!1,name:"check_file",outlined:"","use-chips":""},{prepend:t(()=>[e(K,{name:"attach_file"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(Me),e(Ne,{align:"right"},{default:t(()=>[e(v,{color:"primary",label:"Guardar",type:"submit"})]),_:1})]),_:1},8,["onSubmit"]))}});const We={class:"q-table__title"},H=$e.formatDate,At=re({__name:"IndexPage",setup(a){const n="https://nestjs-boilerplate-production.up.railway.app",h=we(),w=Oe(),U=w.query.show||"presupuestos",p=m(U==="subpresupuestos"),{currencyFormat:P}=Te(),{queryPaymentOrders:V}=Le({show:p}),{deletePaymentOrderMutation:q}=He({show:p}),{isLoading:o}=q,{data:g,isLoading:k,isError:D}=V,E=[{name:"consecutiveId",label:"ID",field:"consecutiveId",sortable:!1,required:!0},{name:"a_description",field:"a_description",label:"Departamento",align:"left",sortable:!0},{name:"sb_event",field:"sb_event",label:"Evento",sortable:!1,align:"left"},{name:"po_payment_number",field:"po_payment_number",label:"Orden de pago",align:"right",sortable:!0},{name:"po_amount",field:s=>P(+s.po_amount),label:"Total real",align:"right",sortable:!0},{name:"po_payment_date",field:s=>H(s.po_payment_date,"YYYY-MM-DD"),label:"Fecha de pago",align:"center",sortable:!0},{name:"por_order_number",field:"por_order_number",label:"Orden de compra",align:"right",sortable:!0},{name:"por_reception_date",field:s=>H(s.por_reception_date,"YYYY-MM-DD"),label:"Orden de compra fecha de recepci\xF3n",align:"center",sortable:!0},{name:"r_requisition_number",field:"r_requisition_number",label:"Requisici\xF3n",align:"right",sortable:!0},{name:"r_estimated_amount",field:s=>P(+s.r_estimated_amount),label:"Estimado",align:"right",sortable:!0},{name:"rsb_requisition_number",field:"rsb_requisition_number",label:"Requisici\xF3n",align:"right",sortable:!0},{name:"rsb_estimated_amount",field:s=>P(+s.rsb_estimated_amount),label:"Estimado",align:"right",sortable:!0},{name:"po_payment_file",field:"po_payment_file",label:"Archivo de pago",align:"center",sortable:!1},{name:"actions",field:"actions",label:"Acciones",align:"center"}],c=m(["a_description","po_payment_number","po_amount","po_payment_date","por_order_number","por_reception_date","r_requisition_number","r_estimated_amount","po_payment_file","actions"]),f=m(!1),S=m(-1);let i=le({purchase_order_id:"",payment_number:"",amount:0,payment_date:new Date().toISOString().substring(0,10),payment_file:"",check_number:"",check_file:"",is_submitted_to_finance:!1});const u={purchase_order_id:"",payment_number:"",amount:0,payment_date:new Date().toISOString().substring(0,10),payment_file:"",check_number:"",check_file:"",is_submitted_to_finance:!1},l=m(""),C=m(!1),$=m(void 0);ve(()=>{p.value&&(c.value.splice(1,0,"sb_event"),c.value.splice(7,2,"rsb_requisition_number","rsb_estimated_amount"))}),te(f,s=>{s||me()}),te(p,s=>{h.replace({query:{...w.query,show:s?"subpresupuestos":"presupuestos"}}),s?(c.value.splice(1,0,"sb_event"),c.value.splice(7,2,"rsb_requisition_number","rsb_estimated_amount")):(c.value.splice(1,1),c.value.splice(6,2,"r_requisition_number","r_estimated_amount"))});const ue=he(()=>p.value?"\xD3rdenes de pago/SubPresupuestos":"\xD3rdenes de pago/Presupuestos");function de(s){var ee;const{payment_number:d,amount:r,payment_date:F,payment_file:T,check_number:Y,check_file:B,id:R,is_submitted_to_finance:j,purchase_order_id:L}=pe(s);S.value=(ee=g.value)==null?void 0:ee.findIndex(fe=>fe.po_id===s.po_id),i=Object.assign({},{id:R,purchase_order_id:L,payment_number:d,amount:r,payment_date:F,payment_file:T,check_number:Y,check_file:B,is_submitted_to_finance:j}),f.value=!0}function me(){f.value=!1,ke(()=>{i=W(u),S.value=-1})}function pe(s){const{po_payment_number:d,po_amount:r,po_payment_date:F,po_payment_file:T,po_check_number:Y,po_check_file:B,po_id:R,po_is_submitted_to_finance:j,po_purchase_order_id:L}=s;return{id:R,purchase_order_id:L,payment_number:d,amount:+r,payment_date:H(F,"YYYY-MM-DD"),payment_file:T,check_number:Y,check_file:B,is_submitted_to_finance:j}}async function ce(){await q.mutateAsync({id:$.value}),Z()}function _e(s){$.value=s,C.value=!0}function Z(){C.value=!1,$.value=void 0}return(s,d)=>(Q(),x(xe,null,{default:t(()=>[e(qe,null,{"card-body":t(()=>[e(Fe,{columns:E,filter:l.value,flat:"",loading:_(k),pagination:{rowsPerPage:20},rows:_(g),"visible-columns":c.value,"wrap-cells":""},{top:t(()=>[Pe("div",We,z(_(ue)),1),e(ye),e(be,{modelValue:p.value,"onUpdate:modelValue":d[0]||(d[0]=r=>p.value=r),class:"tw-mr-4",label:"Mostrar las \xF3rdenes de pago de los SubPresupuestos"},null,8,["modelValue"]),e(N,{modelValue:l.value,"onUpdate:modelValue":d[1]||(d[1]=r=>l.value=r),class:"q-mr-xs",clearable:"",debounce:"300",dense:"",outlined:"",placeholder:"Buscar"},{append:t(()=>[e(K,{name:"search"})]),_:1},8,["modelValue"]),e(v,{color:"primary",label:"Nueva orden de pago",onClick:d[2]||(d[2]=r=>f.value=!0)})]),"body-cell-consecutiveId":t(r=>[e(I,{props:r},{default:t(()=>[G(z((r.rowIndex+1).toString()),1)]),_:2},1032,["props"])]),"body-cell-po_payment_number":t(r=>[e(I,{props:r},{default:t(()=>[r.value?(Q(),x(v,{key:0,color:"primary",flat:"","no-caps":"",onClick:F=>de(r.row)},{default:t(()=>[G(z(r.value),1)]),_:2},1032,["onClick"])):Ve("",!0)]),_:2},1032,["props"])]),"body-cell-po_payment_file":t(r=>[e(I,{props:r},{default:t(()=>[e(se,{"file-url":`${_(n)}/api/files/payment-orders/${r.row.po_id}/${r.row.po_payment_file}`},null,8,["file-url"])]),_:2},1032,["props"])]),"body-cell-actions":t(r=>[e(I,{props:r},{default:t(()=>[e(v,{color:"negative",flat:"",icon:"delete",round:"",onClick:F=>_e(r.row.po_id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["filter","loading","rows","visible-columns"])]),footer:t(()=>[e(ae,{modelValue:f.value,"onUpdate:modelValue":d[3]||(d[3]=r=>f.value=r),"card-title":"Orden de pago",class:"form-payment-order"},{default:t(({closeDialog:r})=>[e(Ke,{"payment-order":_(i),onClose:r},null,8,["payment-order","onClose"])]),_:1},8,["modelValue"]),e(ae,{modelValue:C.value,"onUpdate:modelValue":d[4]||(d[4]=r=>C.value=r),"card-title":"\xBFDesea eliminar la orden de pago?"},{"close-button":t(()=>[e(v,{dense:"",flat:"",icon:"close",round:"",onClick:Z})]),default:t(()=>[e(ie,null,{default:t(()=>[e(Qe,{class:"text-white bg-red","inline-actions":""},{action:t(()=>[e(v,{color:"white",flat:"",label:"Confirmar",loading:_(o),onClick:ce},null,8,["loading"])]),default:t(()=>[G(" \xA1Atenci\xF3n! Esta acci\xF3n no se puede deshacer ")]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}))}});export{At as default};
