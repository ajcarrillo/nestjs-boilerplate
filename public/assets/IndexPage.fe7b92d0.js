import{Q as oe}from"./QSpace.62bbc7da.js";import{Q as le}from"./QToggle.3e6ba614.js";import{v as E,h as d,x as D,r as y,c as f,_ as $,ah as ne,aS as ie,g as A,y as N,i as ue,b5 as se,b8 as Y,H as de,N as ce,ai as pe,j as Z,m as me,M as ve,p as O,k as T,l as o,d as a,u as F,ap as j,b2 as H,q as R,t as V,aj as B,X as U,b9 as fe,o as _e,w as be,V as ge,s as qe}from"./index.e2638eb4.js";import{l as Se,Q as ee}from"./layout.b48f6ca2.js";import{a as Pe,Q as M}from"./QTable.71f78e09.js";import{Q as ye}from"./QSlideTransition.a13930fe.js";import{u as he,a as xe,b as Ce,c as Fe}from"./use-panel.ea062d4d.js";import{u as Qe}from"./ClosePopup.e552dc18.js";import{Q as we}from"./QCard.be8ff39f.js";import{u as Ve,a as Ie}from"./use-dark.eb190f4a.js";import{Q as Re}from"./QPage.c2fef450.js";import{T as Ue}from"./TablePage.c13247da.js";import{P as Oe,u as Te,a as ke}from"./usePurchaseOrders.ff26eee5.js";import{Q as I,a as w,b as k}from"./QItemLabel.9891a74a.js";import{Q as W}from"./QSelect.8f3e200a.js";import{Q as De}from"./QFile.2bb28d4c.js";import{Q as Ee}from"./QList.9bbd2c21.js";import{Q as Ne}from"./QCardSection.94464a72.js";import{a as Be}from"./format.c4cd2b11.js";import{Q as $e}from"./QCardActions.771e2101.js";import{c as z}from"./index.7adaf3a2.js";import{d as Ae}from"./useRequisitions.b145ad4a.js";import{_ as Le}from"./DatePicker.9480aac9.js";import{Q as Ke}from"./QForm.e216d907.js";import{u as je}from"./useSubBudgets.b930e893.js";import{_ as He}from"./CardDialog.cb32ff35.js";import{F as Me}from"./FilePreview.15041e1a.js";import"./QCheckbox.b1850863.js";import"./planeacion.api.4718394d.js";import"./index.2cf0d985.js";import"./scroll.28522c71.js";import"./touch.70a9dd44.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./QChip.e0f21080.js";import"./utils.esm.7ac9ce6f.js";import"./useMutation.esm.7ab5810a.js";import"./mutation.esm.6f8cd676.js";import"./QPopupProxy.c515cd9f.js";import"./date.5b07776c.js";import"./QTooltip.5f4d8a67.js";import"./QImg.39e45ba0.js";var G=E({name:"QStepperNavigation",setup(e,{slots:u}){return()=>d("div",{class:"q-stepper__nav"},D(u.default))}}),te=E({name:"StepHeader",props:{stepper:{},step:{},goToPanel:Function},setup(e,{attrs:u}){const{proxy:{$q:c}}=A(),p=y(null),l=f(()=>e.stepper.modelValue===e.step.name),b=f(()=>{const r=e.step.disable;return r===!0||r===""}),g=f(()=>{const r=e.step.error;return r===!0||r===""}),m=f(()=>{const r=e.step.done;return b.value===!1&&(r===!0||r==="")}),_=f(()=>{const r=e.step.headerNav,t=r===!0||r===""||r===void 0;return b.value===!1&&e.stepper.headerNav&&t}),h=f(()=>e.step.prefix&&(l.value===!1||e.stepper.activeIcon==="none")&&(g.value===!1||e.stepper.errorIcon==="none")&&(m.value===!1||e.stepper.doneIcon==="none")),q=f(()=>{const r=e.step.icon||e.stepper.inactiveIcon;if(l.value===!0){const t=e.step.activeIcon||e.stepper.activeIcon;return t==="none"?r:t||c.iconSet.stepper.active}if(g.value===!0){const t=e.step.errorIcon||e.stepper.errorIcon;return t==="none"?r:t||c.iconSet.stepper.error}if(b.value===!1&&m.value===!0){const t=e.step.doneIcon||e.stepper.doneIcon;return t==="none"?r:t||c.iconSet.stepper.done}return r}),s=f(()=>{const r=g.value===!0?e.step.errorColor||e.stepper.errorColor:void 0;if(l.value===!0){const t=e.step.activeColor||e.stepper.activeColor||e.step.color;return t!==void 0?t:r}return r!==void 0?r:b.value===!1&&m.value===!0?e.step.doneColor||e.stepper.doneColor||e.step.color||e.stepper.inactiveColor:e.step.color||e.stepper.inactiveColor}),S=f(()=>"q-stepper__tab col-grow flex items-center no-wrap relative-position"+(s.value!==void 0?` text-${s.value}`:"")+(g.value===!0?" q-stepper__tab--error q-stepper__tab--error-with-"+(h.value===!0?"prefix":"icon"):"")+(l.value===!0?" q-stepper__tab--active":"")+(m.value===!0?" q-stepper__tab--done":"")+(_.value===!0?" q-stepper__tab--navigation q-focusable q-hoverable":"")+(b.value===!0?" q-stepper__tab--disabled":"")),v=f(()=>e.stepper.headerNav!==!0?!1:_.value);function Q(){p.value!==null&&p.value.focus(),l.value===!1&&e.goToPanel(e.step.name)}function x(r){r.keyCode===13&&l.value===!1&&e.goToPanel(e.step.name)}return()=>{const r={class:S.value};_.value===!0&&(r.onClick=Q,r.onKeyup=x,Object.assign(r,b.value===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:u.tabindex||0}));const t=[d("div",{class:"q-focus-helper",tabindex:-1,ref:p}),d("div",{class:"q-stepper__dot row flex-center q-stepper__line relative-position"},[d("span",{class:"row flex-center"},[h.value===!0?e.step.prefix:d($,{name:q.value})])])];if(e.step.title!==void 0&&e.step.title!==null){const n=[d("div",{class:"q-stepper__title"},e.step.title)];e.step.caption!==void 0&&e.step.caption!==null&&n.push(d("div",{class:"q-stepper__caption"},e.step.caption)),t.push(d("div",{class:"q-stepper__label q-stepper__line relative-position"},n))}return ne(d("div",r,t),[[ie,v.value]])}}});function re(e){return d("div",{class:"q-stepper__step-content"},[d("div",{class:"q-stepper__step-inner"},D(e.default))])}const X={setup(e,{slots:u}){return()=>re(u)}};var J=E({name:"QStep",props:{...he,icon:String,color:String,title:{type:String,required:!0},caption:String,prefix:[String,Number],doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String,headerNav:{type:Boolean,default:!0},done:Boolean,error:Boolean,onScroll:[Function,Array]},setup(e,{slots:u,emit:c}){const{proxy:{$q:p}}=A(),l=ue(Y,N);if(l===N)return console.error("QStep needs to be a child of QStepper"),N;const{getCacheWithFn:b}=Qe(),g=y(null),m=f(()=>l.value.modelValue===e.name),_=f(()=>p.platform.is.ios!==!0&&p.platform.is.chrome===!0||m.value!==!0||l.value.vertical!==!0?{}:{onScroll(s){const{target:S}=s;S.scrollTop>0&&(S.scrollTop=0),e.onScroll!==void 0&&c("scroll",s)}}),h=f(()=>typeof e.name=="string"||typeof e.name=="number"?e.name:String(e.name));function q(){const s=l.value.vertical;return s===!0&&l.value.keepAlive===!0?d(se,l.value.keepAliveProps.value,m.value===!0?[d(l.value.needsUniqueKeepAliveWrapper.value===!0?b(h.value,()=>({...X,name:h.value})):X,{key:h.value},u.default)]:void 0):s!==!0||m.value===!0?re(u):void 0}return()=>d("div",{ref:g,class:"q-stepper__step",role:"tabpanel",..._.value},l.value.vertical===!0?[d(te,{stepper:l.value,step:e,goToPanel:l.value.goToPanel}),l.value.animated===!0?d(ye,q):q()]:[q()])}});const We=/(-\w)/g;function ze(e){const u={};for(const c in e){const p=c.replace(We,l=>l[1].toUpperCase());u[p]=e[c]}return u}var Ge=E({name:"QStepper",props:{...Ve,...xe,flat:Boolean,bordered:Boolean,alternativeLabels:Boolean,headerNav:Boolean,contracted:Boolean,headerClass:String,inactiveColor:String,inactiveIcon:String,doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String},emits:Ce,setup(e,{slots:u}){const c=A(),p=Ie(e,c.proxy.$q),{updatePanelsList:l,isValidPanelName:b,updatePanelIndex:g,getPanelContent:m,getPanels:_,panelDirectives:h,goToPanel:q,keepAliveProps:s,needsUniqueKeepAliveWrapper:S}=Fe();de(Y,f(()=>({goToPanel:q,keepAliveProps:s,needsUniqueKeepAliveWrapper:S,...e})));const v=f(()=>`q-stepper q-stepper--${e.vertical===!0?"vertical":"horizontal"}`+(e.flat===!0?" q-stepper--flat":"")+(e.bordered===!0?" q-stepper--bordered":"")+(p.value===!0?" q-stepper--dark q-dark":"")),Q=f(()=>`q-stepper__header row items-stretch justify-between q-stepper__header--${e.alternativeLabels===!0?"alternative":"standard"}-labels`+(e.flat===!1||e.bordered===!0?" q-stepper__header--border":"")+(e.contracted===!0?" q-stepper__header--contracted":"")+(e.headerClass!==void 0?` ${e.headerClass}`:""));function x(){const r=D(u.message,[]);if(e.vertical===!0){b(e.modelValue)&&g();const t=d("div",{class:"q-stepper__content"},D(u.default));return r===void 0?[t]:r.concat(t)}return[d("div",{class:Q.value},_().map(t=>{const n=ze(t.props);return d(te,{key:n.name,stepper:e,step:n,goToPanel:q})})),r,pe("div",{class:"q-stepper__content q-panel-parent"},m(),"cont",e.swipeable,()=>h.value)]}return()=>(l(u),d("div",{class:v.value},ce(u.navigation,x())))}});const Xe=()=>{const e=y(),u=y(!1);return{isLoading:u,fileToUpload:e,uploadFile:async p=>{if(!e.value)throw new Error("No hay archivo para cargar");u.value=!0;const l=await p(e.value);return u.value=!1,Se.showSuccessNotification("Archivo subido con \xE9xito"),e.value=void 0,l}}},Je=()=>{const{fileToUpload:e,isLoading:u,uploadFile:c}=Xe();return{fileToUpload:e,isLoading:u,uploadRequisitionFile:async l=>await c(async g=>{const m=new FormData;m.append("file",g);const{data:_}=await Oe.uploadFile(l,m);return _.file_name})}},Ye=Z({__name:"PurchaseOrderForm",props:{purchaseOrder:{default:()=>({order_number:null,reception_date:new Date().toISOString().substring(0,10),requisition_id:null})}},setup(e){const u=e,c=me(),p=y(c.query.fromSubBudgets==="true"),{uploadRequisitionFile:l,fileToUpload:b,isLoading:g}=Je(),{requisitionsDictionary:m}=Ae(),{subBudgetReqDictionary:_}=je(),{createPurchaseOrder:h,purchaseOrder:q,purchaseOrderType:s}=Te({fromSubBudgets:p}),S={order_number:null,reception_date:new Date().toISOString().substring(0,10),requisition_id:null},v=ve(z(u.purchaseOrder)||z(S)),Q={order_number:[C=>!!C||"El n\xFAmero de orden de compra es requerido",C=>C.length==3||"El n\xFAmero de orden de compra debe tener 3 d\xEDgitos",C=>!isNaN(Number(C))||"El n\xFAmero de orden de compra debe ser un n\xFAmero"],reception_date:[C=>!!C||"La fecha de recepci\xF3n es requerida"],requisition_id:[C=>!!C||"La requisici\xF3n es requerida"]},x=y(),r=y(null),t=y();async function n(){var P,i,L,K;await((P=x.value)==null?void 0:P.validate())&&(await h({requisition_id:(i=r.value)==null?void 0:i.id,order_number:v.order_number,reception_date:v.reception_date}),t.value?(b.value=t.value,await l(q.value.id),(L=x.value)==null||L.reset()):(K=x.value)==null||K.reset())}function ae(){v.order_number=null,v.reception_date=new Date().toISOString().substring(0,10),v.requisition_id=null,r.value=null,t.value=void 0}return(C,P)=>(O(),T(F(Ke),{ref_key:"qPurchaseOrderForm",ref:x,onReset:ae,onSubmit:fe(n,["prevent"])},{default:o(()=>[a(Ne,null,{default:o(()=>[a(Ee,null,{default:o(()=>[a(I,null,{default:o(()=>[a(w,null,{default:o(()=>[a(ee,{modelValue:v.order_number,"onUpdate:modelValue":P[0]||(P[0]=i=>v.order_number=i),dense:"",label:"N\xFAmero de orden de compra",outlined:"",rules:Q.order_number},null,8,["modelValue","rules"])]),_:1})]),_:1}),a(I,null,{default:o(()=>[a(w,null,{default:o(()=>[a(Le,{modelValue:v.reception_date,"onUpdate:modelValue":P[1]||(P[1]=i=>v.reception_date=i),rules:Q.reception_date},null,8,["modelValue","rules"])]),_:1})]),_:1}),a(I,null,{default:o(()=>[F(s)==="PRESUPUESTO"?(O(),T(w,{key:0},{default:o(()=>[a(W,{modelValue:r.value,"onUpdate:modelValue":P[2]||(P[2]=i=>r.value=i),dense:"",label:"Requisici\xF3n","option-label":i=>`Requisici\xF3n #${i.requisition_number} - ${i.area_description}`,"option-value":"id",options:F(m),outlined:"",rules:Q.requisition_id},{option:o(i=>[a(I,j(H(i.itemProps)),{default:o(()=>[a(w,null,{default:o(()=>[a(k,null,{default:o(()=>[R("Requisici\xF3n #"+V(i.opt.requisition_number),1)]),_:2},1024),a(k,{caption:""},{default:o(()=>[R(V(i.opt.area_description),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","option-label","options","rules"])]),_:1})):B("",!0),F(s)==="SUBPRESUPUESTO"?(O(),T(w,{key:1},{default:o(()=>[a(W,{modelValue:r.value,"onUpdate:modelValue":P[3]||(P[3]=i=>r.value=i),dense:"",label:"Requisici\xF3n","option-label":i=>`Requisici\xF3n #${i.requisition_number} - ${i.event}`,"option-value":"id",options:F(_),outlined:"",rules:Q.requisition_id},{option:o(i=>[a(I,j(H(i.itemProps)),{default:o(()=>[a(w,null,{default:o(()=>[a(k,null,{default:o(()=>[R("Requisici\xF3n #"+V(i.opt.requisition_number),1)]),_:2},1024),a(k,{caption:""},{default:o(()=>[R(V(i.opt.area_description)+" "+V(i.opt.event),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","option-label","options","rules"])]),_:1})):B("",!0)]),_:1}),a(I,null,{default:o(()=>[a(w,null,{default:o(()=>[a(De,{modelValue:t.value,"onUpdate:modelValue":P[4]||(P[4]=i=>t.value=i),accept:".jpg, image/*, application/pdf",dense:"",label:"Haga click para subir el archivo o arrastralo aqu\xED",loading:F(g),outlined:"","use-chips":""},{prepend:o(()=>[a($,{name:"attach_file"})]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),a(Be),a($e,{align:"right"},{default:o(()=>[a(U,{color:"primary",label:"Guardar",type:"submit",unelevated:""})]),_:1})]),_:1},8,["onSubmit"]))}});const Ze={class:"q-table__title"},At=Z({__name:"IndexPage",setup(e){const u="https://nestjs-boilerplate-production.up.railway.app",c=ge(),p=c.currentRoute.value,l=y(p.query.fromSubBudgets==="true"),{isLoading:b,isFetching:g,orders:m,purchaseOrderType:_}=ke({fromSubBudgets:l}),h=[{name:"consecutiveId",label:"ID",field:"consecutiveId",sortable:!1,required:!0},{name:"area",field:r=>{var t,n;return(n=(t=r.requisition)==null?void 0:t.area)==null?void 0:n.name},label:"Departamento",sortalbe:!0,align:"left"},{name:"event",field:"event",label:"Evento",sortable:!1,align:"left"},{name:"order_number",field:"order_number",label:"N\xFAmero de orden de compra",align:"center",sortable:!0},{name:"reception_date",field:"reception_date",label:"Fecha de recepci\xF3n",sortable:!0,align:"left"},{name:"requisition",field:r=>{var t;return(t=r.requisition)==null?void 0:t.requisition_number},label:"Requisici\xF3n",sortable:!0,align:"center"},{name:"file",field:"file",label:"Archivo",sortable:!1,align:"left"}],q=y(!1),s=y(1),S=y(["area","order_number","reception_date","requisition","file"]),v=y("");_e(()=>{l.value&&S.value.splice(1,0,"event")}),be(l,r=>{c.replace({query:{...p.query,fromSubBudgets:r.toString()}}),r?S.value.splice(1,0,"event"):S.value.splice(1,1)});const Q=f(()=>_.value===""?"Selecciona un tipo de orden de compra":_.value==="PRESUPUESTO"?"Presupuesto":"SubPresupuesto");function x(r){_.value=r,s.value=2}return(r,t)=>(O(),T(Re,null,{default:o(()=>[a(Ue,null,{"card-body":o(()=>[a(Pe,{columns:h,filter:v.value,loading:F(b)||F(g),pagination:{rowsPerPage:20},rows:F(m),"visible-columns":S.value,"wrap-cells":""},{top:o(()=>[qe("div",Ze," \xD3rdenes de compra/"+V(l.value?"SubPresupuestos":"Presupuestos"),1),a(oe),a(le,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=n=>l.value=n),class:"tw-mr-4",label:"Mostrar las \xF3rdenes de compra de los SubPresupuestos"},null,8,["modelValue"]),a(ee,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=n=>v.value=n),class:"q-mr-xs",clearable:"",debounce:"300",dense:"",outlined:"",placeholder:"Buscar"},{append:o(()=>[a($,{name:"search"})]),_:1},8,["modelValue"]),a(U,{color:"primary",label:"Nueva orden de compra",onClick:t[2]||(t[2]=n=>q.value=!0)})]),"body-cell-consecutiveId":o(n=>[a(M,{props:n},{default:o(()=>[R(V((n.rowIndex+1).toString()),1)]),_:2},1032,["props"])]),"body-cell-file":o(n=>[a(M,{props:n},{default:o(()=>[n.value?(O(),T(Me,{key:0,"file-url":`${F(u)}/api/files/purchase-orders/${n.id}/${n.value}`},null,8,["file-url"])):B("",!0)]),_:2},1032,["props"])]),_:1},8,["filter","loading","rows","visible-columns"])]),footer:o(()=>[a(He,{modelValue:q.value,"onUpdate:modelValue":t[7]||(t[7]=n=>q.value=n),"card-title":"Orden de Compra",class:"form-purchase-order"},{default:o(()=>[a(Ge,{modelValue:s.value,"onUpdate:modelValue":t[6]||(t[6]=n=>s.value=n),animated:"",color:"primary",vertical:""},{default:o(()=>[a(J,{done:s.value>1,icon:"settings",name:1,title:"Selecciona un tipo de orden de compra"},{default:o(()=>[a(G,{class:"tw-flex tw-gap-1"},{default:o(()=>[a(U,{color:"primary",label:"Presupuesto",outline:"",onClick:t[3]||(t[3]=n=>x("PRESUPUESTO"))}),a(U,{color:"primary",label:"SubPresupuesto",outline:"",onClick:t[4]||(t[4]=n=>x("SUBPRESUPUESTO"))})]),_:1})]),_:1},8,["done"]),a(J,{caption:F(Q),done:s.value>2,icon:"create_new_folder",name:2,title:"Crear Orden de Compra"},{default:o(()=>[a(we,{bordered:"",flat:""},{default:o(()=>[a(Ye)]),_:1}),a(G,null,{default:o(()=>[a(U,{color:"primary",flat:"",label:"atr\xE1s",onClick:t[5]||(t[5]=n=>{s.value=1,_.value=""})})]),_:1})]),_:1},8,["caption","done"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})]),_:1}))}});export{At as default};
