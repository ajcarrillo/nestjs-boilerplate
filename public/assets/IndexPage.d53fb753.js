import{j as V,M as Q,r as x,c as S,p as C,k as q,l as o,d as t,X as _,u as p,w as M,_ as U,s as T,O as L}from"./index.fd322d53.js";import{l as w,Q as h}from"./layout.f54ea114.js";import{Q as B,a as D}from"./QTable.e67cb383.js";import{T as $}from"./TablePage.43569ace.js";import{Q as z,a as K}from"./QItemLabel.c8d4dbcb.js";import{Q as j}from"./QList.95d5dd46.js";import{Q as O}from"./QCardSection.64ffc5d5.js";import{a as P}from"./format.971bd004.js";import{Q as G}from"./QCardActions.b146cc88.js";import{A as E,u as H}from"./app.aade59bf.js";import{u as R,a as I}from"./QChip.a1dbb620.js";import{u as N}from"./useMutation.esm.35cc447d.js";import{c as k}from"./index.7adaf3a2.js";import{Q as X}from"./QForm.c8935c1a.js";import{_ as J}from"./CardDialog.290c89a5.js";import"./use-dark.724c4dc5.js";import"./planeacion.api.6ff597f7.js";import"./index.2cf0d985.js";import"./QSelect.7b234108.js";import"./scroll.86be79e5.js";import"./QCheckbox.09c2ac40.js";import"./QCard.b959a5ba.js";import"./QPage.5abcef1e.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./ArticleResource.acb3dbf0.js";import"./utils.esm.ed5e8086.js";import"./mutation.esm.8f60915a.js";import"./QSpace.a559b592.js";const W=async()=>{const{data:a}=await E.getActions();return a},Y=async a=>{const{data:e}=await E.storeAction(a);return e},Z=async a=>{const{id:e,name:l}=a,{data:r}=await E.updateAction(e,{name:l});return r},tt=()=>{const{isLoading:a,isError:e,data:l,error:r}=R({queryKey:["actions"],queryFn:W,staleTime:6e5});return{isLoading:a,isError:e,data:l,error:r}},at=()=>{const a=I();return{actionStoreMutations:N({mutationFn:Y,onSuccess:()=>{a.invalidateQueries({queryKey:["actions"]}),w.showSuccessNotification("Acci\xF3n creada con \xE9xito")},onError:()=>{w.showErrorNotification("Error al crear acci\xF3n")}})}},et=()=>{const a=I();return{actionUpdateMutations:N({mutationFn:Z,onSuccess:()=>{a.invalidateQueries({queryKey:["actions"]}),w.showSuccessNotification("Acci\xF3n actualizada con \xE9xito")},onError:()=>{w.showErrorNotification("Error al actualizar acci\xF3n")}})}},ot=V({__name:"ActionForm",props:{action:null},setup(a){const e=a,l=H(),{fetchActionDictionary:r}=l,{actionStoreMutations:A}=at(),{isLoading:s}=A,{actionUpdateMutations:f}=et(),{isLoading:y}=f,b=Q({name:""}),u=Q(k(e.action||b)),g=x(),F={name:[d=>!!d||"El nombre es requerido"]},c=S(()=>e.action&&"id"in e.action);S(()=>c.value?"Editar acci\xF3n":"Agregar acci\xF3n");async function i(){var m,v;!await((m=g.value)==null?void 0:m.validate())||(c.value?(await f.mutateAsync(u),await n()):(await A.mutateAsync(u),u.name="",(v=g.value)==null||v.reset(),await n()))}async function n(){await r()}return(d,m)=>(C(),q(p(X),{ref_key:"actionForm",ref:g,class:"q-gutter-md"},{default:o(()=>[t(O,null,{default:o(()=>[t(j,null,{default:o(()=>[t(z,null,{default:o(()=>[t(K,null,{default:o(()=>[t(h,{modelValue:u.name,"onUpdate:modelValue":m[0]||(m[0]=v=>u.name=v),dense:"",label:"Nombre",outlined:"",rules:F.name},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),t(P),t(G,{align:"right"},{default:o(()=>[t(_,{color:"primary",label:"Guardar",loading:p(s)||p(y),onClick:i},null,8,["loading"])]),_:1})]),_:1},512))}}),nt={class:"q-gutter-sm"},kt=V({__name:"IndexPage",setup(a){const{data:e,isLoading:l}=tt(),r=x(""),A=[{name:"id",field:"id",required:!0,label:"ID",sortable:!0,align:"left"},{name:"name",field:"name",label:"Nombre",sortable:!0,align:"left"},{name:"action",align:"center",label:"Acciones",field:"action",sortable:!1}],s=x(!1),f=x(-1);let y=Q({name:""});const b=Q({name:""}),u=S(()=>f.value===-1?"Nueva acci\xF3n":"Editar acci\xF3n");M(s,c=>{c||F()});function g(c){var d;const{name:i,id:n}=c;f.value=(d=e.value)==null?void 0:d.findIndex(m=>m.id===c.id),y=Object.assign({},{id:n,name:i}),s.value=!0}function F(){s.value=!1,L(()=>{y=k(b),f.value=-1})}return(c,i)=>(C(),q($,null,{"card-body":o(()=>[t(D,{columns:A,loading:p(l),rows:p(e),"rows-per-page-options":[20,30,40,50],title:"Acciones"},{"top-right":o(()=>[t(_,{class:"q-mr-xs",color:"primary",icon:"add",label:"Nueva Acci\xF3n",outline:"",onClick:i[0]||(i[0]=n=>s.value=!0)}),t(h,{modelValue:r.value,"onUpdate:modelValue":i[1]||(i[1]=n=>r.value=n),class:"q-mr-xs",debounce:"300",dense:"",outlined:"",placeholder:"Search"},{append:o(()=>[t(U,{name:"search"})]),_:1},8,["modelValue"]),t(_,{color:"primary","icon-right":"archive",label:"Exportar CSV","no-caps":""})]),"body-cell-action":o(n=>[t(B,{props:n},{default:o(()=>[T("div",nt,[t(_,{color:"primary",dense:"",flat:"",icon:"edit",rounded:"",size:"sm",onClick:d=>g(n.row)},null,8,["onClick"])])]),_:2},1032,["props"])]),_:1},8,["loading","rows"])]),footer:o(()=>[t(J,{modelValue:s.value,"onUpdate:modelValue":i[2]||(i[2]=n=>s.value=n),"card-title":p(u)},{default:o(()=>[t(ot,{action:p(y)},null,8,["action"])]),_:1},8,["modelValue","card-title"])]),_:1}))}});export{kt as default};
