import{j as F,r as M,M as L,w as S,c as v,ae as h,u as s,d as l,l as e,ah as I,s as R,p as m,_ as j,X as J,q as n,F as x,ai as w,t as u,k as O}from"./index.a852c7dd.js";import{Q as P}from"./QInput.5a757dc1.js";import{b as E,Q as d,a as Y}from"./QTable.14f30bfe.js";import{Q as A}from"./QTr.f1adea96.js";import{u as $}from"./useMoney.dbc60660.js";import{M as z,D}from"./constants.e9961e47.js";import{u as G}from"./useQuery.esm.6e7da3a0.js";import{u as K}from"./useExportDataToCsv.013a913a.js";import"./use-key-composition.0193e5f8.js";import"./use-dark.84119dd2.js";import"./focus-manager.387b0375.js";import"./QMenu.1dc72ab8.js";import"./scroll.1d333f42.js";import"./QList.3193c694.js";import"./QSelect.52923b78.js";import"./format.d73ecc87.js";import"./QItem.3abe05b4.js";import"./QItemLabel.aabbfeaa.js";import"./QCheckbox.ecd43410.js";import"./BudgetResource.e21a87b9.js";import"./index.2cf0d985.js";import"./utils.esm.3b6b5005.js";import"./date.b0104a9d.js";import"./layout.1849cf49.js";const U=async f=>{const{data:p}=await z.getAllByYear(f);return p},X=({budgetYear:f})=>{const{isLoading:p,isError:_,data:T,error:b}=G({queryKey:["monthly-allocations",f],queryFn:()=>U(f),staleTime:6e5});return{isLoading:p,isError:_,allocations:T,error:b}},H={class:"q-pa-md"},W=R("div",{class:"text-h4"},"Asignaci\xF3n de \xC1reas",-1),Z={key:0},Aa=F({__name:"AllocationsPage",setup(f){const{exportDataToCsv:p}=K(),_=M(),{allocations:T,isLoading:b,isError:aa,error:ta}=X({budgetYear:2025}),{currencyFormat:g}=$(),y=M(""),i=L({allocations:[],monthTotals:new Array(12).fill(0),grandTotal:0});D.forEach((o,t)=>{const a=`dept-${t+1}`;Array.from({length:12},()=>0).reduce((r,c,N)=>(r[N+1]=0,r),{})}),S(T,o=>{i.allocations=D.map(t=>({areaName:t,allocations:Array.from({length:12},()=>0).reduce((a,r,c)=>(a[c+1]=0,a),{}),total:0})),i.monthTotals.fill(0),i.grandTotal=0,o==null||o.forEach(({areaName:t,month:a,allocatedAmount:r})=>{const c=i.allocations.find(N=>N.areaName===t);c&&(c.allocations[a]=r,c.total+=r,i.monthTotals[a-1]+=r,i.grandTotal+=r)})},{immediate:!0});const Q=v(()=>y.value?i.allocations.filter(o=>o.areaName.toLowerCase().includes(y.value.toLowerCase())):i.allocations);function k(o){return["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][o-1]||""}const C=v(()=>{const o=new Array(12).fill(0);return Q.value.forEach(t=>{Object.entries(t.allocations).forEach(([a,r])=>{o[+a-1]+=r})}),o}),B=v(()=>C.value.reduce((o,t)=>o+t,0)),V=[{name:"areaName",label:"Departamento",align:"left",field:"areaName"},...Array.from({length:12},(o,t)=>({name:`month${t+1}`,label:k(t+1),align:"right",field:a=>a.allocations&&a.allocations[t+1]!==void 0?a.allocations[t+1]:0})),{name:"total",label:"Total",align:"right",field:"total"}];function q(){p(_.value.filteredSortedRows,V,"allocations")}return(o,t)=>(m(),h("div",H,[W,s(b)?I("",!0):(m(),h("div",Z,[l(s(Y),{ref_key:"qTableAllocations",ref:_,bordered:"",flat:"",rows:s(Q),"rows-per-page-options":[0],separator:"cell"},{"top-right":e(()=>[l(P,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=a=>y.value=a),debounce:"300",dense:"",outlined:"",placeholder:"Buscar"},{append:e(()=>[l(j,{name:"search"})]),_:1},8,["modelValue"]),l(J,{class:"q-ml-sm",color:"primary",label:"Exportar a CSV",onClick:q})]),header:e(()=>[l(A,null,{default:e(()=>[l(E,null,{default:e(()=>[n("Deptos")]),_:1}),(m(),h(x,null,w(12,a=>l(E,{key:a,class:"text-right"},{default:e(()=>[n(u(k(a)),1)]),_:2},1024)),64)),l(E,{class:"text-right"},{default:e(()=>[n("Total")]),_:1})]),_:1})]),body:e(a=>[l(A,{props:a},{default:e(()=>[l(d,null,{default:e(()=>[n(u(a.row.areaName),1)]),_:2},1024),(m(),h(x,null,w(12,r=>l(d,{key:r,class:"text-right"},{default:e(()=>[n(u(s(g)(a.row.allocations[r]||0)),1)]),_:2},1024)),64)),l(d,{class:"text-right tw-font-bold"},{default:e(()=>[n(u(s(g)(a.row.total)),1)]),_:2},1024)]),_:2},1032,["props"])]),"bottom-row":e(()=>[l(A,{class:"tw-font-bold"},{default:e(()=>[l(d,null,{default:e(()=>[n("Total")]),_:1}),(m(!0),h(x,null,w(s(C),(a,r)=>(m(),O(d,{key:r,class:"text-right"},{default:e(()=>[n(u(s(g)(a)),1)]),_:2},1024))),128)),l(d,{class:"text-right"},{default:e(()=>[n(u(s(g)(s(B))),1)]),_:1})]),_:1})]),_:1},8,["rows"])]))]))}});export{Aa as default};
