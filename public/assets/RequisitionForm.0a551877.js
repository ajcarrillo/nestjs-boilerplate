import{r as _,j as X,M as J,V as K,c as E,o as W,p as g,ag as F,d as a,l as t,s as r,_ as m,u as n,b as Z,ap as ee,b2 as ae,q as A,t as D,ah as N,X as V,aj as M,F as ie}from"./index.fd322d53.js";import{l as oe,Q as c}from"./layout.f54ea114.js";import{Q as te,a as se,b as k}from"./QItemLabel.c8d4dbcb.js";import{Q as le}from"./QSelect.7b234108.js";import{Q as C,a as S}from"./QPopupProxy.69a11e34.js";import{Q as re}from"./QFile.a368e704.js";import{a as ne}from"./format.971bd004.js";import{Q as ue}from"./QSpace.a559b592.js";import{C as L}from"./ClosePopup.ad77fb2e.js";import{Q as de}from"./QForm.c8935c1a.js";import{R as me,u as pe,a as ce}from"./useRequisitions.cd31b813.js";import{c as P}from"./index.7adaf3a2.js";import{F as _e}from"./FilePreview.41e280fe.js";import{c as fe}from"./useAreas.db260936.js";const qe=()=>{const d=_(),l=_(!1);return{isLoading:l,requisitionFile:d,uploadRequisitionFile:async f=>{const p=new FormData;p.append("file",d.value),l.value=!0;const{data:q}=await me.uploadFile(f,p);return l.value=!1,oe.showSuccessNotification("Archivo subido con \xE9xito"),d.value=void 0,q.file_name}}},ve={class:"row q-gutter-md"},be={class:"col"},ge={class:"row q-gutter-md"},Fe={class:"col"},Ve={class:"row q-gutter-md"},xe={class:"col"},we={class:"row q-gutter-md"},he={class:"col"},ye={class:"row items-center justify-end"},Qe={class:"col"},Re={class:"row items-center justify-end"},Ue={key:0,class:"row q-gutter-md"},Ee={class:"col"},Ae={key:0,class:"col"},De={class:"row q-mt-md"},ze=X({__name:"RequisitionForm",props:{requisition:{default:()=>({requisition_number:"",preparation_date:"",processing_date:"",estimated_amount:0,area_id:"",area:null})}},setup(d){const l=d,x="https://nestjs-boilerplate-production.up.railway.app",{uploadRequisitionFile:f,requisitionFile:p,isLoading:q}=qe(),{area:u,filterArea:Y,areasOptions:j}=fe(),I={requisition_number:"",preparation_date:"",processing_date:"",estimated_amount:0,area_id:"",area:null},o=J(P(l.requisition)||P(I)),w=_(),{requisitionStoreMutations:h}=pe(),{requisitionUpdateMutations:y}=ce(),{isLoading:B,data:$}=h,{isLoading:H}=y,O=K(),v={requisition_number:[s=>!!s||"El n\xFAmero de requisici\xF3n es requerido",s=>s.length==3||"El n\xFAmero de requisici\xF3n debe tener 3 d\xEDgitos",s=>!isNaN(Number(s))||"El n\xFAmero de requisici\xF3n debe ser un n\xFAmero"],estimated_amount:[s=>!!s||"El monto estimado es requerido",s=>!isNaN(Number(s))||"El monto estimado debe ser un n\xFAmero"],area_id:[s=>!!s||"El \xE1rea es requerida"]},b=_(),Q=E(()=>!!l.requisition.id),z=E(()=>!l.requisition.details||l.requisition.details.length==0);W(()=>{l.requisition.area&&(u.value={label:l.requisition.area.alias,full_description:l.requisition.area.description,value:l.requisition.area.id})});async function G(){var i,e,R,U;!await((i=w.value)==null?void 0:i.validate())||(Q.value?await y.mutateAsync({...o,area_id:(U=u.value)==null?void 0:U.value}):(await h.mutateAsync({...o,area_id:(e=u.value)==null?void 0:e.value}),await O.push({name:"requisitions.edit",params:{id:(R=$.value)==null?void 0:R.id}})))}async function T(s){p.value=s,o.file=await f(l.requisition.id),b.value=void 0}return(s,i)=>(g(),F(ie,null,[a(n(de),{ref_key:"qRequisitionForm",ref:w,class:"q-pb-md"},{default:t(()=>[r("div",ve,[r("div",be,[a(c,{modelValue:o.requisition_number,"onUpdate:modelValue":i[0]||(i[0]=e=>o.requisition_number=e),"bg-color":"white",counter:"",dense:"",label:"N\xFAmero de requisici\xF3n",maxlength:"3",outlined:"",rules:v.requisition_number},{prepend:t(()=>[a(m,{name:"tag"})]),_:1},8,["modelValue","rules"])])]),r("div",ge,[r("div",Fe,[a(le,{modelValue:n(u),"onUpdate:modelValue":i[1]||(i[1]=e=>Z(u)?u.value=e:null),"bg-color":"white",dense:"","input-debounce":"0",label:"Departamentos",options:n(j),outlined:"",rules:v.area_id,"use-input":"",onFilter:n(Y)},{option:t(e=>[a(te,ee(ae(e.itemProps)),{default:t(()=>[a(se,null,{default:t(()=>[a(k,null,{default:t(()=>[A(D(e.opt.full_description),1)]),_:2},1024),a(k,{caption:""},{default:t(()=>[A(D(e.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules","onFilter"])])]),r("div",Ve,[r("div",xe,[a(c,{modelValue:o.estimated_amount,"onUpdate:modelValue":i[2]||(i[2]=e=>o.estimated_amount=e),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Monto estimado",outlined:"",readonly:!n(z),rules:v.estimated_amount,type:"number"},{prepend:t(()=>[a(m,{name:"attach_money"})]),_:1},8,["modelValue","readonly","rules"])])]),r("div",we,[r("div",he,[a(c,{modelValue:o.preparation_date,"onUpdate:modelValue":i[4]||(i[4]=e=>o.preparation_date=e),dense:"",label:"Fecha de elaboraci\xF3n",outlined:"",rules:[e=>!!e||"La fecha de elaboraci\xF3n es requerida"]},{append:t(()=>[a(m,{class:"cursor-pointer",name:"event"},{default:t(()=>[a(C,{cover:"","transition-hide":"scale","transition-show":"scale"},{default:t(()=>[a(S,{modelValue:o.preparation_date,"onUpdate:modelValue":i[3]||(i[3]=e=>o.preparation_date=e),mask:"YYYY-MM-DD"},{default:t(()=>[r("div",ye,[N(a(V,{color:"primary",flat:"",label:"Close"},null,512),[[L]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])]),r("div",Qe,[a(c,{modelValue:o.processing_date,"onUpdate:modelValue":i[6]||(i[6]=e=>o.processing_date=e),dense:"",label:"Fecha de tr\xE1mite",outlined:"",rules:[e=>!!e||"La fecha de tr\xE1mite es requerida"]},{append:t(()=>[a(m,{class:"cursor-pointer",name:"event"},{default:t(()=>[a(C,{cover:"","transition-hide":"scale","transition-show":"scale"},{default:t(()=>[a(S,{modelValue:o.processing_date,"onUpdate:modelValue":i[5]||(i[5]=e=>o.processing_date=e),mask:"YYYY-MM-DD"},{default:t(()=>[r("div",Re,[N(a(V,{color:"primary",flat:"",label:"Close"},null,512),[[L]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])])]),n(Q)?(g(),F("div",Ue,[r("div",Ee,[a(re,{modelValue:b.value,"onUpdate:modelValue":[i[7]||(i[7]=e=>b.value=e),T],accept:".jpg, image/*, application/pdf",dense:"",label:"Haga click para subir el archivo o arrastralo aqu\xED",loading:n(q),outlined:""},{prepend:t(()=>[a(m,{name:"attach_file"})]),_:1},8,["modelValue","loading"])]),o.file?(g(),F("div",Ae,[a(_e,{"file-url":`${n(x)}/api/files/requisitions/${l.requisition.id}/${o.file}`},null,8,["file-url"])])):M("",!0)])):M("",!0)]),_:1},512),a(ne),r("div",De,[a(ue),r("div",null,[a(V,{color:"primary",label:"Guardar",loading:n(B)||n(H),onClick:G},null,8,["loading"])])])],64))}});export{ze as _};
