import{Q as se,a as J}from"./QSpace.806ddb40.js";import{Q as W,b as w,k as I,a as Q,c as L}from"./format.5c2ef003.js";import{u as de,a as me,Q as ce}from"./useTableFilter.47a0e0b4.js";import{Q as X}from"./QList.5b32bffe.js";import{v as Y,r as x,c as Z,h as B,g as fe,J as be,aU as pe,a2 as ve,X as A,x as ye,b0 as _e,j as z,V as ee,m as H,N as te,w as le,p as S,k as R,l as a,d as e,q as s,t as d,u as q,b as ae,s as U,_ as $,aH as ge,av as we,b1 as Ve,ag as oe,F as ne,at as ue,b2 as N}from"./index.3368071b.js";import{a as j,Q as he}from"./QForm.b003c7e9.js";import{Q as qe}from"./QBtnGroup.2c085fd2.js";import{a as xe,Q as v}from"./QTable.389e2b81.js";import{Q as ke}from"./QPage.1cbbdd27.js";import{b as Qe}from"./useBudgets.eb8f2a86.js";import{T as Ce}from"./TablePage.d279c911.js";import{a as K,Q as Me}from"./QCard.39cdd76c.js";import{g as De,f as O}from"./QSelect.37b48709.js";import{Q as Se}from"./QCardActions.b7416617.js";import{u as je}from"./useDictionaries.b48501a3.js";import{c as ie}from"./index.7adaf3a2.js";import{u as Be,a as Ue}from"./useBudgetDetail.c855cf40.js";import{u as Ae}from"./useExportDataToCsv.b458a9cb.js";import"./scroll.0ed17dea.js";import"./use-dark.df68422f.js";import"./focus-manager.33224ae2.js";import"./QCheckbox.0e68f13b.js";import"./layout.e94e56b8.js";import"./index.2cf0d985.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./utils.esm.6355ed5c.js";import"./app.687a1927.js";import"./ActionResource.a4dd4a2d.js";import"./LineResource.3b098459.js";import"./ArticleResource.fdc89ee4.js";import"./date.2891a3b3.js";function E(o,b=new WeakMap){if(Object(o)!==o)return o;if(b.has(o))return b.get(o);const r=o instanceof Date?new Date(o):o instanceof RegExp?new RegExp(o.source,o.flags):o instanceof Set?new Set:o instanceof Map?new Map:typeof o.constructor!="function"?Object.create(null):o.prototype!==void 0&&typeof o.prototype.constructor=="function"?o:new o.constructor;if(typeof o.constructor=="function"&&typeof o.valueOf=="function"){const m=o.valueOf();if(Object(m)!==m){const _=new o.constructor(m);return b.set(o,_),_}}return b.set(o,r),o instanceof Set?o.forEach(m=>{r.add(E(m,b))}):o instanceof Map&&o.forEach((m,_)=>{r.set(_,E(m,b))}),Object.assign(r,...Object.keys(o).map(m=>({[m]:E(o[m],b)})))}var G=Y({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(o,{slots:b,emit:r}){const{proxy:m}=fe(),{$q:_}=m,p=x(null),y=x(""),f=x("");let V=!1;const C=Z(()=>ve({initialValue:y.value,validate:o.validate,set:M,cancel:h,updatePosition:D},"value",()=>f.value,c=>{f.value=c}));function M(){o.validate(f.value)!==!1&&(i()===!0&&(r("save",f.value,y.value),r("update:modelValue",f.value)),g())}function h(){i()===!0&&r("cancel",f.value,y.value),g()}function D(){be(()=>{p.value.updatePosition()})}function i(){return pe(f.value,y.value)===!1}function g(){V=!0,p.value.hide()}function T(){V=!1,y.value=E(o.modelValue),f.value=E(o.modelValue),r("beforeShow")}function F(){r("show")}function P(){V===!1&&i()===!0&&(o.autoSave===!0&&o.validate(f.value)===!0?(r("save",f.value,y.value),r("update:modelValue",f.value)):r("cancel",f.value,y.value)),r("beforeHide")}function n(){r("hide")}function u(){const c=b.default!==void 0?[].concat(b.default(C.value)):[];return o.title&&c.unshift(B("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},o.title)),o.buttons===!0&&c.push(B("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[B(A,{flat:!0,color:o.color,label:o.labelCancel||_.lang.label.cancel,onClick:h}),B(A,{flat:!0,color:o.color,label:o.labelSet||_.lang.label.set,onClick:M})])),c}return Object.assign(m,{set:M,cancel:h,show(c){p.value!==null&&p.value.show(c)},hide(c){p.value!==null&&p.value.hide(c)},updatePosition:D}),()=>{if(o.disable!==!0)return B(W,{ref:p,class:"q-popup-edit",cover:o.cover,onBeforeShow:T,onShow:F,onBeforeHide:P,onHide:n,onEscapeKey:h},u)}}}),Te=Y({name:"QTr",props:{props:Object,noHover:Boolean},setup(o,{slots:b}){const r=Z(()=>"q-tr"+(o.props===void 0||o.props.header===!0?"":" "+o.props.__trClass)+(o.noHover===!0?" q-tr--no-hover":""));return()=>B("tr",{class:r.value},ye(b.default))}});const Fe=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],Pe=(o,b=0,r=!1)=>{let m;return(..._)=>{r&&!m&&o(..._),clearTimeout(m),m=setTimeout(()=>{o(..._)},b)}},Oe=(o,b,r)=>{const m=x(o);return _e((_,p)=>({get(){return _(),m.value},set:Pe(y=>{m.value=y,p()},b,r)}))},Ee={class:"self-center full-width no-outline",tabindex:"0"},Ie=z({__name:"MonthBudgetForm",props:{month:null,budgetMonth:{default:()=>({quantity:0})},estimatedAmount:{default:0}},emits:["update:quantity"],setup(o,{emit:b}){const r=o;ee();const m=H(),{id:_}=m.params,p=te(ie(r.budgetMonth)),y=Oe(p.quantity||0,250,!1);return le(y,f=>{f>0&&(p.quantity=f,p.month=r.month,p.budget_detail_id=_,b("update:quantity",p))}),(f,V)=>(S(),R(Q,null,{default:a(()=>[e(w,null,{default:a(()=>[e(I,{overline:""},{default:a(()=>[s(d(o.month),1)]),_:1}),e(j,{modelValue:q(y),"onUpdate:modelValue":V[0]||(V[0]=C=>ae(y)?y.value=C:null),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Cantidad",outlined:"",type:"number"},null,8,["modelValue"])]),_:1}),e(w,{side:""},{default:a(()=>[e(I,{overline:""},{default:a(()=>[s("\xA0\xA0\xA0")]),_:1}),e(De,{dense:"",label:"Total",outlined:"","stack-label":""},{control:a(()=>[U("div",Ee,d(p.quantity*r.estimatedAmount),1)]),prepend:a(()=>[e($,{name:"o_attach_money"})]),_:1})]),_:1})]),_:1}))}}),Re=U("div",{class:"tw-text-xl"},"Agregar bien",-1),$e=z({__name:"BudgetDetailForm",setup(o){ee();const b=H(),{id:r}=b.params,{actionDictionary:m,lineDictionary:_,areaDictionary:p,getArticleByName:y}=je(),{storeBudgetDetailMutation:f}=Be(),{isLoading:V}=f,C=x(m.value),M=x(_.value),h=x(p.value),D=x([]),i=te({action:null,line:null,area:null,article:null,estimated_amount:0,justification:"",month:[],total:0,budgetMonths:[]}),g=x([]);ge(()=>{if(g.value.length>0){const c=g.value.reduce((l,t)=>l+t.quantity,0);i.total=c*i.estimated_amount}});function T(c,l,t){l(()=>{const k=c.toLowerCase();h.value=p.value.filter(re=>re.label.toLowerCase().indexOf(k)>-1)})}function F(c,l,t){if(c.length<2){t();return}l(()=>{const k=c.toLowerCase();D.value=y(k).value})}function P(c){const l=g.value.findIndex(t=>t.month===c.month);l>-1?g.value[l]=c:g.value.push(c)}function n({value:c}){g.value=g.value.filter(l=>l.month!==c)}async function u(){i.budgetMonths=g.value,await f.mutateAsync({budgetId:r,budgetDetail:i}),i.action=null,i.line=null,i.area=null,i.article=null,i.estimated_amount=0,i.justification="",i.month=[],i.total=0,i.budgetMonths=[],g.value=[]}return(c,l)=>(S(),R(Me,null,{default:a(()=>[e(K,null,{default:a(()=>[Re]),_:1}),e(L),e(K,{class:"tw-px-0"},{default:a(()=>[e(he,null,{default:a(()=>[e(X,null,{default:a(()=>[e(Q,null,{default:a(()=>[e(w,null,{default:a(()=>[e(O,{modelValue:i.action,"onUpdate:modelValue":l[0]||(l[0]=t=>i.action=t),dense:"",label:"ACC",options:C.value,outlined:""},null,8,["modelValue","options"])]),_:1})]),_:1}),e(Q,null,{default:a(()=>[e(w,null,{default:a(()=>[e(O,{modelValue:i.line,"onUpdate:modelValue":l[1]||(l[1]=t=>i.line=t),dense:"",label:"Partida",options:M.value,outlined:""},null,8,["modelValue","options"])]),_:1})]),_:1}),e(Q,null,{default:a(()=>[e(w,null,{default:a(()=>[e(O,{modelValue:i.area,"onUpdate:modelValue":l[2]||(l[2]=t=>i.area=t),dense:"",label:"\xC1rea",options:h.value,outlined:"","use-input":"",onFilter:T},null,8,["modelValue","options"])]),_:1})]),_:1}),e(Q,null,{default:a(()=>[e(w,null,{default:a(()=>[e(O,{modelValue:i.article,"onUpdate:modelValue":l[3]||(l[3]=t=>i.article=t),dense:"",hint:"M\xEDnimo 2 caracteres para activar el filtrado",label:"Art\xEDculos",options:D.value,outlined:"","use-input":"",onFilter:F},{option:a(t=>[e(Q,we(Ve(t.itemProps)),{default:a(()=>[e(w,null,{default:a(()=>[e(I,null,{default:a(()=>[s(d(t.opt.label),1)]),_:2},1024),e(I,{caption:""},{default:a(()=>[s(d(t.opt.caption),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])]),_:1})]),_:1}),e(Q,null,{default:a(()=>[e(w,null,{default:a(()=>[e(j,{modelValue:i.justification,"onUpdate:modelValue":l[4]||(l[4]=t=>i.justification=t),dense:"",label:"Justificaci\xF3n",outlined:"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),e(Q,null,{default:a(()=>[e(w,null,{default:a(()=>[e(j,{modelValue:i.estimated_amount,"onUpdate:modelValue":l[5]||(l[5]=t=>i.estimated_amount=t),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Monto estimado",outlined:"",type:"number"},{prepend:a(()=>[e($,{name:"o_attach_money"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(Q,null,{default:a(()=>[e(w,null,{default:a(()=>[e(O,{modelValue:i.month,"onUpdate:modelValue":l[6]||(l[6]=t=>i.month=t),dense:"",label:"Mes",multiple:"",options:q(Fe),outlined:"","use-chips":"",onRemove:n},null,8,["modelValue","options"])]),_:1})]),_:1}),(S(!0),oe(ne,null,ue(i.month,t=>(S(),R(Ie,{key:t,"estimated-amount":i.estimated_amount,month:t,"onUpdate:quantity":P},null,8,["estimated-amount","month"]))),128)),e(Q,null,{default:a(()=>[e(w,null,{default:a(()=>[e(j,{modelValue:i.total,"onUpdate:modelValue":l[7]||(l[7]=t=>i.total=t),dense:"","input-class":"tw-text-right",label:"Total",outlined:"",readonly:"",type:"number"},{prepend:a(()=>[e($,{name:"o_attach_money"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(L),e(Se,null,{default:a(()=>[e(se),e(A,{color:"primary",icon:"o_save",loading:q(V),unelevated:"",onClick:u},{default:a(()=>[s(" guardar ")]),_:1},8,["loading"])]),_:1})]),_:1}))}}),ze={class:"q-my-xs q-pt-sm q-ml-md tw-text-2xl tw-font-bold tw-text-slate-700"},He={class:"row"},Je={class:"col col-md-3 q-pa-sm"},Le={class:"col"},xt=z({__name:"DetailPage",setup(o){const{exportDataToCsv:b}=Ae(),{updateBudgetDetailMutation:r}=Ue(),m=x(),_=H(),{id:p}=_.params,{budget:y}=Qe(p),{currencyFormat:f}=me(),V=[{name:"consecutiveId",label:"ID",field:"consecutiveId",sortable:!1,required:!0},{name:"action",field:n=>n.action.name,label:"Acci\xF3n",sortable:!0,align:"left"},{name:"line",field:n=>n.line.name,label:"Partida",sortable:!0,align:"left"},{name:"department",field:n=>n.department.alias,label:"\xC1rea",sortable:!0,align:"left"},{name:"article",field:n=>n.article.name,label:"Bien",sortable:!0,align:"left"},{name:"article_description",field:n=>n.article.description,label:"Descripci\xF3n del bien",sortable:!0,align:"left"},{name:"justification",field:"justification",label:"Justificaci\xF3n",sortable:!0,align:"left"},{name:"enero",field:n=>{var u;return(u=n.enero)==null?void 0:u.quantity},label:"Enero",sortable:!0,align:"right"},{name:"febrero",field:n=>{var u;return(u=n.febrero)==null?void 0:u.quantity},label:"Febrero",sortable:!0,align:"right"},{name:"marzo",field:n=>{var u;return(u=n.marzo)==null?void 0:u.quantity},label:"Marzo",sortable:!0,align:"right"},{name:"abril",field:n=>{var u;return(u=n.abril)==null?void 0:u.quantity},label:"Abril",sortable:!0,align:"right"},{name:"mayo",field:n=>{var u;return(u=n.mayo)==null?void 0:u.quantity},label:"Mayo",sortable:!0,align:"right"},{name:"junio",field:n=>{var u;return(u=n.junio)==null?void 0:u.quantity},label:"Junio",sortable:!0,align:"right"},{name:"julio",field:n=>{var u;return(u=n.julio)==null?void 0:u.quantity},label:"Julio",sortable:!0,align:"right"},{name:"agosto",field:n=>{var u;return(u=n.agosto)==null?void 0:u.quantity},label:"Agosto",sortable:!0,align:"right"},{name:"septiembre",field:n=>{var u;return(u=n.septiembre)==null?void 0:u.quantity},label:"Septiembre",sortable:!0,align:"right"},{name:"octubre",field:n=>{var u;return(u=n.octubre)==null?void 0:u.quantity},label:"Octubre",sortable:!0,align:"right"},{name:"noviembre",field:n=>{var u;return(u=n.noviembre)==null?void 0:u.quantity},label:"Noviembre",sortable:!0,align:"right"},{name:"diciembre",field:n=>{var u;return(u=n.diciembre)==null?void 0:u.quantity},label:"Diciembre",sortable:!0,align:"right"},{name:"estimated_amount",field:n=>`${f(+n.estimated_amount)}`,label:"Precio",sortable:!0,align:"right"},{name:"total",field:n=>`${f(+n.total)}`,label:"Total",sortable:!0,align:"right"}],C=x(["action","line","department","article","estimated_amount","enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre","total"]),M=V.map(n=>({label:n.label,value:n.name})),{searchQuery:h,pagination:D,updatePagination:i}=de(),g=x([]);le(y,()=>{var n;g.value=ie(((n=y.value)==null?void 0:n.details)||[])},{immediate:!0});function T(){b(m.value.filteredSortedRows,V,"presupuesto")}async function F(n,u){u(),await r.mutateAsync({budgetDetail:n})}async function P(n,u){u(),await r.mutateAsync({budgetDetail:n})}return(n,u)=>(S(),R(ke,null,{default:a(()=>{var c;return[U("h5",ze,"Presupuesto "+d((c=q(y))==null?void 0:c.year),1),U("div",He,[U("div",Je,[e($e)]),U("div",Le,[e(Ce,null,{"card-body":a(()=>[e(q(xe),{ref_key:"qTablePresupuesto",ref:m,columns:V,filter:q(h),pagination:q(D),"row-key":"id",rows:g.value,"rows-per-page-options":[13,26,52,0],separator:"cell",title:"Detalle","visible-columns":C.value,"onUpdate:pagination":q(i)},{"top-right":a(l=>[e(A,{class:"tw-mr-2",color:"primary","fab-mini":"",flat:"",icon:"tune",size:"sm"},{default:a(()=>[e(J,null,{default:a(()=>[s(" Mostrar/Ocultar columnas ")]),_:1}),e(W,{anchor:"top end",self:"center start"},{default:a(()=>[e(X,null,{default:a(()=>[(S(!0),oe(ne,null,ue(q(M),t=>(S(),R(Q,{key:t.value,clickable:""},{default:a(()=>[e(w,null,{default:a(()=>[e(I,null,{default:a(()=>[s(d(t.label),1)]),_:2},1024)]),_:2},1024),e(w,{side:""},{default:a(()=>[e(ce,{modelValue:C.value,"onUpdate:modelValue":u[0]||(u[0]=k=>C.value=k),color:"primary",val:t.value},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(A,{dense:"",flat:"",icon:l.inFullscreen?"fullscreen_exit":"fullscreen",round:"",onClick:l.toggleFullscreen},{default:a(()=>[e(J,{disable:n.$q.platform.is.mobile},{default:a(()=>[s(d(l.inFullscreen?"Salir de Pantalla Completa":"Pantalla Completa"),1)]),_:2},1032,["disable"])]),_:2},1032,["icon","onClick"]),e(j,{modelValue:q(h),"onUpdate:modelValue":u[1]||(u[1]=t=>ae(h)?h.value=t:null),class:"q-mr-xs",clearable:"",debounce:"300",dense:"",outlined:"",placeholder:"Buscar"},{append:a(()=>[e($,{name:"search"})]),_:1},8,["modelValue"]),e(qe,{unelevated:""},{default:a(()=>[e(A,{color:"primary","icon-right":"archive",label:"Exportar a CSV",onClick:T})]),_:1})]),body:a(l=>[e(Te,{props:l},{default:a(()=>[e(v,{key:"consecutiveId",props:l},{default:a(()=>[s(d(l.rowIndex+1),1)]),_:2},1032,["props"]),e(v,{key:"action",props:l},{default:a(()=>[s(d(l.row.action.name),1)]),_:2},1032,["props"]),e(v,{key:"line",props:l},{default:a(()=>[s(d(l.row.line.name),1)]),_:2},1032,["props"]),e(v,{key:"department",props:l},{default:a(()=>[s(d(l.row.department.alias),1)]),_:2},1032,["props"]),e(v,{key:"article",props:l},{default:a(()=>[s(d(l.row.article.name),1)]),_:2},1032,["props"]),e(v,{key:"article_description",props:l},{default:a(()=>[s(d(l.row.article.description),1)]),_:2},1032,["props"]),e(v,{key:"justification",props:l},{default:a(()=>[s(d(l.row.justification),1)]),_:2},1032,["props"]),e(v,{key:"enero",props:l},{default:a(()=>{var t;return[s(d((t=l.row.enero)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(v,{key:"febrero",props:l},{default:a(()=>{var t;return[s(d((t=l.row.febrero)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(v,{key:"marzo",props:l},{default:a(()=>{var t;return[s(d((t=l.row.marzo)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(v,{key:"abril",props:l},{default:a(()=>{var t;return[s(d((t=l.row.abril)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(v,{key:"mayo",props:l},{default:a(()=>{var t;return[s(d((t=l.row.mayo)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(v,{key:"junio",props:l},{default:a(()=>{var t;return[s(d((t=l.row.junio)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(v,{key:"julio",props:l},{default:a(()=>{var t;return[s(d((t=l.row.julio)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(v,{key:"agosto",props:l},{default:a(()=>{var t;return[s(d((t=l.row.agosto)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(v,{key:"septiembre",props:l},{default:a(()=>{var t;return[s(d((t=l.row.septiembre)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(v,{key:"octubre",props:l},{default:a(()=>{var t;return[s(d((t=l.row.octubre)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(v,{key:"noviembre",props:l},{default:a(()=>{var t;return[s(d((t=l.row.noviembre)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(v,{key:"diciembre",props:l},{default:a(()=>{var t;return[s(d((t=l.row.diciembre)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(v,{key:"estimated_amount",class:"tw-cursor-pointer",props:l},{default:a(()=>[s(d(q(f)(+l.row.estimated_amount))+" ",1),e(G,{modelValue:l.row.estimated_amount,"onUpdate:modelValue":t=>l.row.estimated_amount=t},{default:a(t=>[e(j,{modelValue:t.value,"onUpdate:modelValue":k=>t.value=k,modelModifiers:{number:!0},autofocus:"",dense:"",outlined:"",type:"number",onKeyup:N(k=>P(l.row,t.set),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),e(v,{key:"total",class:"tw-cursor-pointer",props:l},{default:a(()=>[s(d(q(f)(+l.row.total))+" ",1),e(G,{modelValue:l.row.total,"onUpdate:modelValue":t=>l.row.total=t},{default:a(t=>[e(j,{modelValue:t.value,"onUpdate:modelValue":k=>t.value=k,modelModifiers:{number:!0},autofocus:"",dense:"",outlined:"",type:"number",onKeyup:N(k=>F(l.row,t.set),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["filter","pagination","rows","visible-columns","onUpdate:pagination"])]),_:1})])])]}),_:1}))}});export{xt as default};
