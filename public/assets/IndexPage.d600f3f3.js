import{j as I,M as Q,r as A,c as q,p as S,k as x,l as a,d as e,u as m,ah as T,X as V,S as L,aN as B,_ as R,q as $,t as z}from"./index.c148c0c6.js";import{Q as w}from"./QInput.e430ec3b.js";import{Q as K}from"./QBtnGroup.47b57af3.js";import{Q as k,a as h}from"./QTable.0ad6c918.js";import{c as j}from"./format.2ad21e77.js";import{T as G}from"./TablePage.8ac86ae8.js";import{Q as v,a as U}from"./QItem.2533442d.js";import{Q as F}from"./QSelect.48bd3f96.js";import{Q as P}from"./QList.21f703e4.js";import{p as _,u as W}from"./BudgetResource.04074e95.js";import{l as E}from"./layout.49dbfba7.js";import{u as H,a as M}from"./useQuery.esm.9d8865ca.js";import{u as D}from"./useMutation.esm.c5d42c0d.js";import{c as X}from"./index.7adaf3a2.js";import{Q as J}from"./QForm.667ad4d7.js";import{C as O}from"./CardForm.9648fbcb.js";import"./use-key-composition.2fce6913.js";import"./use-dark.74ed7cd3.js";import"./focus-manager.387b0375.js";import"./QMenu.f4712139.js";import"./scroll.789d8182.js";import"./QCheckbox.93825cb8.js";import"./QCard.029ff02f.js";import"./QPage.d291ee07.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./QItemLabel.cfb7cd9a.js";import"./index.2cf0d985.js";import"./utils.esm.6708c4fa.js";import"./mutation.esm.b17910c4.js";import"./QCardSection.c5a77f55.js";import"./QCardActions.3e077162.js";var C={getUsers(){return _.get("/users")},storeUser(l){const{area:o,...s}=l;return _.post("/users",{...s,area:o==null?void 0:o.value})},updateUser(l,o){const{area:s,...d}=o;return _.put(`/users/${l}`,{...d,area:s==null?void 0:s.value})}};const Y=async()=>{const{data:l}=await C.getUsers();return l},Z=async l=>{const{data:o}=await C.storeUser(l);return o},ee=async l=>{const{id:o,...s}=l,{data:d}=await C.updateUser(o,s);return d},ae=()=>{const{isLoading:l,isError:o,data:s,error:d}=H({queryKey:["users"],queryFn:Y,staleTime:6e5});return{isLoading:l,isError:o,data:s,error:d}},te=()=>{const l=M();return{userStoreMutations:D({mutationFn:Z,onSuccess:()=>{l.invalidateQueries({queryKey:["users"]}),E.showSuccessNotification("Usuario creado con \xE9xito")},onError:()=>{E.showErrorNotification("Error al crear usuario")}})}},le=()=>{const l=M();return{userUpdateMutations:D({mutationFn:ee,onSuccess:()=>{l.invalidateQueries({queryKey:["users"]}),E.showSuccessNotification("Usuario actualizado con \xE9xito")},onError:()=>{E.showErrorNotification("Error al actualizar usuario")}})}},oe=I({__name:"UserForm",props:{user:null,areas:null},setup(l){const o=l,{userStoreMutations:s}=te(),{isLoading:d}=s,{userUpdateMutations:N}=le(),{isLoading:y}=N,f=Q({email:"",firstName:"",isActive:!0,lastName:"",roles:[],password:"",area:null}),t=Q(X(o.user||f)),g=A(),b={email:[i=>!!i||"El email es requerido",i=>/.+@.+\..+/.test(i)||"El email debe ser v\xE1lido"],firstName:[i=>!!i||"El nombre es requerido"],lastName:[i=>!!i||"El apellido es requerido"],password:[i=>!!i||"El password es requerido"],roles:[i=>!!i.length||"Debe seleccionar al menos un rol"]},p=q(()=>o.user&&"id"in o.user),c=q(()=>p.value?"Editar usuario":"Agregar usuario");async function n(){var r,u;!await((r=g.value)==null?void 0:r.validate())||(p.value?await N.mutateAsync(t):(await s.mutateAsync(t),t.email="",t.firstName="",t.isActive=!0,t.lastName="",t.roles=[],t.password="",t.area=null,(u=g.value)==null||u.reset()))}return(i,r)=>(S(),x(O,{title:m(c)},{form:a(()=>[e(m(J),{ref_key:"userForm",ref:g,class:"q-gutter-md"},{default:a(()=>[e(P,null,{default:a(()=>[e(v,null,{default:a(()=>[e(U,null,{default:a(()=>[e(w,{modelValue:t.email,"onUpdate:modelValue":r[0]||(r[0]=u=>t.email=u),dense:"",label:"Email",outlined:"",rules:b.email},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(U,null,{default:a(()=>[e(w,{modelValue:t.firstName,"onUpdate:modelValue":r[1]||(r[1]=u=>t.firstName=u),dense:"",label:"Nombre",outlined:"",rules:b.firstName},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(U,null,{default:a(()=>[e(w,{modelValue:t.lastName,"onUpdate:modelValue":r[2]||(r[2]=u=>t.lastName=u),dense:"",label:"Apellido",outlined:"",rules:b.lastName},null,8,["modelValue","rules"])]),_:1})]),_:1}),m(p)?T("",!0):(S(),x(v,{key:0},{default:a(()=>[e(U,null,{default:a(()=>[e(w,{modelValue:t.password,"onUpdate:modelValue":r[3]||(r[3]=u=>t.password=u),dense:"",label:"Contrase\xF1a",outlined:"",rules:b.password,type:"password"},null,8,["modelValue","rules"])]),_:1})]),_:1})),e(v,null,{default:a(()=>[e(U,null,{default:a(()=>[e(F,{modelValue:t.area,"onUpdate:modelValue":r[4]||(r[4]=u=>t.area=u),dense:"",label:"Departamento","option-label":"full_description","option-value":"value",options:l.areas,outlined:""},null,8,["modelValue","options"])]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(U,null,{default:a(()=>[e(F,{modelValue:t.roles,"onUpdate:modelValue":r[5]||(r[5]=u=>t.roles=u),dense:"",label:"Roles",multiple:"",options:["admin","user","departament"],outlined:"",rules:b.roles},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1},512)]),actions:a(()=>[e(V,{color:"primary",label:"Guardar",loading:m(d)||m(y),onClick:n},null,8,["loading"])]),_:1},8,["title"]))}}),Te=I({__name:"IndexPage",setup(l){const o=W(),{areaDictionary:s}=L(o),{data:d,isLoading:N}=ae(),y=A(""),f=A(!1);let t=Q({email:"",firstName:"",isActive:!0,lastName:"",roles:[],password:""});const g=[{name:"consecutiveId",label:"ID",field:"consecutiveId",sortable:!1},{name:"email",field:"email",label:"Email",sortable:!0,align:"left"},{name:"firstName",field:"firstName",label:"Nombre",sortable:!0,align:"left"},{name:"lastName",field:"lastName",label:"Apellido",sortable:!0,align:"left"},{name:"isActive",field:"isActive",label:"Activo",sortable:!0,align:"left"},{name:"roles",field:p=>p.roles.join(", "),label:"Roles",sortable:!0,align:"left"},{name:"action",align:"center",label:"Acciones",field:"action",sortable:!1}];B(()=>{f.value||(t=Q({email:"",firstName:"",isActive:!0,lastName:"",roles:[],password:""}))});function b(p){f.value=!0,t=p}return(p,c)=>(S(),x(G,null,{"card-body":a(()=>[e(h,{columns:g,loading:m(N),"row-key":"id",rows:m(d),"rows-per-page-options":[20,30,40,50],title:"Usuarios"},{"top-right":a(()=>[e(w,{modelValue:y.value,"onUpdate:modelValue":c[0]||(c[0]=n=>y.value=n),class:"q-mr-xs",debounce:"300",dense:"",outlined:"",placeholder:"Search"},{append:a(()=>[e(R,{name:"search"})]),_:1},8,["modelValue"]),e(K,{unelevated:""},{default:a(()=>[e(V,{class:"tw-bg-indigo-900",icon:"add",label:"Nueva Usuario","text-color":"white",onClick:c[1]||(c[1]=n=>f.value=!0)}),e(V,{color:"primary","icon-right":"archive",label:"Exportar CSV"})]),_:1})]),"body-cell-consecutiveId":a(n=>[e(k,{props:n},{default:a(()=>[$(z(n.rowIndex+1),1)]),_:2},1032,["props"])]),"body-cell-action":a(n=>[e(k,{props:n},{default:a(()=>[e(V,{color:"primary",dense:"",flat:"",icon:"edit",rounded:"",size:"sm",onClick:i=>b(n.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["loading","rows"])]),footer:a(()=>[e(j,{modelValue:f.value,"onUpdate:modelValue":c[2]||(c[2]=n=>f.value=n)},{default:a(()=>[e(oe,{areas:m(s),user:m(t)},null,8,["areas","user"])]),_:1},8,["modelValue"])]),_:1}))}});export{Te as default};
