import{v as X,r as q,c as k,w as W,z as oe,am as ne,aj as ie,h as B,R as De,g as Qe,x as Me,a5 as Ae,a0 as R,V as ke,a_ as Fe,j as G,X as Z,m as K,N as be,p as D,k as U,l as a,d as e,q as V,t as Q,u as E,b as Be,s as F,aH as pe,av as Ee,a$ as Oe,ag as ve,F as he,at as ye,Z as H}from"./index.6741c124.js";import{w as je,u as Ie,m as Ne,x as re,y as Re,f as Ue,n as Le,g as He,o as $e,z as ze,A as Je,h as We,p as Xe,B as ue,C as Ge,e as se,D as de,E as Ze,c as h,l as L,b as w,d as ce,a as _e,Q as Ke}from"./format.d522e83a.js";import{g as Ye}from"./scroll.f68c09c4.js";import{g as et,h as tt,i as at,c as lt,j as ot,a as nt,b as it,f as I,e as rt,Q as ut,T as st}from"./QCardActions.a137c815.js";import{a as N,p as dt,l as me,Q as ct}from"./layout.930594d2.js";import{Q as mt}from"./QBtnGroup.3b4e1b97.js";import{Q as ft}from"./QPage.60cbfee8.js";import{b as gt}from"./useBudgets.3b0952f7.js";import{a as fe,Q as bt}from"./QCard.c905067c.js";import{u as pt}from"./app.4b87c24c.js";import"./use-dark.fdfa0a81.js";import"./focus-manager.33224ae2.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./utils.esm.cca72ecc.js";import"./index.2cf0d985.js";import"./ActionResource.7bd55d7e.js";import"./LineResource.531971dc.js";import"./AreaResource.bea591b3.js";import"./ArticleResource.4ca6c160.js";var ge=X({name:"QTooltip",inheritAttrs:!1,props:{...je,...Ie,...Ne,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{default:"jump-down"},transitionHide:{default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:re},self:{type:String,default:"top middle",validator:re},offset:{type:Array,default:()=>[14,14],validator:Re},scrollTarget:{default:void 0},delay:{type:Number,default:0},hideDelay:{type:Number,default:0}},emits:[...Ue],setup(l,{slots:s,emit:u,attrs:d}){let m,c;const v=Qe(),{proxy:{$q:f}}=v,y=q(null),_=q(!1),M=k(()=>de(l.anchor,f.lang.rtl)),S=k(()=>de(l.self,f.lang.rtl)),C=k(()=>l.persistent!==!0),{registerTick:r,removeTick:b}=Le(),{registerTimeout:P}=He(),{transitionProps:O,transitionStyle:t}=$e(l),{localScrollTarget:o,changeScrollEvent:A,unconfigureScrollTarget:g}=ze(l,ae),{anchorEl:n,canShow:i,anchorEvents:x}=Je({showing:_,configureAnchorEl:Ve}),{show:$,hide:z}=We({showing:_,canShow:i,handleShow:we,handleHide:qe,hideOnRouteChange:C,processOnMount:!0});Object.assign(x,{delayShow:Pe,delayHide:Ce});const{showPortal:Y,hidePortal:ee,renderPortal:xe}=Xe(v,y,Te,"tooltip");if(f.platform.is.mobile===!0){const p={anchorEl:n,innerRef:y,onClickOutside(T){return z(T),T.target.classList.contains("q-dialog__backdrop")&&Ae(T),!0}},J=k(()=>l.modelValue===null&&l.persistent!==!0&&_.value===!0);W(J,T=>{(T===!0?Ze:ue)(p)}),oe(()=>{ue(p)})}function we(p){Y(),r(()=>{c=new MutationObserver(()=>j()),c.observe(y.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),j(),ae()}),m===void 0&&(m=W(()=>f.screen.width+"|"+f.screen.height+"|"+l.self+"|"+l.anchor+"|"+f.lang.rtl,j)),P(()=>{Y(!0),u("show",p)},l.transitionDuration)}function qe(p){b(),ee(),te(),P(()=>{ee(!0),u("hide",p)},l.transitionDuration)}function te(){c!==void 0&&(c.disconnect(),c=void 0),m!==void 0&&(m(),m=void 0),g(),ne(x,"tooltipTemp")}function j(){const p=y.value;n.value===null||!p||Ge({el:p,offset:l.offset,anchorEl:n.value,anchorOrigin:M.value,selfOrigin:S.value,maxHeight:l.maxHeight,maxWidth:l.maxWidth})}function Pe(p){if(f.platform.is.mobile===!0){se(),document.body.classList.add("non-selectable");const J=n.value,T=["touchmove","touchcancel","touchend","click"].map(le=>[J,le,"delayHide","passiveCapture"]);ie(x,"tooltipTemp",T)}P(()=>{$(p)},l.delay)}function Ce(p){f.platform.is.mobile===!0&&(ne(x,"tooltipTemp"),se(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),P(()=>{z(p)},l.hideDelay)}function Ve(){if(l.noParentEvent===!0||n.value===null)return;const p=f.platform.is.mobile===!0?[[n.value,"touchstart","delayShow","passive"]]:[[n.value,"mouseenter","delayShow","passive"],[n.value,"mouseleave","delayHide","passive"]];ie(x,"anchor",p)}function ae(){if(n.value!==null||l.scrollTarget!==void 0){o.value=Ye(n.value,l.scrollTarget);const p=l.noParentEvent===!0?j:z;A(o.value,p)}}function Se(){return _.value===!0?B("div",{...d,ref:y,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",d.class],style:[d.style,t.value],role:"tooltip"},Me(s.default)):null}function Te(){return B(De,O.value,Se)}return oe(te),Object.assign(v.proxy,{updatePosition:j}),xe}}),vt=X({name:"QToggle",props:{...et,icon:String,iconColor:String},emits:tt,setup(l){function s(u,d){const m=k(()=>(u.value===!0?l.checkedIcon:d.value===!0?l.indeterminateIcon:l.uncheckedIcon)||l.icon),c=k(()=>u.value===!0?l.iconColor:null);return()=>[B("div",{class:"q-toggle__track"}),B("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},m.value!==void 0?[B(R,{name:m.value,color:c.value})]:void 0)]}return at("toggle",s)}});const ht=B("div",{class:"q-space"});var yt=X({name:"QSpace",setup(){return()=>ht}});const _t=()=>{const l=pt(),{actionDictionary:s,lineDictionary:u,areaDictionary:d,articleDictionary:m}=ke(l),{getArticleByName:c}=l;return{actionDictionary:s,lineDictionary:u,areaDictionary:d,articleDictionary:m,getArticleByName:c}},xt=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],wt=(l,s=0,u=!1)=>{let d;return(...m)=>{u&&!d&&l(...m),clearTimeout(d),d=setTimeout(()=>{l(...m)},s)}},qt=(l,s,u)=>{const d=q(l);return Fe((m,c)=>({get(){return m(),d.value},set:wt(v=>{d.value=v,c()},s,u)}))},Pt={class:"self-center full-width no-outline",tabindex:"0"},Ct=G({__name:"MonthBudgetForm",props:{month:null,budgetMonth:{default:()=>({quantity:0})},estimatedAmount:{default:0}},emits:["update:quantity"],setup(l,{emit:s}){const u=l;Z();const d=K(),{id:m}=d.params,c=be(lt(u.budgetMonth)),v=qt(c.quantity||0,250,!1);return W(v,f=>{f>0&&(c.quantity=f,c.month=u.month,c.budget_detail_id=m,s("update:quantity",c))}),(f,y)=>(D(),U(w,null,{default:a(()=>[e(h,null,{default:a(()=>[e(L,{overline:""},{default:a(()=>[V(Q(l.month),1)]),_:1}),e(N,{modelValue:E(v),"onUpdate:modelValue":y[0]||(y[0]=_=>Be(v)?v.value=_:null),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Cantidad",outlined:"",type:"number"},null,8,["modelValue"])]),_:1}),e(h,{side:""},{default:a(()=>[e(L,{overline:""},{default:a(()=>[V("\xA0\xA0\xA0")]),_:1}),e(ot,{dense:"",label:"Total",outlined:"","stack-label":""},{control:a(()=>[F("div",Pt,Q(c.quantity*u.estimatedAmount),1)]),prepend:a(()=>[e(R,{name:"o_attach_money"})]),_:1})]),_:1})]),_:1}))}});var Vt={storeDetail(l,s){return dt.post(`/budgets/${l}/budget-details`,s)}};const St=async({budgetId:l,budgetDetail:s})=>{const{data:u}=await Vt.storeDetail(l,s);return u},Tt=()=>{const l=nt();return{storeBudgetDetailMutation:it({mutationFn:u=>St(u),onSuccess:async(u,d)=>{await l.invalidateQueries(["budget",d.budgetId]),me.showSuccessNotification("El bien se agreg\xF3 al presupuesto con \xE9xito")},onError:()=>{me.showErrorNotification("Error al agregar el bien al presupuesto")}})}},Dt=F("div",{class:"tw-text-xl"},"Agregar bien",-1),Qt=G({__name:"BudgetDetailForm",setup(l){Z();const s=K(),{id:u}=s.params,{actionDictionary:d,lineDictionary:m,areaDictionary:c,getArticleByName:v}=_t(),{storeBudgetDetailMutation:f}=Tt(),{isLoading:y}=f,_=q(d.value),M=q(m.value),S=q(c.value),C=q([]),r=be({action:null,line:null,area:null,article:null,estimated_amount:0,justification:"",month:[],total:0,budgetMonths:[]}),b=q([]);pe(()=>{if(b.value.length>0){const g=b.value.reduce((n,i)=>n+i.quantity,0);r.total=g*r.estimated_amount}});function P(g,n,i){n(()=>{const x=g.toLowerCase();S.value=c.value.filter($=>$.label.toLowerCase().indexOf(x)>-1)})}function O(g,n,i){if(g.length<2){i();return}n(()=>{const x=g.toLowerCase();C.value=v(x).value})}function t(g){const n=b.value.findIndex(i=>i.month===g.month);n>-1?b.value[n]=g:b.value.push(g)}function o({value:g}){b.value=b.value.filter(n=>n.month!==g)}async function A(){r.budgetMonths=b.value,await f.mutateAsync({budgetId:u,budgetDetail:r}),r.action=null,r.line=null,r.area=null,r.article=null,r.estimated_amount=0,r.justification="",r.month=[],r.total=0,r.budgetMonths=[],b.value=[]}return(g,n)=>(D(),U(bt,null,{default:a(()=>[e(fe,null,{default:a(()=>[Dt]),_:1}),e(ce),e(fe,{class:"tw-px-0"},{default:a(()=>[e(ct,null,{default:a(()=>[e(_e,null,{default:a(()=>[e(w,null,{default:a(()=>[e(h,null,{default:a(()=>[e(I,{modelValue:r.action,"onUpdate:modelValue":n[0]||(n[0]=i=>r.action=i),dense:"",label:"ACC",options:_.value,outlined:""},null,8,["modelValue","options"])]),_:1})]),_:1}),e(w,null,{default:a(()=>[e(h,null,{default:a(()=>[e(I,{modelValue:r.line,"onUpdate:modelValue":n[1]||(n[1]=i=>r.line=i),dense:"",label:"Partida",options:M.value,outlined:""},null,8,["modelValue","options"])]),_:1})]),_:1}),e(w,null,{default:a(()=>[e(h,null,{default:a(()=>[e(I,{modelValue:r.area,"onUpdate:modelValue":n[2]||(n[2]=i=>r.area=i),dense:"",label:"\xC1rea",options:S.value,outlined:"","use-input":"",onFilter:P},null,8,["modelValue","options"])]),_:1})]),_:1}),e(w,null,{default:a(()=>[e(h,null,{default:a(()=>[e(I,{modelValue:r.article,"onUpdate:modelValue":n[3]||(n[3]=i=>r.article=i),dense:"",hint:"M\xEDnimo 2 caracteres para activar el filtrado",label:"Art\xEDculos",options:C.value,outlined:"","use-input":"",onFilter:O},{option:a(i=>[e(w,Ee(Oe(i.itemProps)),{default:a(()=>[e(h,null,{default:a(()=>[e(L,null,{default:a(()=>[V(Q(i.opt.label),1)]),_:2},1024),e(L,{caption:""},{default:a(()=>[V(Q(i.opt.caption),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])]),_:1})]),_:1}),e(w,null,{default:a(()=>[e(h,null,{default:a(()=>[e(N,{modelValue:r.justification,"onUpdate:modelValue":n[4]||(n[4]=i=>r.justification=i),dense:"",label:"Justificaci\xF3n",outlined:"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),e(w,null,{default:a(()=>[e(h,null,{default:a(()=>[e(N,{modelValue:r.estimated_amount,"onUpdate:modelValue":n[5]||(n[5]=i=>r.estimated_amount=i),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Monto estimado",outlined:"",type:"number"},{prepend:a(()=>[e(R,{name:"o_attach_money"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(w,null,{default:a(()=>[e(h,null,{default:a(()=>[e(I,{modelValue:r.month,"onUpdate:modelValue":n[6]||(n[6]=i=>r.month=i),dense:"",label:"Mes",multiple:"",options:E(xt),outlined:"","use-chips":"",onRemove:o},null,8,["modelValue","options"])]),_:1})]),_:1}),(D(!0),ve(he,null,ye(r.month,i=>(D(),U(Ct,{key:i,"estimated-amount":r.estimated_amount,month:i,"onUpdate:quantity":t},null,8,["estimated-amount","month"]))),128)),e(w,null,{default:a(()=>[e(h,null,{default:a(()=>[e(N,{modelValue:r.total,"onUpdate:modelValue":n[7]||(n[7]=i=>r.total=i),dense:"","input-class":"tw-text-right",label:"Total",outlined:"",readonly:"",type:"number"},{prepend:a(()=>[e(R,{name:"o_attach_money"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ce),e(rt,null,{default:a(()=>[e(yt),e(H,{color:"primary",icon:"o_save",loading:E(y),unelevated:"",onClick:A},{default:a(()=>[V(" guardar ")]),_:1},8,["loading"])]),_:1})]),_:1}))}}),Mt=()=>({currencyFormat:s=>{const u={style:"currency",currency:"MXN"};return new Intl.NumberFormat("es-MX",u).format(s)}}),At={class:"q-my-xs q-pt-sm q-ml-md tw-text-2xl tw-font-bold tw-text-slate-700"},kt={class:"row"},Ft={class:"col col-md-3 q-pa-sm"},Bt={class:"col"},ta=G({__name:"DetailPage",setup(l){const s=Z(),u=K(),{id:d}=u.params,{search:m,sortBy:c="id",descending:v=!1,page:f,rowsPerPage:y=13}=u.query,{budget:_}=gt(d),{currencyFormat:M}=Mt(),S=[{name:"id",field:"id",required:!0,label:"ID",sortable:!0,align:"left"},{name:"action",field:t=>t.action.name,label:"Acci\xF3n",sortable:!0,align:"left"},{name:"line",field:t=>t.line.name,label:"Partida",sortable:!0,align:"left"},{name:"department",field:t=>t.department.alias,label:"\xC1rea",sortable:!0,align:"left"},{name:"article",field:t=>t.article.name,label:"Bien",sortable:!0,align:"left"},{name:"article_description",field:t=>t.article.description,label:"Descripci\xF3n del bien",sortable:!0,align:"left"},{name:"justification",field:"justification",label:"Justificaci\xF3n",sortable:!0,align:"left"},{name:"enero",field:t=>{var o;return(o=t.enero)==null?void 0:o.quantity},label:"Enero",sortable:!0,align:"right"},{name:"febrero",field:t=>{var o;return(o=t.febrero)==null?void 0:o.quantity},label:"Febrero",sortable:!0,align:"right"},{name:"marzo",field:t=>{var o;return(o=t.marzo)==null?void 0:o.quantity},label:"Marzo",sortable:!0,align:"right"},{name:"abril",field:t=>{var o;return(o=t.abril)==null?void 0:o.quantity},label:"Abril",sortable:!0,align:"right"},{name:"mayo",field:t=>{var o;return(o=t.mayo)==null?void 0:o.quantity},label:"Mayo",sortable:!0,align:"right"},{name:"junio",field:t=>{var o;return(o=t.junio)==null?void 0:o.quantity},label:"Junio",sortable:!0,align:"right"},{name:"julio",field:t=>{var o;return(o=t.julio)==null?void 0:o.quantity},label:"Julio",sortable:!0,align:"right"},{name:"agosto",field:t=>{var o;return(o=t.agosto)==null?void 0:o.quantity},label:"Agosto",sortable:!0,align:"right"},{name:"septiembre",field:t=>{var o;return(o=t.septiembre)==null?void 0:o.quantity},label:"Septiembre",sortable:!0,align:"right"},{name:"octubre",field:t=>{var o;return(o=t.octubre)==null?void 0:o.quantity},label:"Octubre",sortable:!0,align:"right"},{name:"noviembre",field:t=>{var o;return(o=t.noviembre)==null?void 0:o.quantity},label:"Noviembre",sortable:!0,align:"right"},{name:"diciembre",field:t=>{var o;return(o=t.diciembre)==null?void 0:o.quantity},label:"Diciembre",sortable:!0,align:"right"},{name:"estimated_amount",field:t=>`${M(+t.estimated_amount)}`,label:"Precio",sortable:!0,align:"right"},{name:"total",field:t=>`${M(+t.total)}`,label:"Total",sortable:!0,align:"right"}],C=q(["action","line","department","article","estimated_amount","enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre","total"]),r=S.map(t=>({label:t.label,value:t.name})),b=q(m||""),P=q({sortBy:c,descending:v==="true",page:+f||1,rowsPerPage:+y||10});pe(()=>{let t={};b.value?t={...s.currentRoute.value.query,search:b.value}:(t={...s.currentRoute.value.query},delete t.search),s.push({query:t})});function O(t){P.value=t,s.push({query:{...s.currentRoute.value.query,page:t.page,rowsPerPage:t.rowsPerPage,sortBy:t.sortBy,descending:t.descending}})}return(t,o)=>(D(),U(ft,null,{default:a(()=>{var A;return[F("h5",At,"Presupuesto "+Q((A=E(_))==null?void 0:A.year),1),F("div",kt,[F("div",Ft,[e(Qt)]),F("div",Bt,[e(st,null,{"card-body":a(()=>{var g;return[e(ut,{columns:S,filter:b.value,pagination:P.value,"row-key":"id",rows:((g=E(_))==null?void 0:g.details)||[],"rows-per-page-options":[13,26,52,0],separator:"cell",title:"Detalle","visible-columns":C.value,"onUpdate:pagination":O},{"top-right":a(n=>[e(H,{class:"tw-mr-2",color:"primary","fab-mini":"",flat:"",icon:"tune",size:"sm"},{default:a(()=>[e(ge,null,{default:a(()=>[V(" Mostrar/Ocultar columnas ")]),_:1}),e(Ke,{anchor:"top end",self:"center start"},{default:a(()=>[e(_e,null,{default:a(()=>[(D(!0),ve(he,null,ye(E(r),i=>(D(),U(w,{key:i.value,clickable:""},{default:a(()=>[e(h,null,{default:a(()=>[e(L,null,{default:a(()=>[V(Q(i.label),1)]),_:2},1024)]),_:2},1024),e(h,{side:""},{default:a(()=>[e(vt,{modelValue:C.value,"onUpdate:modelValue":o[0]||(o[0]=x=>C.value=x),color:"primary",val:i.value},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(H,{dense:"",flat:"",icon:n.inFullscreen?"fullscreen_exit":"fullscreen",round:"",onClick:n.toggleFullscreen},{default:a(()=>[e(ge,{disable:t.$q.platform.is.mobile},{default:a(()=>[V(Q(n.inFullscreen?"Salir de Pantalla Completa":"Pantalla Completa"),1)]),_:2},1032,["disable"])]),_:2},1032,["icon","onClick"]),e(N,{modelValue:b.value,"onUpdate:modelValue":o[1]||(o[1]=i=>b.value=i),class:"q-mr-xs",clearable:"",debounce:"300",dense:"",outlined:"",placeholder:"Search"},{append:a(()=>[e(R,{name:"search"})]),_:1},8,["modelValue"]),e(mt,{unelevated:""},{default:a(()=>[e(H,{color:"primary","icon-right":"archive",label:"Exportar CSV"})]),_:1})]),_:1},8,["filter","pagination","rows","visible-columns"])]}),_:1})])])]}),_:1}))}});export{ta as default};
