import{j as V,N as Q,r as x,c as S,p as C,k as q,l as e,d as t,X as _,u as p,w as U,_ as M,s as T,J as L}from"./index.6e092ff4.js";import{Q as N}from"./QInput.17ed03ff.js";import{Q as B,a as D}from"./QTable.14f5bf59.js";import{T as $}from"./TablePage.1e62c5a7.js";import{Q as z,a as K}from"./QItemLabel.0869f881.js";import{Q as j}from"./QList.a2cdda04.js";import{Q as P}from"./QCardSection.e6dd9052.js";import{a as G}from"./format.9da510a0.js";import{Q as H}from"./QCardActions.beef4929.js";import{A as E,u as J}from"./app.fdb8304e.js";import{l as w}from"./layout.8898c8f1.js";import{u as O,a as h}from"./QChip.2e36ff41.js";import{u as I}from"./useMutation.esm.8f902b98.js";import{c as k}from"./index.7adaf3a2.js";import{Q as R}from"./QForm.8fac44d9.js";import{_ as X}from"./CardDialog.00e419ec.js";import"./planeacion.api.ebfeb564.js";import"./index.2cf0d985.js";import"./use-dark.6f924d7f.js";import"./QSelect.653a261d.js";import"./scroll.aae0930c.js";import"./QCheckbox.9e355c67.js";import"./QCard.c3a0553c.js";import"./QPage.e3c9f7e9.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./ArticleResource.29ae1c09.js";import"./utils.esm.ed28f146.js";import"./mutation.esm.313dacbf.js";import"./QSpace.4f34f3fa.js";const W=async()=>{const{data:a}=await E.getActions();return a},Y=async a=>{const{data:o}=await E.storeAction(a);return o},Z=async a=>{const{id:o,name:l}=a,{data:r}=await E.updateAction(o,{name:l});return r},tt=()=>{const{isLoading:a,isError:o,data:l,error:r}=O({queryKey:["actions"],queryFn:W,staleTime:6e5});return{isLoading:a,isError:o,data:l,error:r}},at=()=>{const a=h();return{actionStoreMutations:I({mutationFn:Y,onSuccess:()=>{a.invalidateQueries({queryKey:["actions"]}),w.showSuccessNotification("Acci\xF3n creada con \xE9xito")},onError:()=>{w.showErrorNotification("Error al crear acci\xF3n")}})}},ot=()=>{const a=h();return{actionUpdateMutations:I({mutationFn:Z,onSuccess:()=>{a.invalidateQueries({queryKey:["actions"]}),w.showSuccessNotification("Acci\xF3n actualizada con \xE9xito")},onError:()=>{w.showErrorNotification("Error al actualizar acci\xF3n")}})}},et=V({__name:"ActionForm",props:{action:null},setup(a){const o=a,l=J(),{fetchActionDictionary:r}=l,{actionStoreMutations:A}=at(),{isLoading:s}=A,{actionUpdateMutations:f}=ot(),{isLoading:y}=f,b=Q({name:""}),u=Q(k(o.action||b)),g=x(),F={name:[d=>!!d||"El nombre es requerido"]},c=S(()=>o.action&&"id"in o.action);S(()=>c.value?"Editar acci\xF3n":"Agregar acci\xF3n");async function i(){var m,v;!await((m=g.value)==null?void 0:m.validate())||(c.value?(await f.mutateAsync(u),await n()):(await A.mutateAsync(u),u.name="",(v=g.value)==null||v.reset(),await n()))}async function n(){await r()}return(d,m)=>(C(),q(p(R),{ref_key:"actionForm",ref:g,class:"q-gutter-md"},{default:e(()=>[t(P,null,{default:e(()=>[t(j,null,{default:e(()=>[t(z,null,{default:e(()=>[t(K,null,{default:e(()=>[t(N,{modelValue:u.name,"onUpdate:modelValue":m[0]||(m[0]=v=>u.name=v),dense:"",label:"Nombre",outlined:"",rules:F.name},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),t(G),t(H,{align:"right"},{default:e(()=>[t(_,{color:"primary",label:"Guardar",loading:p(s)||p(y),onClick:i},null,8,["loading"])]),_:1})]),_:1},512))}}),nt={class:"q-gutter-sm"},Ut=V({__name:"IndexPage",setup(a){const{data:o,isLoading:l}=tt(),r=x(""),A=[{name:"id",field:"id",required:!0,label:"ID",sortable:!0,align:"left"},{name:"name",field:"name",label:"Nombre",sortable:!0,align:"left"},{name:"action",align:"center",label:"Acciones",field:"action",sortable:!1}],s=x(!1),f=x(-1);let y=Q({name:""});const b=Q({name:""}),u=S(()=>f.value===-1?"Nueva acci\xF3n":"Editar acci\xF3n");U(s,c=>{c||F()});function g(c){var d;const{name:i,id:n}=c;f.value=(d=o.value)==null?void 0:d.findIndex(m=>m.id===c.id),y=Object.assign({},{id:n,name:i}),s.value=!0}function F(){s.value=!1,L(()=>{y=k(b),f.value=-1})}return(c,i)=>(C(),q($,null,{"card-body":e(()=>[t(D,{columns:A,loading:p(l),rows:p(o),"rows-per-page-options":[20,30,40,50],title:"Acciones"},{"top-right":e(()=>[t(_,{class:"q-mr-xs",color:"primary",icon:"add",label:"Nueva Acci\xF3n",outline:"",onClick:i[0]||(i[0]=n=>s.value=!0)}),t(N,{modelValue:r.value,"onUpdate:modelValue":i[1]||(i[1]=n=>r.value=n),class:"q-mr-xs",debounce:"300",dense:"",outlined:"",placeholder:"Search"},{append:e(()=>[t(M,{name:"search"})]),_:1},8,["modelValue"]),t(_,{color:"primary","icon-right":"archive",label:"Exportar CSV","no-caps":""})]),"body-cell-action":e(n=>[t(B,{props:n},{default:e(()=>[T("div",nt,[t(_,{color:"primary",dense:"",flat:"",icon:"edit",rounded:"",size:"sm",onClick:d=>g(n.row)},null,8,["onClick"])])]),_:2},1032,["props"])]),_:1},8,["loading","rows"])]),footer:e(()=>[t(X,{modelValue:s.value,"onUpdate:modelValue":i[2]||(i[2]=n=>s.value=n),"card-title":p(u)},{default:e(()=>[t(et,{action:p(y)},null,8,["action"])]),_:1},8,["modelValue","card-title"])]),_:1}))}});export{Ut as default};
