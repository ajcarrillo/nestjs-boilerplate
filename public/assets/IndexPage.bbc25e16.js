import{j as I,M as Q,r as A,c as q,p as S,k as x,l as t,d as e,u as m,ah as B,s as L,t as M,X as y,S as R,aN as $,_ as z,q as K}from"./index.33aee9c3.js";import{Q as N}from"./QInput.bc534865.js";import{Q as h}from"./QBtnGroup.e484a0b7.js";import{Q as k,a as j}from"./QTable.71d6b359.js";import{c as G}from"./format.9dfa61a7.js";import{T as P}from"./TablePage.1ebf5b06.js";import{Q as v,a as U}from"./QItem.3270a199.js";import{Q as F}from"./QSelect.bc9b930f.js";import{Q as W}from"./QList.1e036a38.js";import{p as _,u as H}from"./BudgetResource.3a0abb0c.js";import{l as E}from"./layout.880d2741.js";import{u as X,a as D}from"./useQuery.esm.08e598e9.js";import{u as T}from"./useMutation.esm.5aff8292.js";import{c as J}from"./index.7adaf3a2.js";import{Q as O}from"./QForm.05da6a20.js";import{C as Y}from"./CardForm.e852cb18.js";import"./use-key-composition.b1866cfc.js";import"./use-dark.a42b1db8.js";import"./focus-manager.387b0375.js";import"./QMenu.746f001c.js";import"./scroll.5632c0ea.js";import"./QCheckbox.685522c0.js";import"./QCard.e44cba30.js";import"./QPage.6112cc6b.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./QItemLabel.b3a0c01c.js";import"./index.2cf0d985.js";import"./utils.esm.aa7cdc1a.js";import"./mutation.esm.9a94c1b8.js";import"./QCardSection.2089956e.js";import"./QCardActions.ddbe4808.js";var C={getUsers(){return _.get("/users")},storeUser(l){const{area:o,...s}=l;return _.post("/users",{...s,area:o==null?void 0:o.value})},updateUser(l,o){const{area:s,...d}=o;return _.put(`/users/${l}`,{...d,area:s==null?void 0:s.value})}};const Z=async()=>{const{data:l}=await C.getUsers();return l},ee=async l=>{const{data:o}=await C.storeUser(l);return o},ae=async l=>{const{id:o,...s}=l,{data:d}=await C.updateUser(o,s);return d},te=()=>{const{isLoading:l,isError:o,data:s,error:d}=X({queryKey:["users"],queryFn:Z,staleTime:6e5});return{isLoading:l,isError:o,data:s,error:d}},le=()=>{const l=D();return{userStoreMutations:T({mutationFn:ee,onSuccess:()=>{l.invalidateQueries({queryKey:["users"]}),E.showSuccessNotification("Usuario creado con \xE9xito")},onError:()=>{E.showErrorNotification("Error al crear usuario")}})}},oe=()=>{const l=D();return{userUpdateMutations:T({mutationFn:ae,onSuccess:()=>{l.invalidateQueries({queryKey:["users"]}),E.showSuccessNotification("Usuario actualizado con \xE9xito")},onError:()=>{E.showErrorNotification("Error al actualizar usuario")}})}},re=I({__name:"UserForm",props:{user:null,areas:null},setup(l){const o=l,{userStoreMutations:s}=le(),{isLoading:d}=s,{userUpdateMutations:w}=oe(),{isLoading:V}=w,f=Q({email:"",firstName:"",isActive:!0,lastName:"",roles:[],password:"",area:null}),a=Q(J(o.user||f)),g=A(),b={email:[i=>!!i||"El email es requerido",i=>/.+@.+\..+/.test(i)||"El email debe ser v\xE1lido"],firstName:[i=>!!i||"El nombre es requerido"],lastName:[i=>!!i||"El apellido es requerido"],password:[i=>!!i||"El password es requerido"],roles:[i=>!!i.length||"Debe seleccionar al menos un rol"]},p=q(()=>o.user&&"id"in o.user),c=q(()=>p.value?"Editar usuario":"Agregar usuario");async function n(){var r,u;!await((r=g.value)==null?void 0:r.validate())||(p.value?await w.mutateAsync(a):(await s.mutateAsync(a),a.email="",a.firstName="",a.isActive=!0,a.lastName="",a.roles=[],a.password="",a.area=null,(u=g.value)==null||u.reset()))}return(i,r)=>(S(),x(Y,{title:m(c)},{form:t(()=>[e(m(O),{ref_key:"userForm",ref:g,class:"q-gutter-md"},{default:t(()=>[e(W,null,{default:t(()=>[e(v,null,{default:t(()=>[e(U,null,{default:t(()=>[e(N,{modelValue:a.email,"onUpdate:modelValue":r[0]||(r[0]=u=>a.email=u),dense:"",label:"Email",outlined:"",rules:b.email},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(v,null,{default:t(()=>[e(U,null,{default:t(()=>[e(N,{modelValue:a.firstName,"onUpdate:modelValue":r[1]||(r[1]=u=>a.firstName=u),dense:"",label:"Nombre",outlined:"",rules:b.firstName},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(v,null,{default:t(()=>[e(U,null,{default:t(()=>[e(N,{modelValue:a.lastName,"onUpdate:modelValue":r[2]||(r[2]=u=>a.lastName=u),dense:"",label:"Apellido",outlined:"",rules:b.lastName},null,8,["modelValue","rules"])]),_:1})]),_:1}),m(p)?B("",!0):(S(),x(v,{key:0},{default:t(()=>[e(U,null,{default:t(()=>[e(N,{modelValue:a.password,"onUpdate:modelValue":r[3]||(r[3]=u=>a.password=u),dense:"",label:"Contrase\xF1a",outlined:"",rules:b.password,type:"password"},null,8,["modelValue","rules"])]),_:1})]),_:1})),e(v,null,{default:t(()=>[e(U,null,{default:t(()=>[e(F,{modelValue:a.area,"onUpdate:modelValue":r[4]||(r[4]=u=>a.area=u),dense:"",label:"Departamento","option-label":"full_description","option-value":"value",options:l.areas,outlined:""},null,8,["modelValue","options"])]),_:1})]),_:1}),e(v,null,{default:t(()=>[e(U,null,{default:t(()=>[e(F,{modelValue:a.roles,"onUpdate:modelValue":r[5]||(r[5]=u=>a.roles=u),dense:"",label:"Roles",multiple:"",options:["admin","user","departament"],outlined:"",rules:b.roles},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),L("pre",null,M(a),1)]),_:1},512)]),actions:t(()=>[e(y,{color:"primary",label:"Guardar",loading:m(d)||m(V),onClick:n},null,8,["loading"])]),_:1},8,["title"]))}}),Be=I({__name:"IndexPage",setup(l){const o=H(),{areaDictionary:s}=R(o),{data:d,isLoading:w}=te(),V=A(""),f=A(!1);let a=Q({email:"",firstName:"",isActive:!0,lastName:"",roles:[],password:""});const g=[{name:"consecutiveId",label:"ID",field:"consecutiveId",sortable:!1},{name:"email",field:"email",label:"Email",sortable:!0,align:"left"},{name:"firstName",field:"firstName",label:"Nombre",sortable:!0,align:"left"},{name:"lastName",field:"lastName",label:"Apellido",sortable:!0,align:"left"},{name:"isActive",field:"isActive",label:"Activo",sortable:!0,align:"left"},{name:"roles",field:p=>p.roles.join(", "),label:"Roles",sortable:!0,align:"left"},{name:"action",align:"center",label:"Acciones",field:"action",sortable:!1}];$(()=>{f.value||(a=Q({email:"",firstName:"",isActive:!0,lastName:"",roles:[],password:""}))});function b(p){f.value=!0,a=p}return(p,c)=>(S(),x(P,null,{"card-body":t(()=>[e(j,{columns:g,loading:m(w),"row-key":"id",rows:m(d),"rows-per-page-options":[20,30,40,50],title:"Usuarios"},{"top-right":t(()=>[e(N,{modelValue:V.value,"onUpdate:modelValue":c[0]||(c[0]=n=>V.value=n),class:"q-mr-xs",debounce:"300",dense:"",outlined:"",placeholder:"Search"},{append:t(()=>[e(z,{name:"search"})]),_:1},8,["modelValue"]),e(h,{unelevated:""},{default:t(()=>[e(y,{class:"tw-bg-indigo-900",icon:"add",label:"Nueva Usuario","text-color":"white",onClick:c[1]||(c[1]=n=>f.value=!0)}),e(y,{color:"primary","icon-right":"archive",label:"Exportar CSV"})]),_:1})]),"body-cell-consecutiveId":t(n=>[e(k,{props:n},{default:t(()=>[K(M(n.rowIndex+1),1)]),_:2},1032,["props"])]),"body-cell-action":t(n=>[e(k,{props:n},{default:t(()=>[e(y,{color:"primary",dense:"",flat:"",icon:"edit",rounded:"",size:"sm",onClick:i=>b(n.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["loading","rows"])]),footer:t(()=>[e(G,{modelValue:f.value,"onUpdate:modelValue":c[2]||(c[2]=n=>f.value=n)},{default:t(()=>[e(re,{areas:m(s),user:m(a)},null,8,["areas","user"])]),_:1},8,["modelValue"])]),_:1}))}});export{Be as default};
