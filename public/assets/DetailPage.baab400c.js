import{Q as L}from"./QTooltip.ff7da719.js";import{a as f,b as T,Q as w}from"./QItemLabel.0869f881.js";import{Q as oe}from"./QToggle.585e9820.js";import{Q as G}from"./QList.a2cdda04.js";import{a as N,Q as ne}from"./format.9da510a0.js";import{r as q,b0 as ie,j as O,V as H,m as $,N as X,w as W,p as D,k as j,l,d as e,q as u,t as r,u as y,b as Y,s as U,_ as P,aH as ue,av as re,b1 as de,ag as Z,F as ee,at as te,X as B,b2 as R}from"./index.6e092ff4.js";import{Q as C}from"./QInput.17ed03ff.js";import{Q as se}from"./QBtnGroup.6aa46b5f.js";import{a as me,Q as d}from"./QTable.14f5bf59.js";import{Q as ce,a as J}from"./QTr.a99aa9f4.js";import{Q as fe}from"./QPage.e3c9f7e9.js";import{b as be}from"./useBudgets.bc5dd619.js";import{T as pe}from"./TablePage.1e62c5a7.js";import{Q as K}from"./QCardSection.e6dd9052.js";import{b as _e,Q as A}from"./QSelect.653a261d.js";import{Q as ye}from"./QForm.8fac44d9.js";import{Q as ge}from"./QSpace.4f34f3fa.js";import{Q as ve}from"./QCardActions.beef4929.js";import{Q as we}from"./QCard.c3a0553c.js";import{u as Ve}from"./useDictionaries.2b7835d7.js";import{c as ae}from"./index.7adaf3a2.js";import{u as he,a as Qe}from"./useBudgetDetail.43be231c.js";import{u as qe}from"./useMoney.dbc60660.js";import{u as xe}from"./useExportDataToCsv.e23ed0b3.js";import{u as ke}from"./useTableFilter.0810001a.js";import"./scroll.aae0930c.js";import"./use-dark.6f924d7f.js";import"./QCheckbox.9e355c67.js";import"./layout.8898c8f1.js";import"./planeacion.api.ebfeb564.js";import"./index.2cf0d985.js";import"./QChip.2e36ff41.js";import"./utils.esm.ed28f146.js";import"./useMutation.esm.8f902b98.js";import"./mutation.esm.313dacbf.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./app.fdb8304e.js";import"./ArticleResource.29ae1c09.js";import"./date.f1865af8.js";const Me=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],De=(h,Q=0,b=!1)=>{let m;return(...V)=>{b&&!m&&h(...V),clearTimeout(m),m=setTimeout(()=>{h(...V)},Q)}},Ce=(h,Q,b)=>{const m=q(h);return ie((V,c)=>({get(){return V(),m.value},set:De(p=>{m.value=p,c()},Q,b)}))},Ue={class:"self-center full-width no-outline",tabindex:"0"},Ae=O({__name:"MonthBudgetForm",props:{month:null,budgetMonth:{default:()=>({quantity:0})},estimatedAmount:{default:0}},emits:["update:quantity"],setup(h,{emit:Q}){const b=h;H();const m=$(),{id:V}=m.params,c=X(ae(b.budgetMonth)),p=Ce(c.quantity||0,250,!1);return W(p,g=>{g>0&&(c.quantity=g,c.month=b.month,c.budget_detail_id=V,Q("update:quantity",c))}),(g,x)=>(D(),j(w,null,{default:l(()=>[e(f,null,{default:l(()=>[e(T,{overline:""},{default:l(()=>[u(r(h.month),1)]),_:1}),e(C,{modelValue:y(p),"onUpdate:modelValue":x[0]||(x[0]=k=>Y(p)?p.value=k:null),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Cantidad",outlined:"",type:"number"},null,8,["modelValue"])]),_:1}),e(f,{side:""},{default:l(()=>[e(T,{overline:""},{default:l(()=>[u("\xA0\xA0\xA0")]),_:1}),e(_e,{dense:"",label:"Total",outlined:"","stack-label":""},{control:l(()=>[U("div",Ue,r(c.quantity*b.estimatedAmount),1)]),prepend:l(()=>[e(P,{name:"o_attach_money"})]),_:1})]),_:1})]),_:1}))}}),Te=U("div",{class:"tw-text-xl"},"Agregar bien",-1),je=O({__name:"BudgetDetailForm",setup(h){H();const Q=$(),{id:b}=Q.params,{actionDictionary:m,lineDictionary:V,areaDictionary:c,getArticleByName:p}=Ve(),{storeBudgetDetailMutation:g}=he(),{isLoading:x}=g,k=q(m.value),I=q(V.value),M=q(c.value),F=q([]),i=X({action:null,line:null,area:null,article:null,estimated_amount:0,justification:"",month:[],total:0,budgetMonths:[]}),_=q([]);ue(()=>{if(_.value.length>0){const s=_.value.reduce((a,t)=>a+t.quantity,0);i.total=s*i.estimated_amount}});function S(s,a,t){a(()=>{const v=s.toLowerCase();M.value=c.value.filter(le=>le.label.toLowerCase().indexOf(v)>-1)})}function E(s,a,t){if(s.length<2){t();return}a(()=>{const v=s.toLowerCase();F.value=p(v).value})}function z(s){const a=_.value.findIndex(t=>t.month===s.month);a>-1?_.value[a]=s:_.value.push(s)}function o({value:s}){_.value=_.value.filter(a=>a.month!==s)}async function n(){i.budgetMonths=_.value,await g.mutateAsync({budgetId:b,budgetDetail:i}),i.action=null,i.line=null,i.area=null,i.article=null,i.estimated_amount=0,i.justification="",i.month=[],i.total=0,i.budgetMonths=[],_.value=[]}return(s,a)=>(D(),j(we,null,{default:l(()=>[e(K,null,{default:l(()=>[Te]),_:1}),e(N),e(K,{class:"tw-px-0"},{default:l(()=>[e(ye,null,{default:l(()=>[e(G,null,{default:l(()=>[e(w,null,{default:l(()=>[e(f,null,{default:l(()=>[e(A,{modelValue:i.action,"onUpdate:modelValue":a[0]||(a[0]=t=>i.action=t),dense:"",label:"ACC",options:k.value,outlined:""},null,8,["modelValue","options"])]),_:1})]),_:1}),e(w,null,{default:l(()=>[e(f,null,{default:l(()=>[e(A,{modelValue:i.line,"onUpdate:modelValue":a[1]||(a[1]=t=>i.line=t),dense:"",label:"Partida",options:I.value,outlined:""},null,8,["modelValue","options"])]),_:1})]),_:1}),e(w,null,{default:l(()=>[e(f,null,{default:l(()=>[e(A,{modelValue:i.area,"onUpdate:modelValue":a[2]||(a[2]=t=>i.area=t),dense:"",label:"\xC1rea",options:M.value,outlined:"","use-input":"",onFilter:S},null,8,["modelValue","options"])]),_:1})]),_:1}),e(w,null,{default:l(()=>[e(f,null,{default:l(()=>[e(A,{modelValue:i.article,"onUpdate:modelValue":a[3]||(a[3]=t=>i.article=t),dense:"",hint:"M\xEDnimo 2 caracteres para activar el filtrado",label:"Art\xEDculos",options:F.value,outlined:"","use-input":"",onFilter:E},{option:l(t=>[e(w,re(de(t.itemProps)),{default:l(()=>[e(f,null,{default:l(()=>[e(T,null,{default:l(()=>[u(r(t.opt.label),1)]),_:2},1024),e(T,{caption:""},{default:l(()=>[u(r(t.opt.caption),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])]),_:1})]),_:1}),e(w,null,{default:l(()=>[e(f,null,{default:l(()=>[e(C,{modelValue:i.justification,"onUpdate:modelValue":a[4]||(a[4]=t=>i.justification=t),dense:"",label:"Justificaci\xF3n",outlined:"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),e(w,null,{default:l(()=>[e(f,null,{default:l(()=>[e(C,{modelValue:i.estimated_amount,"onUpdate:modelValue":a[5]||(a[5]=t=>i.estimated_amount=t),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Monto estimado",outlined:"",type:"number"},{prepend:l(()=>[e(P,{name:"o_attach_money"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(w,null,{default:l(()=>[e(f,null,{default:l(()=>[e(A,{modelValue:i.month,"onUpdate:modelValue":a[6]||(a[6]=t=>i.month=t),dense:"",label:"Mes",multiple:"",options:y(Me),outlined:"","use-chips":"",onRemove:o},null,8,["modelValue","options"])]),_:1})]),_:1}),(D(!0),Z(ee,null,te(i.month,t=>(D(),j(Ae,{key:t,"estimated-amount":i.estimated_amount,month:t,"onUpdate:quantity":z},null,8,["estimated-amount","month"]))),128)),e(w,null,{default:l(()=>[e(f,null,{default:l(()=>[e(C,{modelValue:i.total,"onUpdate:modelValue":a[7]||(a[7]=t=>i.total=t),dense:"","input-class":"tw-text-right",label:"Total",outlined:"",readonly:"",type:"number"},{prepend:l(()=>[e(P,{name:"o_attach_money"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(N),e(ve,null,{default:l(()=>[e(ge),e(B,{color:"primary",icon:"o_save",loading:y(x),unelevated:"",onClick:n},{default:l(()=>[u(" guardar ")]),_:1},8,["loading"])]),_:1})]),_:1}))}}),Fe={class:"q-my-xs q-pt-sm q-ml-md tw-text-2xl tw-font-bold tw-text-slate-700"},Be={class:"row"},Pe={class:"col col-md-3 q-pa-sm"},Ie={class:"col"},Qt=O({__name:"DetailPage",setup(h){const{exportDataToCsv:Q}=xe(),{updateBudgetDetailMutation:b}=Qe(),m=q(),V=$(),{id:c}=V.params,{budget:p}=be(c),{currencyFormat:g}=qe(),x=[{name:"consecutiveId",label:"ID",field:"consecutiveId",sortable:!1,required:!0},{name:"action",field:o=>o.action.name,label:"Acci\xF3n",sortable:!0,align:"left"},{name:"line",field:o=>o.line.name,label:"Partida",sortable:!0,align:"left"},{name:"department",field:o=>o.department.alias,label:"\xC1rea",sortable:!0,align:"left"},{name:"article",field:o=>o.article.name,label:"Bien",sortable:!0,align:"left"},{name:"article_description",field:o=>o.article.description,label:"Descripci\xF3n del bien",sortable:!0,align:"left"},{name:"justification",field:"justification",label:"Justificaci\xF3n",sortable:!0,align:"left"},{name:"enero",field:o=>{var n;return(n=o.enero)==null?void 0:n.quantity},label:"Enero",sortable:!0,align:"right"},{name:"febrero",field:o=>{var n;return(n=o.febrero)==null?void 0:n.quantity},label:"Febrero",sortable:!0,align:"right"},{name:"marzo",field:o=>{var n;return(n=o.marzo)==null?void 0:n.quantity},label:"Marzo",sortable:!0,align:"right"},{name:"abril",field:o=>{var n;return(n=o.abril)==null?void 0:n.quantity},label:"Abril",sortable:!0,align:"right"},{name:"mayo",field:o=>{var n;return(n=o.mayo)==null?void 0:n.quantity},label:"Mayo",sortable:!0,align:"right"},{name:"junio",field:o=>{var n;return(n=o.junio)==null?void 0:n.quantity},label:"Junio",sortable:!0,align:"right"},{name:"julio",field:o=>{var n;return(n=o.julio)==null?void 0:n.quantity},label:"Julio",sortable:!0,align:"right"},{name:"agosto",field:o=>{var n;return(n=o.agosto)==null?void 0:n.quantity},label:"Agosto",sortable:!0,align:"right"},{name:"septiembre",field:o=>{var n;return(n=o.septiembre)==null?void 0:n.quantity},label:"Septiembre",sortable:!0,align:"right"},{name:"octubre",field:o=>{var n;return(n=o.octubre)==null?void 0:n.quantity},label:"Octubre",sortable:!0,align:"right"},{name:"noviembre",field:o=>{var n;return(n=o.noviembre)==null?void 0:n.quantity},label:"Noviembre",sortable:!0,align:"right"},{name:"diciembre",field:o=>{var n;return(n=o.diciembre)==null?void 0:n.quantity},label:"Diciembre",sortable:!0,align:"right"},{name:"estimated_amount",field:o=>`${g(+o.estimated_amount)}`,label:"Precio",sortable:!0,align:"right"},{name:"total",field:o=>`${g(+o.total)}`,label:"Total",sortable:!0,align:"right"}],k=q(["action","line","department","article","estimated_amount","enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre","total"]),I=x.map(o=>({label:o.label,value:o.name})),{searchQuery:M,pagination:F,updatePagination:i}=ke(),_=q([]);W(p,()=>{var o;_.value=ae(((o=p.value)==null?void 0:o.details)||[])},{immediate:!0});function S(){Q(m.value.filteredSortedRows,x,"presupuesto")}async function E(o,n){n(),await b.mutateAsync({budgetDetail:o})}async function z(o,n){n(),await b.mutateAsync({budgetDetail:o})}return(o,n)=>(D(),j(fe,null,{default:l(()=>{var s;return[U("h5",Fe,"Presupuesto "+r((s=y(p))==null?void 0:s.year),1),U("div",Be,[U("div",Pe,[e(je)]),U("div",Ie,[e(pe,null,{"card-body":l(()=>[e(y(me),{ref_key:"qTablePresupuesto",ref:m,columns:x,filter:y(M),pagination:y(F),"row-key":"id",rows:_.value,"rows-per-page-options":[13,26,52,0],separator:"cell",title:"Detalle","visible-columns":k.value,"onUpdate:pagination":y(i)},{"top-right":l(a=>[e(B,{class:"tw-mr-2",color:"primary","fab-mini":"",flat:"",icon:"tune",size:"sm"},{default:l(()=>[e(L,null,{default:l(()=>[u(" Mostrar/Ocultar columnas ")]),_:1}),e(ne,{anchor:"top end",self:"center start"},{default:l(()=>[e(G,null,{default:l(()=>[(D(!0),Z(ee,null,te(y(I),t=>(D(),j(w,{key:t.value,clickable:""},{default:l(()=>[e(f,null,{default:l(()=>[e(T,null,{default:l(()=>[u(r(t.label),1)]),_:2},1024)]),_:2},1024),e(f,{side:""},{default:l(()=>[e(oe,{modelValue:k.value,"onUpdate:modelValue":n[0]||(n[0]=v=>k.value=v),color:"primary",val:t.value},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(B,{dense:"",flat:"",icon:a.inFullscreen?"fullscreen_exit":"fullscreen",round:"",onClick:a.toggleFullscreen},{default:l(()=>[e(L,{disable:o.$q.platform.is.mobile},{default:l(()=>[u(r(a.inFullscreen?"Salir de Pantalla Completa":"Pantalla Completa"),1)]),_:2},1032,["disable"])]),_:2},1032,["icon","onClick"]),e(C,{modelValue:y(M),"onUpdate:modelValue":n[1]||(n[1]=t=>Y(M)?M.value=t:null),class:"q-mr-xs",clearable:"",debounce:"300",dense:"",outlined:"",placeholder:"Buscar"},{append:l(()=>[e(P,{name:"search"})]),_:1},8,["modelValue"]),e(se,{unelevated:""},{default:l(()=>[e(B,{color:"primary","icon-right":"archive",label:"Exportar a CSV",onClick:S})]),_:1})]),body:l(a=>[e(ce,{props:a},{default:l(()=>[e(d,{key:"consecutiveId",props:a},{default:l(()=>[u(r(a.rowIndex+1),1)]),_:2},1032,["props"]),e(d,{key:"action",props:a},{default:l(()=>[u(r(a.row.action.name),1)]),_:2},1032,["props"]),e(d,{key:"line",props:a},{default:l(()=>[u(r(a.row.line.name),1)]),_:2},1032,["props"]),e(d,{key:"department",props:a},{default:l(()=>[u(r(a.row.department.alias),1)]),_:2},1032,["props"]),e(d,{key:"article",props:a},{default:l(()=>[u(r(a.row.article.name),1)]),_:2},1032,["props"]),e(d,{key:"article_description",props:a},{default:l(()=>[u(r(a.row.article.description),1)]),_:2},1032,["props"]),e(d,{key:"justification",props:a},{default:l(()=>[u(r(a.row.justification),1)]),_:2},1032,["props"]),e(d,{key:"enero",props:a},{default:l(()=>{var t;return[u(r((t=a.row.enero)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(d,{key:"febrero",props:a},{default:l(()=>{var t;return[u(r((t=a.row.febrero)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(d,{key:"marzo",props:a},{default:l(()=>{var t;return[u(r((t=a.row.marzo)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(d,{key:"abril",props:a},{default:l(()=>{var t;return[u(r((t=a.row.abril)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(d,{key:"mayo",props:a},{default:l(()=>{var t;return[u(r((t=a.row.mayo)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(d,{key:"junio",props:a},{default:l(()=>{var t;return[u(r((t=a.row.junio)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(d,{key:"julio",props:a},{default:l(()=>{var t;return[u(r((t=a.row.julio)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(d,{key:"agosto",props:a},{default:l(()=>{var t;return[u(r((t=a.row.agosto)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(d,{key:"septiembre",props:a},{default:l(()=>{var t;return[u(r((t=a.row.septiembre)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(d,{key:"octubre",props:a},{default:l(()=>{var t;return[u(r((t=a.row.octubre)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(d,{key:"noviembre",props:a},{default:l(()=>{var t;return[u(r((t=a.row.noviembre)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(d,{key:"diciembre",props:a},{default:l(()=>{var t;return[u(r((t=a.row.diciembre)==null?void 0:t.quantity),1)]}),_:2},1032,["props"]),e(d,{key:"estimated_amount",class:"tw-cursor-pointer",props:a},{default:l(()=>[u(r(y(g)(+a.row.estimated_amount))+" ",1),e(J,{modelValue:a.row.estimated_amount,"onUpdate:modelValue":t=>a.row.estimated_amount=t},{default:l(t=>[e(C,{modelValue:t.value,"onUpdate:modelValue":v=>t.value=v,modelModifiers:{number:!0},autofocus:"",dense:"",outlined:"",type:"number",onKeyup:R(v=>z(a.row,t.set),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),e(d,{key:"total",class:"tw-cursor-pointer",props:a},{default:l(()=>[u(r(y(g)(+a.row.total))+" ",1),e(J,{modelValue:a.row.total,"onUpdate:modelValue":t=>a.row.total=t},{default:l(t=>[e(C,{modelValue:t.value,"onUpdate:modelValue":v=>t.value=v,modelModifiers:{number:!0},autofocus:"",dense:"",outlined:"",type:"number",onKeyup:R(v=>E(a.row,t.set),["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["filter","pagination","rows","visible-columns","onUpdate:pagination"])]),_:1})])])]}),_:1}))}});export{Qt as default};
