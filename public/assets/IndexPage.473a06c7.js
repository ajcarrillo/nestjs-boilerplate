import{Q as W}from"./QSpace.8011658f.js";import{j as B,r as P,N as R,p as f,k as y,l as a,d as e,u as b,_ as T,X as v,b8 as X,w as Y,q as x,t as Z,ap as S,s as ee,J as ae}from"./index.c642270b.js";import{a as te,Q as C}from"./QTable.a954ff7c.js";import{Q as ne}from"./QPage.b05b83f0.js";import{T as re}from"./TablePage.2028e38e.js";import{p as q,l as w}from"./layout.57642b32.js";import{u as oe,a as z,b as G,f as le}from"./QSelect.0c416ba6.js";import{_ as ie}from"./CardDialog.b8ead8f2.js";import{a as N,Q as ue}from"./QForm.b5e5b280.js";import{a as c,b as _,c as de}from"./format.36dd34d6.js";import{Q as se}from"./QCheckbox.52de3645.js";import{Q as j}from"./QFile.b67b105f.js";import{Q as me}from"./QList.c5c39a9c.js";import{a as pe}from"./QCard.45ee23b3.js";import{Q as ce}from"./QCardActions.1a1d2e3c.js";import{c as I}from"./index.7adaf3a2.js";import{_ as _e}from"./DatePicker.f5a0ea2e.js";import{b as fe}from"./usePurchaseOrders.47de912f.js";import{F as A}from"./FilePreview.2dff7549.js";import"./scroll.da5f8d4c.js";import"./use-dark.ce8ccf7c.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./focus-manager.33224ae2.js";import"./index.2cf0d985.js";import"./utils.esm.f401af83.js";import"./ClosePopup.d8aae995.js";import"./date.e564ab4d.js";import"./QImg.fb40d397.js";function L(n){const o=new FormData;return o.append("payment_number",n.payment_number),o.append("payment_date",n.payment_date),o.append("amount",n.amount.toString()),o.append("purchase_order_id",n.purchase_order_id),o.append("check_number",n.check_number||""),o.append("is_submitted_to_finance",n.is_submitted_to_finance),n.paymentFile&&o.append("payment_file",n.paymentFile),n.checkFile&&o.append("check_file",n.checkFile),o}var D={getPaymentOrders(){return q.get("/payment-orders")},storePaymentOrder(n){const o=L(n);return q.post("/payment-orders",o,{headers:{"Content-Type":"multipart/form-data"}})},updatePaymentOrder(n){const{...o}=n,{id:k}=o;delete o.id;const h=L(o);return q.patch(`/payment-orders/${k}`,h,{headers:{"Content-Type":"multipart/form-data"}})}};const ye=async()=>(await D.getPaymentOrders()).data,be=async n=>(await D.storePaymentOrder(n)).data,he=async n=>(await D.updatePaymentOrder(n)).data,ge=()=>({queryPaymentOrders:oe({queryKey:["paymentOrders"],queryFn:ye,staleTime:6e4})}),ve=()=>{const n=z();return{storePaymentOrderMutation:G({mutationFn:be,onSuccess:async()=>{await n.invalidateQueries(["paymentOrders"]),w.showSuccessNotification("Orden de pago creada")},onError:()=>{w.showErrorNotification("No se pudo crear la orden de pago")}})}},ke=()=>{const n=z();return{updatePaymentOrderMutation:G({mutationFn:he,onSuccess:async()=>{await n.invalidateQueries(["paymentOrders"]),w.showSuccessNotification("Orden de pago actualizada")},onError:()=>{w.showErrorNotification("No se pudo actualizar la orden de pago")}})}},Oe=B({__name:"PaymentOrderForm",props:{paymentOrder:{default:()=>({purchase_order_id:"",payment_number:"",amount:0,payment_date:new Date().toISOString().substring(0,10),payment_file:"",check_number:"",check_file:"",is_submitted_to_finance:!1})}},emits:["close"],setup(n,{emit:o}){const k=n,h="https://nestjs-boilerplate-production.up.railway.app",{storePaymentOrderMutation:U}=ve(),{updatePaymentOrderMutation:$}=ke(),{dictionary:Q}=fe(),m=P(),F={purchase_order_id:"",payment_number:"",amount:0,payment_date:new Date().toISOString().substring(0,10),payment_file:"",check_number:"",check_file:"",is_submitted_to_finance:!1},t=R(I(k.paymentOrder)||I(F)),g={purchase_order_id:[i=>!!i||"La orden de compra es requerida"],payment_number:[i=>!!i||"El n\xFAmero de pago es requerido",i=>i.length==3||"El n\xFAmero de pago debe tener 3 d\xEDgitos",i=>!isNaN(Number(i))||"El n\xFAmero de pago debe ser un n\xFAmero"],amount:[i=>!!i||"El monto es requerido",i=>!isNaN(Number(i))||"El monto debe ser un n\xFAmero"],payment_date:[i=>!!i||"La fecha de pago es requerida"]},O=P(),V=P();async function d(){var u,l;await((u=m.value)==null?void 0:u.validate())&&(t.hasOwnProperty("id")?await $.mutateAsync(t):(await U.mutateAsync(t),(l=m.value)==null||l.reset(),o("close")))}function s(){t.purchase_order_id="",t.payment_number="",t.amount=0,t.payment_date=new Date().toISOString().substring(0,10),t.payment_file="",t.check_number="",t.check_file="",t.is_submitted_to_finance=!1,O.value=void 0,V.value=void 0}function r(i){t.paymentFile=i}function p(i){t.checkFile=i}return(i,u)=>(f(),y(b(ue),{ref_key:"qPaymentOrderForm",ref:m,onReset:s,onSubmit:X(d,["prevent"])},{default:a(()=>[e(pe,null,{default:a(()=>[e(me,null,{default:a(()=>[e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(N,{modelValue:t.payment_number,"onUpdate:modelValue":u[0]||(u[0]=l=>t.payment_number=l),dense:"",label:"N\xFAmero de pago",outlined:"",rules:g.payment_number},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(_e,{modelValue:t.payment_date,"onUpdate:modelValue":u[1]||(u[1]=l=>t.payment_date=l),rules:g.payment_date},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(N,{modelValue:t.amount,"onUpdate:modelValue":u[2]||(u[2]=l=>t.amount=l),modelModifiers:{number:!0},dense:"",label:"Monto",outlined:"",rules:g.amount},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(le,{modelValue:t.purchase_order_id,"onUpdate:modelValue":u[3]||(u[3]=l=>t.purchase_order_id=l),dense:"","emit-value":"",label:"Orden de compra","map-options":"",options:b(Q),outlined:"",rules:g.purchase_order_id},null,8,["modelValue","options","rules"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(se,{modelValue:t.is_submitted_to_finance,"onUpdate:modelValue":u[4]||(u[4]=l=>t.is_submitted_to_finance=l),dense:"",label:"\xBFSe envi\xF3 a finanzas?",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[t.payment_file?(f(),y(A,{key:1,"file-url":`${b(h)}/api/files/payment-orders/${t.id}/${t.payment_file}`},{activator:a(({showPreview:l})=>[e(v,{color:"primary",dense:"",flat:"",icon:"visibility",label:"Ver archivo de pago",unelevated:"",onClick:l},null,8,["onClick"])]),_:1},8,["file-url"])):(f(),y(j,{key:0,modelValue:O.value,"onUpdate:modelValue":[u[5]||(u[5]=l=>O.value=l),r],accept:".jpg, image/*, application/pdf",dense:"",label:"Archivo de pago",loading:!1,name:"payment_file",outlined:"","use-chips":""},{prepend:a(()=>[e(T,{name:"attach_file"})]),_:1},8,["modelValue"]))]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(N,{modelValue:t.check_number,"onUpdate:modelValue":u[6]||(u[6]=l=>t.check_number=l),dense:"",label:"N\xFAmero de cheque",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,null,{default:a(()=>[e(_,null,{default:a(()=>[e(j,{modelValue:V.value,"onUpdate:modelValue":[u[7]||(u[7]=l=>V.value=l),p],accept:".jpg, image/*, application/pdf",dense:"",label:"Archivo de cheque",loading:!1,name:"check_file",outlined:"","use-chips":""},{prepend:a(()=>[e(T,{name:"attach_file"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(de),e(ce,{align:"right"},{default:a(()=>[e(v,{color:"primary",label:"Guardar",type:"submit"})]),_:1})]),_:1},8,["onSubmit"]))}});const Ve=ee("div",{class:"q-table__title"},"\xD3rdenes de pago",-1),Ye=B({__name:"IndexPage",setup(n){const o="https://nestjs-boilerplate-production.up.railway.app",{queryPaymentOrders:k}=ge(),{data:h,isLoading:U,isError:$}=k,Q=[{name:"payment_number",field:"payment_number",label:"Orden de pago",align:"right",sortable:!0},{name:"amount",field:"amount",label:"Total real",align:"right",sortable:!0},{name:"payment_date",field:"payment_date",label:"Fecha de elaboraci\xF3n",align:"center",sortable:!0},{name:"purchaseOrder",field:d=>{var s;return(s=d.purchaseOrder)==null?void 0:s.order_number},label:"Orden de compra",align:"right",sortable:!0},{name:"requisition",field:d=>{var s,r;return(r=(s=d.purchaseOrder)==null?void 0:s.requisition)==null?void 0:r.requisition_number},label:"Requisici\xF3n",align:"right",sortable:!0},{name:"payment_file",field:"payment_file",label:"Archivo",align:"center",sortable:!0},{name:"is_submitted_to_finance",field:d=>d.is_submitted_to_finance?"Si":"No",label:"Enviado a finanzas",sortable:!0,align:"center"},{name:"check_number",field:"check_number",label:"N\xFAmero de cheque",align:"right",sortable:!0},{name:"check_file",field:"check_file",label:"Cheque",align:"center",sortable:!0}],m=P(!1),F=P(-1);let t=R({purchase_order_id:"",payment_number:"",amount:0,payment_date:new Date().toISOString().substring(0,10),payment_file:"",check_number:"",check_file:"",is_submitted_to_finance:!1});const g={purchase_order_id:"",payment_number:"",amount:0,payment_date:new Date().toISOString().substring(0,10),payment_file:"",check_number:"",check_file:"",is_submitted_to_finance:!1};Y(m,d=>{d||V()});function O(d){var E,M;const{payment_number:s,amount:r,payment_date:p,payment_file:i,check_number:u,check_file:l,id:H,is_submitted_to_finance:J}=d;F.value=(E=h.value)==null?void 0:E.findIndex(K=>K.id===d.id),t=Object.assign({},{id:H,purchase_order_id:(M=d.purchaseOrder)==null?void 0:M.id,payment_number:s,amount:r,payment_date:p,payment_file:i,check_number:u,check_file:l,is_submitted_to_finance:J}),m.value=!0}function V(){m.value=!1,ae(()=>{t=I(g),F.value=-1})}return(d,s)=>(f(),y(ne,null,{default:a(()=>[e(re,null,{"card-body":a(()=>[e(te,{columns:Q,rows:b(h),title:"\xD3rdenes de pago"},{top:a(()=>[Ve,e(W),e(v,{color:"primary",label:"Nueva orden de pago",onClick:s[0]||(s[0]=r=>m.value=!0)})]),"body-cell-payment_number":a(r=>[e(C,{props:r},{default:a(()=>[r.value?(f(),y(v,{key:0,color:"primary",flat:"","no-caps":"",onClick:p=>O(r.row)},{default:a(()=>[x(Z(r.value),1)]),_:2},1032,["onClick"])):S("",!0)]),_:2},1032,["props"])]),"body-cell-payment_file":a(r=>[e(C,{props:r},{default:a(()=>[r.value?(f(),y(A,{key:0,"file-url":`${b(o)}/api/files/payment-orders/${r.id}/${r.value}`},{activator:a(({showPreview:p})=>[e(v,{color:"primary",flat:"","no-caps":"",onClick:p},{default:a(()=>[x(" Ver archivo ")]),_:2},1032,["onClick"])]),_:2},1032,["file-url"])):S("",!0)]),_:2},1032,["props"])]),"body-cell-check_file":a(r=>[e(C,{props:r},{default:a(()=>[r.value?(f(),y(A,{key:0,"file-url":`${b(o)}/api/files/payment-orders/${r.id}/${r.value}`},{activator:a(({showPreview:p})=>[e(v,{color:"primary",flat:"","no-caps":"",onClick:p},{default:a(()=>[x(" Ver archivo ")]),_:2},1032,["onClick"])]),_:2},1032,["file-url"])):S("",!0)]),_:2},1032,["props"])]),_:1},8,["rows"])]),footer:a(()=>[e(ie,{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=r=>m.value=r),"card-title":"Orden de pago",class:"form-payment-order"},{default:a(({closeDialog:r})=>[e(Oe,{"payment-order":b(t),onClose:r},null,8,["payment-order","onClose"])]),_:1},8,["modelValue"])]),_:1})]),_:1}))}});export{Ye as default};
