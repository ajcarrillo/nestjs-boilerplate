import{j as F,M as V,r as Q,c as S,p as N,k,l as t,d as e,X as w,u as f,w as P,_ as T,s as A,O as D}from"./index.33aee9c3.js";import{Q as C}from"./QInput.bc534865.js";import{Q as B,a as $}from"./QTable.71d6b359.js";import{T as z}from"./TablePage.1ebf5b06.js";import{L as E,u as K}from"./BudgetResource.3a0abb0c.js";import{l as L}from"./layout.880d2741.js";import{u as j,a as U}from"./useQuery.esm.08e598e9.js";import{u as h}from"./useMutation.esm.5aff8292.js";import{Q as q,a as I}from"./QItem.3270a199.js";import{Q as O}from"./QList.1e036a38.js";import{Q as G}from"./QCardSection.2089956e.js";import{a as H}from"./QMenu.746f001c.js";import{Q as R}from"./QCardActions.ddbe4808.js";import{Q as X}from"./QForm.05da6a20.js";import{c as M}from"./index.7adaf3a2.js";import{_ as J}from"./CardDialog.f8593b25.js";import"./use-key-composition.b1866cfc.js";import"./use-dark.a42b1db8.js";import"./focus-manager.387b0375.js";import"./QSelect.bc9b930f.js";import"./format.9dfa61a7.js";import"./scroll.5632c0ea.js";import"./QItemLabel.b3a0c01c.js";import"./QCheckbox.685522c0.js";import"./QCard.e44cba30.js";import"./QPage.6112cc6b.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./index.2cf0d985.js";import"./utils.esm.aa7cdc1a.js";import"./mutation.esm.9a94c1b8.js";import"./QSpace.3bc606e8.js";import"./MyCardTitle.c7481455.js";const W=async()=>{const{data:a}=await E.getLines();return a},Y=async a=>{const{data:o}=await E.storeLine(a);return o},Z=async a=>{const{id:o,name:p,description:u}=a,{data:y}=await E.updateLine(o,{name:p,description:u});return y},ee=()=>{const{isLoading:a,isError:o,data:p,error:u}=j({queryKey:["lines"],queryFn:W,staleTime:6e5});return{isLoading:a,isError:o,data:p,error:u}},te=()=>{const a=U();return{lineStoreMutations:h({mutationFn:Y,onSuccess:()=>{a.invalidateQueries({queryKey:["lines"]}),L.showSuccessNotification("Partida creada con \xE9xito")},onError:()=>{L.showErrorNotification("Error al crear partida")}})}},ae=()=>{const a=U();return{lineUpdateMutations:h({mutationFn:Z,onSuccess:()=>{a.invalidateQueries({queryKey:["lines"]}),L.showSuccessNotification("Partida actualizada con \xE9xito")},onError:()=>{L.showErrorNotification("Error al actualizar partida")}})}},oe=F({__name:"LineForm",props:{line:null},setup(a){const o=a,p=K(),{fetchLineDictionary:u}=p,{lineStoreMutations:y}=te(),{isLoading:g}=y,{lineUpdateMutations:l}=ae(),{isLoading:v}=l,x=V({name:"",description:""}),n=V(M(o.line||x)),_=Q(),b={name:[c=>!!c||"El nombre es requerido"],description:[c=>!!c||"La descripci\xF3n es requerida"]},d=S(()=>o.line&&"id"in o.line);S(()=>d.value?"Editar partida":"Agregar partida");async function r(){var s,m;await((s=_.value)==null?void 0:s.validate())&&(d.value?(await l.mutateAsync(n),await i()):(await y.mutateAsync(n),n.name="",n.description="",(m=_.value)==null||m.reset(),await i()))}async function i(){await u()}return(c,s)=>(N(),k(f(X),{ref_key:"lineForm",ref:_,class:"q-gutter-md"},{default:t(()=>[e(G,null,{default:t(()=>[e(O,null,{default:t(()=>[e(q,null,{default:t(()=>[e(I,null,{default:t(()=>[e(C,{modelValue:n.name,"onUpdate:modelValue":s[0]||(s[0]=m=>n.name=m),dense:"",label:"Nombre",outlined:"",rules:b.name},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(q,null,{default:t(()=>[e(I,null,{default:t(()=>[e(C,{modelValue:n.description,"onUpdate:modelValue":s[1]||(s[1]=m=>n.description=m),dense:"",label:"Descripci\xF3n",outlined:"",rules:b.description,type:"textarea"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),e(H),e(R,{align:"right"},{default:t(()=>[e(w,{color:"primary",label:"Guardar",loading:f(g)||f(v),onClick:r},null,8,["loading"])]),_:1})]),_:1},512))}}),ie={class:"q-gutter-sm"},Te=F({__name:"IndexPage",setup(a){const{data:o,isLoading:p}=ee(),u=Q(""),y=[{name:"id",field:"id",required:!0,label:"ID",sortable:!0,align:"left"},{name:"name",field:"name",label:"Nombre",sortable:!0,align:"left"},{name:"description",field:"description",label:"Descripci\xF3n",sortable:!1,align:"left"},{name:"action",align:"center",label:"Acciones",field:"action",sortable:!1}],g=Q(-1),l=Q(!1);let v=V({name:"",description:""});const x={name:"",description:""},n=S(()=>g.value===-1?"Nueva Partida":"Editar Partida");P(l,d=>{d||b()});function _(d){var s;const{name:r,description:i,id:c}=d;g.value=(s=o.value)==null?void 0:s.findIndex(m=>m.id===d.id),v=Object.assign({},{id:c,name:r,description:i}),l.value=!0}function b(){l.value=!1,D(()=>{v=M(x),g.value=-1})}return(d,r)=>(N(),k(z,null,{"card-body":t(()=>[e($,{columns:y,loading:f(p),rows:f(o),"rows-per-page-options":[20,30,40,50],title:"Partidas"},{"top-right":t(()=>[e(w,{class:"q-mr-xs",color:"primary",icon:"add",label:"Nueva Partida",outline:"",onClick:r[0]||(r[0]=i=>l.value=!0)}),e(C,{modelValue:u.value,"onUpdate:modelValue":r[1]||(r[1]=i=>u.value=i),class:"q-mr-xs",debounce:"300",dense:"",outlined:"",placeholder:"Search"},{append:t(()=>[e(T,{name:"search"})]),_:1},8,["modelValue"]),e(w,{color:"primary","icon-right":"archive",label:"Exportar CSV","no-caps":""})]),"body-cell-action":t(i=>[e(B,{props:i},{default:t(()=>[A("div",ie,[e(w,{color:"primary",dense:"",flat:"",icon:"edit",rounded:"",size:"sm",onClick:c=>_(i.row)},null,8,["onClick"])])]),_:2},1032,["props"])]),_:1},8,["loading","rows"])]),footer:t(()=>[e(J,{modelValue:l.value,"onUpdate:modelValue":r[2]||(r[2]=i=>l.value=i),"card-title":f(n)},{default:t(()=>[e(oe,{line:f(v)},null,8,["line"])]),_:1},8,["modelValue","card-title"])]),_:1}))}});export{Te as default};
