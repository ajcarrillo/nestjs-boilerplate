import{Q as ee}from"./QSpace.a3e1f224.js";import{Q as te}from"./QToggle.b77bfd12.js";import{v as D,h as c,x as T,r as F,c as _,_ as G,ah as re,aS as ae,g as $,y as N,i as oe,b5 as ne,b8 as X,H as le,N as ie,ai as ue,j as J,M as se,p as U,k,l as a,d as r,u as x,ap as L,b2 as K,q as R,t as I,aj as E,X as V,b9 as de,w as ce,V as pe,b as me,s as ve}from"./index.14e8ebb5.js";import{a as fe,Q as _e}from"./QTable.4cc72d32.js";import{Q as be}from"./QSlideTransition.77f83b45.js";import{u as ge,a as Se,b as qe,c as Pe}from"./use-panel.ad4505e0.js";import{u as he}from"./ClosePopup.559675a8.js";import{Q as ye}from"./QCard.01814d56.js";import{u as xe,a as Ce}from"./use-dark.e748ccdc.js";import{Q as Fe}from"./QPage.6a9365d9.js";import{T as Qe}from"./TablePage.c82df34f.js";import{P as we,u as Ve,a as Ie}from"./usePurchaseOrders.b8dc2269.js";import{Q as Re}from"./QInput.0f74b52d.js";import{Q as w,a as Q,b as O}from"./QItemLabel.7fed4ad0.js";import{Q as j}from"./QSelect.3bb31b5f.js";import{Q as Ue}from"./QFile.0879df6b.js";import{Q as ke}from"./QList.2e5bba7a.js";import{Q as Oe}from"./QCardSection.0d056ee7.js";import{a as Te}from"./format.d9f81dde.js";import{Q as De}from"./QCardActions.dee82ce4.js";import{c as H}from"./index.7adaf3a2.js";import{d as Ne}from"./useRequisitions.c64731a9.js";import{_ as Ee}from"./DatePicker.ef7c594a.js";import{Q as $e}from"./QForm.4ada3f4b.js";import{l as Ae}from"./layout.a470fe7f.js";import{u as Be}from"./useSubBudgets.bf228bfc.js";import{_ as Le}from"./CardDialog.be84acff.js";import{F as Ke}from"./FilePreview.7be9115f.js";import"./QCheckbox.cc510596.js";import"./scroll.d839d060.js";import"./touch.70a9dd44.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./planeacion.api.91fa18e5.js";import"./index.2cf0d985.js";import"./QChip.c477ed29.js";import"./utils.esm.1cc111ad.js";import"./useMutation.esm.fc6ad15c.js";import"./mutation.esm.6a2477d4.js";import"./QPopupProxy.3538f428.js";import"./date.d6e11009.js";import"./QTooltip.133969a2.js";import"./QImg.17c45358.js";var M=D({name:"QStepperNavigation",setup(e,{slots:u}){return()=>c("div",{class:"q-stepper__nav"},T(u.default))}}),Y=D({name:"StepHeader",props:{stepper:{},step:{},goToPanel:Function},setup(e,{attrs:u}){const{proxy:{$q:p}}=$(),m=F(null),o=_(()=>e.stepper.modelValue===e.step.name),g=_(()=>{const t=e.step.disable;return t===!0||t===""}),S=_(()=>{const t=e.step.error;return t===!0||t===""}),d=_(()=>{const t=e.step.done;return g.value===!1&&(t===!0||t==="")}),b=_(()=>{const t=e.step.headerNav,s=t===!0||t===""||t===void 0;return g.value===!1&&e.stepper.headerNav&&s}),P=_(()=>e.step.prefix&&(o.value===!1||e.stepper.activeIcon==="none")&&(S.value===!1||e.stepper.errorIcon==="none")&&(d.value===!1||e.stepper.doneIcon==="none")),q=_(()=>{const t=e.step.icon||e.stepper.inactiveIcon;if(o.value===!0){const s=e.step.activeIcon||e.stepper.activeIcon;return s==="none"?t:s||p.iconSet.stepper.active}if(S.value===!0){const s=e.step.errorIcon||e.stepper.errorIcon;return s==="none"?t:s||p.iconSet.stepper.error}if(g.value===!1&&d.value===!0){const s=e.step.doneIcon||e.stepper.doneIcon;return s==="none"?t:s||p.iconSet.stepper.done}return t}),n=_(()=>{const t=S.value===!0?e.step.errorColor||e.stepper.errorColor:void 0;if(o.value===!0){const s=e.step.activeColor||e.stepper.activeColor||e.step.color;return s!==void 0?s:t}return t!==void 0?t:g.value===!1&&d.value===!0?e.step.doneColor||e.stepper.doneColor||e.step.color||e.stepper.inactiveColor:e.step.color||e.stepper.inactiveColor}),h=_(()=>"q-stepper__tab col-grow flex items-center no-wrap relative-position"+(n.value!==void 0?` text-${n.value}`:"")+(S.value===!0?" q-stepper__tab--error q-stepper__tab--error-with-"+(P.value===!0?"prefix":"icon"):"")+(o.value===!0?" q-stepper__tab--active":"")+(d.value===!0?" q-stepper__tab--done":"")+(b.value===!0?" q-stepper__tab--navigation q-focusable q-hoverable":"")+(g.value===!0?" q-stepper__tab--disabled":"")),C=_(()=>e.stepper.headerNav!==!0?!1:b.value);function v(){m.value!==null&&m.value.focus(),o.value===!1&&e.goToPanel(e.step.name)}function l(t){t.keyCode===13&&o.value===!1&&e.goToPanel(e.step.name)}return()=>{const t={class:h.value};b.value===!0&&(t.onClick=v,t.onKeyup=l,Object.assign(t,g.value===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:u.tabindex||0}));const s=[c("div",{class:"q-focus-helper",tabindex:-1,ref:m}),c("div",{class:"q-stepper__dot row flex-center q-stepper__line relative-position"},[c("span",{class:"row flex-center"},[P.value===!0?e.step.prefix:c(G,{name:q.value})])])];if(e.step.title!==void 0&&e.step.title!==null){const f=[c("div",{class:"q-stepper__title"},e.step.title)];e.step.caption!==void 0&&e.step.caption!==null&&f.push(c("div",{class:"q-stepper__caption"},e.step.caption)),s.push(c("div",{class:"q-stepper__label q-stepper__line relative-position"},f))}return re(c("div",t,s),[[ae,C.value]])}}});function Z(e){return c("div",{class:"q-stepper__step-content"},[c("div",{class:"q-stepper__step-inner"},T(e.default))])}const W={setup(e,{slots:u}){return()=>Z(u)}};var z=D({name:"QStep",props:{...ge,icon:String,color:String,title:{type:String,required:!0},caption:String,prefix:[String,Number],doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String,headerNav:{type:Boolean,default:!0},done:Boolean,error:Boolean,onScroll:[Function,Array]},setup(e,{slots:u,emit:p}){const{proxy:{$q:m}}=$(),o=oe(X,N);if(o===N)return console.error("QStep needs to be a child of QStepper"),N;const{getCacheWithFn:g}=he(),S=F(null),d=_(()=>o.value.modelValue===e.name),b=_(()=>m.platform.is.ios!==!0&&m.platform.is.chrome===!0||d.value!==!0||o.value.vertical!==!0?{}:{onScroll(n){const{target:h}=n;h.scrollTop>0&&(h.scrollTop=0),e.onScroll!==void 0&&p("scroll",n)}}),P=_(()=>typeof e.name=="string"||typeof e.name=="number"?e.name:String(e.name));function q(){const n=o.value.vertical;return n===!0&&o.value.keepAlive===!0?c(ne,o.value.keepAliveProps.value,d.value===!0?[c(o.value.needsUniqueKeepAliveWrapper.value===!0?g(P.value,()=>({...W,name:P.value})):W,{key:P.value},u.default)]:void 0):n!==!0||d.value===!0?Z(u):void 0}return()=>c("div",{ref:S,class:"q-stepper__step",role:"tabpanel",...b.value},o.value.vertical===!0?[c(Y,{stepper:o.value,step:e,goToPanel:o.value.goToPanel}),o.value.animated===!0?c(be,q):q()]:[q()])}});const je=/(-\w)/g;function He(e){const u={};for(const p in e){const m=p.replace(je,o=>o[1].toUpperCase());u[m]=e[p]}return u}var Me=D({name:"QStepper",props:{...xe,...Se,flat:Boolean,bordered:Boolean,alternativeLabels:Boolean,headerNav:Boolean,contracted:Boolean,headerClass:String,inactiveColor:String,inactiveIcon:String,doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String},emits:qe,setup(e,{slots:u}){const p=$(),m=Ce(e,p.proxy.$q),{updatePanelsList:o,isValidPanelName:g,updatePanelIndex:S,getPanelContent:d,getPanels:b,panelDirectives:P,goToPanel:q,keepAliveProps:n,needsUniqueKeepAliveWrapper:h}=Pe();le(X,_(()=>({goToPanel:q,keepAliveProps:n,needsUniqueKeepAliveWrapper:h,...e})));const C=_(()=>`q-stepper q-stepper--${e.vertical===!0?"vertical":"horizontal"}`+(e.flat===!0?" q-stepper--flat":"")+(e.bordered===!0?" q-stepper--bordered":"")+(m.value===!0?" q-stepper--dark q-dark":"")),v=_(()=>`q-stepper__header row items-stretch justify-between q-stepper__header--${e.alternativeLabels===!0?"alternative":"standard"}-labels`+(e.flat===!1||e.bordered===!0?" q-stepper__header--border":"")+(e.contracted===!0?" q-stepper__header--contracted":"")+(e.headerClass!==void 0?` ${e.headerClass}`:""));function l(){const t=T(u.message,[]);if(e.vertical===!0){g(e.modelValue)&&S();const s=c("div",{class:"q-stepper__content"},T(u.default));return t===void 0?[s]:t.concat(s)}return[c("div",{class:v.value},b().map(s=>{const f=He(s.props);return c(Y,{key:f.name,stepper:e,step:f,goToPanel:q})})),t,ue("div",{class:"q-stepper__content q-panel-parent"},d(),"cont",e.swipeable,()=>P.value)]}return()=>(o(u),c("div",{class:C.value},ie(u.navigation,l())))}});const We=()=>{const e=F(),u=F(!1);return{isLoading:u,fileToUpload:e,uploadFile:async m=>{if(!e.value)throw new Error("No hay archivo para cargar");u.value=!0;const o=await m(e.value);return u.value=!1,Ae.showSuccessNotification("Archivo subido con \xE9xito"),e.value=void 0,o}}},ze=()=>{const{fileToUpload:e,isLoading:u,uploadFile:p}=We();return{fileToUpload:e,isLoading:u,uploadRequisitionFile:async o=>await p(async S=>{const d=new FormData;d.append("file",S);const{data:b}=await we.uploadFile(o,d);return b.file_name})}},Ge=J({__name:"PurchaseOrderForm",props:{purchaseOrder:{default:()=>({order_number:null,reception_date:new Date().toISOString().substring(0,10),requisition_id:null})}},setup(e){const u=e,{uploadRequisitionFile:p,fileToUpload:m,isLoading:o}=ze(),{requisitionsDictionary:g}=Ne(),{subBudgetReqDictionary:S}=Be(),{createPurchaseOrder:d,purchaseOrder:b,purchaseOrderType:P}=Ve(),q={order_number:null,reception_date:new Date().toISOString().substring(0,10),requisition_id:null},n=se(H(u.purchaseOrder)||H(q)),h={order_number:[f=>!!f||"El n\xFAmero de orden de compra es requerido",f=>f.length==3||"El n\xFAmero de orden de compra debe tener 3 d\xEDgitos",f=>!isNaN(Number(f))||"El n\xFAmero de orden de compra debe ser un n\xFAmero"],reception_date:[f=>!!f||"La fecha de recepci\xF3n es requerida"],requisition_id:[f=>!!f||"La requisici\xF3n es requerida"]},C=F(),v=F(null),l=F();async function t(){var y,i,A,B;await((y=C.value)==null?void 0:y.validate())&&(await d({requisition_id:(i=v.value)==null?void 0:i.id,order_number:n.order_number,reception_date:n.reception_date}),l.value?(m.value=l.value,await p(b.value.id),(A=C.value)==null||A.reset()):(B=C.value)==null||B.reset())}function s(){n.order_number=null,n.reception_date=new Date().toISOString().substring(0,10),n.requisition_id=null,v.value=null,l.value=void 0}return(f,y)=>(U(),k(x($e),{ref_key:"qPurchaseOrderForm",ref:C,onReset:s,onSubmit:de(t,["prevent"])},{default:a(()=>[r(Oe,null,{default:a(()=>[r(ke,null,{default:a(()=>[r(w,null,{default:a(()=>[r(Q,null,{default:a(()=>[r(Re,{modelValue:n.order_number,"onUpdate:modelValue":y[0]||(y[0]=i=>n.order_number=i),dense:"",label:"N\xFAmero de orden de compra",outlined:"",rules:h.order_number},null,8,["modelValue","rules"])]),_:1})]),_:1}),r(w,null,{default:a(()=>[r(Q,null,{default:a(()=>[r(Ee,{modelValue:n.reception_date,"onUpdate:modelValue":y[1]||(y[1]=i=>n.reception_date=i),rules:h.reception_date},null,8,["modelValue","rules"])]),_:1})]),_:1}),r(w,null,{default:a(()=>[x(P)==="PRESUPUESTO"?(U(),k(Q,{key:0},{default:a(()=>[r(j,{modelValue:v.value,"onUpdate:modelValue":y[2]||(y[2]=i=>v.value=i),dense:"",label:"Requisici\xF3n","option-label":i=>`Requisici\xF3n #${i.requisition_number} - ${i.area_description}`,"option-value":"id",options:x(g),outlined:"",rules:h.requisition_id},{option:a(i=>[r(w,L(K(i.itemProps)),{default:a(()=>[r(Q,null,{default:a(()=>[r(O,null,{default:a(()=>[R("Requisici\xF3n #"+I(i.opt.requisition_number),1)]),_:2},1024),r(O,{caption:""},{default:a(()=>[R(I(i.opt.area_description),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","option-label","options","rules"])]),_:1})):E("",!0),x(P)==="SUBPRESUPUESTO"?(U(),k(Q,{key:1},{default:a(()=>[r(j,{modelValue:v.value,"onUpdate:modelValue":y[3]||(y[3]=i=>v.value=i),dense:"",label:"Requisici\xF3n","option-label":i=>`Requisici\xF3n #${i.requisition_number} - ${i.event}`,"option-value":"id",options:x(S),outlined:"",rules:h.requisition_id},{option:a(i=>[r(w,L(K(i.itemProps)),{default:a(()=>[r(Q,null,{default:a(()=>[r(O,null,{default:a(()=>[R("Requisici\xF3n #"+I(i.opt.requisition_number),1)]),_:2},1024),r(O,{caption:""},{default:a(()=>[R(I(i.opt.area_description)+" "+I(i.opt.event),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","option-label","options","rules"])]),_:1})):E("",!0)]),_:1}),r(w,null,{default:a(()=>[r(Q,null,{default:a(()=>[r(Ue,{modelValue:l.value,"onUpdate:modelValue":y[4]||(y[4]=i=>l.value=i),accept:".jpg, image/*, application/pdf",dense:"",label:"Haga click para subir el archivo o arrastralo aqu\xED",loading:x(o),outlined:"","use-chips":""},{prepend:a(()=>[r(G,{name:"attach_file"})]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),r(Te),r(De,{align:"right"},{default:a(()=>[r(V,{color:"primary",label:"Guardar",type:"submit",unelevated:""})]),_:1})]),_:1},8,["onSubmit"]))}});const Xe=ve("div",{class:"q-table__title"},"\xD3rdenes de compra",-1),$t=J({__name:"IndexPage",setup(e){const u="https://nestjs-boilerplate-production.up.railway.app",p=pe(),m=p.currentRoute.value,{isLoading:o,isFetching:g,orders:S,fromSubBudgetsModel:d,purchaseOrderType:b}=Ie(),P=[{name:"order_number",field:"order_number",label:"N\xFAmero de orden de compra",align:"center",sortable:!0},{name:"reception_date",field:"reception_date",label:"Fecha de recepci\xF3n",sortable:!0,align:"left"},{name:"requisition",field:v=>{var l;return(l=v.requisition)==null?void 0:l.requisition_number},label:"Requisici\xF3n",sortable:!0,align:"center"},{name:"file",field:"file",label:"Archivo",sortable:!1,align:"left"}],q=F(!1),n=F(1);ce(d,v=>{p.replace({query:{...m.query,fromSubBudgets:v.toString()}})});const h=_(()=>b.value===""?"Selecciona un tipo de orden de compra":b.value==="PRESUPUESTO"?"Presupuesto":"SubPresupuesto");function C(v){b.value=v,n.value=2}return(v,l)=>(U(),k(Fe,null,{default:a(()=>[r(Qe,null,{"card-body":a(()=>[r(fe,{columns:P,loading:x(o)||x(g),rows:x(S),title:"\xD3rdenes de compra"},{top:a(()=>[Xe,r(ee),r(te,{modelValue:x(d),"onUpdate:modelValue":l[0]||(l[0]=t=>me(d)?d.value=t:null),class:"tw-mr-4",label:"Mostrar las \xF3rdenes de compra de los SubPresupuestos"},null,8,["modelValue"]),r(V,{color:"primary",label:"Nueva orden de compra",onClick:l[1]||(l[1]=t=>q.value=!0)})]),"body-cell-file":a(t=>[r(_e,{props:t},{default:a(()=>[t.value?(U(),k(Ke,{key:0,"file-url":`${x(u)}/api/files/purchase-orders/${t.id}/${t.value}`},{activator:a(({showPreview:s})=>[r(V,{color:"primary",flat:"","no-caps":"",onClick:s},{default:a(()=>[R(" Ver archivo ")]),_:2},1032,["onClick"])]),_:2},1032,["file-url"])):E("",!0)]),_:2},1032,["props"])]),_:1},8,["loading","rows"])]),footer:a(()=>[r(Le,{modelValue:q.value,"onUpdate:modelValue":l[6]||(l[6]=t=>q.value=t),"card-title":"Orden de Compra",class:"form-purchase-order"},{default:a(()=>[r(Me,{modelValue:n.value,"onUpdate:modelValue":l[5]||(l[5]=t=>n.value=t),animated:"",color:"primary",vertical:""},{default:a(()=>[r(z,{done:n.value>1,icon:"settings",name:1,title:"Selecciona un tipo de orden de compra"},{default:a(()=>[r(M,{class:"tw-flex tw-gap-1"},{default:a(()=>[r(V,{color:"primary",label:"Presupuesto",outline:"",onClick:l[2]||(l[2]=t=>C("PRESUPUESTO"))}),r(V,{color:"primary",label:"SubPresupuesto",outline:"",onClick:l[3]||(l[3]=t=>C("SUBPRESUPUESTO"))})]),_:1})]),_:1},8,["done"]),r(z,{caption:x(h),done:n.value>2,icon:"create_new_folder",name:2,title:"Crear Orden de Compra"},{default:a(()=>[r(ye,{bordered:"",flat:""},{default:a(()=>[r(Ge)]),_:1}),r(M,null,{default:a(()=>[r(V,{color:"primary",flat:"",label:"atr\xE1s",onClick:l[4]||(l[4]=t=>{n.value=1,b.value=""})})]),_:1})]),_:1},8,["caption","done"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})]),_:1}))}});export{$t as default};
