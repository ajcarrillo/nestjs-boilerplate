import{a as D,Q as R}from"./QCard.8418aa13.js";import{c as E,a as M,b as A,k as P}from"./format.bc6b5d0a.js";import{v as X,c as v,h as V,x as S,g as G,p as m,k as b,l as t,s as g,aR as J,r as w,j as C,aH as W,ag as B,d as e,X as k,q as _,F as L,at as N,u as n,t as Q,ap as I,o as Y,av as Z,b1 as K,an as ee,_ as te,b as ae,m as le}from"./index.0b175f01.js";import{Q as U,f as ie}from"./QSelect.a01fc3f8.js";import{C as oe,_ as ne}from"./RequisitionForm.472c7d7c.js";import{R as se,c as re}from"./useRequisitions.910cf54e.js";import{Q as j}from"./QSpace.c1f9a46e.js";import{u as ue,a as de}from"./use-dark.46bf0f81.js";import{Q as ce}from"./QTd.18df5e8a.js";import{Q as H}from"./QTable.78812d52.js";import{C as me}from"./ClosePopup.ba470207.js";import{_ as pe}from"./plugin-vue_export-helper.21dcd24c.js";import{u as fe}from"./useDictionaries.0adf0c16.js";import{a as _e}from"./useBudgetDetail.bbeea406.js";import{a as ge}from"./QForm.e02b1b3f.js";import{Q as z}from"./QList.de9c20f7.js";import{Q as qe}from"./QCardActions.cdd25544.js";import"./focus-manager.33224ae2.js";import"./scroll.be050d28.js";import"./utils.esm.4fba875c.js";import"./layout.e5b39b81.js";import"./index.2cf0d985.js";import"./QPage.f7e992f7.js";import"./index.7adaf3a2.js";import"./FilePreview.45205163.js";import"./QImg.4d76d69d.js";import"./useAreas.79d8009b.js";import"./app.5e9b6a7a.js";import"./ActionResource.106ff265.js";import"./LineResource.1917564b.js";import"./ArticleResource.776678dc.js";import"./date.2de2ec43.js";var O=X({name:"QBanner",props:{...ue,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(i,{slots:a}){const{proxy:{$q:s}}=G(),l=de(i,s),o=v(()=>"q-banner row items-center"+(i.dense===!0?" q-banner--dense":"")+(l.value===!0?" q-banner--dark q-dark":"")+(i.rounded===!0?" rounded-borders":"")),u=v(()=>`q-banner__actions row items-center justify-end col-${i.inlineActions===!0?"auto":"all"}`);return()=>{const r=[V("div",{class:"q-banner__avatar col-auto row items-center self-start"},S(a.avatar)),V("div",{class:"q-banner__content col text-body2"},S(a.default))],c=S(a.action);return c!==void 0&&r.push(V("div",{class:u.value},c)),V("div",{class:o.value+(i.inlineActions===!1&&c!==void 0?" q-banner--top-padding":""),role:"alert"},r)}}});const ve={},be={class:"text-h6"};function ye(i,a){return m(),b(D,null,{default:t(()=>[g("div",be,[J(i.$slots,"default")])]),_:3})}var T=pe(ve,[["render",ye]]);const we=async(i,a)=>{const{data:s}=await se.storeRequisitionDetail(i,a);return s},De=()=>{const i=w(!1),a=w(null),s=w(null);return{loading:i,error:a,data:s,storeDetail:async(o,u)=>{i.value=!0,a.value=null;try{s.value=await we(o,u)}catch(r){a.value=r}finally{i.value=!1}}}},he=C({__name:"AddArticleDialog",props:{selectedArticle:null,requisition:null},setup(i){const a=i,{storeDetail:s,loading:l}=De(),o=w(!1),u={alias:"Depto.",description:"Departamento",article_description:"Descripci\xF3n del art\xEDculo",month:"Mes",estimated_amount:"Monto estimado",total:"Total",quantity:"Cantidad programada"},r=w(a.selectedArticle.quantity||0),c=[p=>p>0||"La cantidad debe ser mayor a 0",p=>p<=a.selectedArticle.quantity||"La cantidad no puede ser mayor a la cantidad disponible"],d=w([]),y=v(()=>r.value*a.selectedArticle.estimated_amount||0),F=v(()=>a.requisition.estimated_amount/r.value),q=v(()=>d.value.length>0),$=v(()=>Object.keys(u).filter(p=>p!=="id"&&p!=="budget_id"));W(()=>{d.value=[],F.value>a.selectedArticle.estimated_amount&&d.value.push("El precio por art\xEDculo no puede ser mayor al monto estimado por art\xEDculo"),y.value>a.selectedArticle.total&&d.value.push("El monto total no puede ser mayor al monto autorizado"),y.value>a.requisition.estimated_amount&&d.value.push("El monto total no puede ser mayor al monto estimado de la requisici\xF3n")});async function h(){if(q.value)return;const p={...a.selectedArticle,quantity:r.value};await s(a.requisition.id,{budget_detail_id:p.id,quantity:p.quantity,unit_price:+p.estimated_amount,requisition_id:a.requisition.id})}return(p,x)=>(m(),B(L,null,[e(k,{color:"primary",dense:"",icon:"o_post_add",size:"sm",unelevated:"",onClick:x[0]||(x[0]=f=>o.value=!0)}),e(U,{modelValue:o.value,"onUpdate:modelValue":x[2]||(x[2]=f=>o.value=f)},{default:t(()=>[e(R,null,{default:t(()=>[e(T,null,{default:t(()=>[_("Art\xEDculo seleccionado")]),_:1}),e(E),e(D,null,{default:t(()=>[e(z,null,{default:t(()=>[(m(!0),B(L,null,N(n($),f=>(m(),b(M,{key:f},{default:t(()=>[e(A,{class:"tw-font-bold"},{default:t(()=>[_(Q(u[f]),1)]),_:2},1024),e(A,null,{default:t(()=>[_(Q(i.selectedArticle[f]),1)]),_:2},1024)]),_:2},1024))),128)),e(M,null,{default:t(()=>[e(A,{class:"tw-font-bold"},{default:t(()=>[_("Cantidad")]),_:1}),e(A,null,{default:t(()=>[e(ge,{modelValue:r.value,"onUpdate:modelValue":x[1]||(x[1]=f=>r.value=f),modelModifiers:{number:!0},dense:"",max:i.selectedArticle.quantity,min:"1",outlined:"",rules:c,type:"number"},null,8,["modelValue","max"])]),_:1})]),_:1})]),_:1}),n(q)?(m(),b(O,{key:0,class:"text-white bg-red tw-mt-4","inline-actions":""},{default:t(()=>[e(z,null,{default:t(()=>[(m(!0),B(L,null,N(d.value,f=>(m(),b(M,{key:f,dense:""},{default:t(()=>[e(A,null,{default:t(()=>[_(Q(f),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):I("",!0)]),_:1}),e(E),e(qe,null,{default:t(()=>[e(j),e(k,{color:"primary",disable:n(q),label:"Agregar",loading:n(l),onClick:h},null,8,["disable","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),xe={class:"row items-center q-pb-none"},Ae={class:"tw-flex tw-gap-4 tw-items-center"},Qe={class:"tw-w-80"},Ce={class:"tw-gap-4 tw-flex"},ke=C({inheritAttrs:!1}),$e=C({...ke,__name:"BudgetDetailDialog",props:{requisition:null},setup(i){const a=i,{monthsDictionary:s}=fe(),{month:l,area:o,items:u,isLoading:r,isFetching:c}=_e(),d=[{name:"actions",field:"actions",label:"Agregar",align:"center"},{name:"alias",field:"alias",label:"Alias",align:"left"},{name:"description",field:"description",label:"Descripci\xF3n",align:"left"},{name:"month",field:"month",label:"Mes",align:"left"},{name:"quantity",field:"quantity",label:"Cantidad",align:"left"},{name:"article_description",field:"article_description",label:"Descripci\xF3n del art\xEDculo",align:"left"},{name:"estimated_amount",field:"estimated_amount",label:"Monto estimado",align:"left"},{name:"total",field:"total",label:"Total",align:"left"}];Y(()=>{o.value=a.requisition.area});const y=v(()=>{var q;return(q=o.value)==null?void 0:q.description});function F(){l.value=""}return(q,$)=>(m(),b(R,Z(K(q.$attrs)),{default:t(()=>[e(T,null,{default:t(()=>[g("div",xe,[e(A,null,{default:t(()=>[e(P,null,{default:t(()=>[_("Art\xEDculos")]),_:1}),e(P,{caption:""},{default:t(()=>[_(Q(n(y)),1)]),_:1})]),_:1}),e(j),ee(e(k,{dense:"",flat:"",icon:"close",round:""},null,512),[[me]])])]),_:1}),e(E),e(D,null,{default:t(()=>[e(O,{class:"bg-grey-3",rounded:""},{default:t(()=>[g("div",Ae,[g("div",null,[e(te,{name:"o_filter_list"})]),g("div",Qe,[e(ie,{modelValue:n(l),"onUpdate:modelValue":$[0]||($[0]=h=>ae(l)?l.value=h:null),"bg-color":"white",dense:"",label:"Meses",options:n(s),outlined:""},null,8,["modelValue","options"])]),g("div",Ce,[e(k,{color:"secondary",outline:"",onClick:F},{default:t(()=>[_("Limpiar")]),_:1})])])]),_:1})]),_:1}),e(D,null,{default:t(()=>[e(H,{columns:d,loading:n(c)||n(r),rows:n(u),"wrap-cells":""},{"body-cell-actions":t(h=>[e(ce,{props:h},{default:t(()=>[e(he,{requisition:a.requisition,"selected-article":h.row},null,8,["requisition","selected-article"])]),_:2},1032,["props"])]),_:1},8,["loading","rows"])]),_:1})]),_:1},16))}}),Ve=C({__name:"RequisitionDetailTable",props:{details:null},setup(i){const a=i,s=[{name:"id",field:l=>l.id.substring(0,8),label:"ID",align:"left"},{name:"article",field:l=>l.budgetDetail.article.name,label:"Art\xEDculo",align:"left"},{name:"department",field:l=>l.budgetDetail.department.description,label:"Departamento",align:"left"},{name:"requested_quantity",field:"quantity",label:"Total solicitado",align:"right"},{name:"programed_quantity",field:l=>{var o;return(o=l.budgetDetail.months)==null?void 0:o.reduce((u,r)=>u+r.quantity,0)},label:"Total programado",align:"right"},{name:"requested_amount",field:"unit_price",label:"Monto solicitado",align:"right"},{name:"estimated_amount",field:l=>l.budgetDetail.total,label:"Monto programado",align:"right"}];return(l,o)=>(m(),b(H,{columns:s,flat:"",rows:a.details},null,8,["rows"]))}}),Be=C({__name:"RequisitionDetailCard",props:{requisition:null},setup(i){const a=i,s=v(()=>{var l;return(l=a.requisition.details)==null?void 0:l.length});return(l,o)=>(m(),b(R,null,{default:t(()=>[e(T,null,{default:t(()=>[_(Q(n(s))+" Art\xEDculo(s) solicitado(s)",1)]),_:1}),e(D,{class:"tw-p-0"},{default:t(()=>[e(Ve,{details:a.requisition.details},null,8,["details"])]),_:1})]),_:1}))}}),Ee={class:"q-pa-sm"},Re={class:"row q-mb-md"},Te={class:"col col-md-6"},Fe={key:0,class:"row q-mb-md"},Me={class:"col col-md-6"},_t=C({__name:"EditPage",setup(i){const a=le(),{id:s}=a.params,{isLoading:l,requisition:o}=re(s),u=w(!1);return(r,c)=>n(l)?I("",!0):(m(),b(oe,{key:0},{title:t(()=>{var d;return[_(" Requisici\xF3n "+Q((d=n(o))==null?void 0:d.requisition_number),1)]}),body:t(()=>{var d;return[g("div",Ee,[g("div",Re,[g("div",Te,[e(R,null,{default:t(()=>[e(D,{class:"tw-p-0"},{default:t(()=>[e(T,{class:"tw-grow"},{default:t(()=>[_("Datos de la requisici\xF3n")]),_:1})]),_:1}),e(E),e(D,{class:"tw-pt-9"},{default:t(()=>[e(k,{class:"absolute tw-top-0 tw-right-3 tw-translate-y-[-50%]",color:"purple",icon:"o_add_shopping_cart",round:"",size:"1rem",onClick:c[0]||(c[0]=y=>u.value=!0)}),e(ne,{requisition:n(o)},null,8,["requisition"])]),_:1})]),_:1})])]),((d=n(o))==null?void 0:d.details.length)>0?(m(),B("div",Fe,[g("div",Me,[e(Be,{requisition:n(o)},null,8,["requisition"])])])):I("",!0),e(U,{modelValue:u.value,"onUpdate:modelValue":c[1]||(c[1]=y=>u.value=y),"full-width":""},{default:t(()=>[e($e,{requisition:n(o)},null,8,["requisition"])]),_:1},8,["modelValue"])])]}),_:1}))}});export{_t as default};
