import{a as C}from"./QSpace.68167c32.js";import{b as y,a as w,c as W,Q as Y,k as Z}from"./format.5ed1b2f9.js";import{u as E,Q as ee}from"./useMoney.19fa1730.js";import{Q as O}from"./QList.93ee1cf7.js";import{j as q,c as A,p as F,k as V,l as t,d as e,q as k,t as P,u as d,r as x,N as te,s as T,ap as R,X as h,b4 as ae,m as le,V as ne,w as M,ag as oe,at as ue,F as ie,b as re,_ as se}from"./index.29beeebf.js";import{a as I,Q as de}from"./QForm.89ce2382.js";import{Q as $}from"./QBtnGroup.93e49097.js";import{Q as U}from"./QTd.14df1cc5.js";import{u as L,a as ce}from"./useSubBudgets.24b00e64.js";import{T as me}from"./TablePage.0b68744b.js";import{g as D,f as fe}from"./QSelect.a8d33ba4.js";import{a as J}from"./QCard.d231550d.js";import{Q as be}from"./QCardActions.d676ed10.js";import{_ as N}from"./CardDialog.d035b07e.js";import{Q as z}from"./QTable.b7a0d227.js";import{u as ge}from"./useExportDataToCsv.a2a63db7.js";import"./scroll.da39b050.js";import"./use-dark.c9685ee7.js";import"./focus-manager.33224ae2.js";import"./QCheckbox.cbd511b7.js";import"./layout.0b44b01f.js";import"./index.2cf0d985.js";import"./QPage.4b31ca73.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./utils.esm.b56e2037.js";import"./date.2c671626.js";const G=q({__name:"ShortUuidLink",props:{uuid:null,to:null},setup(i){const b=i,S=A(()=>b.uuid.substring(0,8).toUpperCase());return(p,B)=>(F(),V(w,{clickable:"",to:i.to},{default:t(()=>[e(y,null,{default:t(()=>[k(P(d(S)),1)]),_:1})]),_:1},8,["to"]))}}),pe={class:"self-center full-width no-outline",tabindex:"0"},_e={class:"self-center full-width no-outline",tabindex:"0"},ve={class:"self-center full-width no-outline",tabindex:"0"},Se=q({__name:"SubBudgetAdjustmentForm",props:{target:null},setup(i){const b=i,{subBudgetQuery:S}=L(),{createSubBudgetAdjustmentMutation:p}=ce(),{currencyFormat:B}=E(),{data:c}=S,_=x(),m=te({source_sub_budget_id:"",target_sub_budget_id:b.target.id,justification:"",amount:0}),a=A(()=>{var l;return n.value?+((l=n.value)==null?void 0:l.amount):0}),n=A(()=>{var l;return(l=c==null?void 0:c.value)==null?void 0:l.find(r=>r.id===m.source_sub_budget_id)}),u=A(()=>{var r;return(((r=c==null?void 0:c.value)==null?void 0:r.filter(g=>g.id!==b.target.id))||[]).map(g=>({label:g.event,value:g.id}))}),v={source_sub_budget_id:[l=>!!l||"El campo origen es requerido"],justification:[l=>!!l||"El campo justificaci\xF3n es requerido"],amount:[l=>!!l||"El campo monto es requerido",l=>l>0||"El monto debe ser mayor a 0",l=>l<=a.value||`El monto debe ser menor o igual a ${a.value}`]};async function j(){var r;await((r=_.value)==null?void 0:r.validate())&&await p.mutateAsync({createSubBudgetAdjustmentDto:m})}return(l,r)=>(F(),V(d(de),{ref_key:"qSubBudgetAdjustmentForm",ref:_,onSubmit:ae(j,["prevent"])},{default:t(()=>[e(J,null,{default:t(()=>[e(O,null,{default:t(()=>[e(w,null,{default:t(()=>[e(y,null,{default:t(()=>[e(D,{dense:"",label:"Transferir al evento",outlined:"","stack-label":""},{control:t(()=>[T("div",pe,P(i.target.event),1)]),_:1})]),_:1})]),_:1}),e(w,null,{default:t(()=>[e(y,null,{default:t(()=>[e(D,{dense:"",label:"Monto",outlined:"","stack-label":""},{control:t(()=>[T("div",_e,P(d(B)(+i.target.amount)),1)]),_:1})]),_:1})]),_:1}),e(w,null,{default:t(()=>[e(y,null,{default:t(()=>[e(fe,{modelValue:m.source_sub_budget_id,"onUpdate:modelValue":r[0]||(r[0]=g=>m.source_sub_budget_id=g),dense:"","emit-value":"",label:"Origen","map-options":"",options:d(u),outlined:"",rules:v.source_sub_budget_id},null,8,["modelValue","options","rules"])]),_:1})]),_:1}),d(n)?(F(),V(w,{key:0},{default:t(()=>[e(y,null,{default:t(()=>[e(D,{label:"Monto disponible",outlined:"","stack-label":""},{control:t(()=>[T("div",ve,P(d(B)(+d(n).amount)),1)]),_:1})]),_:1})]),_:1})):R("",!0),e(w,null,{default:t(()=>[e(y,null,{default:t(()=>[e(I,{modelValue:m.justification,"onUpdate:modelValue":r[1]||(r[1]=g=>m.justification=g),dense:"",label:"Justificaci\xF3n",outlined:"",rules:v.justification,type:"textarea"},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(w,null,{default:t(()=>[e(y,null,{default:t(()=>[e(I,{modelValue:m.amount,"onUpdate:modelValue":r[2]||(r[2]=g=>m.amount=g),modelModifiers:{number:!0},dense:"",label:"Monto a transferir",max:d(a),min:1,outlined:"",rules:v.amount,step:"1",type:"number"},null,8,["modelValue","max","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),e(W),e(be,{align:"right"},{default:t(()=>[e(h,{color:"primary",label:"Guardar",type:"submit"})]),_:1})]),_:1},8,["onSubmit"]))}}),ye=q({__name:"SubBudgetAdjustmentHistory",props:{subBudget:null},setup(i){const b=i,{currencyFormat:S}=E(),p=[{name:"id",label:"ID",field:"id",align:"left",sortable:!1},{name:"signedAmount",field:a=>S(a.signedAmount),label:"Operaci\xF3n",align:"right",sortable:!1,style:a=>a.signedAmount>0?"color: green; font-weight: 700":"color: red; font-weight: 700"},{name:"event",field:a=>a.signedAmount>0?a.sourceSubBudget.event:a.targetSubBudget.event,label:"Evento",align:"left",sortable:!1},{name:"action",field:a=>a.signedAmount>0?a.sourceSubBudget.action.name:a.targetSubBudget.action.name,label:"Acci\xF3n",align:"left",sortable:!1},{name:"line",field:a=>a.signedAmount>0?a.sourceSubBudget.line.name:a.targetSubBudget.line.name,label:"Partida",align:"left",sortable:!1},{name:"department",field:a=>a.signedAmount>0?a.sourceSubBudget.department.description:a.targetSubBudget.department.description,label:"Departamento",align:"left",sortable:!1},{name:"justification",field:"justification",label:"Justificaci\xF3n",align:"left",sortable:!1}],B=A(()=>{var a,n;return(n=(a=b.subBudget)==null?void 0:a.adjustmentsFrom)==null?void 0:n.map(u=>({...u,signedAmount:-parseFloat(u.amount)}))}),c=A(()=>{var a,n;return(n=(a=b.subBudget)==null?void 0:a.adjustmentsTo)==null?void 0:n.map(u=>({...u,signedAmount:parseFloat(u.amount)}))}),_=A(()=>[...B.value,...c.value]),m=A(()=>_.value.sort((a,n)=>new Date(a.createdAt).getTime()-new Date(n.createdAt).getTime()));return(a,n)=>(F(),V(J,null,{default:t(()=>[e(z,{columns:p,rows:d(m),"wrap-cells":""},{"body-cell-id":t(u=>[e(U,{props:u},{default:t(()=>[e(G,{to:{name:"sub-budgets.show",params:{id:u.row.id}},uuid:u.row.id},null,8,["to","uuid"])]),_:2},1032,["props"])]),_:1},8,["rows"])]),_:1}))}});function Be(){var c,_,m,a,n,u,v,j;const i=le(),b=ne(),S=x((_=(c=i.query.q)==null?void 0:c.toString())!=null?_:""),p=x({sortBy:(a=(m=i.query.sortBy)==null?void 0:m.toString())!=null?a:"",descending:i.query.descending==="true",page:parseInt((u=(n=i.query.page)==null?void 0:n.toString())!=null?u:"1",10),rowsPerPage:parseInt((j=(v=i.query.rowsPerPage)==null?void 0:v.toString())!=null?j:"5",10)});return M(S,l=>{b.replace({query:{...i.query,q:l}})}),M(p,l=>{b.replace({query:{...i.query,sortBy:l.sortBy,descending:l.descending.toString(),page:l.page.toString(),rowsPerPage:l.rowsPerPage.toString()}})},{deep:!0}),{searchQuery:S,pagination:p,updatePagination:l=>{p.value=l}}}const He=q({__name:"IndexPage",setup(i){const{exportDataToCsv:b}=ge(),{subBudgetQuery:S}=L(),{currencyFormat:p}=E(),{data:B}=S,c=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"action",label:"Acci\xF3n",field:o=>{var f;return(f=o.action)==null?void 0:f.name},align:"left",sortable:!0},{name:"line",label:"Partida",field:o=>{var f;return(f=o.line)==null?void 0:f.name},align:"left",sortable:!0},{name:"area",label:"\xC1rea",field:o=>o.department.description,align:"left",sortable:!0},{name:"benefited_population",label:"Poblaci\xF3n Beneficiada",field:"benefited_population",align:"left",sortable:!0},{name:"objective",label:"Objetivo",field:"objective",align:"left",sortable:!1},{name:"cost_per_participant",label:"Costo Por Participante",field:o=>p(+o.cost_per_participant),align:"right",sortable:!0},{name:"number_participants",label:"N\xFAmero de Participantes",field:"number_participants",align:"right",sortable:!0},{name:"event",label:"Servicio o Evento",field:"event",align:"left",sortable:!0},{name:"event_venue",label:"Sede del Evento",field:"event_venue",align:"left",sortable:!0},{name:"justification",label:"Justificaci\xF3n",field:"justification",align:"left",sortable:!1},{name:"start_date",label:"Inicio del Periodo",field:"start_date",align:"left",sortable:!0},{name:"end_date",label:"Final del Periodo",field:"end_date",align:"left",sortable:!0},{name:"amount",label:"Importe",field:o=>p(+o.amount),align:"right",sortable:!0},{name:"vat_breakdown",label:"Desglose del I.V.A.",field:o=>o.vat_breakdown?"Si":"No",align:"left",sortable:!0},{name:"risk",label:"Riesgo",field:"risk",align:"left",sortable:!1},{name:"actions",label:"Acciones",field:"actions",sortable:!1,align:"center"}],_=x(["id","action","line","area","benefited_population","cost_per_participant","number_participants","event","event_venue","start_date","end_date","amount","vat_breakdown","actions"]),m=c.map(o=>({label:o.label,value:o.name})),a=x(null),n=x(!1),u=x(!1),{searchQuery:v,pagination:j,updatePagination:l}=Be(),r=x();function g(o){a.value=o,n.value=!0}function H(o){a.value=o,u.value=!0}function X(){b(r.value.filteredSortedRows,c,"sub-presupuestos")}return(o,f)=>(F(),V(me,null,{"card-body":t(()=>[e(d(z),{ref_key:"qTableSubBudgets",ref:r,columns:c,filter:d(v),pagination:d(j),"row-key":"id",rows:d(B),title:"Sub Presupuestos","visible-columns":_.value,"wrap-cells":"","onUpdate:pagination":d(l)},{"top-right":t(s=>[e(h,{class:"tw-mr-2",color:"primary","fab-mini":"",flat:"",icon:"tune",size:"sm"},{default:t(()=>[e(C,null,{default:t(()=>[k(" Mostrar/Ocultar columnas ")]),_:1}),e(Y,{anchor:"top end",self:"center start"},{default:t(()=>[e(O,null,{default:t(()=>[(F(!0),oe(ie,null,ue(d(m),Q=>(F(),V(w,{key:Q.value,clickable:""},{default:t(()=>[e(y,null,{default:t(()=>[e(Z,null,{default:t(()=>[k(P(Q.label),1)]),_:2},1024)]),_:2},1024),e(y,{side:""},{default:t(()=>[e(ee,{modelValue:_.value,"onUpdate:modelValue":f[0]||(f[0]=K=>_.value=K),color:"primary",val:Q.value},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(h,{dense:"",flat:"",icon:s.inFullscreen?"fullscreen_exit":"fullscreen",round:"",onClick:s.toggleFullscreen},{default:t(()=>[e(C,{disable:o.$q.platform.is.mobile},{default:t(()=>[k(P(s.inFullscreen?"Salir de Pantalla Completa":"Pantalla Completa"),1)]),_:2},1032,["disable"])]),_:2},1032,["icon","onClick"]),e(I,{modelValue:d(v),"onUpdate:modelValue":f[1]||(f[1]=Q=>re(v)?v.value=Q:null),class:"q-mr-xs",clearable:"",debounce:"300",dense:"",outlined:"",placeholder:"Buscar"},{append:t(()=>[e(se,{name:"search"})]),_:1},8,["modelValue"]),e($,{unelevated:""},{default:t(()=>[e(h,{color:"primary","icon-right":"archive",label:"Exportar a CSV",onClick:X})]),_:1})]),"body-cell-id":t(s=>[e(U,{props:s},{default:t(()=>[e(G,{to:{name:"sub-budgets.show",params:{id:s.row.id}},uuid:s.row.id},null,8,["to","uuid"])]),_:2},1032,["props"])]),"body-cell-actions":t(s=>[e(U,{props:s},{default:t(()=>[e($,{rounded:"",unelevated:""},{default:t(()=>[e(h,{color:"primary",dense:"",flat:"",icon:"currency_exchange",onClick:Q=>g(s.row)},{default:t(()=>[e(C,null,{default:t(()=>[k(" Adecuaci\xF3n ")]),_:1})]),_:2},1032,["onClick"]),s.row.adjustmentsFrom.length>0||s.row.adjustmentsTo.length>0?(F(),V(h,{key:0,color:"info",dense:"",flat:"",icon:"history",onClick:Q=>H(s.row)},{default:t(()=>[e(C,null,{default:t(()=>[k(" Ver adecuaciones ")]),_:1})]),_:2},1032,["onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["filter","pagination","rows","visible-columns","onUpdate:pagination"])]),footer:t(()=>[e(N,{modelValue:n.value,"onUpdate:modelValue":f[2]||(f[2]=s=>n.value=s),"card-title":"Adecuaci\xF3n"},{default:t(()=>[e(Se,{target:a.value},null,8,["target"])]),_:1},8,["modelValue"]),e(N,{modelValue:u.value,"onUpdate:modelValue":f[3]||(f[3]=s=>u.value=s),"card-title":"Historial de Adecuaciones",class:"card-size-dialog"},{default:t(()=>[e(ye,{"sub-budget":a.value},null,8,["sub-budget"])]),_:1},8,["modelValue"])]),_:1}))}});export{He as default};
