import{v as X,r as w,c as Q,w as J,z as ne,am as oe,aj as ie,h as P,R as Ve,g as Me,x as Qe,a4 as Ae,a6 as N,V as Pe,a_ as ke,j as Z,X as K,m as Y,N as ge,p as V,k as j,l as n,d as t,q as k,t as B,u as E,b as Ee,s as A,aH as Oe,ag as pe,F as ve,at as he,Z as W}from"./index.ab1ab5b3.js";import{w as Fe,u as Be,m as je,x as ue,y as Le,f as Ie,n as Ne,g as Ue,o as $e,z as He,A as Re,h as ze,p as Je,B as re,C as We,e as se,D as de,E as Ge,c as h,l as G,b as x,d as ce,a as ye,Q as Xe}from"./format.00788522.js";import{g as Ze}from"./scroll.b38dbfea.js";import{g as Ke,h as Ye,i as et,c as tt,j as at,a as lt,b as nt,f as F,e as ot,Q as it,T as ut}from"./QCardActions.06977e5e.js";import{Q as rt}from"./QPage.bce5ab9b.js";import{b as st}from"./useBudgets.827eb6c7.js";import{a as me,Q as dt}from"./QCard.412cbb6d.js";import{a as I,p as ct,l as fe,Q as mt}from"./layout.6a960996.js";import{u as ft}from"./app.1ec39b22.js";import"./use-dark.494f195b.js";import"./focus-manager.33224ae2.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./utils.esm.d3e11ed7.js";import"./index.2cf0d985.js";import"./ActionResource.87d2ead0.js";import"./LineResource.18831b0e.js";import"./AreaResource.348a7d11.js";import"./ArticleResource.caa92ad3.js";var be=X({name:"QTooltip",inheritAttrs:!1,props:{...Fe,...Be,...je,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{default:"jump-down"},transitionHide:{default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:ue},self:{type:String,default:"top middle",validator:ue},offset:{type:Array,default:()=>[14,14],validator:Le},scrollTarget:{default:void 0},delay:{type:Number,default:0},hideDelay:{type:Number,default:0}},emits:[...Ie],setup(l,{slots:f,emit:s,attrs:d}){let c,r;const g=Me(),{proxy:{$q:e}}=g,a=w(null),p=w(!1),q=Q(()=>de(l.anchor,e.lang.rtl)),C=Q(()=>de(l.self,e.lang.rtl)),D=Q(()=>l.persistent!==!0),{registerTick:i,removeTick:_}=Ne(),{registerTimeout:M}=Ue(),{transitionProps:U,transitionStyle:$}=$e(l),{localScrollTarget:L,changeScrollEvent:H,unconfigureScrollTarget:R}=He(l,ae),{anchorEl:v,canShow:m,anchorEvents:o}=Re({showing:p,configureAnchorEl:Te}),{show:u,hide:y}=ze({showing:p,canShow:m,handleShow:xe,handleHide:we,hideOnRouteChange:D,processOnMount:!0});Object.assign(o,{delayShow:Ce,delayHide:De});const{showPortal:T,hidePortal:ee,renderPortal:_e}=Je(g,a,Se,"tooltip");if(e.platform.is.mobile===!0){const b={anchorEl:v,innerRef:a,onClickOutside(S){return y(S),S.target.classList.contains("q-dialog__backdrop")&&Ae(S),!0}},z=Q(()=>l.modelValue===null&&l.persistent!==!0&&p.value===!0);J(z,S=>{(S===!0?Ge:re)(b)}),ne(()=>{re(b)})}function xe(b){T(),i(()=>{r=new MutationObserver(()=>O()),r.observe(a.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),O(),ae()}),c===void 0&&(c=J(()=>e.screen.width+"|"+e.screen.height+"|"+l.self+"|"+l.anchor+"|"+e.lang.rtl,O)),M(()=>{T(!0),s("show",b)},l.transitionDuration)}function we(b){_(),ee(),te(),M(()=>{ee(!0),s("hide",b)},l.transitionDuration)}function te(){r!==void 0&&(r.disconnect(),r=void 0),c!==void 0&&(c(),c=void 0),R(),oe(o,"tooltipTemp")}function O(){const b=a.value;v.value===null||!b||We({el:b,offset:l.offset,anchorEl:v.value,anchorOrigin:q.value,selfOrigin:C.value,maxHeight:l.maxHeight,maxWidth:l.maxWidth})}function Ce(b){if(e.platform.is.mobile===!0){se(),document.body.classList.add("non-selectable");const z=v.value,S=["touchmove","touchcancel","touchend","click"].map(le=>[z,le,"delayHide","passiveCapture"]);ie(o,"tooltipTemp",S)}M(()=>{u(b)},l.delay)}function De(b){e.platform.is.mobile===!0&&(oe(o,"tooltipTemp"),se(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),M(()=>{y(b)},l.hideDelay)}function Te(){if(l.noParentEvent===!0||v.value===null)return;const b=e.platform.is.mobile===!0?[[v.value,"touchstart","delayShow","passive"]]:[[v.value,"mouseenter","delayShow","passive"],[v.value,"mouseleave","delayHide","passive"]];ie(o,"anchor",b)}function ae(){if(v.value!==null||l.scrollTarget!==void 0){L.value=Ze(v.value,l.scrollTarget);const b=l.noParentEvent===!0?O:y;H(L.value,b)}}function qe(){return p.value===!0?P("div",{...d,ref:a,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",d.class],style:[d.style,$.value],role:"tooltip"},Qe(f.default)):null}function Se(){return P(Ve,U.value,qe)}return ne(te),Object.assign(g.proxy,{updatePosition:O}),_e}}),bt=X({name:"QToggle",props:{...Ke,icon:String,iconColor:String},emits:Ye,setup(l){function f(s,d){const c=Q(()=>(s.value===!0?l.checkedIcon:d.value===!0?l.indeterminateIcon:l.uncheckedIcon)||l.icon),r=Q(()=>s.value===!0?l.iconColor:null);return()=>[P("div",{class:"q-toggle__track"}),P("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},c.value!==void 0?[P(N,{name:c.value,color:r.value})]:void 0)]}return et("toggle",f)}});const gt=P("div",{class:"q-space"});var pt=X({name:"QSpace",setup(){return()=>gt}});const vt=()=>{const l=ft(),{actionDictionary:f,lineDictionary:s,areaDictionary:d,articleDictionary:c}=Pe(l),{getArticleByName:r}=l;return{actionDictionary:f,lineDictionary:s,areaDictionary:d,articleDictionary:c,getArticleByName:r}},ht=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],yt=(l,f=0,s=!1)=>{let d;return(...c)=>{s&&!d&&l(...c),clearTimeout(d),d=setTimeout(()=>{l(...c)},f)}},_t=(l,f,s)=>{const d=w(l);return ke((c,r)=>({get(){return c(),d.value},set:yt(g=>{d.value=g,r()},f,s)}))},xt={class:"self-center full-width no-outline",tabindex:"0"},wt=Z({__name:"MonthBudgetForm",props:{month:null,budgetMonth:{default:()=>({quantity:0})},estimatedAmount:{default:0}},emits:["update:quantity"],setup(l,{emit:f}){const s=l;K();const d=Y(),{id:c}=d.params,r=ge(tt(s.budgetMonth)),g=_t(r.quantity||0,250,!1);return J(g,e=>{e>0&&(r.quantity=e,r.month=s.month,r.budget_detail_id=c,f("update:quantity",r))}),(e,a)=>(V(),j(x,null,{default:n(()=>[t(h,null,{default:n(()=>[t(G,{overline:""},{default:n(()=>[k(B(l.month),1)]),_:1}),t(I,{modelValue:E(g),"onUpdate:modelValue":a[0]||(a[0]=p=>Ee(g)?g.value=p:null),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Cantidad",outlined:"",type:"number"},null,8,["modelValue"])]),_:1}),t(h,{side:""},{default:n(()=>[t(G,{overline:""},{default:n(()=>[k("\xA0\xA0\xA0")]),_:1}),t(at,{dense:"",label:"Total",outlined:"","stack-label":""},{control:n(()=>[A("div",xt,B(r.quantity*s.estimatedAmount),1)]),prepend:n(()=>[t(N,{name:"o_attach_money"})]),_:1})]),_:1})]),_:1}))}});var Ct={storeDetail(l,f){return ct.post(`/budgets/${l}/budget-details`,f)}};const Dt=async({budgetId:l,budgetDetail:f})=>{const{data:s}=await Ct.storeDetail(l,f);return s},Tt=()=>{const l=lt();return{storeBudgetDetailMutation:nt({mutationFn:s=>Dt(s),onSuccess:async(s,d)=>{await l.invalidateQueries(["budget",d.budgetId]),fe.showSuccessNotification("El bien se agreg\xF3 al presupuesto con \xE9xito")},onError:()=>{fe.showErrorNotification("Error al agregar el bien al presupuesto")}})}},qt=A("div",{class:"tw-text-xl"},"Agregar bien",-1),St=Z({__name:"BudgetDetailForm",setup(l){K();const f=Y(),{id:s}=f.params,{actionDictionary:d,lineDictionary:c,areaDictionary:r,getArticleByName:g}=vt(),{storeBudgetDetailMutation:e}=Tt(),{isLoading:a}=e,p=w(d.value),q=w(c.value),C=w(r.value),D=w([]),i=ge({action:null,line:null,area:null,article:null,estimated_amount:0,justification:"",month:[],total:0,budgetMonths:[]}),_=w([]);Oe(()=>{if(_.value.length>0){const m=_.value.reduce((o,u)=>o+u.quantity,0);i.total=m*i.estimated_amount}});function M(m,o,u){if(m.length<2){u();return}o(()=>{const y=m.toLowerCase();p.value=d.value.filter(T=>T.label.toLowerCase().indexOf(y)>-1)})}function U(m,o,u){if(m.length<2){u();return}o(()=>{const y=m.toLowerCase();q.value=c.value.filter(T=>T.label.toLowerCase().indexOf(y)>-1)})}function $(m,o,u){if(m.length<2){u();return}o(()=>{const y=m.toLowerCase();C.value=r.value.filter(T=>T.label.toLowerCase().indexOf(y)>-1)})}function L(m,o,u){if(m.length<2){u();return}o(()=>{const y=m.toLowerCase();D.value=g(y).value})}function H(m){const o=_.value.findIndex(u=>u.month===m.month);o>-1?_.value[o]=m:_.value.push(m)}function R({value:m}){_.value=_.value.filter(o=>o.month!==m)}async function v(){i.budgetMonths=_.value,await e.mutateAsync({budgetId:s,budgetDetail:i}),i.action=null,i.line=null,i.area=null,i.article=null,i.estimated_amount=0,i.justification="",i.month=[],i.total=0,i.budgetMonths=[]}return(m,o)=>(V(),j(dt,null,{default:n(()=>[t(me,null,{default:n(()=>[qt]),_:1}),t(ce),t(me,{class:"tw-px-0"},{default:n(()=>[t(mt,null,{default:n(()=>[t(ye,null,{default:n(()=>[t(x,null,{default:n(()=>[t(h,null,{default:n(()=>[t(F,{modelValue:i.action,"onUpdate:modelValue":o[0]||(o[0]=u=>i.action=u),dense:"",hint:"M\xEDnimo 2 caracteres para activar el filtrado",label:"ACC",options:p.value,outlined:"","use-input":"",onFilter:M},null,8,["modelValue","options"])]),_:1})]),_:1}),t(x,null,{default:n(()=>[t(h,null,{default:n(()=>[t(F,{modelValue:i.line,"onUpdate:modelValue":o[1]||(o[1]=u=>i.line=u),dense:"",hint:"M\xEDnimo 2 caracteres para activar el filtrado",label:"Partida",options:q.value,outlined:"","use-input":"",onFilter:U},null,8,["modelValue","options"])]),_:1})]),_:1}),t(x,null,{default:n(()=>[t(h,null,{default:n(()=>[t(F,{modelValue:i.area,"onUpdate:modelValue":o[2]||(o[2]=u=>i.area=u),dense:"",hint:"M\xEDnimo 2 caracteres para activar el filtrado",label:"\xC1rea",options:C.value,outlined:"","use-input":"",onFilter:$},null,8,["modelValue","options"])]),_:1})]),_:1}),t(x,null,{default:n(()=>[t(h,null,{default:n(()=>[t(F,{modelValue:i.article,"onUpdate:modelValue":o[3]||(o[3]=u=>i.article=u),dense:"",hint:"M\xEDnimo 2 caracteres para activar el filtrado",label:"Art\xEDculos",options:D.value,outlined:"","use-input":"",onFilter:L},null,8,["modelValue","options"])]),_:1})]),_:1}),t(x,null,{default:n(()=>[t(h,null,{default:n(()=>[t(I,{modelValue:i.justification,"onUpdate:modelValue":o[4]||(o[4]=u=>i.justification=u),dense:"",label:"Justificaci\xF3n",outlined:"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),t(x,null,{default:n(()=>[t(h,null,{default:n(()=>[t(I,{modelValue:i.estimated_amount,"onUpdate:modelValue":o[5]||(o[5]=u=>i.estimated_amount=u),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Monto estimado",outlined:"",type:"number"},{prepend:n(()=>[t(N,{name:"o_attach_money"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(x,null,{default:n(()=>[t(h,null,{default:n(()=>[t(F,{modelValue:i.month,"onUpdate:modelValue":o[6]||(o[6]=u=>i.month=u),dense:"",label:"Mes",multiple:"",options:E(ht),outlined:"","use-chips":"",onRemove:R},null,8,["modelValue","options"])]),_:1})]),_:1}),(V(!0),pe(ve,null,he(i.month,u=>(V(),j(wt,{key:u,"estimated-amount":i.estimated_amount,month:u,"onUpdate:quantity":H},null,8,["estimated-amount","month"]))),128)),t(x,null,{default:n(()=>[t(h,null,{default:n(()=>[t(I,{modelValue:i.total,"onUpdate:modelValue":o[7]||(o[7]=u=>i.total=u),dense:"","input-class":"tw-text-right",label:"Total",outlined:"",readonly:"",type:"number"},{prepend:n(()=>[t(N,{name:"o_attach_money"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(ce),t(ot,null,{default:n(()=>[t(pt),t(W,{color:"primary",icon:"o_save",loading:E(a),unelevated:"",onClick:v},{default:n(()=>[k(" guardar ")]),_:1},8,["loading"])]),_:1})]),_:1}))}}),Vt={class:"q-my-xs q-pt-sm q-ml-md tw-text-2xl tw-font-bold tw-text-slate-700"},Mt={class:"row"},Qt={class:"col col-md-3 q-pa-sm"},At={class:"col"},Xt=Z({__name:"DetailPage",setup(l){K();const f=Y(),{id:s}=f.params,{budget:d}=st(s),c=[{name:"id",field:"id",required:!0,label:"ID",sortable:!0,align:"left"},{name:"action",field:e=>e.action.name,label:"Acci\xF3n",sortable:!0,align:"left"},{name:"line",field:e=>e.line.name,label:"Partida",sortable:!0,align:"left"},{name:"department",field:e=>e.department.alias,label:"\xC1rea",sortable:!0,align:"left"},{name:"article",field:e=>e.article.name,label:"Bien",sortable:!0,align:"left"},{name:"article_description",field:e=>e.article.description,label:"Descripci\xF3n del bien",sortable:!0,align:"left"},{name:"justification",field:"justification",label:"Justificaci\xF3n",sortable:!0,align:"left"},{name:"enero",field:e=>{var a;return(a=e.enero)==null?void 0:a.quantity},label:"Enero",sortable:!0,align:"right"},{name:"febrero",field:e=>{var a;return(a=e.febrero)==null?void 0:a.quantity},label:"Febrero",sortable:!0,align:"right"},{name:"marzo",field:e=>{var a;return(a=e.marzo)==null?void 0:a.quantity},label:"Marzo",sortable:!0,align:"right"},{name:"abril",field:e=>{var a;return(a=e.abril)==null?void 0:a.quantity},label:"Abril",sortable:!0,align:"right"},{name:"mayo",field:e=>{var a;return(a=e.mayo)==null?void 0:a.quantity},label:"Mayo",sortable:!0,align:"right"},{name:"junio",field:e=>{var a;return(a=e.junio)==null?void 0:a.quantity},label:"Junio",sortable:!0,align:"right"},{name:"julio",field:e=>{var a;return(a=e.julio)==null?void 0:a.quantity},label:"Julio",sortable:!0,align:"right"},{name:"agosto",field:e=>{var a;return(a=e.agosto)==null?void 0:a.quantity},label:"Agosto",sortable:!0,align:"right"},{name:"septiembre",field:e=>{var a;return(a=e.septiembre)==null?void 0:a.quantity},label:"Septiembre",sortable:!0,align:"right"},{name:"octubre",field:e=>{var a;return(a=e.octubre)==null?void 0:a.quantity},label:"Octubre",sortable:!0,align:"right"},{name:"noviembre",field:e=>{var a;return(a=e.noviembre)==null?void 0:a.quantity},label:"Noviembre",sortable:!0,align:"right"},{name:"diciembre",field:e=>{var a;return(a=e.diciembre)==null?void 0:a.quantity},label:"Diciembre",sortable:!0,align:"right"},{name:"estimated_amount",field:e=>`$ ${e.estimated_amount}`,label:"Precio",sortable:!0,align:"right"},{name:"total",field:e=>`$ ${e.total}`,label:"Total",sortable:!0,align:"right"}],r=w(["action","line","department","article","estimated_amount","enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre","total"]),g=c.map(e=>({label:e.label,value:e.name}));return(e,a)=>(V(),j(rt,null,{default:n(()=>{var p;return[A("h5",Vt,"Presupuesto "+B((p=E(d))==null?void 0:p.year),1),A("div",Mt,[A("div",Qt,[t(St)]),A("div",At,[t(ut,null,{"card-body":n(()=>{var q;return[t(it,{columns:c,rows:((q=E(d))==null?void 0:q.details)||[],title:"Detalle","visible-columns":r.value},{"top-right":n(C=>[t(W,{class:"tw-mr-2",color:"primary","fab-mini":"",flat:"",icon:"tune",size:"sm"},{default:n(()=>[t(be,null,{default:n(()=>[k(" Mostrar/Ocultar columnas ")]),_:1}),t(Xe,{anchor:"top end",self:"center start"},{default:n(()=>[t(ye,null,{default:n(()=>[(V(!0),pe(ve,null,he(E(g),D=>(V(),j(x,{key:D.value,clickable:""},{default:n(()=>[t(h,null,{default:n(()=>[t(G,null,{default:n(()=>[k(B(D.label),1)]),_:2},1024)]),_:2},1024),t(h,{side:""},{default:n(()=>[t(bt,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=i=>r.value=i),color:"primary",val:D.value},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(W,{dense:"",flat:"",icon:C.inFullscreen?"fullscreen_exit":"fullscreen",round:"",onClick:C.toggleFullscreen},{default:n(()=>[t(be,{disable:e.$q.platform.is.mobile},{default:n(()=>[k(B(C.inFullscreen?"Salir de Pantalla Completa":"Pantalla Completa"),1)]),_:2},1032,["disable"])]),_:2},1032,["icon","onClick"])]),_:1},8,["rows","visible-columns"])]}),_:1})])])]}),_:1}))}});export{Xt as default};
