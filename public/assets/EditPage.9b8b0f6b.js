import{a as x,Q as F}from"./QCard.45ee23b3.js";import{c as B,a as S,b as C,k as U}from"./format.36dd34d6.js";import{v as K,c as g,h as $,x as M,g as ee,p as m,k as b,l as t,s as v,aV as te,r as y,j as k,aH as ae,ag as R,d as e,X as D,q as f,an as O,F as N,at as j,u as c,t as h,ap as L,o as ie,av as le,b1 as oe,_ as ne,b as se,m as re}from"./index.c642270b.js";import{a as ue,Q as X,f as de}from"./QSelect.0c416ba6.js";import{C as ce}from"./CardPage.c0b3e6cb.js";import{R as G,c as me}from"./useRequisitions.aa86c758.js";import{_ as fe}from"./RequisitionForm.f8d16bcf.js";import{Q as P}from"./QSpace.8011658f.js";import{u as pe,a as _e}from"./use-dark.ce8ccf7c.js";import{a as J,Q as z}from"./QTable.a954ff7c.js";import{C as W}from"./ClosePopup.d8aae995.js";import{_ as ve}from"./plugin-vue_export-helper.21dcd24c.js";import{u as qe}from"./useDictionaries.c21de1f9.js";import{b as ge}from"./useBudgetDetail.37915b12.js";import{a as be}from"./QForm.b5e5b280.js";import{Q as H}from"./QList.c5c39a9c.js";import{Q as we}from"./QCardActions.1a1d2e3c.js";import{l as V}from"./layout.57642b32.js";import"./focus-manager.33224ae2.js";import"./scroll.da5f8d4c.js";import"./utils.esm.f401af83.js";import"./QPage.b05b83f0.js";import"./QFile.b67b105f.js";import"./index.7adaf3a2.js";import"./FilePreview.2dff7549.js";import"./QImg.fb40d397.js";import"./useAreas.86fdfa18.js";import"./app.8ed5a79e.js";import"./ActionResource.5e0a3e4e.js";import"./LineResource.5d5ce01d.js";import"./ArticleResource.8e0e00c1.js";import"./QCheckbox.52de3645.js";import"./date.e564ab4d.js";import"./index.2cf0d985.js";var Y=K({name:"QBanner",props:{...pe,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(i,{slots:a}){const{proxy:{$q:d}}=ee(),r=_e(i,d),u=g(()=>"q-banner row items-center"+(i.dense===!0?" q-banner--dense":"")+(r.value===!0?" q-banner--dark q-dark":"")+(i.rounded===!0?" rounded-borders":"")),o=g(()=>`q-banner__actions row items-center justify-end col-${i.inlineActions===!0?"auto":"all"}`);return()=>{const n=[$("div",{class:"q-banner__avatar col-auto row items-center self-start"},M(a.avatar)),$("div",{class:"q-banner__content col text-body2"},M(a.default))],l=M(a.action);return l!==void 0&&n.push($("div",{class:o.value},l)),$("div",{class:u.value+(i.inlineActions===!1&&l!==void 0?" q-banner--top-padding":""),role:"alert"},n)}}});const ye={},De={class:"text-h6"};function he(i,a){return m(),b(x,null,{default:t(()=>[v("div",De,[te(i.$slots,"default")])]),_:3})}var T=ve(ye,[["render",he]]);const xe=async(i,a)=>{const{data:d}=await G.storeRequisitionDetail(i,a);return d},Ae=async({requisitionId:i,requisitionDetailId:a})=>{const{data:d}=await G.removeRequisitionDetail(i,a);return d},Z=()=>{const i=y(!1),a=y(null),d=y(null),r=ue();return{loading:i,error:a,data:d,storeDetail:async(n,l)=>{i.value=!0,a.value=null;try{d.value=await xe(n,l),V.showSuccessNotification("Detalle de requisici\xF3n guardado correctamente"),await r.invalidateQueries(["requisition",n])}catch(s){a.value=s,V.showErrorNotification("Error al guardar el detalle de requisici\xF3n")}finally{i.value=!1}},removeDetail:async({requisitionId:n,requisitionDetailId:l})=>{i.value=!0,a.value=null;try{await Ae({requisitionId:n,requisitionDetailId:l}),V.showSuccessNotification("Detalle de requisici\xF3n eliminado correctamente"),await r.invalidateQueries(["requisition",n])}catch(s){a.value=s,V.showErrorNotification("Error al eliminar el detalle de requisici\xF3n")}finally{i.value=!1}}}},Qe={class:"row items-center"},Ce=k({__name:"AddArticleDialog",props:{selectedArticle:null,requisition:null},setup(i){const a=i,{storeDetail:d,loading:r}=Z(),u=y(!1),o={alias:"Depto.",description:"Departamento",article_description:"Descripci\xF3n del art\xEDculo",month:"Mes",estimated_amount:"Monto estimado",total:"Total",quantity:"Cantidad programada"},n=y(a.selectedArticle.quantity||0),l=[p=>p>0||"La cantidad debe ser mayor a 0",p=>p<=a.selectedArticle.quantity||"La cantidad no puede ser mayor a la cantidad disponible"],s=y([]),w=g(()=>n.value*a.selectedArticle.estimated_amount||0),I=g(()=>a.requisition.estimated_amount/n.value),q=g(()=>s.value.length>0),E=g(()=>Object.keys(o).filter(p=>p!=="id"&&p!=="budget_id"));ae(()=>{s.value=[],I.value>a.selectedArticle.estimated_amount&&s.value.push("El precio por art\xEDculo no puede ser mayor al monto estimado por art\xEDculo"),w.value>a.selectedArticle.total&&s.value.push("El monto total no puede ser mayor al monto autorizado"),w.value>a.requisition.estimated_amount&&s.value.push("El monto total no puede ser mayor al monto estimado de la requisici\xF3n")});async function A(){if(q.value)return;const p={...a.selectedArticle,quantity:n.value};await d(a.requisition.id,{budget_detail_id:p.id,quantity:p.quantity,unit_price:+p.estimated_amount,requisition_id:a.requisition.id}),u.value=!1}return(p,Q)=>(m(),R(N,null,[e(D,{color:"primary",dense:"",icon:"o_post_add",size:"sm",unelevated:"",onClick:Q[0]||(Q[0]=_=>u.value=!0)}),e(X,{modelValue:u.value,"onUpdate:modelValue":Q[2]||(Q[2]=_=>u.value=_)},{default:t(()=>[e(F,null,{default:t(()=>[v("div",Qe,[e(T,null,{default:t(()=>[f("Art\xEDculo seleccionado")]),_:1}),e(P),O(e(D,{dense:"",flat:"",icon:"close",round:""},null,512),[[W]])]),e(B),e(x,null,{default:t(()=>[e(H,null,{default:t(()=>[(m(!0),R(N,null,j(c(E),_=>(m(),b(S,{key:_},{default:t(()=>[e(C,{class:"tw-font-bold"},{default:t(()=>[f(h(o[_]),1)]),_:2},1024),e(C,null,{default:t(()=>[f(h(i.selectedArticle[_]),1)]),_:2},1024)]),_:2},1024))),128)),e(S,null,{default:t(()=>[e(C,{class:"tw-font-bold"},{default:t(()=>[f("Cantidad")]),_:1}),e(C,null,{default:t(()=>[e(be,{modelValue:n.value,"onUpdate:modelValue":Q[1]||(Q[1]=_=>n.value=_),modelModifiers:{number:!0},dense:"",max:i.selectedArticle.quantity,min:"1",outlined:"",rules:l,type:"number"},null,8,["modelValue","max"])]),_:1})]),_:1})]),_:1}),c(q)?(m(),b(Y,{key:0,class:"text-white bg-red tw-mt-4","inline-actions":""},{default:t(()=>[e(H,null,{default:t(()=>[(m(!0),R(N,null,j(s.value,_=>(m(),b(S,{key:_,dense:""},{default:t(()=>[e(C,null,{default:t(()=>[f(h(_),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):L("",!0)]),_:1}),e(B),e(we,null,{default:t(()=>[e(P),e(D,{color:"primary",disable:c(q),label:"Agregar",loading:c(r),onClick:A},null,8,["disable","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),ke={class:"row items-center q-pb-none"},Ee={class:"tw-flex tw-gap-4 tw-items-center"},$e={class:"tw-w-80"},Ve={class:"tw-gap-4 tw-flex"},Re=k({inheritAttrs:!1}),Be=k({...Re,__name:"BudgetDetailDialog",props:{requisition:null},setup(i){const a=i,{monthsDictionary:d}=qe(),{month:r,area:u,items:o,isLoading:n,isFetching:l}=ge(),s=[{name:"actions",field:"actions",label:"Agregar",align:"center"},{name:"alias",field:"alias",label:"Alias",align:"left"},{name:"description",field:"description",label:"Descripci\xF3n",align:"left"},{name:"month",field:"month",label:"Mes",align:"left"},{name:"quantity",field:"quantity",label:"Cantidad",align:"left"},{name:"article_description",field:"article_description",label:"Descripci\xF3n del art\xEDculo",align:"left"},{name:"estimated_amount",field:"estimated_amount",label:"Monto estimado",align:"left"},{name:"total",field:"total",label:"Total",align:"left"}];ie(()=>{u.value=a.requisition.area});const w=g(()=>{var q;return(q=u.value)==null?void 0:q.description});function I(){r.value=""}return(q,E)=>(m(),b(F,le(oe(q.$attrs)),{default:t(()=>[e(T,null,{default:t(()=>[v("div",ke,[e(C,null,{default:t(()=>[e(U,null,{default:t(()=>[f("Art\xEDculos")]),_:1}),e(U,{caption:""},{default:t(()=>[f(h(c(w)),1)]),_:1})]),_:1}),e(P),O(e(D,{dense:"",flat:"",icon:"close",round:""},null,512),[[W]])])]),_:1}),e(B),e(x,null,{default:t(()=>[e(Y,{class:"bg-grey-3",rounded:""},{default:t(()=>[v("div",Ee,[v("div",null,[e(ne,{name:"o_filter_list"})]),v("div",$e,[e(de,{modelValue:c(r),"onUpdate:modelValue":E[0]||(E[0]=A=>se(r)?r.value=A:null),"bg-color":"white",dense:"",label:"Meses",options:c(d),outlined:""},null,8,["modelValue","options"])]),v("div",Ve,[e(D,{color:"secondary",outline:"",onClick:I},{default:t(()=>[f("Limpiar")]),_:1})])])]),_:1})]),_:1}),e(x,null,{default:t(()=>[e(J,{columns:s,loading:c(l)||c(n),rows:c(o),"wrap-cells":""},{"body-cell-actions":t(A=>[e(z,{props:A},{default:t(()=>[e(Ce,{requisition:a.requisition,"selected-article":A.row},null,8,["requisition","selected-article"])]),_:2},1032,["props"])]),_:1},8,["loading","rows"])]),_:1})]),_:1},16))}}),Fe=k({__name:"RequisitionDetailTable",props:{requisition:null,details:null},setup(i){const a=i,{removeDetail:d}=Z(),r=[{name:"consecutiveId",label:"ID",field:"consecutiveId",sortable:!1},{name:"article",field:o=>o.budgetDetail.article.name,label:"Art\xEDculo",align:"left"},{name:"department",field:o=>o.budgetDetail.department.description,label:"Departamento",align:"left"},{name:"requested_quantity",field:"quantity",label:"Total solicitado",align:"right"},{name:"programed_quantity",field:o=>{var n;return(n=o.budgetDetail.months)==null?void 0:n.reduce((l,s)=>l+s.quantity,0)},label:"Total programado",align:"right"},{name:"requested_amount",field:"unit_price",label:"Monto solicitado",align:"right"},{name:"estimated_amount",field:o=>o.budgetDetail.total,label:"Monto programado",align:"right"},{name:"actions",field:"actions",label:"Acciones",align:"center"}];async function u(o){await d({requisitionId:a.requisition.id,requisitionDetailId:o.id})}return(o,n)=>(m(),b(J,{columns:r,flat:"","row-key":"id",rows:a.details},{"body-cell-consecutiveId":t(l=>[e(z,{props:l},{default:t(()=>[f(h(l.rowIndex+1),1)]),_:2},1032,["props"])]),"body-cell-actions":t(l=>[e(z,{props:l},{default:t(()=>[e(D,{color:"negative",dense:"",flat:"",icon:"delete",round:"",onClick:s=>u(l.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows"]))}}),Te=k({__name:"RequisitionDetailCard",props:{requisition:null},setup(i){const a=i,d=g(()=>{var r;return(r=a.requisition.details)==null?void 0:r.length});return(r,u)=>(m(),b(F,null,{default:t(()=>[e(T,null,{default:t(()=>[f(h(c(d))+" Art\xEDculo(s) solicitado(s)",1)]),_:1}),e(x,{class:"tw-p-0"},{default:t(()=>[e(Fe,{details:a.requisition.details,requisition:a.requisition},null,8,["details","requisition"])]),_:1})]),_:1}))}}),Ie={class:"q-pa-sm"},Se={class:"row q-mb-md"},Me={class:"col col-md-6"},Ne={key:0,class:"row q-mb-md"},Le={class:"col"},yt=k({__name:"EditPage",setup(i){const a=re(),{id:d}=a.params,{isLoading:r,requisition:u}=me(d),o=y(!1);return(n,l)=>c(r)?L("",!0):(m(),b(ce,{key:0},{title:t(()=>{var s;return[f(" Requisici\xF3n "+h((s=c(u))==null?void 0:s.requisition_number),1)]}),body:t(()=>{var s;return[v("div",Ie,[v("div",Se,[v("div",Me,[e(F,null,{default:t(()=>[e(x,{class:"tw-p-0"},{default:t(()=>[e(T,{class:"tw-grow"},{default:t(()=>[f("Datos de la requisici\xF3n")]),_:1})]),_:1}),e(B),e(x,{class:"tw-pt-9"},{default:t(()=>[e(D,{class:"absolute tw-top-0 tw-right-3 tw-translate-y-[-50%]",color:"purple",icon:"o_add_shopping_cart",round:"",size:"1rem",onClick:l[0]||(l[0]=w=>o.value=!0)}),e(fe,{requisition:c(u)},null,8,["requisition"])]),_:1})]),_:1})])]),((s=c(u))==null?void 0:s.details.length)>0?(m(),R("div",Ne,[v("div",Le,[e(Te,{requisition:c(u)},null,8,["requisition"])])])):L("",!0),e(X,{modelValue:o.value,"onUpdate:modelValue":l[1]||(l[1]=w=>o.value=w),"full-width":""},{default:t(()=>[e(Be,{requisition:c(u)},null,8,["requisition"])]),_:1},8,["modelValue"])])]}),_:1}))}});export{yt as default};
