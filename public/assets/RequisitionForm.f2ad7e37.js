import{r as _,j as G,N as T,V as X,c as J,o as K,p as g,ag as F,d as a,l as t,s as l,_ as m,u as n,b as W,av as Z,b1 as ee,q as E,t as N,an as A,X as V,ap as D,F as ae}from"./index.29beeebf.js";import{a as c,Q as ie}from"./QForm.89ce2382.js";import{a as oe,b as te,k,c as se}from"./format.5ed1b2f9.js";import{f as le}from"./QSelect.a8d33ba4.js";import{Q as C,a as M,C as S}from"./ClosePopup.c0a5e0d2.js";import{Q as re}from"./QFile.2467139b.js";import{Q as ne}from"./QSpace.68167c32.js";import{R as ue,u as de,a as me}from"./useRequisitions.07fcda56.js";import{c as L}from"./index.7adaf3a2.js";import{F as pe}from"./FilePreview.f0286f62.js";import{l as ce}from"./layout.0b44b01f.js";import{c as _e}from"./useAreas.bf9b1266.js";const fe=()=>{const d=_(),r=_(!1);return{isLoading:r,requisitionFile:d,uploadRequisitionFile:async f=>{const p=new FormData;p.append("file",d.value),r.value=!0;const{data:q}=await ue.uploadFile(f,p);return r.value=!1,ce.showSuccessNotification("Archivo subido con \xE9xito"),d.value=void 0,q.file_name}}},qe={class:"row q-gutter-md"},ve={class:"col"},be={class:"row q-gutter-md"},ge={class:"col"},Fe={class:"row q-gutter-md"},Ve={class:"col"},xe={class:"row q-gutter-md"},we={class:"col"},he={class:"row items-center justify-end"},ye={class:"col"},Qe={class:"row items-center justify-end"},Re={key:0,class:"row q-gutter-md"},Ue={class:"col"},Ee={key:0,class:"col"},Ne={class:"row q-mt-md"},$e=G({__name:"RequisitionForm",props:{requisition:{default:()=>({requisition_number:"",preparation_date:"",processing_date:"",estimated_amount:0,area_id:"",area:null})}},setup(d){const r=d,x="https://nestjs-boilerplate-production.up.railway.app",{uploadRequisitionFile:f,requisitionFile:p,isLoading:q}=fe(),{area:u,filterArea:P,areasOptions:Y}=_e(),I={requisition_number:"",preparation_date:"",processing_date:"",estimated_amount:0,area_id:"",area:null},o=T(L(r.requisition)||L(I)),w=_(),{requisitionStoreMutations:h}=de(),{requisitionUpdateMutations:y}=me(),{isLoading:j,data:B}=h,{isLoading:$}=y,H=X(),v={requisition_number:[s=>!!s||"El n\xFAmero de requisici\xF3n es requerido",s=>s.length==3||"El n\xFAmero de requisici\xF3n debe tener 3 d\xEDgitos",s=>!isNaN(Number(s))||"El n\xFAmero de requisici\xF3n debe ser un n\xFAmero"],estimated_amount:[s=>!!s||"El monto estimado es requerido",s=>!isNaN(Number(s))||"El monto estimado debe ser un n\xFAmero"],area_id:[s=>!!s||"El \xE1rea es requerida"]},b=_(),Q=J(()=>!!r.requisition.id);K(()=>{r.requisition.area&&(u.value={label:r.requisition.area.alias,full_description:r.requisition.area.description,value:r.requisition.area.id})});async function O(){var i,e,R,U;!await((i=w.value)==null?void 0:i.validate())||(Q.value?await y.mutateAsync({...o,area_id:(U=u.value)==null?void 0:U.value}):(await h.mutateAsync({...o,area_id:(e=u.value)==null?void 0:e.value}),await H.push({name:"requisitions.edit",params:{id:(R=B.value)==null?void 0:R.id}})))}async function z(s){p.value=s,o.file=await f(r.requisition.id),b.value=void 0}return(s,i)=>(g(),F(ae,null,[a(n(ie),{ref_key:"qRequisitionForm",ref:w,class:"q-pb-md"},{default:t(()=>[l("div",qe,[l("div",ve,[a(c,{modelValue:o.requisition_number,"onUpdate:modelValue":i[0]||(i[0]=e=>o.requisition_number=e),"bg-color":"white",counter:"",dense:"",label:"N\xFAmero de requisici\xF3n",maxlength:"3",outlined:"",rules:v.requisition_number},{prepend:t(()=>[a(m,{name:"tag"})]),_:1},8,["modelValue","rules"])])]),l("div",be,[l("div",ge,[a(le,{modelValue:n(u),"onUpdate:modelValue":i[1]||(i[1]=e=>W(u)?u.value=e:null),"bg-color":"white",dense:"","input-debounce":"0",label:"Departamentos",options:n(Y),outlined:"",rules:v.area_id,"use-input":"",onFilter:n(P)},{option:t(e=>[a(oe,Z(ee(e.itemProps)),{default:t(()=>[a(te,null,{default:t(()=>[a(k,null,{default:t(()=>[E(N(e.opt.full_description),1)]),_:2},1024),a(k,{caption:""},{default:t(()=>[E(N(e.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules","onFilter"])])]),l("div",Fe,[l("div",Ve,[a(c,{modelValue:o.estimated_amount,"onUpdate:modelValue":i[2]||(i[2]=e=>o.estimated_amount=e),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Monto estimado",outlined:"",rules:v.estimated_amount,type:"number"},{prepend:t(()=>[a(m,{name:"attach_money"})]),_:1},8,["modelValue","rules"])])]),l("div",xe,[l("div",we,[a(c,{modelValue:o.preparation_date,"onUpdate:modelValue":i[4]||(i[4]=e=>o.preparation_date=e),dense:"",label:"Fecha de elaboraci\xF3n",outlined:"",rules:[e=>!!e||"La fecha de elaboraci\xF3n es requerida"]},{append:t(()=>[a(m,{class:"cursor-pointer",name:"event"},{default:t(()=>[a(C,{cover:"","transition-hide":"scale","transition-show":"scale"},{default:t(()=>[a(M,{modelValue:o.preparation_date,"onUpdate:modelValue":i[3]||(i[3]=e=>o.preparation_date=e),mask:"YYYY-MM-DD"},{default:t(()=>[l("div",he,[A(a(V,{color:"primary",flat:"",label:"Close"},null,512),[[S]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])]),l("div",ye,[a(c,{modelValue:o.processing_date,"onUpdate:modelValue":i[6]||(i[6]=e=>o.processing_date=e),dense:"",label:"Fecha de tr\xE1mite",outlined:"",rules:[e=>!!e||"La fecha de tr\xE1mite es requerida"]},{append:t(()=>[a(m,{class:"cursor-pointer",name:"event"},{default:t(()=>[a(C,{cover:"","transition-hide":"scale","transition-show":"scale"},{default:t(()=>[a(M,{modelValue:o.processing_date,"onUpdate:modelValue":i[5]||(i[5]=e=>o.processing_date=e),mask:"YYYY-MM-DD"},{default:t(()=>[l("div",Qe,[A(a(V,{color:"primary",flat:"",label:"Close"},null,512),[[S]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])])]),n(Q)?(g(),F("div",Re,[l("div",Ue,[a(re,{modelValue:b.value,"onUpdate:modelValue":[i[7]||(i[7]=e=>b.value=e),z],accept:".jpg, image/*, application/pdf",dense:"",label:"Haga click para subir el archivo o arrastralo aqu\xED",loading:n(q),outlined:""},{prepend:t(()=>[a(m,{name:"attach_file"})]),_:1},8,["modelValue","loading"])]),o.file?(g(),F("div",Ee,[a(pe,{"file-url":`${n(x)}/api/files/requisitions/${r.requisition.id}/${o.file}`},null,8,["file-url"])])):D("",!0)])):D("",!0)]),_:1},512),a(se),l("div",Ne,[a(ne),l("div",null,[a(V,{color:"primary",label:"Guardar",loading:n(j)||n($),onClick:O},null,8,["loading"])])])],64))}});export{$e as _};
