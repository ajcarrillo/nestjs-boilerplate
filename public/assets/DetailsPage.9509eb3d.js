import{Q as N}from"./QSkeleton.c744978f.js";import{a as E,Q as g}from"./QItem.2533442d.js";import{Q as P}from"./QList.21f703e4.js";import{Q as _}from"./QItemLabel.cfb7cd9a.js";import{Q as B}from"./QInput.e430ec3b.js";import{m as U,j as O,r as q,c as R,p as l,k as h,l as n,d as a,q as y,t as I,s as d,u as s,b3 as k,ae as p,F as v,ai as w}from"./index.c148c0c6.js";import{l as D}from"./layout.49dbfba7.js";import{A as x}from"./AreaAllocationResource.99609f80.js";import{u as Y,a as L}from"./useQuery.esm.9d8865ca.js";import{u as Q}from"./useMutation.esm.c5d42c0d.js";import{b as G}from"./useBudgetCaps.ce549323.js";import{u as V}from"./useMoney.dbc60660.js";import"./use-dark.74ed7cd3.js";import"./use-key-composition.2fce6913.js";import"./focus-manager.387b0375.js";import"./BudgetResource.04074e95.js";import"./index.2cf0d985.js";import"./utils.esm.6708c4fa.js";import"./mutation.esm.b17910c4.js";const K=async()=>{const{data:e}=await x.getAreaAllocations();return e},$=async e=>{const{data:t}=await x.storeAreaAllocation(e);return t},H=async({uuid:e,draft:t})=>{const{data:o}=await x.updateAreaAllocation(e,t);return o},j=()=>{const{isLoading:e,isError:t,data:o,error:i}=Y({queryKey:["area-allocations"],queryFn:K,staleTime:6e5});return{isLoading:e,isError:t,data:o,error:i}},X=()=>{const e=L();return{areaAllocationStoreMutations:Q({mutationFn:$,onSuccess:()=>{e.invalidateQueries({queryKey:["area-allocations"]}),D.showSuccessNotification("Area Allocation created successfully")},onError:()=>{D.showErrorNotification("Error creating Area Allocation")}})}},z=()=>{const e=L();return{areaAllocationUpdateMutations:Q({mutationFn:H,onSuccess:()=>{e.invalidateQueries({queryKey:["area-allocations"]}),D.showSuccessNotification("Area Allocation updated successfully")},onError:()=>{D.showErrorNotification("Error updating Area Allocation")}})}};function F(){const t=U().params.id,{budgetCap:o,fetchingBudgetCap:i}=G(t);return{budgetCap:o,fetchingBudgetCap:i,budgetCapUuid:t}}const J={class:"row tw-gap-4"},W={class:"row q-gutter-sm"},Z=O({__name:"AreaAllocationItem",props:{area:null,allocation:null},setup(e){var A,C;const t=e,o=U(),{currencyFormat:i}=V(),{areaAllocationStoreMutations:u}=X(),{isLoading:m}=u;F();const{areaAllocationUpdateMutations:S}=z(),b=o.params.id,r=q((C=(A=t.allocation)==null?void 0:A.totalAmount)!=null?C:0),c=async()=>{t.allocation?await S.mutateAsync({uuid:t.allocation.uuid,draft:{totalAmount:+r.value}}):await u.mutateAsync({areaId:t.area.id,budgetCapId:b,totalAmount:r.value})},f=R(()=>t.allocation?i(t.allocation.totalAmount):0);return(st,M)=>(l(),h(g,null,{default:n(()=>[a(E,null,{default:n(()=>[a(_,null,{default:n(()=>[y(I(e.area.description),1)]),_:1})]),_:1}),a(E,null,{default:n(()=>[d("div",J,[a(_,{caption:"",class:"tw-text-green-600 tw-font-bold"},{default:n(()=>[y(" ASIGNADO: "+I(s(f)),1)]),_:1})])]),_:1}),a(E,{side:""},{default:n(()=>[d("div",W,[a(B,{modelValue:r.value,"onUpdate:modelValue":M[0]||(M[0]=T=>r.value=T),modelModifiers:{number:!0},dense:"",disable:s(m),hint:"Presione enter para guardar","input-class":"text-right",label:"Monto",outlined:"",prefix:"$",rules:[T=>T>=0||"El monto debe ser mayor o igual a 0"],type:"number",onKeyup:k(c,["enter"])},null,8,["modelValue","disable","rules","onKeyup"])])]),_:1})]),_:1}))}}),tt=O({__name:"AreaAllocationForm",props:{areas:null,allocations:null},setup(e){return(t,o)=>(l(),p("div",null,[a(P,{bordered:"",separator:""},{default:n(()=>[(l(!0),p(v,null,w(e.areas,i=>(l(),h(Z,{key:i.id,allocation:e.allocations[i.id],area:i},null,8,["allocation","area"]))),128))]),_:1})]))}}),et={class:"q-pa-md"},at=d("div",{class:"text-h4"},"Asignaci\xF3n de \xC1reas",-1),ot={class:"column q-mb-md tw-font-semibold tw-text-gray-700"},it={key:0},rt={key:1},nt={class:"row q-gutter-sm"},Mt=O({__name:"DetailsPage",setup(e){const t=[{id:"b3453d23-881e-4297-a558-17754e85f5a8",description:"DIRECCI\xD3N"},{id:"6da35253-9064-4ea0-8edf-4f9a46096725",description:"SUBDIRECCI\xD3N SERVICIOS ADMINISTRATIVOS"},{id:"b6c06fff-a191-42ff-9591-faf5510f6859",description:"CENTRO DE C\xD3MPUTO"},{id:"434f35e2-52f9-4d9a-a74b-2ba5e5bdddbd",description:"DEPARTAMENTO RECURSOS MATERIALES Y SERVICIOS"},{id:"a1397ced-fcf4-4177-af9c-5ae21e927457",description:"DEPARTAMENTO MANTENIMIENTO DE EQUIPO"},{id:"57af26e5-5f34-4e85-be71-8ae4c4035336",description:"DEPARTAMENTO RECURSOS FINANCIEROS"},{id:"54ce39a9-1a09-4428-bab1-cc4c28e5f320",description:"DEPARTAMENTO RECURSOS HUMANOS"},{id:"78f34080-7c74-45d2-bdfd-9c2add3d5e79",description:"SUBDIRECCI\xD3N PLANEACI\xD3N Y VINCULACI\xD3N"},{id:"71e76bf8-a72e-4d29-8ef7-752d2b020441",description:"DEPARTAMENTO GESTI\xD3N TECNOL\xD3GICA Y VINCULACI\xD3N"},{id:"ddde132c-b411-4ced-85b4-50e806119d01",description:"DEPARTAMENTO SERVICIOS ESCOLARES"},{id:"1a5e777b-4ffc-43f0-8616-e23f110f717f",description:"DEPARTAMENTO ACTIVIDADES EXTRAESCOLARES"},{id:"5755c321-818a-4e2f-8e5c-f65f8706ec11",description:"DEPARTAMENTO PLANEACI\xD3N, PROGRAMACI\xD3N Y PRESUPUESTACI\xD3N"},{id:"6df96c83-0c1e-4b35-b714-3e367922a64f",description:"DEPARTAMENTO COMUNICACI\xD3N Y DIFUSI\xD3N"},{id:"4eea91ac-6e24-459f-8b20-00165c3e11fd",description:"CENTRO DE INFORMACI\xD3N"},{id:"6584936d-796c-4dac-bdd3-9c85f25788fc",description:"SUBDIRECCI\xD3N ACAD\xC9MICA"},{id:"ead7cf2f-aa1e-41f0-8c3b-0cf0fdd5ae86",description:"DEPARTAMENTO DESARROLLO ACAD\xC9MICO"},{id:"fda5867f-bccf-42e2-8c2a-b813f4fc9b92",description:"DEPARTAMENTO CIENCIAS DE LA TIERRA"},{id:"d447c48f-1d5f-4fca-b50f-1d561f6f169a",description:"DEPARTAMENTO CIENCIAS B\xC1SICAS"},{id:"6df0ec78-9355-4baa-9c4f-9086a11568b1",description:"DEPARTAMENTO SISTEMAS Y COMPUTACI\xD3N"},{id:"6d7c27ae-8d28-4316-86de-aa8080882a94",description:"DEPARTAMENTO EL\xC9CTRICA Y ELECTR\xD3NICA"},{id:"06695acb-6247-478d-b98f-7620bd027bba",description:"DEPARTAMENTO CIENCIAS ECON\xD3MICO - ADMINISTRATIVAS"},{id:"cc2a8e57-fdc5-406e-9087-b09e4f8df76d",description:"DEPARTAMENTO QU\xCDMICA Y BIOQU\xCDMICA"},{id:"56d761db-bb6a-47d4-9f56-0f5b9e016a9f",description:"DIVISI\xD3N ESTUDIOS POSGRADO E INVESTIGACI\xD3N"},{id:"4466cb99-d379-4f6e-b418-30964c3cab74",description:"DIVISI\xD3N DE ESTUDIOS PROFESIONALES"}],{data:o,isLoading:i}=j(),{budgetCap:u}=F(),{currencyFormat:m}=V(),S=R(()=>o.value?o.value.reduce((r,c)=>(r[c.areaId]=c,r),{}):{}),b=R(()=>{var r,c;return u?((r=u.value)!=null&&r.totalAmount,(c=o.value)==null?void 0:c.reduce((f,A)=>f+A.totalAmount,0)):0});return(r,c)=>{var f,A;return l(),p("div",et,[at,d("div",ot,[d("div",null,"Presupuesto: "+I((f=s(u))==null?void 0:f.budget.year),1),d("div",null,"Techo Presupuestal: "+I(s(m)((A=s(u))==null?void 0:A.totalAmount)),1),d("div",null,"Acumulado: "+I(s(m)(s(b)||0)),1)]),s(i)?(l(),p("div",rt,[a(P,{bordered:"",separator:""},{default:n(()=>[(l(),p(v,null,w(24,C=>a(g,{key:C},{default:n(()=>[a(E,null,{default:n(()=>[a(N,{type:"text",width:"150px"}),a(N,{class:"q-mt-sm",type:"text",width:"100px"})]),_:1}),a(E,{side:""},{default:n(()=>[d("div",nt,[a(N,{type:"QInput",width:"100px"}),a(N,{type:"QInput",width:"100px"})])]),_:1})]),_:2},1024)),64))]),_:1})])):(l(),p("div",it,[a(tt,{allocations:s(S),areas:t},null,8,["allocations"])]))])}}});export{Mt as default};
