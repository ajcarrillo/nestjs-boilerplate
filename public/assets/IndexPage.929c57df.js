import{j as V,N as b,r as x,c as S,p as C,k as q,l as o,d as t,X as _,u as p,w as U,_ as M,s as T,J as L}from"./index.e9729b38.js";import{a as N,Q as B}from"./QForm.4b7b8896.js";import{Q as D,a as $}from"./QTable.58497212.js";import{T as z}from"./TablePage.64b25da9.js";import{Q as K,a as j}from"./QItemLabel.944d4b7e.js";import{Q as P}from"./QList.b5e619f7.js";import{a as G}from"./QCard.111c1e59.js";import{a as H}from"./format.a7112a67.js";import{Q as J}from"./QCardActions.271146e9.js";import{A as E,u as O}from"./app.35fd58dd.js";import{l as w}from"./layout.67dbf35a.js";import{u as R,a as h,b as I}from"./QChip.53b72174.js";import{c as k}from"./index.7adaf3a2.js";import{_ as X}from"./CardDialog.087631f7.js";import"./planeacion.api.157e433a.js";import"./index.2cf0d985.js";import"./use-dark.620dcf3e.js";import"./QSelect.673aa07b.js";import"./scroll.913b1c7d.js";import"./QCheckbox.7712489d.js";import"./QPage.b8944cdc.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./ArticleResource.eddf52fa.js";import"./utils.esm.56c6a382.js";import"./QSpace.9e92c996.js";const W=async()=>{const{data:a}=await E.getActions();return a},Y=async a=>{const{data:e}=await E.storeAction(a);return e},Z=async a=>{const{id:e,name:l}=a,{data:r}=await E.updateAction(e,{name:l});return r},tt=()=>{const{isLoading:a,isError:e,data:l,error:r}=R({queryKey:["actions"],queryFn:W,staleTime:6e5});return{isLoading:a,isError:e,data:l,error:r}},at=()=>{const a=h();return{actionStoreMutations:I({mutationFn:Y,onSuccess:()=>{a.invalidateQueries({queryKey:["actions"]}),w.showSuccessNotification("Acci\xF3n creada con \xE9xito")},onError:()=>{w.showErrorNotification("Error al crear acci\xF3n")}})}},et=()=>{const a=h();return{actionUpdateMutations:I({mutationFn:Z,onSuccess:()=>{a.invalidateQueries({queryKey:["actions"]}),w.showSuccessNotification("Acci\xF3n actualizada con \xE9xito")},onError:()=>{w.showErrorNotification("Error al actualizar acci\xF3n")}})}},ot=V({__name:"ActionForm",props:{action:null},setup(a){const e=a,l=O(),{fetchActionDictionary:r}=l,{actionStoreMutations:A}=at(),{isLoading:s}=A,{actionUpdateMutations:f}=et(),{isLoading:y}=f,Q=b({name:""}),u=b(k(e.action||Q)),g=x(),F={name:[d=>!!d||"El nombre es requerido"]},c=S(()=>e.action&&"id"in e.action);S(()=>c.value?"Editar acci\xF3n":"Agregar acci\xF3n");async function i(){var m,v;!await((m=g.value)==null?void 0:m.validate())||(c.value?(await f.mutateAsync(u),await n()):(await A.mutateAsync(u),u.name="",(v=g.value)==null||v.reset(),await n()))}async function n(){await r()}return(d,m)=>(C(),q(p(B),{ref_key:"actionForm",ref:g,class:"q-gutter-md"},{default:o(()=>[t(G,null,{default:o(()=>[t(P,null,{default:o(()=>[t(K,null,{default:o(()=>[t(j,null,{default:o(()=>[t(N,{modelValue:u.name,"onUpdate:modelValue":m[0]||(m[0]=v=>u.name=v),dense:"",label:"Nombre",outlined:"",rules:F.name},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),t(H),t(J,{align:"right"},{default:o(()=>[t(_,{color:"primary",label:"Guardar",loading:p(s)||p(y),onClick:i},null,8,["loading"])]),_:1})]),_:1},512))}}),nt={class:"q-gutter-sm"},Nt=V({__name:"IndexPage",setup(a){const{data:e,isLoading:l}=tt(),r=x(""),A=[{name:"id",field:"id",required:!0,label:"ID",sortable:!0,align:"left"},{name:"name",field:"name",label:"Nombre",sortable:!0,align:"left"},{name:"action",align:"center",label:"Acciones",field:"action",sortable:!1}],s=x(!1),f=x(-1);let y=b({name:""});const Q=b({name:""}),u=S(()=>f.value===-1?"Nueva acci\xF3n":"Editar acci\xF3n");U(s,c=>{c||F()});function g(c){var d;const{name:i,id:n}=c;f.value=(d=e.value)==null?void 0:d.findIndex(m=>m.id===c.id),y=Object.assign({},{id:n,name:i}),s.value=!0}function F(){s.value=!1,L(()=>{y=k(Q),f.value=-1})}return(c,i)=>(C(),q(z,null,{"card-body":o(()=>[t($,{columns:A,loading:p(l),rows:p(e),"rows-per-page-options":[20,30,40,50],title:"Acciones"},{"top-right":o(()=>[t(_,{class:"q-mr-xs",color:"primary",icon:"add",label:"Nueva Acci\xF3n",outline:"",onClick:i[0]||(i[0]=n=>s.value=!0)}),t(N,{modelValue:r.value,"onUpdate:modelValue":i[1]||(i[1]=n=>r.value=n),class:"q-mr-xs",debounce:"300",dense:"",outlined:"",placeholder:"Search"},{append:o(()=>[t(M,{name:"search"})]),_:1},8,["modelValue"]),t(_,{color:"primary","icon-right":"archive",label:"Exportar CSV","no-caps":""})]),"body-cell-action":o(n=>[t(D,{props:n},{default:o(()=>[T("div",nt,[t(_,{color:"primary",dense:"",flat:"",icon:"edit",rounded:"",size:"sm",onClick:d=>g(n.row)},null,8,["onClick"])])]),_:2},1032,["props"])]),_:1},8,["loading","rows"])]),footer:o(()=>[t(X,{modelValue:s.value,"onUpdate:modelValue":i[2]||(i[2]=n=>s.value=n),"card-title":p(u)},{default:o(()=>[t(ot,{action:p(y)},null,8,["action"])]),_:1},8,["modelValue","card-title"])]),_:1}))}});export{Nt as default};
