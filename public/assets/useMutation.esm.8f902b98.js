import{S as f,x as v,a as b,y,z as R,q as m}from"./utils.esm.ed28f146.js";import{a as M}from"./QChip.2e36ff41.js";import{g}from"./mutation.esm.313dacbf.js";import{c as O,N as S,w as C,aO as x,aP as q,aQ as A,u as h}from"./index.6e092ff4.js";class E extends f{constructor(t,e){super(),this.client=t,this.setOptions(e),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const e=this.options;this.options=this.client.defaultMutationOptions(t),v(e,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this})}onUnsubscribe(){if(!this.listeners.length){var t;(t=this.currentMutation)==null||t.removeObserver(this)}}onMutationUpdate(t){this.updateResult();const e={listeners:!0};t.type==="success"?e.onSuccess=!0:t.type==="error"&&(e.onError=!0),this.notify(e)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(t,e){return this.mutateOptions=e,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,{...this.options,variables:typeof t!="undefined"?t:this.options.variables}),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const t=this.currentMutation?this.currentMutation.state:g(),e={...t,isLoading:t.status==="loading",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset};this.currentResult=e}notify(t){b.batch(()=>{if(this.mutateOptions&&this.hasListeners()){if(t.onSuccess){var e,i,s,r;(e=(i=this.mutateOptions).onSuccess)==null||e.call(i,this.currentResult.data,this.currentResult.variables,this.currentResult.context),(s=(r=this.mutateOptions).onSettled)==null||s.call(r,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context)}else if(t.onError){var n,u,o,l;(n=(u=this.mutateOptions).onError)==null||n.call(u,this.currentResult.error,this.currentResult.variables,this.currentResult.context),(o=(l=this.mutateOptions).onSettled)==null||o.call(l,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}}t.listeners&&this.listeners.forEach(d=>{d(this.currentResult)})})}}function L(a,t,e){var i;const s=O(()=>w(a,t,e)),r=(i=s.value.queryClient)!=null?i:M(s.value.queryClientKey),n=new E(r,r.defaultMutationOptions(s.value)),u=S(n.getCurrentResult()),o=n.subscribe(c=>{y(u,c)}),l=(c,p)=>{n.mutate(c,p).catch(()=>{})};return C(s,()=>{n.setOptions(r.defaultMutationOptions(s.value))},{deep:!0}),x(()=>{o()}),{...q(A(u)),mutate:l,mutateAsync:u.mutate,reset:u.reset}}function w(a,t,e){const i=h(a),s=h(t);let r=i;return R(i)&&(typeof s=="function"?r={...h(e),mutationKey:i,mutationFn:s}:r={...s,mutationKey:i}),typeof i=="function"&&(r={...s,mutationFn:i}),m(r)}export{L as u};
