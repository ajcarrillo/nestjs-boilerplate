import{j as N,N as V,r as w,c as S,p as F,k,l as a,d as e,X as L,u as f,w as M,_ as T,s as A,J as D}from"./index.e9729b38.js";import{a as C,Q as B}from"./QForm.4b7b8896.js";import{Q as $,a as z}from"./QTable.58497212.js";import{T as K}from"./TablePage.64b25da9.js";import{L as E,u as j}from"./app.35fd58dd.js";import{l as Q}from"./layout.67dbf35a.js";import{u as G,a as U,b as h}from"./QChip.53b72174.js";import{Q as q,a as I}from"./QItemLabel.944d4b7e.js";import{Q as H}from"./QList.b5e619f7.js";import{a as J}from"./QCard.111c1e59.js";import{a as O}from"./format.a7112a67.js";import{Q as R}from"./QCardActions.271146e9.js";import{c as P}from"./index.7adaf3a2.js";import{_ as X}from"./CardDialog.087631f7.js";import"./planeacion.api.157e433a.js";import"./index.2cf0d985.js";import"./use-dark.620dcf3e.js";import"./QSelect.673aa07b.js";import"./scroll.913b1c7d.js";import"./QCheckbox.7712489d.js";import"./QPage.b8944cdc.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./ArticleResource.eddf52fa.js";import"./utils.esm.56c6a382.js";import"./QSpace.9e92c996.js";const W=async()=>{const{data:t}=await E.getLines();return t},Y=async t=>{const{data:o}=await E.storeLine(t);return o},Z=async t=>{const{id:o,name:p,description:u}=t,{data:y}=await E.updateLine(o,{name:p,description:u});return y},ee=()=>{const{isLoading:t,isError:o,data:p,error:u}=G({queryKey:["lines"],queryFn:W,staleTime:6e5});return{isLoading:t,isError:o,data:p,error:u}},ae=()=>{const t=U();return{lineStoreMutations:h({mutationFn:Y,onSuccess:()=>{t.invalidateQueries({queryKey:["lines"]}),Q.showSuccessNotification("Partida creada con \xE9xito")},onError:()=>{Q.showErrorNotification("Error al crear partida")}})}},te=()=>{const t=U();return{lineUpdateMutations:h({mutationFn:Z,onSuccess:()=>{t.invalidateQueries({queryKey:["lines"]}),Q.showSuccessNotification("Partida actualizada con \xE9xito")},onError:()=>{Q.showErrorNotification("Error al actualizar partida")}})}},oe=N({__name:"LineForm",props:{line:null},setup(t){const o=t,p=j(),{fetchLineDictionary:u}=p,{lineStoreMutations:y}=ae(),{isLoading:g}=y,{lineUpdateMutations:l}=te(),{isLoading:v}=l,x=V({name:"",description:""}),n=V(P(o.line||x)),b=w(),_={name:[c=>!!c||"El nombre es requerido"],description:[c=>!!c||"La descripci\xF3n es requerida"]},d=S(()=>o.line&&"id"in o.line);S(()=>d.value?"Editar partida":"Agregar partida");async function r(){var s,m;await((s=b.value)==null?void 0:s.validate())&&(d.value?(await l.mutateAsync(n),await i()):(await y.mutateAsync(n),n.name="",n.description="",(m=b.value)==null||m.reset(),await i()))}async function i(){await u()}return(c,s)=>(F(),k(f(B),{ref_key:"lineForm",ref:b,class:"q-gutter-md"},{default:a(()=>[e(J,null,{default:a(()=>[e(H,null,{default:a(()=>[e(q,null,{default:a(()=>[e(I,null,{default:a(()=>[e(C,{modelValue:n.name,"onUpdate:modelValue":s[0]||(s[0]=m=>n.name=m),dense:"",label:"Nombre",outlined:"",rules:_.name},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(q,null,{default:a(()=>[e(I,null,{default:a(()=>[e(C,{modelValue:n.description,"onUpdate:modelValue":s[1]||(s[1]=m=>n.description=m),dense:"",label:"Descripci\xF3n",outlined:"",rules:_.description,type:"textarea"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),e(O),e(R,{align:"right"},{default:a(()=>[e(L,{color:"primary",label:"Guardar",loading:f(g)||f(v),onClick:r},null,8,["loading"])]),_:1})]),_:1},512))}}),ie={class:"q-gutter-sm"},Ne=N({__name:"IndexPage",setup(t){const{data:o,isLoading:p}=ee(),u=w(""),y=[{name:"id",field:"id",required:!0,label:"ID",sortable:!0,align:"left"},{name:"name",field:"name",label:"Nombre",sortable:!0,align:"left"},{name:"description",field:"description",label:"Descripci\xF3n",sortable:!1,align:"left"},{name:"action",align:"center",label:"Acciones",field:"action",sortable:!1}],g=w(-1),l=w(!1);let v=V({name:"",description:""});const x={name:"",description:""},n=S(()=>g.value===-1?"Nueva Partida":"Editar Partida");M(l,d=>{d||_()});function b(d){var s;const{name:r,description:i,id:c}=d;g.value=(s=o.value)==null?void 0:s.findIndex(m=>m.id===d.id),v=Object.assign({},{id:c,name:r,description:i}),l.value=!0}function _(){l.value=!1,D(()=>{v=P(x),g.value=-1})}return(d,r)=>(F(),k(K,null,{"card-body":a(()=>[e(z,{columns:y,loading:f(p),rows:f(o),"rows-per-page-options":[20,30,40,50],title:"Partidas"},{"top-right":a(()=>[e(L,{class:"q-mr-xs",color:"primary",icon:"add",label:"Nueva Partida",outline:"",onClick:r[0]||(r[0]=i=>l.value=!0)}),e(C,{modelValue:u.value,"onUpdate:modelValue":r[1]||(r[1]=i=>u.value=i),class:"q-mr-xs",debounce:"300",dense:"",outlined:"",placeholder:"Search"},{append:a(()=>[e(T,{name:"search"})]),_:1},8,["modelValue"]),e(L,{color:"primary","icon-right":"archive",label:"Exportar CSV","no-caps":""})]),"body-cell-action":a(i=>[e($,{props:i},{default:a(()=>[A("div",ie,[e(L,{color:"primary",dense:"",flat:"",icon:"edit",rounded:"",size:"sm",onClick:c=>b(i.row)},null,8,["onClick"])])]),_:2},1032,["props"])]),_:1},8,["loading","rows"])]),footer:a(()=>[e(X,{modelValue:l.value,"onUpdate:modelValue":r[2]||(r[2]=i=>l.value=i),"card-title":f(n)},{default:a(()=>[e(oe,{line:f(v)},null,8,["line"])]),_:1},8,["modelValue","card-title"])]),_:1}))}});export{Ne as default};
