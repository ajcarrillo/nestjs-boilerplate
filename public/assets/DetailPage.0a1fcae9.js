import{Q as oe,a as J}from"./QSpace.52176573.js";import{b as f,c as k,a as p,Q as W}from"./QItemLabel.05af1820.js";import{v as ne,c as X,h as O,_ as S,S as ie,r as g,b0 as re,j as $,V as z,m as L,N as Y,w as ue,p as x,k as T,l,d as a,q as y,t as q,u as h,b as se,s as w,aH as Z,av as de,b1 as me,ag as ee,F as te,at as ae,X as E}from"./index.c6535512.js";import{u as ce,b as fe,c as pe,d as be,a as B,Q as ge,T as _e}from"./QTable.25e693b7.js";import{a as G,Q as ye}from"./format.e5167fe8.js";import{a as A,Q as ve}from"./QForm.866d1cbd.js";import{Q as he}from"./QBtnGroup.b5fe5c8b.js";import{Q as xe}from"./QPage.508d9960.js";import{b as qe}from"./useBudgets.ac77d1ab.js";import{a as H,Q as Ve}from"./QCard.5e2e9fe0.js";import{Q as Qe}from"./QCardActions.76db5bf9.js";import{u as we}from"./app.4484463b.js";import{c as Ce}from"./index.7adaf3a2.js";import{p as De,l as K}from"./layout.7b62d204.js";import{a as Me,b as Fe}from"./QChip.b9af2c8a.js";import{u as Pe}from"./useExportDataToCsv.958d46ee.js";import"./scroll.883daedc.js";import"./use-dark.23b804b4.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./focus-manager.33224ae2.js";import"./ActionResource.54a75bc9.js";import"./LineResource.5d9c407a.js";import"./AreaResource.6f3e1c6c.js";import"./ArticleResource.41f2d0da.js";import"./index.2cf0d985.js";import"./utils.esm.588a85b6.js";import"./date.75b33cd8.js";var Be=ne({name:"QToggle",props:{...ce,icon:String,iconColor:String},emits:fe,setup(i){function s(r,u){const m=X(()=>(r.value===!0?i.checkedIcon:u.value===!0?i.indeterminateIcon:i.uncheckedIcon)||i.icon),d=X(()=>r.value===!0?i.iconColor:null);return()=>[O("div",{class:"q-toggle__track"}),O("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},m.value!==void 0?[O(S,{name:m.value,color:d.value})]:void 0)]}return pe("toggle",s)}});const Ae=()=>{const i=we(),{actionDictionary:s,lineDictionary:r,areaDictionary:u,articleDictionary:m}=ie(i),{getArticleByName:d}=i;return{actionDictionary:s,lineDictionary:r,areaDictionary:u,articleDictionary:m,getArticleByName:d}},ke=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],Se=(i,s=0,r=!1)=>{let u;return(...m)=>{r&&!u&&i(...m),clearTimeout(u),u=setTimeout(()=>{i(...m)},s)}},Te=(i,s,r)=>{const u=g(i);return re((m,d)=>({get(){return m(),u.value},set:Se(b=>{u.value=b,d()},s,r)}))},Ie={class:"self-center full-width no-outline",tabindex:"0"},Ee=$({__name:"MonthBudgetForm",props:{month:null,budgetMonth:{default:()=>({quantity:0})},estimatedAmount:{default:0}},emits:["update:quantity"],setup(i,{emit:s}){const r=i;z();const u=L(),{id:m}=u.params,d=Y(Ce(r.budgetMonth)),b=Te(d.quantity||0,250,!1);return ue(b,_=>{_>0&&(d.quantity=_,d.month=r.month,d.budget_detail_id=m,s("update:quantity",d))}),(_,V)=>(x(),T(p,null,{default:l(()=>[a(f,null,{default:l(()=>[a(k,{overline:""},{default:l(()=>[y(q(i.month),1)]),_:1}),a(A,{modelValue:h(b),"onUpdate:modelValue":V[0]||(V[0]=C=>se(b)?b.value=C:null),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Cantidad",outlined:"",type:"number"},null,8,["modelValue"])]),_:1}),a(f,{side:""},{default:l(()=>[a(k,{overline:""},{default:l(()=>[y("\xA0\xA0\xA0")]),_:1}),a(be,{dense:"",label:"Total",outlined:"","stack-label":""},{control:l(()=>[w("div",Ie,q(d.quantity*r.estimatedAmount),1)]),prepend:l(()=>[a(S,{name:"o_attach_money"})]),_:1})]),_:1})]),_:1}))}});var je={storeDetail(i,s){return De.post(`/budgets/${i}/budget-details`,s)}};const Ue=async({budgetId:i,budgetDetail:s})=>{const{data:r}=await je.storeDetail(i,s);return r},Ne=()=>{const i=Me();return{storeBudgetDetailMutation:Fe({mutationFn:r=>Ue(r),onSuccess:async(r,u)=>{await i.invalidateQueries(["budget",u.budgetId]),K.showSuccessNotification("El bien se agreg\xF3 al presupuesto con \xE9xito")},onError:()=>{K.showErrorNotification("Error al agregar el bien al presupuesto")}})}},Re=w("div",{class:"tw-text-xl"},"Agregar bien",-1),Oe=$({__name:"BudgetDetailForm",setup(i){z();const s=L(),{id:r}=s.params,{actionDictionary:u,lineDictionary:m,areaDictionary:d,getArticleByName:b}=Ae(),{storeBudgetDetailMutation:_}=Ne(),{isLoading:V}=_,C=g(u.value),j=g(m.value),D=g(d.value),M=g([]),o=Y({action:null,line:null,area:null,article:null,estimated_amount:0,justification:"",month:[],total:0,budgetMonths:[]}),c=g([]);Z(()=>{if(c.value.length>0){const t=c.value.reduce((e,n)=>e+n.quantity,0);o.total=t*o.estimated_amount}});function U(t,e,n){e(()=>{const Q=t.toLowerCase();D.value=d.value.filter(F=>F.label.toLowerCase().indexOf(Q)>-1)})}function v(t,e,n){if(t.length<2){n();return}e(()=>{const Q=t.toLowerCase();M.value=b(Q).value})}function I(t){const e=c.value.findIndex(n=>n.month===t.month);e>-1?c.value[e]=t:c.value.push(t)}function N({value:t}){c.value=c.value.filter(e=>e.month!==t)}async function R(){o.budgetMonths=c.value,await _.mutateAsync({budgetId:r,budgetDetail:o}),o.action=null,o.line=null,o.area=null,o.article=null,o.estimated_amount=0,o.justification="",o.month=[],o.total=0,o.budgetMonths=[],c.value=[]}return(t,e)=>(x(),T(Ve,null,{default:l(()=>[a(H,null,{default:l(()=>[Re]),_:1}),a(G),a(H,{class:"tw-px-0"},{default:l(()=>[a(ve,null,{default:l(()=>[a(W,null,{default:l(()=>[a(p,null,{default:l(()=>[a(f,null,{default:l(()=>[a(B,{modelValue:o.action,"onUpdate:modelValue":e[0]||(e[0]=n=>o.action=n),dense:"",label:"ACC",options:C.value,outlined:""},null,8,["modelValue","options"])]),_:1})]),_:1}),a(p,null,{default:l(()=>[a(f,null,{default:l(()=>[a(B,{modelValue:o.line,"onUpdate:modelValue":e[1]||(e[1]=n=>o.line=n),dense:"",label:"Partida",options:j.value,outlined:""},null,8,["modelValue","options"])]),_:1})]),_:1}),a(p,null,{default:l(()=>[a(f,null,{default:l(()=>[a(B,{modelValue:o.area,"onUpdate:modelValue":e[2]||(e[2]=n=>o.area=n),dense:"",label:"\xC1rea",options:D.value,outlined:"","use-input":"",onFilter:U},null,8,["modelValue","options"])]),_:1})]),_:1}),a(p,null,{default:l(()=>[a(f,null,{default:l(()=>[a(B,{modelValue:o.article,"onUpdate:modelValue":e[3]||(e[3]=n=>o.article=n),dense:"",hint:"M\xEDnimo 2 caracteres para activar el filtrado",label:"Art\xEDculos",options:M.value,outlined:"","use-input":"",onFilter:v},{option:l(n=>[a(p,de(me(n.itemProps)),{default:l(()=>[a(f,null,{default:l(()=>[a(k,null,{default:l(()=>[y(q(n.opt.label),1)]),_:2},1024),a(k,{caption:""},{default:l(()=>[y(q(n.opt.caption),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])]),_:1})]),_:1}),a(p,null,{default:l(()=>[a(f,null,{default:l(()=>[a(A,{modelValue:o.justification,"onUpdate:modelValue":e[4]||(e[4]=n=>o.justification=n),dense:"",label:"Justificaci\xF3n",outlined:"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),a(p,null,{default:l(()=>[a(f,null,{default:l(()=>[a(A,{modelValue:o.estimated_amount,"onUpdate:modelValue":e[5]||(e[5]=n=>o.estimated_amount=n),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Monto estimado",outlined:"",type:"number"},{prepend:l(()=>[a(S,{name:"o_attach_money"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(p,null,{default:l(()=>[a(f,null,{default:l(()=>[a(B,{modelValue:o.month,"onUpdate:modelValue":e[6]||(e[6]=n=>o.month=n),dense:"",label:"Mes",multiple:"",options:h(ke),outlined:"","use-chips":"",onRemove:N},null,8,["modelValue","options"])]),_:1})]),_:1}),(x(!0),ee(te,null,ae(o.month,n=>(x(),T(Ee,{key:n,"estimated-amount":o.estimated_amount,month:n,"onUpdate:quantity":I},null,8,["estimated-amount","month"]))),128)),a(p,null,{default:l(()=>[a(f,null,{default:l(()=>[a(A,{modelValue:o.total,"onUpdate:modelValue":e[7]||(e[7]=n=>o.total=n),dense:"","input-class":"tw-text-right",label:"Total",outlined:"",readonly:"",type:"number"},{prepend:l(()=>[a(S,{name:"o_attach_money"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(G),a(Qe,null,{default:l(()=>[a(oe),a(E,{color:"primary",icon:"o_save",loading:h(V),unelevated:"",onClick:R},{default:l(()=>[y(" guardar ")]),_:1},8,["loading"])]),_:1})]),_:1}))}}),$e=()=>({currencyFormat:s=>{const r={style:"currency",currency:"MXN"};return new Intl.NumberFormat("es-MX",r).format(s)}}),ze={class:"q-my-xs q-pt-sm q-ml-md tw-text-2xl tw-font-bold tw-text-slate-700"},Le={class:"row"},Je={class:"col col-md-3 q-pa-sm"},Xe={class:"col"},xt=$({__name:"DetailPage",setup(i){const{exportDataToCsv:s}=Pe(),r=g(),u=z(),m=L(),{id:d}=m.params,{search:b,sortBy:_="id",descending:V=!1,page:C,rowsPerPage:j=13}=m.query,{budget:D}=qe(d),{currencyFormat:M}=$e(),o=[{name:"id",field:"id",required:!0,label:"ID",sortable:!0,align:"left"},{name:"action",field:t=>t.action.name,label:"Acci\xF3n",sortable:!0,align:"left"},{name:"line",field:t=>t.line.name,label:"Partida",sortable:!0,align:"left"},{name:"department",field:t=>t.department.alias,label:"\xC1rea",sortable:!0,align:"left"},{name:"article",field:t=>t.article.name,label:"Bien",sortable:!0,align:"left"},{name:"article_description",field:t=>t.article.description,label:"Descripci\xF3n del bien",sortable:!0,align:"left"},{name:"justification",field:"justification",label:"Justificaci\xF3n",sortable:!0,align:"left"},{name:"enero",field:t=>{var e;return(e=t.enero)==null?void 0:e.quantity},label:"Enero",sortable:!0,align:"right"},{name:"febrero",field:t=>{var e;return(e=t.febrero)==null?void 0:e.quantity},label:"Febrero",sortable:!0,align:"right"},{name:"marzo",field:t=>{var e;return(e=t.marzo)==null?void 0:e.quantity},label:"Marzo",sortable:!0,align:"right"},{name:"abril",field:t=>{var e;return(e=t.abril)==null?void 0:e.quantity},label:"Abril",sortable:!0,align:"right"},{name:"mayo",field:t=>{var e;return(e=t.mayo)==null?void 0:e.quantity},label:"Mayo",sortable:!0,align:"right"},{name:"junio",field:t=>{var e;return(e=t.junio)==null?void 0:e.quantity},label:"Junio",sortable:!0,align:"right"},{name:"julio",field:t=>{var e;return(e=t.julio)==null?void 0:e.quantity},label:"Julio",sortable:!0,align:"right"},{name:"agosto",field:t=>{var e;return(e=t.agosto)==null?void 0:e.quantity},label:"Agosto",sortable:!0,align:"right"},{name:"septiembre",field:t=>{var e;return(e=t.septiembre)==null?void 0:e.quantity},label:"Septiembre",sortable:!0,align:"right"},{name:"octubre",field:t=>{var e;return(e=t.octubre)==null?void 0:e.quantity},label:"Octubre",sortable:!0,align:"right"},{name:"noviembre",field:t=>{var e;return(e=t.noviembre)==null?void 0:e.quantity},label:"Noviembre",sortable:!0,align:"right"},{name:"diciembre",field:t=>{var e;return(e=t.diciembre)==null?void 0:e.quantity},label:"Diciembre",sortable:!0,align:"right"},{name:"estimated_amount",field:t=>`${M(+t.estimated_amount)}`,label:"Precio",sortable:!0,align:"right"},{name:"total",field:t=>`${M(+t.total)}`,label:"Total",sortable:!0,align:"right"}],c=g(["action","line","department","article","estimated_amount","enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre","total"]),U=o.map(t=>({label:t.label,value:t.name})),v=g(b||""),I=g({sortBy:_,descending:V==="true",page:+C||1,rowsPerPage:+j||10});Z(()=>{let t={};v.value?t={...u.currentRoute.value.query,search:v.value}:(t={...u.currentRoute.value.query},delete t.search),u.push({query:t})});function N(t){I.value=t,u.push({query:{...u.currentRoute.value.query,page:t.page,rowsPerPage:t.rowsPerPage,sortBy:t.sortBy,descending:t.descending}})}function R(){s(r.value.filteredSortedRows,o,"presupuesto")}return(t,e)=>(x(),T(xe,null,{default:l(()=>{var n;return[w("h5",ze,"Presupuesto "+q((n=h(D))==null?void 0:n.year),1),w("div",Le,[w("div",Je,[a(Oe)]),w("div",Xe,[a(_e,null,{"card-body":l(()=>{var Q;return[a(h(ge),{ref_key:"qTablePresupuesto",ref:r,columns:o,filter:v.value,pagination:I.value,"row-key":"id",rows:((Q=h(D))==null?void 0:Q.details)||[],"rows-per-page-options":[13,26,52,0],separator:"cell",title:"Detalle","visible-columns":c.value,"onUpdate:pagination":N},{"top-right":l(F=>[a(E,{class:"tw-mr-2",color:"primary","fab-mini":"",flat:"",icon:"tune",size:"sm"},{default:l(()=>[a(J,null,{default:l(()=>[y(" Mostrar/Ocultar columnas ")]),_:1}),a(ye,{anchor:"top end",self:"center start"},{default:l(()=>[a(W,null,{default:l(()=>[(x(!0),ee(te,null,ae(h(U),P=>(x(),T(p,{key:P.value,clickable:""},{default:l(()=>[a(f,null,{default:l(()=>[a(k,null,{default:l(()=>[y(q(P.label),1)]),_:2},1024)]),_:2},1024),a(f,{side:""},{default:l(()=>[a(Be,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=le=>c.value=le),color:"primary",val:P.value},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),a(E,{dense:"",flat:"",icon:F.inFullscreen?"fullscreen_exit":"fullscreen",round:"",onClick:F.toggleFullscreen},{default:l(()=>[a(J,{disable:t.$q.platform.is.mobile},{default:l(()=>[y(q(F.inFullscreen?"Salir de Pantalla Completa":"Pantalla Completa"),1)]),_:2},1032,["disable"])]),_:2},1032,["icon","onClick"]),a(A,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=P=>v.value=P),class:"q-mr-xs",clearable:"",debounce:"300",dense:"",outlined:"",placeholder:"Buscar"},{append:l(()=>[a(S,{name:"search"})]),_:1},8,["modelValue"]),a(he,{unelevated:""},{default:l(()=>[a(E,{color:"primary","icon-right":"archive",label:"Exportar a CSV",onClick:R})]),_:1})]),_:1},8,["filter","pagination","rows","visible-columns"])]}),_:1})])])]}),_:1}))}});export{xt as default};
