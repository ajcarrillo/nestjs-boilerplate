import{r as _,j as X,M as J,V as K,c as A,o as W,p as F,ae as g,d as a,l as t,s as l,_ as m,u as n,b as Z,ak as ee,b2 as ae,q as E,t as N,af as D,X as V,ah as k,F as ie}from"./index.98b8b759.js";import{Q as c}from"./QInput.654fe12c.js";import{Q as M}from"./QItemLabel.f1939688.js";import{Q as oe,a as te}from"./QItem.dd8e4c40.js";import{Q as se}from"./QSelect.52656c1a.js";import{Q as C,a as S}from"./QPopupProxy.388f2f30.js";import{Q as le}from"./QFile.10743da2.js";import{a as re}from"./QMenu.cf460894.js";import{Q as ne}from"./QSpace.607074b7.js";import{C as L}from"./ClosePopup.75a555c2.js";import{Q as ue}from"./QForm.cd1920aa.js";import{R as de,u as me,a as pe}from"./useRequisitions.d4db3724.js";import{c as P}from"./index.7adaf3a2.js";import{F as ce}from"./FilePreview.b238a1f3.js";import{l as _e}from"./layout.893a0074.js";import{c as fe}from"./useAreas.a61ba4a1.js";const qe=()=>{const d=_(),s=_(!1);return{isLoading:s,requisitionFile:d,uploadRequisitionFile:async f=>{const p=new FormData;p.append("file",d.value),s.value=!0;const{data:q}=await de.uploadFile(f,p);return s.value=!1,_e.showSuccessNotification("Archivo subido con \xE9xito"),d.value=void 0,q.file_name}}},ve={class:"row q-gutter-md"},be={class:"col"},Fe={class:"row q-gutter-md"},ge={class:"col"},Ve={class:"row q-gutter-md"},we={class:"col"},he={class:"row q-gutter-md"},xe={class:"col"},ye={class:"row items-center justify-end"},Qe={class:"col"},Re={class:"row items-center justify-end"},Ue={key:0,class:"row q-gutter-md"},Ae={class:"col"},Ee={key:0,class:"col"},Ne={class:"row q-mt-md"},Te=X({__name:"RequisitionForm",props:{requisition:{default:()=>({requisition_number:"",preparation_date:"",processing_date:"",estimated_amount:0,area_id:"",area:null})}},setup(d){const s=d,w="https://nestjs-boilerplate-production.up.railway.app",{uploadRequisitionFile:f,requisitionFile:p,isLoading:q}=qe(),{area:u,filterArea:Y,areasOptions:I}=fe(),j={requisition_number:"",preparation_date:"",processing_date:"",estimated_amount:0,area_id:"",area:null},o=J(P(s.requisition)||P(j)),h=_(),{requisitionStoreMutations:x}=me(),{requisitionUpdateMutations:y}=pe(),{isLoading:B,data:$}=x,{isLoading:H}=y,O=K(),v={requisition_number:[r=>!!r||"El n\xFAmero de requisici\xF3n es requerido",r=>!isNaN(Number(r))||"El n\xFAmero de requisici\xF3n debe ser un n\xFAmero"],estimated_amount:[r=>!!r||"El monto estimado es requerido",r=>!isNaN(Number(r))||"El monto estimado debe ser un n\xFAmero"],area_id:[r=>!!r||"El \xE1rea es requerida"]},b=_(),Q=A(()=>!!s.requisition.id),z=A(()=>!s.requisition.details||s.requisition.details.length==0);W(()=>{s.requisition.area&&(u.value={label:s.requisition.area.alias,full_description:s.requisition.area.description,value:s.requisition.area.id})});async function G(){var i,e,R,U;!await((i=h.value)==null?void 0:i.validate())||(Q.value?await y.mutateAsync({...o,area_id:(U=u.value)==null?void 0:U.value}):(await x.mutateAsync({...o,area_id:(e=u.value)==null?void 0:e.value}),await O.push({name:"requisitions.edit",params:{id:(R=$.value)==null?void 0:R.id}})))}async function T(r){p.value=r,o.file=await f(s.requisition.id),b.value=void 0}return(r,i)=>(F(),g(ie,null,[a(n(ue),{ref_key:"qRequisitionForm",ref:h,class:"q-pb-md"},{default:t(()=>[l("div",ve,[l("div",be,[a(c,{modelValue:o.requisition_number,"onUpdate:modelValue":i[0]||(i[0]=e=>o.requisition_number=e),"bg-color":"white",counter:"",dense:"",label:"N\xFAmero de requisici\xF3n",outlined:"",rules:v.requisition_number},{prepend:t(()=>[a(m,{name:"tag"})]),_:1},8,["modelValue","rules"])])]),l("div",Fe,[l("div",ge,[a(se,{modelValue:n(u),"onUpdate:modelValue":i[1]||(i[1]=e=>Z(u)?u.value=e:null),"bg-color":"white",dense:"","input-debounce":"0",label:"Departamentos",options:n(I),outlined:"",rules:v.area_id,"use-input":"",onFilter:n(Y)},{option:t(e=>[a(oe,ee(ae(e.itemProps)),{default:t(()=>[a(te,null,{default:t(()=>[a(M,null,{default:t(()=>[E(N(e.opt.full_description),1)]),_:2},1024),a(M,{caption:""},{default:t(()=>[E(N(e.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules","onFilter"])])]),l("div",Ve,[l("div",we,[a(c,{modelValue:o.estimated_amount,"onUpdate:modelValue":i[2]||(i[2]=e=>o.estimated_amount=e),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Monto estimado",outlined:"",readonly:!n(z),rules:v.estimated_amount,type:"number"},{prepend:t(()=>[a(m,{name:"attach_money"})]),_:1},8,["modelValue","readonly","rules"])])]),l("div",he,[l("div",xe,[a(c,{modelValue:o.preparation_date,"onUpdate:modelValue":i[4]||(i[4]=e=>o.preparation_date=e),dense:"",label:"Fecha de elaboraci\xF3n",outlined:"",rules:[e=>!!e||"La fecha de elaboraci\xF3n es requerida"]},{append:t(()=>[a(m,{class:"cursor-pointer",name:"event"},{default:t(()=>[a(C,{cover:"","transition-hide":"scale","transition-show":"scale"},{default:t(()=>[a(S,{modelValue:o.preparation_date,"onUpdate:modelValue":i[3]||(i[3]=e=>o.preparation_date=e),mask:"YYYY-MM-DD"},{default:t(()=>[l("div",ye,[D(a(V,{color:"primary",flat:"",label:"Close"},null,512),[[L]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])]),l("div",Qe,[a(c,{modelValue:o.processing_date,"onUpdate:modelValue":i[6]||(i[6]=e=>o.processing_date=e),dense:"",label:"Fecha de tr\xE1mite",outlined:"",rules:[e=>!!e||"La fecha de tr\xE1mite es requerida"]},{append:t(()=>[a(m,{class:"cursor-pointer",name:"event"},{default:t(()=>[a(C,{cover:"","transition-hide":"scale","transition-show":"scale"},{default:t(()=>[a(S,{modelValue:o.processing_date,"onUpdate:modelValue":i[5]||(i[5]=e=>o.processing_date=e),mask:"YYYY-MM-DD"},{default:t(()=>[l("div",Re,[D(a(V,{color:"primary",flat:"",label:"Close"},null,512),[[L]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])])]),n(Q)?(F(),g("div",Ue,[l("div",Ae,[a(le,{modelValue:b.value,"onUpdate:modelValue":[i[7]||(i[7]=e=>b.value=e),T],accept:".jpg, image/*, application/pdf",dense:"",label:"Haga click para subir el archivo o arrastralo aqu\xED",loading:n(q),outlined:""},{prepend:t(()=>[a(m,{name:"attach_file"})]),_:1},8,["modelValue","loading"])]),o.file?(F(),g("div",Ee,[a(ce,{"file-url":`${n(w)}/api/files/requisitions/${s.requisition.id}/${o.file}`},null,8,["file-url"])])):k("",!0)])):k("",!0)]),_:1},512),a(re),l("div",Ne,[a(ne),l("div",null,[a(V,{color:"primary",label:"Guardar",loading:n(B)||n(H),onClick:G},null,8,["loading"])])])],64))}});export{Te as _};
