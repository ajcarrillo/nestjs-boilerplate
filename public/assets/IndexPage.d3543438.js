import{Q as le}from"./QSpace.528ab63f.js";import{Q as ne}from"./QToggle.6a09d58a.js";import{v as A,h as c,x as N,r as P,c as _,_ as H,ah as ie,aS as ue,g as M,y as L,i as se,b5 as de,b8 as ee,H as ce,N as pe,ai as me,j as te,m as ve,M as fe,p as T,k as E,l as r,d as t,u as Q,ap as W,b2 as z,q as k,t as R,aj as j,X as U,b9 as _e,o as be,w as ge,V as qe,s as Se}from"./index.31bcdff2.js";import{l as Pe,Q as re}from"./layout.4578fdda.js";import{a as ye,Q as K}from"./QTable.397c0cde.js";import{Q as he}from"./QSlideTransition.5884a8c0.js";import{u as xe,a as Ce,b as we,c as Fe}from"./use-panel.bff8c18b.js";import{u as Qe}from"./ClosePopup.b65c71a5.js";import{Q as Ve}from"./QCard.002cd73d.js";import{u as Ie,a as De}from"./use-dark.574b32a0.js";import{Q as Re}from"./QPage.a89404f4.js";import{T as Oe}from"./TablePage.e86b1fba.js";import{P as Ue,u as ke,a as Te,b as Ee}from"./usePurchaseOrders.7d691d37.js";import{Q as O,a as D,b as $}from"./QItemLabel.696a5527.js";import{Q as G}from"./QSelect.daf6bf96.js";import{Q as Be}from"./QFile.020d55f9.js";import{Q as $e}from"./QList.78288d86.js";import{Q as Ne}from"./QCardSection.eab7f1df.js";import{a as Ae}from"./format.9b1df232.js";import{Q as Le}from"./QCardActions.f13372c3.js";import{c as X}from"./index.7adaf3a2.js";import{e as Ke}from"./useRequisitions.ec666fa5.js";import{_ as je}from"./DatePicker.e4a26f13.js";import{Q as He}from"./QForm.de165b1a.js";import{u as Me}from"./useSubBudgets.4dff87e6.js";import{_ as We}from"./CardDialog.bc136659.js";import{F as ze}from"./FilePreview.f849a1df.js";import{_ as Ge}from"./DeleteCardDialog.48156d44.js";import"./QCheckbox.2327ede2.js";import"./planeacion.api.245c27fc.js";import"./index.2cf0d985.js";import"./scroll.39fc05e6.js";import"./touch.70a9dd44.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./QChip.44c34bb5.js";import"./utils.esm.8563af24.js";import"./useMutation.esm.88e8dcd1.js";import"./mutation.esm.70ec7135.js";import"./QPopupProxy.280022d4.js";import"./date.c58022a6.js";import"./MyCardTitle.2d38b94e.js";import"./QTooltip.bffa877a.js";import"./QImg.fcb5c8b8.js";import"./QBanner.8caf2d6c.js";var J=A({name:"QStepperNavigation",setup(e,{slots:s}){return()=>c("div",{class:"q-stepper__nav"},N(s.default))}}),ae=A({name:"StepHeader",props:{stepper:{},step:{},goToPanel:Function},setup(e,{attrs:s}){const{proxy:{$q:p}}=M(),m=P(null),o=_(()=>e.stepper.modelValue===e.step.name),q=_(()=>{const a=e.step.disable;return a===!0||a===""}),y=_(()=>{const a=e.step.error;return a===!0||a===""}),v=_(()=>{const a=e.step.done;return q.value===!1&&(a===!0||a==="")}),b=_(()=>{const a=e.step.headerNav,l=a===!0||a===""||a===void 0;return q.value===!1&&e.stepper.headerNav&&l}),F=_(()=>e.step.prefix&&(o.value===!1||e.stepper.activeIcon==="none")&&(y.value===!1||e.stepper.errorIcon==="none")&&(v.value===!1||e.stepper.doneIcon==="none")),h=_(()=>{const a=e.step.icon||e.stepper.inactiveIcon;if(o.value===!0){const l=e.step.activeIcon||e.stepper.activeIcon;return l==="none"?a:l||p.iconSet.stepper.active}if(y.value===!0){const l=e.step.errorIcon||e.stepper.errorIcon;return l==="none"?a:l||p.iconSet.stepper.error}if(q.value===!1&&v.value===!0){const l=e.step.doneIcon||e.stepper.doneIcon;return l==="none"?a:l||p.iconSet.stepper.done}return a}),d=_(()=>{const a=y.value===!0?e.step.errorColor||e.stepper.errorColor:void 0;if(o.value===!0){const l=e.step.activeColor||e.stepper.activeColor||e.step.color;return l!==void 0?l:a}return a!==void 0?a:q.value===!1&&v.value===!0?e.step.doneColor||e.stepper.doneColor||e.step.color||e.stepper.inactiveColor:e.step.color||e.stepper.inactiveColor}),x=_(()=>"q-stepper__tab col-grow flex items-center no-wrap relative-position"+(d.value!==void 0?` text-${d.value}`:"")+(y.value===!0?" q-stepper__tab--error q-stepper__tab--error-with-"+(F.value===!0?"prefix":"icon"):"")+(o.value===!0?" q-stepper__tab--active":"")+(v.value===!0?" q-stepper__tab--done":"")+(b.value===!0?" q-stepper__tab--navigation q-focusable q-hoverable":"")+(q.value===!0?" q-stepper__tab--disabled":"")),f=_(()=>e.stepper.headerNav!==!0?!1:b.value);function C(){m.value!==null&&m.value.focus(),o.value===!1&&e.goToPanel(e.step.name)}function V(a){a.keyCode===13&&o.value===!1&&e.goToPanel(e.step.name)}return()=>{const a={class:x.value};b.value===!0&&(a.onClick=C,a.onKeyup=V,Object.assign(a,q.value===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:s.tabindex||0}));const l=[c("div",{class:"q-focus-helper",tabindex:-1,ref:m}),c("div",{class:"q-stepper__dot row flex-center q-stepper__line relative-position"},[c("span",{class:"row flex-center"},[F.value===!0?e.step.prefix:c(H,{name:h.value})])])];if(e.step.title!==void 0&&e.step.title!==null){const I=[c("div",{class:"q-stepper__title"},e.step.title)];e.step.caption!==void 0&&e.step.caption!==null&&I.push(c("div",{class:"q-stepper__caption"},e.step.caption)),l.push(c("div",{class:"q-stepper__label q-stepper__line relative-position"},I))}return ie(c("div",a,l),[[ue,f.value]])}}});function oe(e){return c("div",{class:"q-stepper__step-content"},[c("div",{class:"q-stepper__step-inner"},N(e.default))])}const Y={setup(e,{slots:s}){return()=>oe(s)}};var Z=A({name:"QStep",props:{...xe,icon:String,color:String,title:{type:String,required:!0},caption:String,prefix:[String,Number],doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String,headerNav:{type:Boolean,default:!0},done:Boolean,error:Boolean,onScroll:[Function,Array]},setup(e,{slots:s,emit:p}){const{proxy:{$q:m}}=M(),o=se(ee,L);if(o===L)return console.error("QStep needs to be a child of QStepper"),L;const{getCacheWithFn:q}=Qe(),y=P(null),v=_(()=>o.value.modelValue===e.name),b=_(()=>m.platform.is.ios!==!0&&m.platform.is.chrome===!0||v.value!==!0||o.value.vertical!==!0?{}:{onScroll(d){const{target:x}=d;x.scrollTop>0&&(x.scrollTop=0),e.onScroll!==void 0&&p("scroll",d)}}),F=_(()=>typeof e.name=="string"||typeof e.name=="number"?e.name:String(e.name));function h(){const d=o.value.vertical;return d===!0&&o.value.keepAlive===!0?c(de,o.value.keepAliveProps.value,v.value===!0?[c(o.value.needsUniqueKeepAliveWrapper.value===!0?q(F.value,()=>({...Y,name:F.value})):Y,{key:F.value},s.default)]:void 0):d!==!0||v.value===!0?oe(s):void 0}return()=>c("div",{ref:y,class:"q-stepper__step",role:"tabpanel",...b.value},o.value.vertical===!0?[c(ae,{stepper:o.value,step:e,goToPanel:o.value.goToPanel}),o.value.animated===!0?c(he,h):h()]:[h()])}});const Xe=/(-\w)/g;function Je(e){const s={};for(const p in e){const m=p.replace(Xe,o=>o[1].toUpperCase());s[m]=e[p]}return s}var Ye=A({name:"QStepper",props:{...Ie,...Ce,flat:Boolean,bordered:Boolean,alternativeLabels:Boolean,headerNav:Boolean,contracted:Boolean,headerClass:String,inactiveColor:String,inactiveIcon:String,doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String},emits:we,setup(e,{slots:s}){const p=M(),m=De(e,p.proxy.$q),{updatePanelsList:o,isValidPanelName:q,updatePanelIndex:y,getPanelContent:v,getPanels:b,panelDirectives:F,goToPanel:h,keepAliveProps:d,needsUniqueKeepAliveWrapper:x}=Fe();ce(ee,_(()=>({goToPanel:h,keepAliveProps:d,needsUniqueKeepAliveWrapper:x,...e})));const f=_(()=>`q-stepper q-stepper--${e.vertical===!0?"vertical":"horizontal"}`+(e.flat===!0?" q-stepper--flat":"")+(e.bordered===!0?" q-stepper--bordered":"")+(m.value===!0?" q-stepper--dark q-dark":"")),C=_(()=>`q-stepper__header row items-stretch justify-between q-stepper__header--${e.alternativeLabels===!0?"alternative":"standard"}-labels`+(e.flat===!1||e.bordered===!0?" q-stepper__header--border":"")+(e.contracted===!0?" q-stepper__header--contracted":"")+(e.headerClass!==void 0?` ${e.headerClass}`:""));function V(){const a=N(s.message,[]);if(e.vertical===!0){q(e.modelValue)&&y();const l=c("div",{class:"q-stepper__content"},N(s.default));return a===void 0?[l]:a.concat(l)}return[c("div",{class:C.value},b().map(l=>{const I=Je(l.props);return c(ae,{key:I.name,stepper:e,step:I,goToPanel:h})})),a,me("div",{class:"q-stepper__content q-panel-parent"},v(),"cont",e.swipeable,()=>F.value)]}return()=>(o(s),c("div",{class:f.value},pe(s.navigation,V())))}});const Ze=()=>{const e=P(),s=P(!1);return{isLoading:s,fileToUpload:e,uploadFile:async m=>{if(!e.value)throw new Error("No hay archivo para cargar");s.value=!0;const o=await m(e.value);return s.value=!1,Pe.showSuccessNotification("Archivo subido con \xE9xito"),e.value=void 0,o}}},et=()=>{const{fileToUpload:e,isLoading:s,uploadFile:p}=Ze();return{fileToUpload:e,isLoading:s,uploadRequisitionFile:async o=>await p(async y=>{const v=new FormData;v.append("file",y);const{data:b}=await Ue.uploadFile(o,v);return b.file_name})}},tt=te({__name:"PurchaseOrderForm",props:{purchaseOrder:{default:()=>({order_number:null,reception_date:new Date().toISOString().substring(0,10),requisition_id:null})}},setup(e){const s=e,p=ve(),m=P(p.query.fromSubBudgets==="true"),{uploadRequisitionFile:o,fileToUpload:q,isLoading:y}=et(),{requisitionsDictionary:v}=Ke(),{subBudgetReqDictionary:b}=Me(),{createPurchaseOrder:F,purchaseOrder:h,purchaseOrderType:d}=ke({fromSubBudgets:m}),x={order_number:null,reception_date:new Date().toISOString().substring(0,10),requisition_id:null},f=fe(X(s.purchaseOrder)||X(x)),C={order_number:[w=>!!w||"El n\xFAmero de orden de compra es requerido",w=>w.length==3||"El n\xFAmero de orden de compra debe tener 3 d\xEDgitos",w=>!isNaN(Number(w))||"El n\xFAmero de orden de compra debe ser un n\xFAmero"],reception_date:[w=>!!w||"La fecha de recepci\xF3n es requerida"],requisition_id:[w=>!!w||"La requisici\xF3n es requerida"]},V=P(),a=P(null),l=P();async function I(){var S,n,g,i;await((S=V.value)==null?void 0:S.validate())&&(await F({requisition_id:(n=a.value)==null?void 0:n.id,order_number:f.order_number,reception_date:f.reception_date}),l.value?(q.value=l.value,await o(h.value.id),(g=V.value)==null||g.reset()):(i=V.value)==null||i.reset())}function B(){f.order_number=null,f.reception_date=new Date().toISOString().substring(0,10),f.requisition_id=null,a.value=null,l.value=void 0}return(w,S)=>(T(),E(Q(He),{ref_key:"qPurchaseOrderForm",ref:V,onReset:B,onSubmit:_e(I,["prevent"])},{default:r(()=>[t(Ne,null,{default:r(()=>[t($e,null,{default:r(()=>[t(O,null,{default:r(()=>[t(D,null,{default:r(()=>[t(re,{modelValue:f.order_number,"onUpdate:modelValue":S[0]||(S[0]=n=>f.order_number=n),dense:"",label:"N\xFAmero de orden de compra",outlined:"",rules:C.order_number},null,8,["modelValue","rules"])]),_:1})]),_:1}),t(O,null,{default:r(()=>[t(D,null,{default:r(()=>[t(je,{modelValue:f.reception_date,"onUpdate:modelValue":S[1]||(S[1]=n=>f.reception_date=n),rules:C.reception_date},null,8,["modelValue","rules"])]),_:1})]),_:1}),t(O,null,{default:r(()=>[Q(d)==="PRESUPUESTO"?(T(),E(D,{key:0},{default:r(()=>[t(G,{modelValue:a.value,"onUpdate:modelValue":S[2]||(S[2]=n=>a.value=n),dense:"",label:"Requisici\xF3n","option-label":n=>`Requisici\xF3n #${n.requisition_number} - ${n.area_description}`,"option-value":"id",options:Q(v),outlined:"",rules:C.requisition_id},{option:r(n=>[t(O,W(z(n.itemProps)),{default:r(()=>[t(D,null,{default:r(()=>[t($,null,{default:r(()=>[k("Requisici\xF3n #"+R(n.opt.requisition_number),1)]),_:2},1024),t($,{caption:""},{default:r(()=>[k(R(n.opt.area_description),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","option-label","options","rules"])]),_:1})):j("",!0),Q(d)==="SUBPRESUPUESTO"?(T(),E(D,{key:1},{default:r(()=>[t(G,{modelValue:a.value,"onUpdate:modelValue":S[3]||(S[3]=n=>a.value=n),dense:"",label:"Requisici\xF3n","option-label":n=>`Requisici\xF3n #${n.requisition_number} - ${n.event}`,"option-value":"id",options:Q(b),outlined:"",rules:C.requisition_id},{option:r(n=>[t(O,W(z(n.itemProps)),{default:r(()=>[t(D,null,{default:r(()=>[t($,null,{default:r(()=>[k("Requisici\xF3n #"+R(n.opt.requisition_number),1)]),_:2},1024),t($,{caption:""},{default:r(()=>[k(R(n.opt.area_description)+" "+R(n.opt.event),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","option-label","options","rules"])]),_:1})):j("",!0)]),_:1}),t(O,null,{default:r(()=>[t(D,null,{default:r(()=>[t(Be,{modelValue:l.value,"onUpdate:modelValue":S[4]||(S[4]=n=>l.value=n),accept:".jpg, image/*, application/pdf",dense:"",label:"Haga click para subir el archivo o arrastralo aqu\xED",loading:Q(y),outlined:"","use-chips":""},{prepend:r(()=>[t(H,{name:"attach_file"})]),_:1},8,["modelValue","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(Ae),t(Le,{align:"right"},{default:r(()=>[t(U,{color:"primary",label:"Guardar",type:"submit",unelevated:""})]),_:1})]),_:1},8,["onSubmit"]))}});const rt={class:"q-table__title"},zt=te({__name:"IndexPage",setup(e){const s="https://nestjs-boilerplate-production.up.railway.app",p=qe(),m=p.currentRoute.value,o=P(m.query.fromSubBudgets==="true"),{isLoading:q,isFetching:y,orders:v,purchaseOrderType:b}=Te({fromSubBudgets:o}),F=[{name:"consecutiveId",label:"ID",field:"consecutiveId",sortable:!1,required:!0},{name:"area",field:g=>{var i,u;return(u=(i=g.requisition)==null?void 0:i.area)==null?void 0:u.name},label:"Departamento",sortable:!0,align:"left"},{name:"event",field:"event",label:"Evento",sortable:!1,align:"left"},{name:"order_number",field:"order_number",label:"N\xFAmero de orden de compra",align:"center",sortable:!0},{name:"reception_date",field:"reception_date",label:"Fecha de recepci\xF3n",sortable:!0,align:"left"},{name:"requisition",field:g=>{var i;return(i=g.requisition)==null?void 0:i.requisition_number},label:"Requisici\xF3n",sortable:!0,align:"center"},{name:"file",field:"file",label:"Archivo",sortable:!1,align:"left"},{name:"actions",field:"actions",label:"Acciones",sortable:!1,align:"center"}],h=P(!1),d=P(1),x=P(["area","order_number","reception_date","requisition","file","actions"]),f=P(""),C=P(!1),{deletePurchaseOrder:V,isDeleteingPurchaseOrder:a}=Ee({fromSubBudgets:o}),l=P(void 0);be(()=>{o.value&&x.value.splice(1,0,"event")}),ge(o,g=>{p.replace({query:{...m.query,fromSubBudgets:g.toString()}}),g?x.value.splice(1,0,"event"):x.value.splice(1,1)});const I=_(()=>b.value===""?"Selecciona un tipo de orden de compra":b.value==="PRESUPUESTO"?"Presupuesto":"SubPresupuesto");function B(g){b.value=g,d.value=2}function w(g){l.value=g,C.value=!0}async function S(){const g=o.value?"RequisitionSubBudgetEntity":"RequisitionEntity";await V({id:l.value,requisitionType:g}),n()}function n(){l.value=void 0,C.value=!1}return(g,i)=>(T(),E(Re,null,{default:r(()=>[t(Oe,null,{"card-body":r(()=>[t(ye,{columns:F,filter:f.value,loading:Q(q)||Q(y),pagination:{rowsPerPage:20},rows:Q(v),"visible-columns":x.value,"wrap-cells":""},{top:r(()=>[Se("div",rt," \xD3rdenes de compra/"+R(o.value?"SubPresupuestos":"Presupuestos"),1),t(le),t(ne,{modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=u=>o.value=u),class:"tw-mr-4",label:"Mostrar las \xF3rdenes de compra de los SubPresupuestos"},null,8,["modelValue"]),t(re,{modelValue:f.value,"onUpdate:modelValue":i[1]||(i[1]=u=>f.value=u),class:"q-mr-xs",clearable:"",debounce:"300",dense:"",outlined:"",placeholder:"Buscar"},{append:r(()=>[t(H,{name:"search"})]),_:1},8,["modelValue"]),t(U,{color:"primary",label:"Nueva orden de compra",onClick:i[2]||(i[2]=u=>h.value=!0)})]),"body-cell-consecutiveId":r(u=>[t(K,{props:u},{default:r(()=>[k(R((u.rowIndex+1).toString()),1)]),_:2},1032,["props"])]),"body-cell-file":r(u=>[t(K,{props:u},{default:r(()=>[u.value?(T(),E(ze,{key:0,"file-url":`${Q(s)}/api/files/purchase-orders/${u.row.id}/${u.value}`},null,8,["file-url"])):j("",!0)]),_:2},1032,["props"])]),"body-cell-actions":r(u=>[t(K,{props:u},{default:r(()=>[t(U,{color:"negative",flat:"",icon:"delete",round:"",onClick:at=>w(u.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["filter","loading","rows","visible-columns"])]),footer:r(()=>[t(We,{modelValue:h.value,"onUpdate:modelValue":i[7]||(i[7]=u=>h.value=u),"card-title":"Orden de Compra",class:"form-purchase-order"},{default:r(()=>[t(Ye,{modelValue:d.value,"onUpdate:modelValue":i[6]||(i[6]=u=>d.value=u),animated:"",color:"primary",vertical:""},{default:r(()=>[t(Z,{done:d.value>1,icon:"settings",name:1,title:"Selecciona un tipo de orden de compra"},{default:r(()=>[t(J,{class:"tw-flex tw-gap-1"},{default:r(()=>[t(U,{color:"primary",label:"Presupuesto",outline:"",onClick:i[3]||(i[3]=u=>B("PRESUPUESTO"))}),t(U,{color:"primary",label:"SubPresupuesto",outline:"",onClick:i[4]||(i[4]=u=>B("SUBPRESUPUESTO"))})]),_:1})]),_:1},8,["done"]),t(Z,{caption:Q(I),done:d.value>2,icon:"create_new_folder",name:2,title:"Crear Orden de Compra"},{default:r(()=>[t(Ve,{bordered:"",flat:""},{default:r(()=>[t(tt)]),_:1}),t(J,null,{default:r(()=>[t(U,{color:"primary",flat:"",label:"atr\xE1s",onClick:i[5]||(i[5]=u=>{d.value=1,b.value=""})})]),_:1})]),_:1},8,["caption","done"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),t(Ge,{modelValue:C.value,"onUpdate:modelValue":i[8]||(i[8]=u=>C.value=u),"card-title":"\xBFDesea eliminar la orden de compra?",deleting:Q(a),onConfirmDelete:S},null,8,["modelValue","deleting"])]),_:1})]),_:1}))}});export{zt as default};
