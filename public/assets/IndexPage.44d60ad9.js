import{M as C,H as b,r as _,c as V,m as S,j as F,k as a,d as e,u as c,S as g,ax as M,a2 as h,p as I}from"./index.09c0efc9.js";import{l as v,b as P,c as w}from"./layout.68d08a69.js";import{C as T,Q as A}from"./CardForm.2075fdcb.js";import{u as B,a as k,b as N,c as D,T as z,Q as K,d as $}from"./QCardActions.5f901894.js";import{L as x}from"./LineResource.b33beab2.js";import{k as H,Q as E,h as q}from"./QSeparator.4cdb5c47.js";import"./uid.bbec7689.js";import"./index.2cf0d985.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./scroll.3b39a41d.js";import"./QPage.f1048661.js";import"./utils.esm.3895f0a6.js";const j=async()=>{const{data:t}=await x.getLines();return t},G=async t=>{const{data:n}=await x.storeLine(t);return n},R=async t=>{const{id:n,name:s,description:u}=t,{data:o}=await x.updateLine(n,{name:s,description:u});return o},J=()=>{const{isLoading:t,isError:n,data:s,error:u}=B({queryKey:["lines"],queryFn:j,staleTime:6e5});return{isLoading:t,isError:n,data:s,error:u}},O=()=>{const t=k();return{lineStoreMutations:N({mutationFn:G,onSuccess:()=>{t.invalidateQueries({queryKey:["lines"]}),v.showSuccessNotification("Partida creada con \xE9xito")},onError:()=>{v.showErrorNotification("Error al crear partida")}})}},W=()=>{const t=k();return{lineUpdateMutations:N({mutationFn:R,onSuccess:()=>{t.invalidateQueries({queryKey:["lines"]}),v.showSuccessNotification("Partida actualizada con \xE9xito")},onError:()=>{v.showErrorNotification("Error al actualizar partida")}})}},X=C({__name:"LineForm",props:{line:null},setup(t){const n=t,{lineStoreMutations:s}=O(),{isLoading:u}=s,{lineUpdateMutations:o}=W(),{isLoading:f}=o,L=b({name:"",description:""}),i=b(D(n.line||L)),m=_(),l={name:[y=>!!y||"El nombre es requerido"],description:[y=>!!y||"La descripci\xF3n es requerida"]},r=V(()=>n.line&&"id"in n.line),Q=V(()=>r.value?"Editar partida":"Agregar partida");async function U(){var d,p;await((d=m.value)==null?void 0:d.validate())&&(r.value?await o.mutateAsync(i):(await s.mutateAsync(i),i.name="",i.description="",(p=m.value)==null||p.reset()))}return(y,d)=>(S(),F(T,{title:c(Q)},{form:a(()=>[e(c(P),{ref_key:"lineForm",ref:m,class:"q-gutter-md"},{default:a(()=>[e(H,null,{default:a(()=>[e(E,null,{default:a(()=>[e(q,null,{default:a(()=>[e(w,{modelValue:i.name,"onUpdate:modelValue":d[0]||(d[0]=p=>i.name=p),dense:"",label:"Nombre",outlined:"",rules:l.name},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(E,null,{default:a(()=>[e(q,null,{default:a(()=>[e(w,{modelValue:i.description,"onUpdate:modelValue":d[1]||(d[1]=p=>i.description=p),dense:"",label:"Descripci\xF3n",outlined:"",rules:l.description,type:"textarea"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1},512)]),actions:a(()=>[e(g,{color:"primary",label:"Guardar",loading:c(u)||c(f),onClick:U},null,8,["loading"])]),_:1},8,["title"]))}}),Y={class:"q-gutter-sm"},ce=C({__name:"IndexPage",setup(t){const{data:n,isLoading:s}=J(),u=_(""),o=_(!1);let f=b({name:"",description:""});const L=[{name:"id",field:"id",required:!0,label:"ID",sortable:!0,align:"left"},{name:"name",field:"name",label:"Nombre",sortable:!0,align:"left"},{name:"description",field:"description",label:"Descripci\xF3n",sortable:!1,align:"left"},{name:"action",align:"center",label:"Acciones",field:"action",sortable:!1}];M(()=>{o.value||(f=b({name:"",description:""}))});function i(m){o.value=!0,f=m}return(m,l)=>(S(),F(z,null,{"card-body":a(()=>[e(K,{columns:L,loading:c(s),rows:c(n),"rows-per-page-options":[20,30,40,50],title:"Partidas"},{"top-right":a(()=>[e(g,{class:"q-mr-xs",color:"primary",icon:"add",label:"Nueva Partida",outline:"",onClick:l[0]||(l[0]=r=>o.value=!0)}),e(w,{modelValue:u.value,"onUpdate:modelValue":l[1]||(l[1]=r=>u.value=r),class:"q-mr-xs",debounce:"300",dense:"",outlined:"",placeholder:"Search"},{append:a(()=>[e(h,{name:"search"})]),_:1},8,["modelValue"]),e(g,{color:"primary","icon-right":"archive",label:"Exportar CSV","no-caps":""})]),"body-cell-action":a(r=>[e(A,{props:r},{default:a(()=>[I("div",Y,[e(g,{color:"primary",dense:"",flat:"",icon:"edit",rounded:"",size:"sm",onClick:Q=>i(r.row)},null,8,["onClick"])])]),_:2},1032,["props"])]),_:1},8,["loading","rows"])]),footer:a(()=>[e($,{modelValue:o.value,"onUpdate:modelValue":l[2]||(l[2]=r=>o.value=r)},{default:a(()=>[e(X,{line:c(f)},null,8,["line"])]),_:1},8,["modelValue"])]),_:1}))}});export{ce as default};
