import{j as N,N as V,r as Q,c as S,p as F,k,l as t,d as e,X as w,u as f,w as M,_ as T,s as A,J as D}from"./index.6e092ff4.js";import{Q as C}from"./QInput.17ed03ff.js";import{Q as B,a as $}from"./QTable.14f5bf59.js";import{T as z}from"./TablePage.1e62c5a7.js";import{L as E,u as K}from"./app.fdb8304e.js";import{l as L}from"./layout.8898c8f1.js";import{u as j,a as U}from"./QChip.2e36ff41.js";import{u as h}from"./useMutation.esm.8f902b98.js";import{Q as q,a as I}from"./QItemLabel.0869f881.js";import{Q as G}from"./QList.a2cdda04.js";import{Q as H}from"./QCardSection.e6dd9052.js";import{a as J}from"./format.9da510a0.js";import{Q as O}from"./QCardActions.beef4929.js";import{Q as R}from"./QForm.8fac44d9.js";import{c as P}from"./index.7adaf3a2.js";import{_ as X}from"./CardDialog.00e419ec.js";import"./planeacion.api.ebfeb564.js";import"./index.2cf0d985.js";import"./use-dark.6f924d7f.js";import"./QSelect.653a261d.js";import"./scroll.aae0930c.js";import"./QCheckbox.9e355c67.js";import"./QCard.c3a0553c.js";import"./QPage.e3c9f7e9.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./ArticleResource.29ae1c09.js";import"./utils.esm.ed28f146.js";import"./mutation.esm.313dacbf.js";import"./QSpace.4f34f3fa.js";const W=async()=>{const{data:a}=await E.getLines();return a},Y=async a=>{const{data:o}=await E.storeLine(a);return o},Z=async a=>{const{id:o,name:p,description:u}=a,{data:y}=await E.updateLine(o,{name:p,description:u});return y},ee=()=>{const{isLoading:a,isError:o,data:p,error:u}=j({queryKey:["lines"],queryFn:W,staleTime:6e5});return{isLoading:a,isError:o,data:p,error:u}},te=()=>{const a=U();return{lineStoreMutations:h({mutationFn:Y,onSuccess:()=>{a.invalidateQueries({queryKey:["lines"]}),L.showSuccessNotification("Partida creada con \xE9xito")},onError:()=>{L.showErrorNotification("Error al crear partida")}})}},ae=()=>{const a=U();return{lineUpdateMutations:h({mutationFn:Z,onSuccess:()=>{a.invalidateQueries({queryKey:["lines"]}),L.showSuccessNotification("Partida actualizada con \xE9xito")},onError:()=>{L.showErrorNotification("Error al actualizar partida")}})}},oe=N({__name:"LineForm",props:{line:null},setup(a){const o=a,p=K(),{fetchLineDictionary:u}=p,{lineStoreMutations:y}=te(),{isLoading:g}=y,{lineUpdateMutations:l}=ae(),{isLoading:v}=l,x=V({name:"",description:""}),n=V(P(o.line||x)),_=Q(),b={name:[c=>!!c||"El nombre es requerido"],description:[c=>!!c||"La descripci\xF3n es requerida"]},d=S(()=>o.line&&"id"in o.line);S(()=>d.value?"Editar partida":"Agregar partida");async function r(){var s,m;await((s=_.value)==null?void 0:s.validate())&&(d.value?(await l.mutateAsync(n),await i()):(await y.mutateAsync(n),n.name="",n.description="",(m=_.value)==null||m.reset(),await i()))}async function i(){await u()}return(c,s)=>(F(),k(f(R),{ref_key:"lineForm",ref:_,class:"q-gutter-md"},{default:t(()=>[e(H,null,{default:t(()=>[e(G,null,{default:t(()=>[e(q,null,{default:t(()=>[e(I,null,{default:t(()=>[e(C,{modelValue:n.name,"onUpdate:modelValue":s[0]||(s[0]=m=>n.name=m),dense:"",label:"Nombre",outlined:"",rules:b.name},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(q,null,{default:t(()=>[e(I,null,{default:t(()=>[e(C,{modelValue:n.description,"onUpdate:modelValue":s[1]||(s[1]=m=>n.description=m),dense:"",label:"Descripci\xF3n",outlined:"",rules:b.description,type:"textarea"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),e(J),e(O,{align:"right"},{default:t(()=>[e(w,{color:"primary",label:"Guardar",loading:f(g)||f(v),onClick:r},null,8,["loading"])]),_:1})]),_:1},512))}}),ie={class:"q-gutter-sm"},he=N({__name:"IndexPage",setup(a){const{data:o,isLoading:p}=ee(),u=Q(""),y=[{name:"id",field:"id",required:!0,label:"ID",sortable:!0,align:"left"},{name:"name",field:"name",label:"Nombre",sortable:!0,align:"left"},{name:"description",field:"description",label:"Descripci\xF3n",sortable:!1,align:"left"},{name:"action",align:"center",label:"Acciones",field:"action",sortable:!1}],g=Q(-1),l=Q(!1);let v=V({name:"",description:""});const x={name:"",description:""},n=S(()=>g.value===-1?"Nueva Partida":"Editar Partida");M(l,d=>{d||b()});function _(d){var s;const{name:r,description:i,id:c}=d;g.value=(s=o.value)==null?void 0:s.findIndex(m=>m.id===d.id),v=Object.assign({},{id:c,name:r,description:i}),l.value=!0}function b(){l.value=!1,D(()=>{v=P(x),g.value=-1})}return(d,r)=>(F(),k(z,null,{"card-body":t(()=>[e($,{columns:y,loading:f(p),rows:f(o),"rows-per-page-options":[20,30,40,50],title:"Partidas"},{"top-right":t(()=>[e(w,{class:"q-mr-xs",color:"primary",icon:"add",label:"Nueva Partida",outline:"",onClick:r[0]||(r[0]=i=>l.value=!0)}),e(C,{modelValue:u.value,"onUpdate:modelValue":r[1]||(r[1]=i=>u.value=i),class:"q-mr-xs",debounce:"300",dense:"",outlined:"",placeholder:"Search"},{append:t(()=>[e(T,{name:"search"})]),_:1},8,["modelValue"]),e(w,{color:"primary","icon-right":"archive",label:"Exportar CSV","no-caps":""})]),"body-cell-action":t(i=>[e(B,{props:i},{default:t(()=>[A("div",ie,[e(w,{color:"primary",dense:"",flat:"",icon:"edit",rounded:"",size:"sm",onClick:c=>_(i.row)},null,8,["onClick"])])]),_:2},1032,["props"])]),_:1},8,["loading","rows"])]),footer:t(()=>[e(X,{modelValue:l.value,"onUpdate:modelValue":r[2]||(r[2]=i=>l.value=i),"card-title":f(n)},{default:t(()=>[e(oe,{line:f(v)},null,8,["line"])]),_:1},8,["modelValue","card-title"])]),_:1}))}});export{he as default};
