import{j as C,N as w,r as Q,c as A,p as S,k as q,l as a,d as e,u as f,s as I,t as B,Z as v,aH as D,a0 as L}from"./index.6741c124.js";import{p as E,l as y,Q as T,a as N}from"./layout.930594d2.js";import{Q as $}from"./QBtnGroup.3b4e1b97.js";import{C as z,Q as K}from"./CardForm.e7afcc46.js";import{u as R,a as F,b as k,c as j,f as G,T as H,Q as P,d as h}from"./QCardActions.a137c815.js";import{a as Z,b as g,c as U}from"./format.d522e83a.js";import"./use-dark.fdfa0a81.js";import"./focus-manager.33224ae2.js";import"./index.2cf0d985.js";import"./QCard.c905067c.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./scroll.f68c09c4.js";import"./QPage.60cbfee8.js";import"./utils.esm.cca72ecc.js";var _={getUsers(){return E.get("/users")},storeUser(s){return E.post("/users",s)},updateUser(s,t){return E.put(`/users/${s}`,t)}};const J=async()=>{const{data:s}=await _.getUsers();return s},O=async s=>{const{data:t}=await _.storeUser(s);return t},W=async s=>{const{id:t,...d}=s,{data:m}=await _.updateUser(t,d);return m},X=()=>{const{isLoading:s,isError:t,data:d,error:m}=R({queryKey:["users"],queryFn:J,staleTime:6e5});return{isLoading:s,isError:t,data:d,error:m}},Y=()=>{const s=F();return{userStoreMutations:k({mutationFn:O,onSuccess:()=>{s.invalidateQueries({queryKey:["users"]}),y.showSuccessNotification("Usuario creado con \xE9xito")},onError:()=>{y.showErrorNotification("Error al crear usuario")}})}},ee=()=>{const s=F();return{userUpdateMutations:k({mutationFn:W,onSuccess:()=>{s.invalidateQueries({queryKey:["users"]}),y.showSuccessNotification("Usuario actualizado con \xE9xito")},onError:()=>{y.showErrorNotification("Error al actualizar usuario")}})}},ae=C({__name:"UserForm",props:{user:null},setup(s){const t=s,{userStoreMutations:d}=Y(),{isLoading:m}=d,{userUpdateMutations:c}=ee(),{isLoading:b}=c,V=w({email:"",firstName:"",isActive:!0,lastName:"",roles:[],password:""}),l=w(j(t.user||V)),p=Q(),u={email:[r=>!!r||"El email es requerido",r=>/.+@.+\..+/.test(r)||"El email debe ser v\xE1lido"],firstName:[r=>!!r||"El nombre es requerido"],lastName:[r=>!!r||"El apellido es requerido"],password:[r=>!!r||"El password es requerido"],roles:[r=>!!r.length||"Debe seleccionar al menos un rol"]},n=A(()=>t.user&&"id"in t.user),x=A(()=>n.value?"Editar usuario":"Agregar usuario");async function M(){var o,i;!await((o=p.value)==null?void 0:o.validate())||(n.value?await c.mutateAsync(l):(await d.mutateAsync(l),l.email="",l.firstName="",l.isActive=!0,l.lastName="",l.roles=[],l.password="",(i=p.value)==null||i.reset()))}return(r,o)=>(S(),q(z,{title:f(x)},{form:a(()=>[e(f(T),{ref_key:"userForm",ref:p,class:"q-gutter-md"},{default:a(()=>[e(Z,null,{default:a(()=>[e(g,null,{default:a(()=>[e(U,null,{default:a(()=>[e(N,{modelValue:l.email,"onUpdate:modelValue":o[0]||(o[0]=i=>l.email=i),dense:"",label:"Email",outlined:"",rules:u.email},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(U,null,{default:a(()=>[e(N,{modelValue:l.firstName,"onUpdate:modelValue":o[1]||(o[1]=i=>l.firstName=i),dense:"",label:"Nombre",outlined:"",rules:u.firstName},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(U,null,{default:a(()=>[e(N,{modelValue:l.lastName,"onUpdate:modelValue":o[2]||(o[2]=i=>l.lastName=i),dense:"",label:"Apellido",outlined:"",rules:u.lastName},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(U,null,{default:a(()=>[e(N,{modelValue:l.password,"onUpdate:modelValue":o[3]||(o[3]=i=>l.password=i),dense:"",label:"Contrase\xF1a",outlined:"",rules:u.password,type:"password"},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(g,null,{default:a(()=>[e(U,null,{default:a(()=>[e(G,{modelValue:l.roles,"onUpdate:modelValue":o[4]||(o[4]=i=>l.roles=i),dense:"",label:"Roles",multiple:"",options:["admin","user"],outlined:"",rules:u.roles},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),I("pre",null,B(l),1)]),_:1},512)]),actions:a(()=>[e(v,{color:"primary",label:"Guardar",loading:f(m)||f(b),onClick:M},null,8,["loading"])]),_:1},8,["title"]))}}),ge=C({__name:"IndexPage",setup(s){const{data:t,isLoading:d}=X(),m=Q(""),c=Q(!1);let b=w({email:"",firstName:"",isActive:!0,lastName:"",roles:[],password:""});const V=[{name:"id",field:"id",required:!0,label:"ID",sortable:!0,align:"left"},{name:"email",field:"email",label:"Email",sortable:!0,align:"left"},{name:"firstName",field:"firstName",label:"Nombre",sortable:!0,align:"left"},{name:"lastName",field:"lastName",label:"Apellido",sortable:!0,align:"left"},{name:"isActive",field:"isActive",label:"Activo",sortable:!0,align:"left"},{name:"roles",field:p=>p.roles.join(", "),label:"Roles",sortable:!0,align:"left"},{name:"action",align:"center",label:"Acciones",field:"action",sortable:!1}];D(()=>{c.value||(b=w({email:"",firstName:"",isActive:!0,lastName:"",roles:[],password:""}))});function l(p){c.value=!0,b=p}return(p,u)=>(S(),q(H,null,{"card-body":a(()=>[e(P,{columns:V,loading:f(d),rows:f(t),"rows-per-page-options":[20,30,40,50],title:"Usuarios"},{"top-right":a(()=>[e(N,{modelValue:m.value,"onUpdate:modelValue":u[0]||(u[0]=n=>m.value=n),class:"q-mr-xs",debounce:"300",dense:"",outlined:"",placeholder:"Search"},{append:a(()=>[e(L,{name:"search"})]),_:1},8,["modelValue"]),e($,{unelevated:""},{default:a(()=>[e(v,{class:"tw-bg-indigo-900",icon:"add",label:"Nueva Usuario","text-color":"white",onClick:u[1]||(u[1]=n=>c.value=!0)}),e(v,{color:"primary","icon-right":"archive",label:"Exportar CSV"})]),_:1})]),"body-cell-action":a(n=>[e(K,{props:n},{default:a(()=>[e(v,{color:"primary",dense:"",flat:"",icon:"edit",rounded:"",size:"sm",onClick:x=>l(n.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["loading","rows"])]),footer:a(()=>[e(h,{modelValue:c.value,"onUpdate:modelValue":u[2]||(u[2]=n=>c.value=n)},{default:a(()=>[e(ae,{user:f(b)},null,8,["user"])]),_:1},8,["modelValue"])]),_:1}))}});export{ge as default};
