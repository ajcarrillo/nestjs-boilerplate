import{Q as ae,a as J}from"./QSpace.c1f9a46e.js";import{b as f,k as B,a as p,c as X,Q as oe}from"./format.bc6b5d0a.js";import{v as ne,c as G,h as O,_ as T,r as g,b0 as ie,j as z,V as L,m as $,N as K,w as ue,p as x,k as S,l as a,d as l,q as v,t as q,u as h,b as re,s as w,aH as W,av as se,b1 as de,ag as Y,F as Z,at as ee,X as j}from"./index.0b175f01.js";import{u as me,a as ce,b as fe,Q as pe}from"./QTable.78812d52.js";import{Q as te}from"./QList.de9c20f7.js";import{a as A,Q as be}from"./QForm.e02b1b3f.js";import{Q as ge}from"./QBtnGroup.52656f6a.js";import{Q as _e}from"./QPage.f7e992f7.js";import{b as ve}from"./useBudgets.7c9b4060.js";import{T as ye}from"./TablePage.af3732ea.js";import{a as H,Q as he}from"./QCard.8418aa13.js";import{g as xe,f as D}from"./QSelect.a01fc3f8.js";import{Q as qe}from"./QCardActions.cdd25544.js";import{u as Ve}from"./useDictionaries.0adf0c16.js";import{c as Qe}from"./index.7adaf3a2.js";import{u as we}from"./useBudgetDetail.bbeea406.js";import{u as Ce}from"./useExportDataToCsv.24875244.js";import"./scroll.be050d28.js";import"./use-dark.46bf0f81.js";import"./focus-manager.33224ae2.js";import"./layout.e5b39b81.js";import"./index.2cf0d985.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./utils.esm.4fba875c.js";import"./app.5e9b6a7a.js";import"./ActionResource.106ff265.js";import"./LineResource.1917564b.js";import"./ArticleResource.776678dc.js";import"./date.2de2ec43.js";var Me=ne({name:"QToggle",props:{...me,icon:String,iconColor:String},emits:ce,setup(r){function m(u,i){const d=G(()=>(u.value===!0?r.checkedIcon:i.value===!0?r.indeterminateIcon:r.uncheckedIcon)||r.icon),s=G(()=>u.value===!0?r.iconColor:null);return()=>[O("div",{class:"q-toggle__track"}),O("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},d.value!==void 0?[O(T,{name:d.value,color:s.value})]:void 0)]}return fe("toggle",m)}});const Pe=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],Fe=(r,m=0,u=!1)=>{let i;return(...d)=>{u&&!i&&r(...d),clearTimeout(i),i=setTimeout(()=>{r(...d)},m)}},ke=(r,m,u)=>{const i=g(r);return ie((d,s)=>({get(){return d(),i.value},set:Fe(b=>{i.value=b,s()},m,u)}))},De={class:"self-center full-width no-outline",tabindex:"0"},Ae=z({__name:"MonthBudgetForm",props:{month:null,budgetMonth:{default:()=>({quantity:0})},estimatedAmount:{default:0}},emits:["update:quantity"],setup(r,{emit:m}){const u=r;L();const i=$(),{id:d}=i.params,s=K(Qe(u.budgetMonth)),b=ke(s.quantity||0,250,!1);return ue(b,_=>{_>0&&(s.quantity=_,s.month=u.month,s.budget_detail_id=d,m("update:quantity",s))}),(_,V)=>(x(),S(p,null,{default:a(()=>[l(f,null,{default:a(()=>[l(B,{overline:""},{default:a(()=>[v(q(r.month),1)]),_:1}),l(A,{modelValue:h(b),"onUpdate:modelValue":V[0]||(V[0]=C=>re(b)?b.value=C:null),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Cantidad",outlined:"",type:"number"},null,8,["modelValue"])]),_:1}),l(f,{side:""},{default:a(()=>[l(B,{overline:""},{default:a(()=>[v("\xA0\xA0\xA0")]),_:1}),l(xe,{dense:"",label:"Total",outlined:"","stack-label":""},{control:a(()=>[w("div",De,q(s.quantity*u.estimatedAmount),1)]),prepend:a(()=>[l(T,{name:"o_attach_money"})]),_:1})]),_:1})]),_:1}))}}),Be=w("div",{class:"tw-text-xl"},"Agregar bien",-1),Te=z({__name:"BudgetDetailForm",setup(r){L();const m=$(),{id:u}=m.params,{actionDictionary:i,lineDictionary:d,areaDictionary:s,getArticleByName:b}=Ve(),{storeBudgetDetailMutation:_}=we(),{isLoading:V}=_,C=g(i.value),U=g(d.value),M=g(s.value),P=g([]),o=K({action:null,line:null,area:null,article:null,estimated_amount:0,justification:"",month:[],total:0,budgetMonths:[]}),c=g([]);W(()=>{if(c.value.length>0){const t=c.value.reduce((e,n)=>e+n.quantity,0);o.total=t*o.estimated_amount}});function R(t,e,n){e(()=>{const Q=t.toLowerCase();M.value=s.value.filter(F=>F.label.toLowerCase().indexOf(Q)>-1)})}function y(t,e,n){if(t.length<2){n();return}e(()=>{const Q=t.toLowerCase();P.value=b(Q).value})}function I(t){const e=c.value.findIndex(n=>n.month===t.month);e>-1?c.value[e]=t:c.value.push(t)}function E({value:t}){c.value=c.value.filter(e=>e.month!==t)}async function N(){o.budgetMonths=c.value,await _.mutateAsync({budgetId:u,budgetDetail:o}),o.action=null,o.line=null,o.area=null,o.article=null,o.estimated_amount=0,o.justification="",o.month=[],o.total=0,o.budgetMonths=[],c.value=[]}return(t,e)=>(x(),S(he,null,{default:a(()=>[l(H,null,{default:a(()=>[Be]),_:1}),l(X),l(H,{class:"tw-px-0"},{default:a(()=>[l(be,null,{default:a(()=>[l(te,null,{default:a(()=>[l(p,null,{default:a(()=>[l(f,null,{default:a(()=>[l(D,{modelValue:o.action,"onUpdate:modelValue":e[0]||(e[0]=n=>o.action=n),dense:"",label:"ACC",options:C.value,outlined:""},null,8,["modelValue","options"])]),_:1})]),_:1}),l(p,null,{default:a(()=>[l(f,null,{default:a(()=>[l(D,{modelValue:o.line,"onUpdate:modelValue":e[1]||(e[1]=n=>o.line=n),dense:"",label:"Partida",options:U.value,outlined:""},null,8,["modelValue","options"])]),_:1})]),_:1}),l(p,null,{default:a(()=>[l(f,null,{default:a(()=>[l(D,{modelValue:o.area,"onUpdate:modelValue":e[2]||(e[2]=n=>o.area=n),dense:"",label:"\xC1rea",options:M.value,outlined:"","use-input":"",onFilter:R},null,8,["modelValue","options"])]),_:1})]),_:1}),l(p,null,{default:a(()=>[l(f,null,{default:a(()=>[l(D,{modelValue:o.article,"onUpdate:modelValue":e[3]||(e[3]=n=>o.article=n),dense:"",hint:"M\xEDnimo 2 caracteres para activar el filtrado",label:"Art\xEDculos",options:P.value,outlined:"","use-input":"",onFilter:y},{option:a(n=>[l(p,se(de(n.itemProps)),{default:a(()=>[l(f,null,{default:a(()=>[l(B,null,{default:a(()=>[v(q(n.opt.label),1)]),_:2},1024),l(B,{caption:""},{default:a(()=>[v(q(n.opt.caption),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])]),_:1})]),_:1}),l(p,null,{default:a(()=>[l(f,null,{default:a(()=>[l(A,{modelValue:o.justification,"onUpdate:modelValue":e[4]||(e[4]=n=>o.justification=n),dense:"",label:"Justificaci\xF3n",outlined:"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),l(p,null,{default:a(()=>[l(f,null,{default:a(()=>[l(A,{modelValue:o.estimated_amount,"onUpdate:modelValue":e[5]||(e[5]=n=>o.estimated_amount=n),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Monto estimado",outlined:"",type:"number"},{prepend:a(()=>[l(T,{name:"o_attach_money"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(p,null,{default:a(()=>[l(f,null,{default:a(()=>[l(D,{modelValue:o.month,"onUpdate:modelValue":e[6]||(e[6]=n=>o.month=n),dense:"",label:"Mes",multiple:"",options:h(Pe),outlined:"","use-chips":"",onRemove:E},null,8,["modelValue","options"])]),_:1})]),_:1}),(x(!0),Y(Z,null,ee(o.month,n=>(x(),S(Ae,{key:n,"estimated-amount":o.estimated_amount,month:n,"onUpdate:quantity":I},null,8,["estimated-amount","month"]))),128)),l(p,null,{default:a(()=>[l(f,null,{default:a(()=>[l(A,{modelValue:o.total,"onUpdate:modelValue":e[7]||(e[7]=n=>o.total=n),dense:"","input-class":"tw-text-right",label:"Total",outlined:"",readonly:"",type:"number"},{prepend:a(()=>[l(T,{name:"o_attach_money"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(X),l(qe,null,{default:a(()=>[l(ae),l(j,{color:"primary",icon:"o_save",loading:h(V),unelevated:"",onClick:N},{default:a(()=>[v(" guardar ")]),_:1},8,["loading"])]),_:1})]),_:1}))}}),Se=()=>({currencyFormat:m=>{const u={style:"currency",currency:"MXN"};return new Intl.NumberFormat("es-MX",u).format(m)}}),Ie={class:"q-my-xs q-pt-sm q-ml-md tw-text-2xl tw-font-bold tw-text-slate-700"},je={class:"row"},Ue={class:"col col-md-3 q-pa-sm"},Re={class:"col"},bt=z({__name:"DetailPage",setup(r){const{exportDataToCsv:m}=Ce(),u=g(),i=L(),d=$(),{id:s}=d.params,{search:b,sortBy:_="id",descending:V=!1,page:C,rowsPerPage:U=13}=d.query,{budget:M}=ve(s),{currencyFormat:P}=Se(),o=[{name:"id",field:"id",required:!0,label:"ID",sortable:!0,align:"left"},{name:"action",field:t=>t.action.name,label:"Acci\xF3n",sortable:!0,align:"left"},{name:"line",field:t=>t.line.name,label:"Partida",sortable:!0,align:"left"},{name:"department",field:t=>t.department.alias,label:"\xC1rea",sortable:!0,align:"left"},{name:"article",field:t=>t.article.name,label:"Bien",sortable:!0,align:"left"},{name:"article_description",field:t=>t.article.description,label:"Descripci\xF3n del bien",sortable:!0,align:"left"},{name:"justification",field:"justification",label:"Justificaci\xF3n",sortable:!0,align:"left"},{name:"enero",field:t=>{var e;return(e=t.enero)==null?void 0:e.quantity},label:"Enero",sortable:!0,align:"right"},{name:"febrero",field:t=>{var e;return(e=t.febrero)==null?void 0:e.quantity},label:"Febrero",sortable:!0,align:"right"},{name:"marzo",field:t=>{var e;return(e=t.marzo)==null?void 0:e.quantity},label:"Marzo",sortable:!0,align:"right"},{name:"abril",field:t=>{var e;return(e=t.abril)==null?void 0:e.quantity},label:"Abril",sortable:!0,align:"right"},{name:"mayo",field:t=>{var e;return(e=t.mayo)==null?void 0:e.quantity},label:"Mayo",sortable:!0,align:"right"},{name:"junio",field:t=>{var e;return(e=t.junio)==null?void 0:e.quantity},label:"Junio",sortable:!0,align:"right"},{name:"julio",field:t=>{var e;return(e=t.julio)==null?void 0:e.quantity},label:"Julio",sortable:!0,align:"right"},{name:"agosto",field:t=>{var e;return(e=t.agosto)==null?void 0:e.quantity},label:"Agosto",sortable:!0,align:"right"},{name:"septiembre",field:t=>{var e;return(e=t.septiembre)==null?void 0:e.quantity},label:"Septiembre",sortable:!0,align:"right"},{name:"octubre",field:t=>{var e;return(e=t.octubre)==null?void 0:e.quantity},label:"Octubre",sortable:!0,align:"right"},{name:"noviembre",field:t=>{var e;return(e=t.noviembre)==null?void 0:e.quantity},label:"Noviembre",sortable:!0,align:"right"},{name:"diciembre",field:t=>{var e;return(e=t.diciembre)==null?void 0:e.quantity},label:"Diciembre",sortable:!0,align:"right"},{name:"estimated_amount",field:t=>`${P(+t.estimated_amount)}`,label:"Precio",sortable:!0,align:"right"},{name:"total",field:t=>`${P(+t.total)}`,label:"Total",sortable:!0,align:"right"}],c=g(["action","line","department","article","estimated_amount","enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre","total"]),R=o.map(t=>({label:t.label,value:t.name})),y=g(b||""),I=g({sortBy:_,descending:V==="true",page:+C||1,rowsPerPage:+U||10});W(()=>{let t={};y.value?t={...i.currentRoute.value.query,search:y.value}:(t={...i.currentRoute.value.query},delete t.search),i.push({query:t})});function E(t){I.value=t,i.push({query:{...i.currentRoute.value.query,page:t.page,rowsPerPage:t.rowsPerPage,sortBy:t.sortBy,descending:t.descending}})}function N(){m(u.value.filteredSortedRows,o,"presupuesto")}return(t,e)=>(x(),S(_e,null,{default:a(()=>{var n;return[w("h5",Ie,"Presupuesto "+q((n=h(M))==null?void 0:n.year),1),w("div",je,[w("div",Ue,[l(Te)]),w("div",Re,[l(ye,null,{"card-body":a(()=>{var Q;return[l(h(pe),{ref_key:"qTablePresupuesto",ref:u,columns:o,filter:y.value,pagination:I.value,"row-key":"id",rows:((Q=h(M))==null?void 0:Q.details)||[],"rows-per-page-options":[13,26,52,0],separator:"cell",title:"Detalle","visible-columns":c.value,"onUpdate:pagination":E},{"top-right":a(F=>[l(j,{class:"tw-mr-2",color:"primary","fab-mini":"",flat:"",icon:"tune",size:"sm"},{default:a(()=>[l(J,null,{default:a(()=>[v(" Mostrar/Ocultar columnas ")]),_:1}),l(oe,{anchor:"top end",self:"center start"},{default:a(()=>[l(te,null,{default:a(()=>[(x(!0),Y(Z,null,ee(h(R),k=>(x(),S(p,{key:k.value,clickable:""},{default:a(()=>[l(f,null,{default:a(()=>[l(B,null,{default:a(()=>[v(q(k.label),1)]),_:2},1024)]),_:2},1024),l(f,{side:""},{default:a(()=>[l(Me,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=le=>c.value=le),color:"primary",val:k.value},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),l(j,{dense:"",flat:"",icon:F.inFullscreen?"fullscreen_exit":"fullscreen",round:"",onClick:F.toggleFullscreen},{default:a(()=>[l(J,{disable:t.$q.platform.is.mobile},{default:a(()=>[v(q(F.inFullscreen?"Salir de Pantalla Completa":"Pantalla Completa"),1)]),_:2},1032,["disable"])]),_:2},1032,["icon","onClick"]),l(A,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=k=>y.value=k),class:"q-mr-xs",clearable:"",debounce:"300",dense:"",outlined:"",placeholder:"Buscar"},{append:a(()=>[l(T,{name:"search"})]),_:1},8,["modelValue"]),l(ge,{unelevated:""},{default:a(()=>[l(j,{color:"primary","icon-right":"archive",label:"Exportar a CSV",onClick:N})]),_:1})]),_:1},8,["filter","pagination","rows","visible-columns"])]}),_:1})])])]}),_:1}))}});export{bt as default};
