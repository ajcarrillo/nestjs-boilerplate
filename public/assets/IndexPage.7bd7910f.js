import{j as V,M as Q,r as x,c as S,p as C,k as q,l as e,d as t,X as _,u as p,w as M,_ as U,s as T,O as L}from"./index.33aee9c3.js";import{Q as h}from"./QInput.bc534865.js";import{Q as B,a as D}from"./QTable.71d6b359.js";import{T as $}from"./TablePage.1ebf5b06.js";import{Q as z,a as K}from"./QItem.3270a199.js";import{Q as j}from"./QList.1e036a38.js";import{Q as O}from"./QCardSection.2089956e.js";import{a as P}from"./QMenu.746f001c.js";import{Q as G}from"./QCardActions.ddbe4808.js";import{a as E,u as H}from"./BudgetResource.3a0abb0c.js";import{l as w}from"./layout.880d2741.js";import{u as R,a as I}from"./useQuery.esm.08e598e9.js";import{u as N}from"./useMutation.esm.5aff8292.js";import{c as k}from"./index.7adaf3a2.js";import{Q as X}from"./QForm.05da6a20.js";import{_ as J}from"./CardDialog.f8593b25.js";import"./use-key-composition.b1866cfc.js";import"./use-dark.a42b1db8.js";import"./focus-manager.387b0375.js";import"./QSelect.bc9b930f.js";import"./format.9dfa61a7.js";import"./scroll.5632c0ea.js";import"./QItemLabel.b3a0c01c.js";import"./QCheckbox.685522c0.js";import"./QCard.e44cba30.js";import"./QPage.6112cc6b.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./index.2cf0d985.js";import"./utils.esm.aa7cdc1a.js";import"./mutation.esm.9a94c1b8.js";import"./QSpace.3bc606e8.js";import"./MyCardTitle.c7481455.js";const W=async()=>{const{data:a}=await E.getActions();return a},Y=async a=>{const{data:o}=await E.storeAction(a);return o},Z=async a=>{const{id:o,name:l}=a,{data:r}=await E.updateAction(o,{name:l});return r},tt=()=>{const{isLoading:a,isError:o,data:l,error:r}=R({queryKey:["actions"],queryFn:W,staleTime:6e5});return{isLoading:a,isError:o,data:l,error:r}},at=()=>{const a=I();return{actionStoreMutations:N({mutationFn:Y,onSuccess:()=>{a.invalidateQueries({queryKey:["actions"]}),w.showSuccessNotification("Acci\xF3n creada con \xE9xito")},onError:()=>{w.showErrorNotification("Error al crear acci\xF3n")}})}},ot=()=>{const a=I();return{actionUpdateMutations:N({mutationFn:Z,onSuccess:()=>{a.invalidateQueries({queryKey:["actions"]}),w.showSuccessNotification("Acci\xF3n actualizada con \xE9xito")},onError:()=>{w.showErrorNotification("Error al actualizar acci\xF3n")}})}},et=V({__name:"ActionForm",props:{action:null},setup(a){const o=a,l=H(),{fetchActionDictionary:r}=l,{actionStoreMutations:v}=at(),{isLoading:s}=v,{actionUpdateMutations:f}=ot(),{isLoading:y}=f,b=Q({name:""}),u=Q(k(o.action||b)),g=x(),F={name:[m=>!!m||"El nombre es requerido"]},c=S(()=>o.action&&"id"in o.action);S(()=>c.value?"Editar acci\xF3n":"Agregar acci\xF3n");async function i(){var d,A;!await((d=g.value)==null?void 0:d.validate())||(c.value?(await f.mutateAsync(u),await n()):(await v.mutateAsync(u),u.name="",(A=g.value)==null||A.reset(),await n()))}async function n(){await r()}return(m,d)=>(C(),q(p(X),{ref_key:"actionForm",ref:g,class:"q-gutter-md"},{default:e(()=>[t(O,null,{default:e(()=>[t(j,null,{default:e(()=>[t(z,null,{default:e(()=>[t(K,null,{default:e(()=>[t(h,{modelValue:u.name,"onUpdate:modelValue":d[0]||(d[0]=A=>u.name=A),dense:"",label:"Nombre",outlined:"",rules:F.name},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),t(P),t(G,{align:"right"},{default:e(()=>[t(_,{color:"primary",label:"Guardar",loading:p(s)||p(y),onClick:i},null,8,["loading"])]),_:1})]),_:1},512))}}),nt={class:"q-gutter-sm"},Lt=V({__name:"IndexPage",setup(a){const{data:o,isLoading:l}=tt(),r=x(""),v=[{name:"id",field:"id",required:!0,label:"ID",sortable:!0,align:"left"},{name:"name",field:"name",label:"Nombre",sortable:!0,align:"left"},{name:"action",align:"center",label:"Acciones",field:"action",sortable:!1}],s=x(!1),f=x(-1);let y=Q({name:""});const b=Q({name:""}),u=S(()=>f.value===-1?"Nueva acci\xF3n":"Editar acci\xF3n");M(s,c=>{c||F()});function g(c){var m;const{name:i,id:n}=c;f.value=(m=o.value)==null?void 0:m.findIndex(d=>d.id===c.id),y=Object.assign({},{id:n,name:i}),s.value=!0}function F(){s.value=!1,L(()=>{y=k(b),f.value=-1})}return(c,i)=>(C(),q($,null,{"card-body":e(()=>[t(D,{columns:v,loading:p(l),rows:p(o),"rows-per-page-options":[20,30,40,50],title:"Acciones"},{"top-right":e(()=>[t(_,{class:"q-mr-xs",color:"primary",icon:"add",label:"Nueva Acci\xF3n",outline:"",onClick:i[0]||(i[0]=n=>s.value=!0)}),t(h,{modelValue:r.value,"onUpdate:modelValue":i[1]||(i[1]=n=>r.value=n),class:"q-mr-xs",debounce:"300",dense:"",outlined:"",placeholder:"Search"},{append:e(()=>[t(U,{name:"search"})]),_:1},8,["modelValue"]),t(_,{color:"primary","icon-right":"archive",label:"Exportar CSV","no-caps":""})]),"body-cell-action":e(n=>[t(B,{props:n},{default:e(()=>[T("div",nt,[t(_,{color:"primary",dense:"",flat:"",icon:"edit",rounded:"",size:"sm",onClick:m=>g(n.row)},null,8,["onClick"])])]),_:2},1032,["props"])]),_:1},8,["loading","rows"])]),footer:e(()=>[t(J,{modelValue:s.value,"onUpdate:modelValue":i[2]||(i[2]=n=>s.value=n),"card-title":p(u)},{default:e(()=>[t(et,{action:p(y)},null,8,["action"])]),_:1},8,["modelValue","card-title"])]),_:1}))}});export{Lt as default};
