import{v as G,r as x,c as P,w as J,z as oe,am as ne,aj as ie,h as A,R as Ve,g as Qe,x as Pe,a5 as Me,a0 as N,V as Ae,a_ as ke,j as X,X as Z,m as K,N as ge,p as S,k as B,l as a,d as t,q as T,t as D,u as k,b as Oe,s as M,aH as Ee,av as Be,a$ as je,ag as pe,F as ve,at as he,Z as W}from"./index.c5fc2f56.js";import{w as Fe,u as Ie,m as Ne,x as ue,y as Ue,f as $e,n as Le,g as Re,o as He,z as ze,A as Je,h as We,p as Ge,B as re,C as Xe,e as se,D as de,E as Ze,c as p,l as j,b as y,d as ce,a as ye,Q as Ke}from"./format.884958e1.js";import{g as Ye}from"./scroll.fe196b7a.js";import{g as et,h as tt,i as at,c as lt,j as ot,a as nt,b as it,f as E,e as ut,Q as rt,T as st}from"./QCardActions.80e0639a.js";import{Q as dt}from"./QPage.f5ac574f.js";import{b as ct}from"./useBudgets.c2a35b09.js";import{a as me,Q as mt}from"./QCard.756ff799.js";import{a as I,p as ft,l as fe,Q as bt}from"./layout.92ba84c8.js";import{u as gt}from"./app.1d87b8aa.js";import"./use-dark.bc45d8f2.js";import"./focus-manager.33224ae2.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./utils.esm.d017e65b.js";import"./index.2cf0d985.js";import"./ActionResource.827a12db.js";import"./LineResource.0b7b21ce.js";import"./AreaResource.bda9c94b.js";import"./ArticleResource.23f326fc.js";var be=G({name:"QTooltip",inheritAttrs:!1,props:{...Fe,...Ie,...Ne,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{default:"jump-down"},transitionHide:{default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:ue},self:{type:String,default:"top middle",validator:ue},offset:{type:Array,default:()=>[14,14],validator:Ue},scrollTarget:{default:void 0},delay:{type:Number,default:0},hideDelay:{type:Number,default:0}},emits:[...$e],setup(o,{slots:m,emit:s,attrs:d}){let c,r;const g=Qe(),{proxy:{$q:e}}=g,l=x(null),v=x(!1),V=P(()=>de(o.anchor,e.lang.rtl)),w=P(()=>de(o.self,e.lang.rtl)),C=P(()=>o.persistent!==!0),{registerTick:i,removeTick:h}=Le(),{registerTimeout:Q}=Re(),{transitionProps:U,transitionStyle:$}=He(o),{localScrollTarget:F,changeScrollEvent:L,unconfigureScrollTarget:b}=ze(o,ae),{anchorEl:n,canShow:u,anchorEvents:_}=Je({showing:v,configureAnchorEl:qe}),{show:R,hide:H}=We({showing:v,canShow:u,handleShow:xe,handleHide:we,hideOnRouteChange:C,processOnMount:!0});Object.assign(_,{delayShow:Ce,delayHide:Te});const{showPortal:Y,hidePortal:ee,renderPortal:_e}=Ge(g,l,De,"tooltip");if(e.platform.is.mobile===!0){const f={anchorEl:n,innerRef:l,onClickOutside(q){return H(q),q.target.classList.contains("q-dialog__backdrop")&&Me(q),!0}},z=P(()=>o.modelValue===null&&o.persistent!==!0&&v.value===!0);J(z,q=>{(q===!0?Ze:re)(f)}),oe(()=>{re(f)})}function xe(f){Y(),i(()=>{r=new MutationObserver(()=>O()),r.observe(l.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),O(),ae()}),c===void 0&&(c=J(()=>e.screen.width+"|"+e.screen.height+"|"+o.self+"|"+o.anchor+"|"+e.lang.rtl,O)),Q(()=>{Y(!0),s("show",f)},o.transitionDuration)}function we(f){h(),ee(),te(),Q(()=>{ee(!0),s("hide",f)},o.transitionDuration)}function te(){r!==void 0&&(r.disconnect(),r=void 0),c!==void 0&&(c(),c=void 0),b(),ne(_,"tooltipTemp")}function O(){const f=l.value;n.value===null||!f||Xe({el:f,offset:o.offset,anchorEl:n.value,anchorOrigin:V.value,selfOrigin:w.value,maxHeight:o.maxHeight,maxWidth:o.maxWidth})}function Ce(f){if(e.platform.is.mobile===!0){se(),document.body.classList.add("non-selectable");const z=n.value,q=["touchmove","touchcancel","touchend","click"].map(le=>[z,le,"delayHide","passiveCapture"]);ie(_,"tooltipTemp",q)}Q(()=>{R(f)},o.delay)}function Te(f){e.platform.is.mobile===!0&&(ne(_,"tooltipTemp"),se(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),Q(()=>{H(f)},o.hideDelay)}function qe(){if(o.noParentEvent===!0||n.value===null)return;const f=e.platform.is.mobile===!0?[[n.value,"touchstart","delayShow","passive"]]:[[n.value,"mouseenter","delayShow","passive"],[n.value,"mouseleave","delayHide","passive"]];ie(_,"anchor",f)}function ae(){if(n.value!==null||o.scrollTarget!==void 0){F.value=Ye(n.value,o.scrollTarget);const f=o.noParentEvent===!0?O:H;L(F.value,f)}}function Se(){return v.value===!0?A("div",{...d,ref:l,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",d.class],style:[d.style,$.value],role:"tooltip"},Pe(m.default)):null}function De(){return A(Ve,U.value,Se)}return oe(te),Object.assign(g.proxy,{updatePosition:O}),_e}}),pt=G({name:"QToggle",props:{...et,icon:String,iconColor:String},emits:tt,setup(o){function m(s,d){const c=P(()=>(s.value===!0?o.checkedIcon:d.value===!0?o.indeterminateIcon:o.uncheckedIcon)||o.icon),r=P(()=>s.value===!0?o.iconColor:null);return()=>[A("div",{class:"q-toggle__track"}),A("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},c.value!==void 0?[A(N,{name:c.value,color:r.value})]:void 0)]}return at("toggle",m)}});const vt=A("div",{class:"q-space"});var ht=G({name:"QSpace",setup(){return()=>vt}});const yt=()=>{const o=gt(),{actionDictionary:m,lineDictionary:s,areaDictionary:d,articleDictionary:c}=Ae(o),{getArticleByName:r}=o;return{actionDictionary:m,lineDictionary:s,areaDictionary:d,articleDictionary:c,getArticleByName:r}},_t=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],xt=(o,m=0,s=!1)=>{let d;return(...c)=>{s&&!d&&o(...c),clearTimeout(d),d=setTimeout(()=>{o(...c)},m)}},wt=(o,m,s)=>{const d=x(o);return ke((c,r)=>({get(){return c(),d.value},set:xt(g=>{d.value=g,r()},m,s)}))},Ct={class:"self-center full-width no-outline",tabindex:"0"},Tt=X({__name:"MonthBudgetForm",props:{month:null,budgetMonth:{default:()=>({quantity:0})},estimatedAmount:{default:0}},emits:["update:quantity"],setup(o,{emit:m}){const s=o;Z();const d=K(),{id:c}=d.params,r=ge(lt(s.budgetMonth)),g=wt(r.quantity||0,250,!1);return J(g,e=>{e>0&&(r.quantity=e,r.month=s.month,r.budget_detail_id=c,m("update:quantity",r))}),(e,l)=>(S(),B(y,null,{default:a(()=>[t(p,null,{default:a(()=>[t(j,{overline:""},{default:a(()=>[T(D(o.month),1)]),_:1}),t(I,{modelValue:k(g),"onUpdate:modelValue":l[0]||(l[0]=v=>Oe(g)?g.value=v:null),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Cantidad",outlined:"",type:"number"},null,8,["modelValue"])]),_:1}),t(p,{side:""},{default:a(()=>[t(j,{overline:""},{default:a(()=>[T("\xA0\xA0\xA0")]),_:1}),t(ot,{dense:"",label:"Total",outlined:"","stack-label":""},{control:a(()=>[M("div",Ct,D(r.quantity*s.estimatedAmount),1)]),prepend:a(()=>[t(N,{name:"o_attach_money"})]),_:1})]),_:1})]),_:1}))}});var qt={storeDetail(o,m){return ft.post(`/budgets/${o}/budget-details`,m)}};const St=async({budgetId:o,budgetDetail:m})=>{const{data:s}=await qt.storeDetail(o,m);return s},Dt=()=>{const o=nt();return{storeBudgetDetailMutation:it({mutationFn:s=>St(s),onSuccess:async(s,d)=>{await o.invalidateQueries(["budget",d.budgetId]),fe.showSuccessNotification("El bien se agreg\xF3 al presupuesto con \xE9xito")},onError:()=>{fe.showErrorNotification("Error al agregar el bien al presupuesto")}})}},Vt=M("div",{class:"tw-text-xl"},"Agregar bien",-1),Qt=X({__name:"BudgetDetailForm",setup(o){Z();const m=K(),{id:s}=m.params,{actionDictionary:d,lineDictionary:c,areaDictionary:r,getArticleByName:g}=yt(),{storeBudgetDetailMutation:e}=Dt(),{isLoading:l}=e,v=x(d.value),V=x(c.value),w=x(r.value),C=x([]),i=ge({action:null,line:null,area:null,article:null,estimated_amount:0,justification:"",month:[],total:0,budgetMonths:[]}),h=x([]);Ee(()=>{if(h.value.length>0){const b=h.value.reduce((n,u)=>n+u.quantity,0);i.total=b*i.estimated_amount}});function Q(b,n,u){n(()=>{const _=b.toLowerCase();w.value=r.value.filter(R=>R.label.toLowerCase().indexOf(_)>-1)})}function U(b,n,u){if(b.length<2){u();return}n(()=>{const _=b.toLowerCase();C.value=g(_).value})}function $(b){const n=h.value.findIndex(u=>u.month===b.month);n>-1?h.value[n]=b:h.value.push(b)}function F({value:b}){h.value=h.value.filter(n=>n.month!==b)}async function L(){i.budgetMonths=h.value,await e.mutateAsync({budgetId:s,budgetDetail:i}),i.action=null,i.line=null,i.area=null,i.article=null,i.estimated_amount=0,i.justification="",i.month=[],i.total=0,i.budgetMonths=[],h.value=[]}return(b,n)=>(S(),B(mt,null,{default:a(()=>[t(me,null,{default:a(()=>[Vt]),_:1}),t(ce),t(me,{class:"tw-px-0"},{default:a(()=>[t(bt,null,{default:a(()=>[t(ye,null,{default:a(()=>[t(y,null,{default:a(()=>[t(p,null,{default:a(()=>[t(E,{modelValue:i.action,"onUpdate:modelValue":n[0]||(n[0]=u=>i.action=u),dense:"",label:"ACC",options:v.value,outlined:""},null,8,["modelValue","options"])]),_:1})]),_:1}),t(y,null,{default:a(()=>[t(p,null,{default:a(()=>[t(E,{modelValue:i.line,"onUpdate:modelValue":n[1]||(n[1]=u=>i.line=u),dense:"",label:"Partida",options:V.value,outlined:""},null,8,["modelValue","options"])]),_:1})]),_:1}),t(y,null,{default:a(()=>[t(p,null,{default:a(()=>[t(E,{modelValue:i.area,"onUpdate:modelValue":n[2]||(n[2]=u=>i.area=u),dense:"",label:"\xC1rea",options:w.value,outlined:"","use-input":"",onFilter:Q},null,8,["modelValue","options"])]),_:1})]),_:1}),t(y,null,{default:a(()=>[t(p,null,{default:a(()=>[t(E,{modelValue:i.article,"onUpdate:modelValue":n[3]||(n[3]=u=>i.article=u),dense:"",hint:"M\xEDnimo 2 caracteres para activar el filtrado",label:"Art\xEDculos",options:C.value,outlined:"","use-input":"",onFilter:U},{option:a(u=>[t(y,Be(je(u.itemProps)),{default:a(()=>[t(p,null,{default:a(()=>[t(j,null,{default:a(()=>[T(D(u.opt.label),1)]),_:2},1024),t(j,{caption:""},{default:a(()=>[T(D(u.opt.caption),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options"])]),_:1})]),_:1}),t(y,null,{default:a(()=>[t(p,null,{default:a(()=>[t(I,{modelValue:i.justification,"onUpdate:modelValue":n[4]||(n[4]=u=>i.justification=u),dense:"",label:"Justificaci\xF3n",outlined:"",type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1}),t(y,null,{default:a(()=>[t(p,null,{default:a(()=>[t(I,{modelValue:i.estimated_amount,"onUpdate:modelValue":n[5]||(n[5]=u=>i.estimated_amount=u),modelModifiers:{number:!0},dense:"","input-class":"tw-text-right",label:"Monto estimado",outlined:"",type:"number"},{prepend:a(()=>[t(N,{name:"o_attach_money"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(y,null,{default:a(()=>[t(p,null,{default:a(()=>[t(E,{modelValue:i.month,"onUpdate:modelValue":n[6]||(n[6]=u=>i.month=u),dense:"",label:"Mes",multiple:"",options:k(_t),outlined:"","use-chips":"",onRemove:F},null,8,["modelValue","options"])]),_:1})]),_:1}),(S(!0),pe(ve,null,he(i.month,u=>(S(),B(Tt,{key:u,"estimated-amount":i.estimated_amount,month:u,"onUpdate:quantity":$},null,8,["estimated-amount","month"]))),128)),t(y,null,{default:a(()=>[t(p,null,{default:a(()=>[t(I,{modelValue:i.total,"onUpdate:modelValue":n[7]||(n[7]=u=>i.total=u),dense:"","input-class":"tw-text-right",label:"Total",outlined:"",readonly:"",type:"number"},{prepend:a(()=>[t(N,{name:"o_attach_money"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(ce),t(ut,null,{default:a(()=>[t(ht),t(W,{color:"primary",icon:"o_save",loading:k(l),unelevated:"",onClick:L},{default:a(()=>[T(" guardar ")]),_:1},8,["loading"])]),_:1})]),_:1}))}}),Pt={class:"q-my-xs q-pt-sm q-ml-md tw-text-2xl tw-font-bold tw-text-slate-700"},Mt={class:"row"},At={class:"col col-md-3 q-pa-sm"},kt={class:"col"},Kt=X({__name:"DetailPage",setup(o){Z();const m=K(),{id:s}=m.params,{budget:d}=ct(s),c=[{name:"id",field:"id",required:!0,label:"ID",sortable:!0,align:"left"},{name:"action",field:e=>e.action.name,label:"Acci\xF3n",sortable:!0,align:"left"},{name:"line",field:e=>e.line.name,label:"Partida",sortable:!0,align:"left"},{name:"department",field:e=>e.department.alias,label:"\xC1rea",sortable:!0,align:"left"},{name:"article",field:e=>e.article.name,label:"Bien",sortable:!0,align:"left"},{name:"article_description",field:e=>e.article.description,label:"Descripci\xF3n del bien",sortable:!0,align:"left"},{name:"justification",field:"justification",label:"Justificaci\xF3n",sortable:!0,align:"left"},{name:"enero",field:e=>{var l;return(l=e.enero)==null?void 0:l.quantity},label:"Enero",sortable:!0,align:"right"},{name:"febrero",field:e=>{var l;return(l=e.febrero)==null?void 0:l.quantity},label:"Febrero",sortable:!0,align:"right"},{name:"marzo",field:e=>{var l;return(l=e.marzo)==null?void 0:l.quantity},label:"Marzo",sortable:!0,align:"right"},{name:"abril",field:e=>{var l;return(l=e.abril)==null?void 0:l.quantity},label:"Abril",sortable:!0,align:"right"},{name:"mayo",field:e=>{var l;return(l=e.mayo)==null?void 0:l.quantity},label:"Mayo",sortable:!0,align:"right"},{name:"junio",field:e=>{var l;return(l=e.junio)==null?void 0:l.quantity},label:"Junio",sortable:!0,align:"right"},{name:"julio",field:e=>{var l;return(l=e.julio)==null?void 0:l.quantity},label:"Julio",sortable:!0,align:"right"},{name:"agosto",field:e=>{var l;return(l=e.agosto)==null?void 0:l.quantity},label:"Agosto",sortable:!0,align:"right"},{name:"septiembre",field:e=>{var l;return(l=e.septiembre)==null?void 0:l.quantity},label:"Septiembre",sortable:!0,align:"right"},{name:"octubre",field:e=>{var l;return(l=e.octubre)==null?void 0:l.quantity},label:"Octubre",sortable:!0,align:"right"},{name:"noviembre",field:e=>{var l;return(l=e.noviembre)==null?void 0:l.quantity},label:"Noviembre",sortable:!0,align:"right"},{name:"diciembre",field:e=>{var l;return(l=e.diciembre)==null?void 0:l.quantity},label:"Diciembre",sortable:!0,align:"right"},{name:"estimated_amount",field:e=>`$ ${e.estimated_amount}`,label:"Precio",sortable:!0,align:"right"},{name:"total",field:e=>`$ ${e.total}`,label:"Total",sortable:!0,align:"right"}],r=x(["action","line","department","article","estimated_amount","enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre","total"]),g=c.map(e=>({label:e.label,value:e.name}));return(e,l)=>(S(),B(dt,null,{default:a(()=>{var v;return[M("h5",Pt,"Presupuesto "+D((v=k(d))==null?void 0:v.year),1),M("div",Mt,[M("div",At,[t(Qt)]),M("div",kt,[t(st,null,{"card-body":a(()=>{var V;return[t(rt,{columns:c,rows:((V=k(d))==null?void 0:V.details)||[],title:"Detalle","visible-columns":r.value},{"top-right":a(w=>[t(W,{class:"tw-mr-2",color:"primary","fab-mini":"",flat:"",icon:"tune",size:"sm"},{default:a(()=>[t(be,null,{default:a(()=>[T(" Mostrar/Ocultar columnas ")]),_:1}),t(Ke,{anchor:"top end",self:"center start"},{default:a(()=>[t(ye,null,{default:a(()=>[(S(!0),pe(ve,null,he(k(g),C=>(S(),B(y,{key:C.value,clickable:""},{default:a(()=>[t(p,null,{default:a(()=>[t(j,null,{default:a(()=>[T(D(C.label),1)]),_:2},1024)]),_:2},1024),t(p,{side:""},{default:a(()=>[t(pt,{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=i=>r.value=i),color:"primary",val:C.value},null,8,["modelValue","val"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(W,{dense:"",flat:"",icon:w.inFullscreen?"fullscreen_exit":"fullscreen",round:"",onClick:w.toggleFullscreen},{default:a(()=>[t(be,{disable:e.$q.platform.is.mobile},{default:a(()=>[T(D(w.inFullscreen?"Salir de Pantalla Completa":"Pantalla Completa"),1)]),_:2},1032,["disable"])]),_:2},1032,["icon","onClick"])]),_:1},8,["rows","visible-columns"])]}),_:1})])])]}),_:1}))}});export{Kt as default};
