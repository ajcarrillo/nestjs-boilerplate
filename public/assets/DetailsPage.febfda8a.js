import{Q as N}from"./QSkeleton.2c499c18.js";import{a as m,Q as g}from"./QItem.3270a199.js";import{Q as P}from"./QList.1e036a38.js";import{m as U,j as O,r as F,c as R,p as A,k as v,l as n,d as a,q as y,t as I,s,u as r,b3 as q,ae as E,F as h,ai as w,X as k}from"./index.33aee9c3.js";import{Q as _}from"./QItemLabel.b3a0c01c.js";import{Q as Y}from"./QInput.bc534865.js";import{l as D}from"./layout.880d2741.js";import{A as x}from"./AreaAllocationResource.73bcf67b.js";import{u as G,a as Q}from"./useQuery.esm.08e598e9.js";import{u as L}from"./useMutation.esm.5aff8292.js";import{b as K}from"./useBudgetCaps.13ba3481.js";import{u as V}from"./useMoney.dbc60660.js";import"./use-dark.a42b1db8.js";import"./use-key-composition.b1866cfc.js";import"./focus-manager.387b0375.js";import"./BudgetResource.3a0abb0c.js";import"./index.2cf0d985.js";import"./utils.esm.aa7cdc1a.js";import"./mutation.esm.9a94c1b8.js";const $=async()=>{const{data:e}=await x.getAreaAllocations();return e},H=async e=>{const{data:t}=await x.storeAreaAllocation(e);return t},X=async({uuid:e,draft:t})=>{const{data:o}=await x.updateAreaAllocation(e,t);return o},j=()=>{const{isLoading:e,isError:t,data:o,error:c}=G({queryKey:["area-allocations"],queryFn:$,staleTime:6e5});return{isLoading:e,isError:t,data:o,error:c}},z=()=>{const e=Q();return{areaAllocationStoreMutations:L({mutationFn:H,onSuccess:()=>{e.invalidateQueries({queryKey:["area-allocations"]}),D.showSuccessNotification("Area Allocation created successfully")},onError:()=>{D.showErrorNotification("Error creating Area Allocation")}})}},J=()=>{const e=Q();return{areaAllocationUpdateMutations:L({mutationFn:X,onSuccess:()=>{e.invalidateQueries({queryKey:["area-allocations"]}),D.showSuccessNotification("Area Allocation updated successfully")},onError:()=>{D.showErrorNotification("Error updating Area Allocation")}})}};function B(){const t=U().params.id,{budgetCap:o,fetchingBudgetCap:c}=K(t);return{budgetCap:o,fetchingBudgetCap:c,budgetCapUuid:t}}const W={class:"row tw-gap-4"},Z={class:"row q-gutter-sm"},tt=O({__name:"AreaAllocationItem",props:{area:null,allocation:null},setup(e){var f,C;const t=e,o=U(),{currencyFormat:c}=V(),{areaAllocationStoreMutations:d}=z(),{isLoading:l}=d;B();const{areaAllocationUpdateMutations:S}=J(),b=o.params.id,i=F((C=(f=t.allocation)==null?void 0:f.totalAmount)!=null?C:0),u=async()=>{t.allocation?await S.mutateAsync({uuid:t.allocation.uuid,draft:{totalAmount:+i.value}}):await d.mutateAsync({areaId:t.area.id,budgetCapId:b,totalAmount:i.value})},p=R(()=>t.allocation?c(t.allocation.totalAmount):0);return(dt,M)=>(A(),v(g,null,{default:n(()=>[a(m,null,{default:n(()=>[a(_,null,{default:n(()=>[y(I(e.area.description),1)]),_:1})]),_:1}),a(m,null,{default:n(()=>[s("div",W,[a(_,{caption:"",class:"tw-text-green-600 tw-font-bold"},{default:n(()=>[y(" ASIGNADO: "+I(r(p)),1)]),_:1})])]),_:1}),a(m,{side:""},{default:n(()=>[s("div",Z,[a(Y,{modelValue:i.value,"onUpdate:modelValue":M[0]||(M[0]=T=>i.value=T),modelModifiers:{number:!0},dense:"",disable:r(l),"input-class":"text-right",label:"Monto",outlined:"",prefix:"$",rules:[T=>T>=0||"El monto debe ser mayor o igual a 0"],type:"number",onKeyup:q(u,["enter"])},null,8,["modelValue","disable","rules","onKeyup"])])]),_:1})]),_:1}))}}),et={class:"q-mt-md"},at=O({__name:"AreaAllocationForm",props:{areas:null,allocations:null},setup(e){const t=e,o=()=>{console.log("Saving allocations",t.allocations)};return(c,d)=>(A(),E("div",null,[a(P,{bordered:"",separator:""},{default:n(()=>[(A(!0),E(h,null,w(e.areas,l=>(A(),v(tt,{key:l.id,allocation:e.allocations[l.id],area:l},null,8,["allocation","area"]))),128))]),_:1}),s("div",et,[a(k,{color:"primary",label:"Guardar",onClick:o})])]))}}),ot={class:"q-pa-md"},it=s("div",{class:"text-h4"},"Asignaci\xF3n de \xC1reas",-1),nt={class:"column q-mb-md tw-font-semibold tw-text-gray-700"},rt={key:0},st={key:1},ct={class:"row q-gutter-sm"},_t=O({__name:"DetailsPage",setup(e){const t=[{id:"b3453d23-881e-4297-a558-17754e85f5a8",description:"DIRECCI\xD3N"},{id:"6da35253-9064-4ea0-8edf-4f9a46096725",description:"SUBDIRECCI\xD3N SERVICIOS ADMINISTRATIVOS"},{id:"b6c06fff-a191-42ff-9591-faf5510f6859",description:"CENTRO DE C\xD3MPUTO"},{id:"434f35e2-52f9-4d9a-a74b-2ba5e5bdddbd",description:"DEPARTAMENTO RECURSOS MATERIALES Y SERVICIOS"},{id:"a1397ced-fcf4-4177-af9c-5ae21e927457",description:"DEPARTAMENTO MANTENIMIENTO DE EQUIPO"},{id:"57af26e5-5f34-4e85-be71-8ae4c4035336",description:"DEPARTAMENTO RECURSOS FINANCIEROS"},{id:"54ce39a9-1a09-4428-bab1-cc4c28e5f320",description:"DEPARTAMENTO RECURSOS HUMANOS"},{id:"78f34080-7c74-45d2-bdfd-9c2add3d5e79",description:"SUBDIRECCI\xD3N PLANEACI\xD3N Y VINCULACI\xD3N"},{id:"71e76bf8-a72e-4d29-8ef7-752d2b020441",description:"DEPARTAMENTO GESTI\xD3N TECNOL\xD3GICA Y VINCULACI\xD3N"},{id:"ddde132c-b411-4ced-85b4-50e806119d01",description:"DEPARTAMENTO SERVICIOS ESCOLARES"},{id:"1a5e777b-4ffc-43f0-8616-e23f110f717f",description:"DEPARTAMENTO ACTIVIDADES EXTRAESCOLARES"},{id:"5755c321-818a-4e2f-8e5c-f65f8706ec11",description:"DEPARTAMENTO PLANEACI\xD3N, PROGRAMACI\xD3N Y PRESUPUESTACI\xD3N"},{id:"6df96c83-0c1e-4b35-b714-3e367922a64f",description:"DEPARTAMENTO COMUNICACI\xD3N Y DIFUSI\xD3N"},{id:"4eea91ac-6e24-459f-8b20-00165c3e11fd",description:"CENTRO DE INFORMACI\xD3N"},{id:"6584936d-796c-4dac-bdd3-9c85f25788fc",description:"SUBDIRECCI\xD3N ACAD\xC9MICA"},{id:"ead7cf2f-aa1e-41f0-8c3b-0cf0fdd5ae86",description:"DEPARTAMENTO DESARROLLO ACAD\xC9MICO"},{id:"fda5867f-bccf-42e2-8c2a-b813f4fc9b92",description:"DEPARTAMENTO CIENCIAS DE LA TIERRA"},{id:"d447c48f-1d5f-4fca-b50f-1d561f6f169a",description:"DEPARTAMENTO CIENCIAS B\xC1SICAS"},{id:"6df0ec78-9355-4baa-9c4f-9086a11568b1",description:"DEPARTAMENTO SISTEMAS Y COMPUTACI\xD3N"},{id:"6d7c27ae-8d28-4316-86de-aa8080882a94",description:"DEPARTAMENTO EL\xC9CTRICA Y ELECTR\xD3NICA"},{id:"06695acb-6247-478d-b98f-7620bd027bba",description:"DEPARTAMENTO CIENCIAS ECON\xD3MICO - ADMINISTRATIVAS"},{id:"cc2a8e57-fdc5-406e-9087-b09e4f8df76d",description:"DEPARTAMENTO QU\xCDMICA Y BIOQU\xCDMICA"},{id:"56d761db-bb6a-47d4-9f56-0f5b9e016a9f",description:"DIVISI\xD3N ESTUDIOS POSGRADO E INVESTIGACI\xD3N"},{id:"4466cb99-d379-4f6e-b418-30964c3cab74",description:"DIVISI\xD3N DE ESTUDIOS PROFESIONALES"}],{data:o,isLoading:c}=j(),{budgetCap:d}=B(),{currencyFormat:l}=V(),S=R(()=>o.value?o.value.reduce((i,u)=>(i[u.areaId]=u,i),{}):{}),b=R(()=>{var i,u;return d?((i=d.value)!=null&&i.totalAmount,(u=o.value)==null?void 0:u.reduce((p,f)=>p+f.totalAmount,0)):0});return(i,u)=>{var p,f;return A(),E("div",ot,[it,s("div",nt,[s("div",null,"Presupuesto: "+I((p=r(d))==null?void 0:p.budget.year),1),s("div",null,"Techo Presupuestal: "+I(r(l)((f=r(d))==null?void 0:f.totalAmount)),1),s("div",null,"Acumulado: "+I(r(l)(r(b)||0)),1)]),r(c)?(A(),E("div",st,[a(P,{bordered:"",separator:""},{default:n(()=>[(A(),E(h,null,w(24,C=>a(g,{key:C},{default:n(()=>[a(m,null,{default:n(()=>[a(N,{type:"text",width:"150px"}),a(N,{class:"q-mt-sm",type:"text",width:"100px"})]),_:1}),a(m,{side:""},{default:n(()=>[s("div",ct,[a(N,{type:"QInput",width:"100px"}),a(N,{type:"QInput",width:"100px"})])]),_:1})]),_:2},1024)),64))]),_:1})])):(A(),E("div",rt,[a(at,{allocations:r(S),areas:t},null,8,["allocations"])]))])}}});export{_t as default};
